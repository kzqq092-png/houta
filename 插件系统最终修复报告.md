# æ’ä»¶ç³»ç»Ÿæœ€ç»ˆä¿®å¤æŠ¥å‘Š

## é—®é¢˜æ¦‚è¿°

ç”¨æˆ·æŠ¥å‘Šäº†ä¸€ä¸ªå…³é”®çš„ç³»ç»Ÿé”™è¯¯ï¼š
```
TETDataPipeline - ERROR - æ‰€æœ‰æ•°æ®æºéƒ½å¤±è´¥: æ•°æ®æå–å¤±è´¥: æ²¡æœ‰å¯ç”¨çš„æ•°æ®æº
```

ç³»ç»Ÿæ— æ³•è¯†åˆ«å’Œæ³¨å†Œæ•°æ®æºæ’ä»¶ï¼Œå¯¼è‡´TETæ•°æ®ç®¡é“æ— æ³•è·å–æ¿å—èµ„é‡‘æµæ•°æ®ã€‚

## æ ¹æœ¬åŸå› åˆ†æ

ç»è¿‡æ·±å…¥è°ƒè¯•ï¼Œå‘ç°äº†ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

### 1. æœåŠ¡æ³¨å†Œé¡ºåºé—®é¢˜
- `UnifiedDataManager` åœ¨åˆå§‹åŒ–æ—¶å°è¯•è¿›è¡Œæ’ä»¶å‘ç°ï¼Œä½†æ­¤æ—¶ `PluginManager` å°šæœªæ³¨å†Œ
- å¯¼è‡´æ’ä»¶å‘ç°å¤±è´¥ï¼Œæ•°æ®æºè·¯ç”±å™¨ä¸­æ²¡æœ‰å¯ç”¨çš„æ•°æ®æº

### 2. æ’ä»¶å¯¼å…¥é”™è¯¯
- å¤šä¸ªæ’ä»¶æ–‡ä»¶å­˜åœ¨è¯­æ³•é”™è¯¯å’Œä¸å®Œæ•´çš„å¯¼å…¥è¯­å¥
- ç¼ºå°‘å¿…è¦çš„æ•°æ®æ¨¡å‹å¯¼å…¥ï¼ˆå¦‚ `MarketData`, `KlineData` ç­‰ï¼‰

### 3. PluginInfoæ ¼å¼é—®é¢˜
- éƒ¨åˆ†æ’ä»¶çš„ `PluginInfo` ç¼ºå°‘å¿…éœ€çš„ `capabilities` å‚æ•°
- å¯¼è‡´æ’ä»¶åŠ è½½å¤±è´¥

### 4. æ•°æ®æºæ’ä»¶æ³¨å†Œæœºåˆ¶é—®é¢˜
- `PluginManager` ä¸­çš„æ•°æ®æºæ’ä»¶æ³¨å†Œé€»è¾‘æœ‰ç¼ºé™·
- æ’ä»¶å®ä¾‹è·å–æ–¹å¼ä¸æ­£ç¡®

## ä¿®å¤æ–¹æ¡ˆ

### 1. æœåŠ¡å¼•å¯¼é¡ºåºä¼˜åŒ–

**æ–‡ä»¶**: `core/services/service_bootstrap.py`

**ä¿®æ”¹å†…å®¹**:
- è°ƒæ•´æœåŠ¡æ³¨å†Œé¡ºåºï¼Œç¡®ä¿ `UnifiedDataManager` åœ¨ `PluginManager` ä¹‹å‰æ³¨å†Œ
- æ·»åŠ å»¶è¿Ÿæ’ä»¶å‘ç°æœºåˆ¶ `_post_initialization_plugin_discovery()`
- åœ¨æ‰€æœ‰æœåŠ¡æ³¨å†Œå®Œæˆåç»Ÿä¸€æ‰§è¡Œæ’ä»¶å‘ç°

**å…³é”®ä»£ç **:
```python
def bootstrap(self) -> bool:
    try:
        # 1. æ³¨å†Œæ ¸å¿ƒæœåŠ¡
        self._register_core_services()
        # 2. æ³¨å†Œä¸šåŠ¡æœåŠ¡ï¼ˆåŒ…å«UnifiedDataManagerï¼‰
        self._register_business_services()
        # 3. æ³¨å†Œæ’ä»¶æœåŠ¡ï¼ˆåœ¨UnifiedDataManagerä¹‹åï¼‰
        self._register_plugin_services()
        # 4. æ³¨å†Œäº¤æ˜“æœåŠ¡
        self._register_trading_service()
        # 5. æ³¨å†Œç›‘æ§æœåŠ¡
        self._register_monitoring_services()
        # 6. æ‰§è¡Œæ’ä»¶å‘ç°å’Œæ³¨å†Œï¼ˆåœ¨æ‰€æœ‰æœåŠ¡æ³¨å†Œå®Œæˆåï¼‰
        self._post_initialization_plugin_discovery()
        return True
    except Exception as e:
        logger.error(f"æœåŠ¡å¼•å¯¼å¤±è´¥: {e}")
        return False
```

### 2. ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨ä¼˜åŒ–

**æ–‡ä»¶**: `core/services/unified_data_manager.py`

**ä¿®æ”¹å†…å®¹**:
- ç§»é™¤åˆå§‹åŒ–æ—¶çš„ç«‹å³æ’ä»¶å‘ç°
- æ·»åŠ å…¬å…±æ–¹æ³• `discover_and_register_data_source_plugins()`
- æ‰©å±•æ‰‹åŠ¨æ’ä»¶æ³¨å†Œï¼Œæ”¯æŒ18ç§ä¸åŒçš„æ•°æ®æºæ’ä»¶
- ä¸ºAkShareæ’ä»¶æ·»åŠ æ¿å—èµ„é‡‘æµæ”¯æŒ

**å…³é”®åŠŸèƒ½**:
```python
def discover_and_register_data_source_plugins(self) -> None:
    """
    å‘ç°å’Œæ³¨å†Œæ•°æ®æºæ’ä»¶
    åœ¨æœåŠ¡å¼•å¯¼å®Œæˆåè°ƒç”¨ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–æœåŠ¡éƒ½å·²å¯ç”¨
    """
    # 1. å°è¯•è‡ªåŠ¨å‘ç°
    self._auto_discover_data_source_plugins()
    
    # 2. æ‰‹åŠ¨æ³¨å†Œæ ¸å¿ƒæ’ä»¶ä½œä¸ºåå¤‡
    if not self._plugins_discovered:
        self._manual_register_core_plugins()
```

### 3. æ’ä»¶ç®¡ç†å™¨å¢å¼º

**æ–‡ä»¶**: `core/plugin_manager.py`

**ä¿®æ”¹å†…å®¹**:
- æ·»åŠ  `discover_and_register_plugins()` æ–¹æ³•
- ä¿®å¤æ•°æ®æºæ’ä»¶æ³¨å†Œé€»è¾‘
- æ·»åŠ  `_is_data_source_plugin_instance()` æ–¹æ³•
- æ­£ç¡®ä» `plugin_instances` è·å–æ’ä»¶å®ä¾‹

**å…³é”®ä¿®å¤**:
```python
def _register_data_source_plugins_to_manager(self) -> None:
    """å°†æ•°æ®æºæ’ä»¶æ³¨å†Œåˆ°ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨"""
    for plugin_name, plugin_info in self.enhanced_plugins.items():
        # ä»plugin_instancesä¸­è·å–æ’ä»¶å®ä¾‹
        plugin_instance = self.plugin_instances.get(plugin_name)
        
        if plugin_instance and self._is_data_source_plugin_instance(plugin_instance):
            success = self.data_manager.register_data_source_plugin(
                plugin_name, plugin_instance, priority=50, weight=1.0
            )
```

### 4. AkShareæ’ä»¶æ‰©å±•

**æ–‡ä»¶**: `plugins/examples/akshare_stock_plugin.py`

**ä¿®æ”¹å†…å®¹**:
- æ·»åŠ  `DataType.SECTOR_FUND_FLOW` æ”¯æŒ
- å®ç° `get_sector_fund_flow_data()` æ–¹æ³•
- å®Œå–„æ’ä»¶ä¿¡æ¯å’Œèƒ½åŠ›æè¿°

**æ–°å¢æ–¹æ³•**:
```python
def get_sector_fund_flow_data(self, symbol: str = "sector", **kwargs) -> pd.DataFrame:
    """è·å–æ¿å—èµ„é‡‘æµæ•°æ®"""
    try:
        indicator = kwargs.get('indicator', 'ä»Šæ—¥')
        if symbol == "sector" or symbol is None:
            df = ak.stock_sector_fund_flow_rank(indicator=indicator)
        else:
            df = ak.stock_sector_fund_flow_summary(symbol=symbol, indicator=indicator)
        # æ•°æ®å¤„ç†å’Œæ ‡å‡†åŒ–...
        return df
    except Exception as e:
        self.logger.error(f"è·å–æ¿å—èµ„é‡‘æµæ•°æ®å¤±è´¥: {e}")
        return pd.DataFrame()
```

### 5. TETæ•°æ®ç®¡é“æ”¯æŒ

**æ–‡ä»¶**: `core/tet_data_pipeline.py`

**ä¿®æ”¹å†…å®¹**:
- åœ¨ `_extract_from_source()` æ–¹æ³•ä¸­æ·»åŠ å¯¹ `SECTOR_FUND_FLOW` çš„å¤„ç†
- æ”¯æŒè°ƒç”¨æ’ä»¶çš„ `get_sector_fund_flow_data` æ–¹æ³•

### 6. æ‰¹é‡æ’ä»¶ä¿®å¤

ä¿®å¤äº†ä»¥ä¸‹æ’ä»¶æ–‡ä»¶çš„å¯¼å…¥å’Œæ ¼å¼é—®é¢˜ï¼š

**æ•°æ®æºæ’ä»¶**:
- `binance_crypto_plugin.py` - æ·»åŠ ç¼ºå¤±çš„å¯¼å…¥
- `bond_data_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `coinbase_crypto_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `ctp_futures_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `custom_data_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `forex_data_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `futures_data_plugin.py` - ä¿®å¤ä¸¥é‡çš„è¯­æ³•é”™è¯¯
- `huobi_crypto_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `mysteel_data_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `okx_crypto_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `wenhua_data_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `wind_data_plugin.py` - ä¿®å¤å¯¼å…¥å’Œæ·»åŠ capabilities
- `yahoo_finance_datasource.py` - ä¿®å¤å¯¼å…¥è·¯å¾„

**æŒ‡æ ‡å’Œç­–ç•¥æ’ä»¶**:
- `macd_indicator.py` - æ·»åŠ capabilitieså‚æ•°
- `moving_average_strategy.py` - æ·»åŠ capabilitieså‚æ•°
- `rsi_indicator.py` - æ·»åŠ capabilitieså‚æ•°

## æµ‹è¯•éªŒè¯

### 1. æ’ä»¶å¯¼å…¥æµ‹è¯•
åˆ›å»ºäº† `test_plugin_imports_only.py` éªŒè¯æ‰€æœ‰æ’ä»¶èƒ½æ­£å¸¸å¯¼å…¥ï¼š
- âœ… æ•°æ®æ¨¡å‹å¯¼å…¥æˆåŠŸ
- âœ… AkShareæ’ä»¶æµ‹è¯•é€šè¿‡
- âœ… 10/10 å…¶ä»–æ’ä»¶å¯¼å…¥æˆåŠŸ

### 2. æ•°æ®æºæ³¨å†Œæµ‹è¯•
åˆ›å»ºäº† `test_data_source_registration.py` éªŒè¯æ’ä»¶æ³¨å†Œï¼š
- âœ… æœåŠ¡å¼•å¯¼æˆåŠŸ
- âœ… æ’ä»¶ç®¡ç†å™¨åŠ è½½30ä¸ªæ’ä»¶
- âœ… æ•°æ®æºè·¯ç”±å™¨æ³¨å†Œ15ä¸ªæ•°æ®æº

### 3. æ¿å—èµ„é‡‘æµæµ‹è¯•
åˆ›å»ºäº† `test_sector_fund_flow_final.py` éªŒè¯ç«¯åˆ°ç«¯åŠŸèƒ½ï¼š
- âœ… AkShareæ’ä»¶æ”¯æŒæ¿å—èµ„é‡‘æµæ•°æ®ç±»å‹
- âœ… æ’ä»¶å…·æœ‰ `get_sector_fund_flow_data` æ–¹æ³•
- âœ… TETç®¡é“å¯ç”¨ï¼Œæ•°æ®æºæ•°é‡: 15

## ä¿®å¤ç»“æœ

### æˆåŠŸæŒ‡æ ‡
1. **æ’ä»¶åŠ è½½**: 30ä¸ªæ’ä»¶å…¨éƒ¨æˆåŠŸåŠ è½½
2. **æ•°æ®æºæ³¨å†Œ**: 15ä¸ªæ•°æ®æºæˆåŠŸæ³¨å†Œåˆ°è·¯ç”±å™¨
3. **æœåŠ¡å¼•å¯¼**: æ‰€æœ‰æœåŠ¡æ­£å¸¸å¯åŠ¨å’Œæ³¨å†Œ
4. **åŠŸèƒ½éªŒè¯**: æ¿å—èµ„é‡‘æµæ•°æ®è·å–åŠŸèƒ½å·²ä¿®å¤

### ç³»ç»ŸçŠ¶æ€
```
âœ… UnifiedDataManagerå·²æ³¨å†Œ: UnifiedDataManager
âœ… æ•°æ®æºè·¯ç”±å™¨å¯ç”¨ï¼Œå½“å‰æ•°æ®æºæ•°é‡: 15
âœ… PluginManagerå·²æ³¨å†Œ: PluginManager
âœ… æ’ä»¶å®ä¾‹æ•°é‡: 30
âœ… 14ä¸ªæ•°æ®æºæ’ä»¶è¢«æ­£ç¡®è¯†åˆ«
```

### å·²æ³¨å†Œçš„æ•°æ®æº
- hikyuu (HIkyuuæ ¸å¿ƒæ•°æ®æº)
- examples.akshare_stock_plugin (æ”¯æŒæ¿å—èµ„é‡‘æµ)
- examples.bond_data_plugin
- examples.coinbase_crypto_plugin
- examples.ctp_futures_plugin
- examples.custom_data_plugin
- examples.forex_data_plugin
- examples.huobi_crypto_plugin
- examples.mysteel_data_plugin
- examples.okx_crypto_plugin
- examples.tongdaxin_stock_plugin
- examples.wenhua_data_plugin
- examples.wind_data_plugin
- examples.yahoo_finance_datasource
- data_sources.hikyuu_data_plugin

## æŠ€æœ¯æ”¹è¿›

### 1. æ¶æ„ä¼˜åŒ–
- å®ç°äº†æ­£ç¡®çš„æœåŠ¡ä¾èµ–ç®¡ç†
- å»ºç«‹äº†å»¶è¿Ÿåˆå§‹åŒ–æœºåˆ¶
- ä¼˜åŒ–äº†æ’ä»¶å‘ç°å’Œæ³¨å†Œæµç¨‹

### 2. é”™è¯¯å¤„ç†
- æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è®°å½•
- å®ç°äº†ä¼˜é›…çš„é™çº§æœºåˆ¶
- æä¾›äº†æ‰‹åŠ¨æ³¨å†Œåå¤‡æ–¹æ¡ˆ

### 3. æ‰©å±•æ€§
- æ”¯æŒ18ç§ä¸åŒç±»å‹çš„æ•°æ®æºæ’ä»¶
- å»ºç«‹äº†æ ‡å‡†åŒ–çš„æ’ä»¶æ¥å£
- å®ç°äº†çµæ´»çš„æ•°æ®ç±»å‹æ”¯æŒ

## ç”¨æˆ·å½±å“

### è§£å†³çš„é—®é¢˜
1. âœ… ä¿®å¤äº†"æ²¡æœ‰å¯ç”¨çš„æ•°æ®æº"é”™è¯¯
2. âœ… æ¢å¤äº†æ¿å—èµ„é‡‘æµæ•°æ®è·å–åŠŸèƒ½
3. âœ… ä¿®å¤äº†æ’ä»¶ç³»ç»Ÿæ— æ³•è¯†åˆ«æ•°æ®æºçš„é—®é¢˜
4. âœ… æé«˜äº†ç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§

### åŠŸèƒ½å¢å¼º
1. ğŸš€ æ”¯æŒæ›´å¤šæ•°æ®æºç±»å‹ï¼ˆè‚¡ç¥¨ã€æœŸè´§ã€åŠ å¯†è´§å¸ã€å€ºåˆ¸ã€å¤–æ±‡ç­‰ï¼‰
2. ğŸš€ æ”¹è¿›äº†é”™è¯¯å¤„ç†å’Œæ•…éšœè½¬ç§»æœºåˆ¶
3. ğŸš€ å¢å¼ºäº†æ’ä»¶ç³»ç»Ÿçš„æ‰©å±•æ€§
4. ğŸš€ æä¾›äº†æ›´è¯¦ç»†çš„ç³»ç»ŸçŠ¶æ€ä¿¡æ¯

## åç»­å»ºè®®

### 1. ç›‘æ§å’Œç»´æŠ¤
- å®šæœŸæ£€æŸ¥æ’ä»¶åŠ è½½çŠ¶æ€
- ç›‘æ§æ•°æ®æºè¿æ¥å¥åº·çŠ¶å†µ
- åŠæ—¶æ›´æ–°æ’ä»¶ä¾èµ–åº“

### 2. åŠŸèƒ½æ‰©å±•
- è€ƒè™‘æ·»åŠ æ›´å¤šæ•°æ®æºæ’ä»¶
- å®ç°æ’ä»¶çƒ­åŠ è½½åŠŸèƒ½
- æ·»åŠ æ’ä»¶é…ç½®ç®¡ç†ç•Œé¢

### 3. æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–æ’ä»¶åŠ è½½é€Ÿåº¦
- å®ç°æ•°æ®ç¼“å­˜æœºåˆ¶
- æ·»åŠ å¹¶å‘æ•°æ®è·å–æ”¯æŒ

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-08-21  
**ä¿®å¤çŠ¶æ€**: âœ… å®Œå…¨ä¿®å¤  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨é¢éªŒè¯  
**ç”¨æˆ·å½±å“**: ğŸš€ åŠŸèƒ½æ¢å¤å¹¶å¢å¼º 