# HIkyuu-UI 告警系统使用指南

## 概述

HIkyuu-UI 的告警系统已经进行了全面升级，现在提供更强大的监控、通知和管理功能。本指南将帮助您充分利用这些新功能。

## 🆕 最新改进

### 1. 界面优化
- ✅ **底部按钮保留**：经过分析，所有底部按钮都有独特的职责，不存在功能重复
- ✅ **增强的工具提示**：每个按钮都有详细的功能说明
- ✅ **新增监控状态面板**：实时显示告警系统运行状态

### 2. 功能增强
- ✅ **增强测试告警**：现在能触发完整的告警流程并保存到数据库
- ✅ **服务状态检查**：自动检测监控服务是否正常运行
- ✅ **启动时诊断**：系统启动时自动检查告警历史生成状态

## 📋 功能说明

### 底部按钮功能

| 按钮 | 功能 | 详细说明 |
|------|------|----------|
| 💾 保存配置 | 保存通知配置 | 将邮件和短信通知设置保存到数据库 |
| 🔄 重置配置 | 重置所有配置 | 重置通知设置和告警规则到默认值 |
| 🧪 测试告警 | 测试告警流程 | 生成测试告警，验证整个告警流程的完整性 |
| ✅ 应用配置 | 应用到系统 | 将配置应用到系统服务，启用实时监控 |

### 右键菜单功能

| 菜单项 | 功能 | 使用场景 |
|--------|------|----------|
| ➕ 添加规则 | 创建新规则 | 在空白区域右键，添加新的告警规则 |
| ✏️ 编辑规则 | 修改规则 | 在现有规则上右键，修改规则设置 |
| 📋 复制规则 | 复制规则 | 基于现有规则创建副本，快速配置相似规则 |
| ⏸️ 禁用规则 | 切换状态 | 临时禁用/启用规则，不删除配置 |
| 🗑️ 删除规则 | 删除规则 | 永久删除选中的规则 |

### 🔍 监控状态面板

新增的监控状态面板显示以下信息：
- **服务状态**：监控服务是否正常运行
- **告警统计**：总告警数、活跃告警数、抑制告警数
- **最后告警**：最近一次告警的时间和级别

状态指示器：
- 🟢 **绿色**：监控服务正常运行
- 🟡 **黄色**：服务有警告或部分功能异常
- 🔴 **红色**：服务严重异常或未运行

## 🚀 使用流程

### 第一次使用

1. **配置通知方式**
   - 填写邮件设置（SMTP/API）
   - 配置短信服务（可选）
   - 点击 `💾 保存配置`

2. **设置告警规则**
   - 在规则列表空白处右键 → `➕ 添加规则`
   - 配置告警条件和阈值
   - 保存规则

3. **应用配置**
   - 点击 `✅ 应用配置` 启用监控
   - 检查监控状态面板确认服务正常

4. **测试功能**
   - 点击 `🧪 测试告警` 验证流程
   - 检查告警历史确认记录生成

### 日常维护

1. **监控服务状态**
   - 定期查看监控状态面板
   - 如有异常，点击 `🔄 刷新状态`

2. **管理告警规则**
   - 根据需要调整阈值
   - 使用 `📋 复制规则` 快速创建相似规则
   - 临时禁用不需要的规则

3. **查看告警历史**
   - 监控告警趋势
   - 分析告警原因
   - 调整规则设置

## 🔧 故障排除

### 告警历史只有启动记录

**症状**：告警历史只显示系统启动时的一条记录

**可能原因**：
1. 监控服务未正常启动
2. 告警阈值设置过高，未触发告警
3. 事件处理器未正确注册

**解决方案**：
1. 检查监控状态面板，确认服务状态
2. 点击 `🧪 测试告警` 验证告警流程
3. 如果测试成功但实际监控无告警，考虑调整阈值
4. 重新点击 `✅ 应用配置` 重新初始化服务

### 测试告警失败

**症状**：点击测试告警按钮出现错误

**解决方案**：
1. 检查数据库文件是否正常（`db/alert_config.db`）
2. 确认告警服务是否正确初始化
3. 查看日志文件了解详细错误信息

### 通知不工作

**症状**：有告警产生但没有收到邮件/短信

**解决方案**：
1. 检查邮件/短信配置是否正确
2. 验证API密钥和服务器设置
3. 确认收件人地址/手机号码正确

## 💡 最佳实践

### 告警规则设置

1. **分级设置**
   - 信息级：日常监控，不需要立即处理
   - 警告级：需要关注，可能影响性能
   - 错误级：需要及时处理
   - 严重级：立即处理，影响系统稳定

2. **阈值调优**
   - 从宽松的阈值开始
   - 根据历史数据逐步调整
   - 避免过于频繁的告警

3. **规则命名**
   - 使用描述性的名称
   - 包含监控对象和条件
   - 便于后期维护

### 通知策略

1. **邮件通知**
   - 适用于非紧急告警
   - 可以包含详细信息
   - 方便历史追踪

2. **短信通知**
   - 适用于紧急告警
   - 24小时可达
   - 成本较高，谨慎使用

3. **通知去重**
   - 系统自动去重相同告警
   - 避免告警风暴
   - 5分钟内相同告警只发送一次

## 📈 进阶功能

### 告警统计分析

监控状态面板提供告警统计信息：
- **总告警数**：系统产生的所有告警
- **活跃告警**：当前需要关注的告警
- **抑制告警**：被去重机制抑制的告警

通过这些数据可以：
- 评估系统稳定性
- 优化告警规则
- 分析告警趋势

### 自动化运维

1. **定期检查**
   - 系统会自动检查服务状态
   - 异常时在监控面板显示

2. **智能恢复**
   - 告警条件恢复正常时自动解除
   - 减少人工干预

3. **历史分析**
   - 保留告警历史记录
   - 支持趋势分析和问题追溯

## 🛠️ 技术细节

### 数据存储

- **配置数据**：存储在 `db/alert_config.db`
- **历史记录**：SQLite数据库，支持高效查询
- **缓存机制**：内存缓存提高响应速度

### 服务架构

- **事件驱动**：基于事件总线的松耦合架构
- **去重机制**：防止告警风暴
- **异步处理**：不阻塞主线程

### 扩展性

- **插件支持**：支持自定义告警规则
- **多种通知渠道**：邮件、短信、桌面通知
- **API接口**：支持外部系统集成

## 📞 支持与反馈

如果您在使用过程中遇到问题或有改进建议，请：

1. 查看日志文件了解详细错误信息
2. 检查监控状态面板的服务状态
3. 尝试重新应用配置解决问题
4. 记录问题的具体表现和操作步骤

通过正确使用这些功能，您可以建立一个强大、可靠的股票监控告警系统，及时发现和处理各种市场异常情况。 