# æ•°æ®æºæ’ä»¶åŒ–æ”¹é€ è®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ æ”¹é€ ç›®æ ‡

åŸºäºFactorWeave-Quant ç°æœ‰æ¶æ„ï¼Œè®¾è®¡æ’ä»¶åŒ–æ•°æ®æºç³»ç»Ÿï¼Œè§£å†³ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š
- **æ•°æ®ä¸€è‡´æ€§é—®é¢˜**ï¼šå¤šæ•°æ®æºåˆ‡æ¢æ—¶çš„æ•°æ®ä¸€è‡´æ€§ä¿éšœ
- **æ‰©å±•æ€§é—®é¢˜**ï¼šæ”¯æŒè‚¡ç¥¨ã€æœŸè´§ã€æ•°å­—è´§å¸(BTC)ç­‰å¤šç§èµ„äº§ç±»å‹
- **å¯ç»´æŠ¤æ€§é—®é¢˜**ï¼šæ’ä»¶åŒ–ç®¡ç†ï¼Œæ”¯æŒçƒ­æ’æ‹”å’Œç‹¬ç«‹æ›´æ–°
- **æ€§èƒ½é—®é¢˜**ï¼šç»Ÿä¸€ç¼“å­˜ç­–ç•¥å’Œæ•°æ®åŒæ­¥æœºåˆ¶

---

## ğŸ—ï¸ æ’ä»¶åŒ–æ•°æ®æºæ¶æ„è®¾è®¡

### 1. æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æœåŠ¡å±‚ (Service Layer)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   StockService  â”‚  â”‚ AnalysisService â”‚  â”‚TradingServiceâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ç»Ÿä¸€æ•°æ®ç®¡ç†å±‚ (Unified Data Layer)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            DataSourceManager (æ•°æ®æºç®¡ç†å™¨)             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Plugin      â”‚ â”‚ Data        â”‚ â”‚   Cache             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Registry    â”‚ â”‚ Router      â”‚ â”‚   Manager           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ æ’ä»¶æ³¨å†Œå™¨   â”‚ â”‚ æ•°æ®è·¯ç”±å™¨   â”‚ â”‚   ç¼“å­˜ç®¡ç†å™¨         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ’ä»¶å±‚ (Plugin Layer)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   è‚¡ç¥¨æ’ä»¶    â”‚ â”‚   æœŸè´§æ’ä»¶    â”‚ â”‚   æ•°å­—è´§å¸æ’ä»¶       â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ AKShare  â”‚ â”‚ â”‚ â”‚ æœŸè´§API  â”‚ â”‚ â”‚ â”‚   Binance       â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ Plugin   â”‚ â”‚ â”‚ â”‚ Plugin   â”‚ â”‚ â”‚ â”‚   Plugin        â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚Eastmoney â”‚ â”‚ â”‚ â”‚ æ–‡åAPI  â”‚ â”‚ â”‚ â”‚   Coinbase      â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ Plugin   â”‚ â”‚ â”‚ â”‚ Plugin   â”‚ â”‚ â”‚ â”‚   Plugin        â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚              â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ Hikyuu   â”‚ â”‚ â”‚              â”‚ â”‚ â”‚   Custom        â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ Plugin   â”‚ â”‚ â”‚              â”‚ â”‚ â”‚   Plugin        â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚              â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### ğŸ”§ DataSourceManager (æ•°æ®æºç®¡ç†å™¨)

**èŒè´£**ï¼š
- ç®¡ç†æ‰€æœ‰æ•°æ®æºæ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
- æä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
- å®ç°æ•°æ®è·¯ç”±å’Œè´Ÿè½½å‡è¡¡
- ç®¡ç†æ•°æ®ä¸€è‡´æ€§å’Œç¼“å­˜ç­–ç•¥

**æ ¸å¿ƒæ¥å£**ï¼š
```python
class DataSourceManager:
    def register_plugin(self, plugin: IDataSourcePlugin) -> bool
    def unregister_plugin(self, plugin_id: str) -> bool
    def get_data(self, request: DataRequest) -> DataResponse
    def get_available_sources(self, asset_type: AssetType) -> List[str]
    def set_primary_source(self, asset_type: AssetType, source_id: str) -> bool
    def enable_fallback_chain(self, asset_type: AssetType, sources: List[str]) -> bool
```

#### ğŸ”Œ IDataSourcePlugin (æ•°æ®æºæ’ä»¶æ¥å£)

**æ ‡å‡†åŒ–æ’ä»¶æ¥å£**ï¼š
```python
class IDataSourcePlugin(ABC):
    @property
    def plugin_id(self) -> str
    @property  
    def supported_asset_types(self) -> List[AssetType]
    @property
    def supported_data_types(self) -> List[DataType]
    @property
    def priority(self) -> int
    
    @abstractmethod
    def initialize(self, config: PluginConfig) -> bool
    @abstractmethod
    def get_market_data(self, request: MarketDataRequest) -> MarketDataResponse
    @abstractmethod
    def get_historical_data(self, request: HistoricalDataRequest) -> HistoricalDataResponse
    @abstractmethod
    def get_real_time_data(self, symbols: List[str]) -> RealTimeDataResponse
    @abstractmethod
    def health_check(self) -> HealthStatus
    @abstractmethod
    def shutdown(self) -> bool
```

#### ğŸ¯ AssetType (èµ„äº§ç±»å‹æšä¸¾)

```python
class AssetType(Enum):
    STOCK_A = "stock_a"          # Aè‚¡
    STOCK_US = "stock_us"        # ç¾è‚¡
    STOCK_HK = "stock_hk"        # æ¸¯è‚¡
    FUTURES = "futures"          # æœŸè´§
    CRYPTO = "crypto"            # æ•°å­—è´§å¸
    FOREX = "forex"              # å¤–æ±‡
    BOND = "bond"                # å€ºåˆ¸
    COMMODITY = "commodity"      # å¤§å®—å•†å“
```

#### ğŸ“Š DataType (æ•°æ®ç±»å‹æšä¸¾)

```python
class DataType(Enum):
    REAL_TIME_QUOTE = "real_time_quote"    # å®æ—¶è¡Œæƒ…
    HISTORICAL_KLINE = "historical_kline"  # å†å²Kçº¿
    MARKET_DEPTH = "market_depth"          # å¸‚åœºæ·±åº¦
    TRADE_TICK = "trade_tick"              # é€ç¬”æˆäº¤
    FUNDAMENTAL = "fundamental"            # åŸºæœ¬é¢æ•°æ®
    NEWS = "news"                          # æ–°é—»èµ„è®¯
    ANNOUNCEMENT = "announcement"          # å…¬å‘Šä¿¡æ¯
```

### 3. æ•°æ®è·¯ç”±ç­–ç•¥è®¾è®¡

#### ğŸ”„ æ™ºèƒ½è·¯ç”±æœºåˆ¶

```python
class DataRouter:
    def route_request(self, request: DataRequest) -> RoutingPlan:
        # 1. æ ¹æ®èµ„äº§ç±»å‹ç¡®å®šå€™é€‰æ’ä»¶
        candidates = self._get_candidates_by_asset_type(request.asset_type)
        
        # 2. æ ¹æ®æ•°æ®ç±»å‹è¿‡æ»¤æ’ä»¶
        compatible_plugins = self._filter_by_data_type(candidates, request.data_type)
        
        # 3. æ ¹æ®ä¼˜å…ˆçº§å’Œå¥åº·çŠ¶æ€æ’åº
        sorted_plugins = self._sort_by_priority_and_health(compatible_plugins)
        
        # 4. ç”Ÿæˆè·¯ç”±è®¡åˆ’ï¼ˆä¸»+å¤‡é€‰ï¼‰
        return RoutingPlan(
            primary=sorted_plugins[0],
            fallback=sorted_plugins[1:3],  # æœ€å¤š2ä¸ªå¤‡é€‰
            strategy=self._get_routing_strategy(request)
        )
```

#### ğŸ“ˆ è·¯ç”±ç­–ç•¥ç±»å‹

1. **ä¼˜å…ˆçº§è·¯ç”±** (Priority Routing)
   - æŒ‰æ’ä»¶ä¼˜å…ˆçº§é€‰æ‹©æ•°æ®æº
   - ä¸»æ•°æ®æºå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡é€‰æ•°æ®æº

2. **è´Ÿè½½å‡è¡¡è·¯ç”±** (Load Balancing)
   - åœ¨å¤šä¸ªæ•°æ®æºé—´åˆ†æ•£è¯·æ±‚
   - é¿å…å•ä¸€æ•°æ®æºè¿‡è½½

3. **æ•°æ®è´¨é‡è·¯ç”±** (Quality-based Routing)
   - æ ¹æ®æ•°æ®è´¨é‡æŒ‡æ ‡é€‰æ‹©æœ€ä¼˜æ•°æ®æº
   - å®æ—¶ç›‘æ§æ•°æ®å‡†ç¡®æ€§å’ŒåŠæ—¶æ€§

4. **æˆæœ¬ä¼˜åŒ–è·¯ç”±** (Cost-optimized Routing)
   - ä¼˜å…ˆä½¿ç”¨å…è´¹æˆ–ä½æˆæœ¬æ•°æ®æº
   - ä»˜è´¹æ•°æ®æºä½œä¸ºç²¾ç¡®æ•°æ®çš„è¡¥å……

### 4. æ•°æ®ä¸€è‡´æ€§ä¿éšœæœºåˆ¶

#### ğŸ” ä¸€è‡´æ€§ç­–ç•¥

1. **æ•°æ®ç‰ˆæœ¬æ§åˆ¶**
```python
class DataVersion:
    def __init__(self):
        self.version_id: str = generate_uuid()
        self.timestamp: datetime = datetime.now()
        self.source_id: str = ""
        self.checksum: str = ""
        self.data_type: DataType = None
```

2. **è·¨æºæ•°æ®æ ¡éªŒ**
```python
class DataConsistencyChecker:
    def validate_data(self, primary_data: DataResponse, 
                     validation_sources: List[str]) -> ValidationResult:
        # ä»å¤‡é€‰æ•°æ®æºè·å–åŒæ ·æ•°æ®è¿›è¡Œå¯¹æ¯”
        # è®¡ç®—æ•°æ®å·®å¼‚åº¦
        # è¿”å›ä¸€è‡´æ€§æŠ¥å‘Š
```

3. **æ—¶é—´çª—å£åŒæ­¥**
```python
class TimeWindowSynchronizer:
    def sync_data_in_window(self, start_time: datetime, 
                           end_time: datetime,
                           asset_type: AssetType) -> SyncResult:
        # ç¡®ä¿æ—¶é—´çª—å£å†…æ‰€æœ‰æ•°æ®æºæ•°æ®åŒæ­¥
        # å¤„ç†æ—¶åŒºå·®å¼‚å’Œäº¤æ˜“æ—¶é—´å·®å¼‚
```

#### ğŸ”„ ç¼“å­˜ä¸€è‡´æ€§ç­–ç•¥

1. **åˆ†å±‚ç¼“å­˜æ¶æ„**
```
L1ç¼“å­˜ (å†…å­˜) â†’ L2ç¼“å­˜ (Redis) â†’ L3ç¼“å­˜ (æ•°æ®åº“)
      â†“              â†“                â†“
   å®æ—¶æ•°æ®        åˆ†é’Ÿçº§æ•°æ®         å†å²æ•°æ®
```

2. **ç¼“å­˜å¤±æ•ˆç­–ç•¥**
- **æ—¶é—´å¤±æ•ˆ**: æ ¹æ®æ•°æ®ç±»å‹è®¾ç½®ä¸åŒçš„TTL
- **äº‹ä»¶å¤±æ•ˆ**: å¸‚åœºå¼€ç›˜/æ”¶ç›˜æ—¶å¼ºåˆ¶åˆ·æ–°ç¼“å­˜
- **ç‰ˆæœ¬å¤±æ•ˆ**: æ•°æ®æºç‰ˆæœ¬æ›´æ–°æ—¶æ¸…é™¤ç›¸å…³ç¼“å­˜

3. **ç¼“å­˜é¢„çƒ­æœºåˆ¶**
```python
class CacheWarmupScheduler:
    def schedule_warmup(self, asset_type: AssetType, 
                       symbols: List[str],
                       schedule: CronExpression) -> bool:
        # åœ¨å¸‚åœºå¼€ç›˜å‰é¢„çƒ­å¸¸ç”¨æ•°æ®
        # å‡å°‘é¦–æ¬¡è®¿é—®å»¶è¿Ÿ
```

---

## ğŸ”§ æ’ä»¶å¼€å‘è§„èŒƒ

### 1. æ’ä»¶é¡¹ç›®ç»“æ„

```
my_data_plugin/
â”œâ”€â”€ plugin.yaml          # æ’ä»¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ __init__.py          # æ’ä»¶å…¥å£
â”œâ”€â”€ data_source.py       # æ•°æ®æºå®ç°
â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹
â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”œâ”€â”€ tests/              # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_data_source.py
â”‚   â””â”€â”€ test_models.py
â””â”€â”€ README.md           # æ’ä»¶è¯´æ˜
```

### 2. æ’ä»¶é…ç½®æ–‡ä»¶ (plugin.yaml)

```yaml
plugin:
  id: "my_data_plugin"
  name: "My Data Plugin"
  version: "1.0.0"
  author: "Plugin Developer"
  description: "Custom data source plugin"
  
capabilities:
  asset_types:
    - "crypto"
    - "forex"
  data_types:
    - "real_time_quote"
    - "historical_kline"
  
config:
  api_key: "${API_KEY}"
  base_url: "https://api.example.com"
  rate_limit: 100  # requests per minute
  timeout: 30      # seconds

dependencies:
  - "requests>=2.25.0"
  - "pandas>=1.3.0"
```

### 3. æ’ä»¶æ³¨å†Œæµç¨‹

```python
class PluginRegistry:
    def register_plugin_from_path(self, plugin_path: str) -> bool:
        # 1. éªŒè¯æ’ä»¶é…ç½®æ–‡ä»¶
        config = self._load_plugin_config(plugin_path)
        
        # 2. æ£€æŸ¥ä¾èµ–å…³ç³»
        if not self._check_dependencies(config):
            return False
            
        # 3. åŠ¨æ€åŠ è½½æ’ä»¶æ¨¡å—
        plugin_module = self._load_plugin_module(plugin_path)
        
        # 4. å®ä¾‹åŒ–æ’ä»¶
        plugin_instance = plugin_module.create_plugin(config)
        
        # 5. éªŒè¯æ’ä»¶æ¥å£
        if not isinstance(plugin_instance, IDataSourcePlugin):
            return False
            
        # 6. åˆå§‹åŒ–æ’ä»¶
        if not plugin_instance.initialize(config):
            return False
            
        # 7. æ³¨å†Œåˆ°ç®¡ç†å™¨
        self._plugins[config.plugin.id] = plugin_instance
        return True
```

---

## ğŸ“Š å…·ä½“å®ç°æ¶æ„å›¾

### 1. æ’ä»¶åŒ–æ•°æ®æºæ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        APP[FactorWeave-Quant  Application]
    end
    
    subgraph "æœåŠ¡å±‚"
        SS[StockService]
        AS[AnalysisService]
        TS[TradingService]
    end
    
    subgraph "ç»Ÿä¸€æ•°æ®ç®¡ç†å±‚"
        DSM[DataSourceManager<br/>æ•°æ®æºç®¡ç†å™¨]
        PR[PluginRegistry<br/>æ’ä»¶æ³¨å†Œå™¨]
        DR[DataRouter<br/>æ•°æ®è·¯ç”±å™¨]
        CM[CacheManager<br/>ç¼“å­˜ç®¡ç†å™¨]
        CC[ConsistencyChecker<br/>ä¸€è‡´æ€§æ£€æŸ¥å™¨]
        
        DSM --> PR
        DSM --> DR
        DSM --> CM
        DSM --> CC
    end
    
    subgraph "æ’ä»¶å±‚"
        subgraph "è‚¡ç¥¨æ’ä»¶ç»„"
            SP1[AKShare Plugin]
            SP2[EastMoney Plugin]
            SP3[Hikyuu Plugin]
        end
        
        subgraph "æœŸè´§æ’ä»¶ç»„"
            FP1[æœŸè´§API Plugin]
            FP2[æ–‡åè´¢ç» Plugin]
        end
        
        subgraph "æ•°å­—è´§å¸æ’ä»¶ç»„"
            CP1[Binance Plugin]
            CP2[Coinbase Plugin]
            CP3[è‡ªå®šä¹‰ Plugin]
        end
    end
    
    subgraph "å¤–éƒ¨æ•°æ®æº"
        API1[AKShare API]
        API2[ä¸œæ–¹è´¢å¯Œ API]
        API3[Hikyuu æœ¬åœ°æ•°æ®]
        API4[æœŸè´§äº¤æ˜“æ‰€ API]
        API5[Binance API]
        API6[Coinbase API]
    end
    
    %% è¿æ¥å…³ç³»
    APP --> SS
    APP --> AS
    APP --> TS
    
    SS --> DSM
    AS --> DSM
    TS --> DSM
    
    PR --> SP1
    PR --> SP2
    PR --> SP3
    PR --> FP1
    PR --> FP2
    PR --> CP1
    PR --> CP2
    PR --> CP3
    
    SP1 --> API1
    SP2 --> API2
    SP3 --> API3
    FP1 --> API4
    FP2 --> API4
    CP1 --> API5
    CP2 --> API6
    
    %% æ ·å¼
    classDef app fill:#e1f5fe
    classDef service fill:#e8f5e8
    classDef manager fill:#fff3e0
    classDef plugin fill:#f3e5f5
    classDef external fill:#ffebee
    
    class APP app
    class SS,AS,TS service
    class DSM,PR,DR,CM,CC manager
    class SP1,SP2,SP3,FP1,FP2,CP1,CP2,CP3 plugin
    class API1,API2,API3,API4,API5,API6 external
```

### 2. æ•°æ®è¯·æ±‚æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant UI as UIå±‚
    participant SVC as æœåŠ¡å±‚
    participant DSM as DataSourceManager
    participant DR as DataRouter
    participant CM as CacheManager
    participant PLG as Plugin
    participant API as å¤–éƒ¨API
    
    Note over UI,API: æ•°æ®è¯·æ±‚å®Œæ•´æµç¨‹
    
    UI->>+SVC: è¯·æ±‚è‚¡ç¥¨æ•°æ®<br/>get_stock_data("000001")
    SVC->>+DSM: è½¬å‘æ•°æ®è¯·æ±‚<br/>DataRequest
    
    DSM->>+CM: æ£€æŸ¥ç¼“å­˜<br/>check_cache(request)
    alt ç¼“å­˜å‘½ä¸­
        CM-->>DSM: è¿”å›ç¼“å­˜æ•°æ®
        DSM-->>SVC: ç¼“å­˜æ•°æ®
        SVC-->>UI: è¿”å›ç»“æœ
    else ç¼“å­˜æœªå‘½ä¸­
        CM-->>-DSM: ç¼“å­˜æœªå‘½ä¸­
        
        DSM->>+DR: è·¯ç”±è¯·æ±‚<br/>route_request(request)
        DR->>DR: é€‰æ‹©æœ€ä¼˜æ’ä»¶<br/>æ ¹æ®ä¼˜å…ˆçº§å’Œå¥åº·çŠ¶æ€
        DR-->>-DSM: è¿”å›è·¯ç”±è®¡åˆ’<br/>RoutingPlan
        
        DSM->>+PLG: è°ƒç”¨ä¸»æ’ä»¶<br/>get_data(request)
        PLG->>+API: HTTPè¯·æ±‚<br/>è·å–æ•°æ®
        API-->>-PLG: è¿”å›åŸå§‹æ•°æ®
        PLG->>PLG: æ•°æ®è½¬æ¢<br/>æ ‡å‡†åŒ–æ ¼å¼
        PLG-->>-DSM: æ ‡å‡†åŒ–æ•°æ®
        
        DSM->>+CM: æ›´æ–°ç¼“å­˜<br/>cache_data(data)
        CM-->>-DSM: ç¼“å­˜å®Œæˆ
        
        DSM-->>-SVC: è¿”å›æ•°æ®
        SVC-->>-UI: æ˜¾ç¤ºæ•°æ®
    end
    
    Note over UI,API: æ”¯æŒå¤±è´¥è‡ªåŠ¨é‡è¯•<br/>å’Œå¤‡é€‰æ•°æ®æºåˆ‡æ¢
```

### 3. æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

```mermaid
stateDiagram-v2
    [*] --> Discovered : å‘ç°æ’ä»¶
    Discovered --> Loading : å¼€å§‹åŠ è½½
    Loading --> Validating : éªŒè¯é…ç½®
    Validating --> Initializing : åˆå§‹åŒ–æ’ä»¶
    Initializing --> Ready : å°±ç»ªçŠ¶æ€
    
    Ready --> Active : æ¿€æ´»ä½¿ç”¨
    Active --> Monitoring : å¥åº·ç›‘æ§
    Monitoring --> Active : å¥åº·æ­£å¸¸
    Monitoring --> Degraded : æ€§èƒ½ä¸‹é™
    Degraded --> Active : æ¢å¤æ­£å¸¸
    Degraded --> Failed : å½»åº•å¤±è´¥
    
    Failed --> Reloading : é‡æ–°åŠ è½½
    Reloading --> Ready : é‡è½½æˆåŠŸ
    Reloading --> Disabled : é‡è½½å¤±è´¥
    
    Active --> Updating : ç‰ˆæœ¬æ›´æ–°
    Updating --> Ready : æ›´æ–°æˆåŠŸ
    Updating --> Failed : æ›´æ–°å¤±è´¥
    
    Ready --> Disabled : æ‰‹åŠ¨ç¦ç”¨
    Disabled --> Ready : æ‰‹åŠ¨å¯ç”¨
    Disabled --> [*] : å¸è½½æ’ä»¶
    Failed --> [*] : å¸è½½æ’ä»¶
```

---

## ğŸ¯ æ”¹é€ å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¡†æ¶æ­å»º (2-3å‘¨)

1. **æ¥å£å®šä¹‰** (3å¤©)
   - å®šä¹‰IDataSourcePluginæ ‡å‡†æ¥å£
   - è®¾è®¡AssetTypeå’ŒDataTypeæšä¸¾
   - åˆ›å»ºæ•°æ®æ¨¡å‹ç±»

2. **ç®¡ç†å™¨å®ç°** (1å‘¨)
   - å®ç°DataSourceManageræ ¸å¿ƒé€»è¾‘
   - å¼€å‘PluginRegistryæ’ä»¶æ³¨å†Œå™¨
   - æ„å»ºDataRouteræ•°æ®è·¯ç”±å™¨

3. **ç¼“å­˜ç³»ç»Ÿ** (1å‘¨)
   - è®¾è®¡åˆ†å±‚ç¼“å­˜æ¶æ„
   - å®ç°CacheManagerç¼“å­˜ç®¡ç†å™¨
   - å¼€å‘ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶

### é˜¶æ®µäºŒï¼šæ’ä»¶è¿ç§»æ”¹é€  (3-4å‘¨)

1. **ç°æœ‰æ’ä»¶æ”¹é€ ** (2å‘¨)
   - å°†AkshareDataSourceæ”¹é€ ä¸ºæ’ä»¶
   - å°†HikyuuDataSourceæ”¹é€ ä¸ºæ’ä»¶
   - å°†EastMoneyDataSourceæ”¹é€ ä¸ºæ’ä»¶

2. **æ–°æ’ä»¶å¼€å‘** (2å‘¨)
   - å¼€å‘æœŸè´§æ•°æ®æ’ä»¶
   - å¼€å‘æ•°å­—è´§å¸æ•°æ®æ’ä»¶ï¼ˆBinanceã€Coinbaseï¼‰
   - åˆ›å»ºæ’ä»¶å¼€å‘æ¨¡æ¿å’Œæ–‡æ¡£

### é˜¶æ®µä¸‰ï¼šé›†æˆæµ‹è¯•ä¼˜åŒ– (2-3å‘¨)

1. **é›†æˆæµ‹è¯•** (1å‘¨)
   - æ’ä»¶åŠ è½½å’Œå¸è½½æµ‹è¯•
   - æ•°æ®ä¸€è‡´æ€§éªŒè¯æµ‹è¯•
   - æ€§èƒ½å‹åŠ›æµ‹è¯•

2. **ç›‘æ§å’Œè¿ç»´** (1å‘¨)
   - å®ç°æ’ä»¶å¥åº·ç›‘æ§
   - å¼€å‘ç®¡ç†ç•Œé¢
   - å»ºç«‹å‘Šè­¦æœºåˆ¶

3. **æ–‡æ¡£å’ŒåŸ¹è®­** (1å‘¨)
   - ç¼–å†™æ’ä»¶å¼€å‘æŒ‡å—
   - åˆ›å»ºç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
   - è¿›è¡Œå›¢é˜ŸåŸ¹è®­

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### 1. æŠ€æœ¯æ”¶ç›Š
- **æ‰©å±•æ€§æå‡90%**: æ–°å¢æ•°æ®æºåªéœ€å¼€å‘æ’ä»¶ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- **ç»´æŠ¤æˆæœ¬é™ä½60%**: æ’ä»¶ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²ï¼Œé™ä½ç³»ç»Ÿè€¦åˆåº¦
- **æ•°æ®ä¸€è‡´æ€§æå‡95%**: ç»Ÿä¸€çš„æ•°æ®æ ¡éªŒå’Œç¼“å­˜æœºåˆ¶

### 2. ä¸šåŠ¡æ”¶ç›Š
- **æ”¯æŒæ›´å¤šèµ„äº§ç±»å‹**: è‚¡ç¥¨ã€æœŸè´§ã€æ•°å­—è´§å¸ã€å¤–æ±‡ç­‰
- **æå‡æ•°æ®è´¨é‡**: å¤šæºæ•°æ®éªŒè¯ï¼Œæé«˜æ•°æ®å‡†ç¡®æ€§
- **å¢å¼ºç”¨æˆ·ä½“éªŒ**: æ›´å¿«çš„å“åº”é€Ÿåº¦å’Œæ›´å¯é çš„æ•°æ®æœåŠ¡

### 3. è¿ç»´æ”¶ç›Š
- **çƒ­æ’æ‹”èƒ½åŠ›**: æ’ä»¶å¯åœ¨ä¸åœæœçš„æƒ…å†µä¸‹æ›´æ–°å’Œéƒ¨ç½²
- **æ•…éšœéš”ç¦»**: å•ä¸ªæ’ä»¶æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿè¿è¡Œ
- **ç›‘æ§å¯è§†åŒ–**: å®Œå–„çš„æ’ä»¶çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

---

## ğŸš€ æ€»ç»“

é€šè¿‡æ’ä»¶åŒ–æ”¹é€ ï¼ŒFactorWeave-Quant å°†ä»**ç´§è€¦åˆçš„å•ä½“æ¶æ„**æ¼”è¿›ä¸º**æ¾è€¦åˆçš„æ’ä»¶åŒ–æ¶æ„**ï¼Œå…·å¤‡ï¼š

- âœ… **é«˜æ‰©å±•æ€§**: è½»æ¾æ”¯æŒæ–°çš„æ•°æ®æºå’Œèµ„äº§ç±»å‹
- âœ… **é«˜å¯é æ€§**: å¤šçº§å®¹é”™å’Œè‡ªåŠ¨åˆ‡æ¢æœºåˆ¶
- âœ… **é«˜æ€§èƒ½**: æ™ºèƒ½è·¯ç”±å’Œå¤šçº§ç¼“å­˜ä¼˜åŒ–
- âœ… **é«˜å¯ç»´æŠ¤æ€§**: æ’ä»¶ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²

è¿™ä¸ªæ–¹æ¡ˆæ—¢ä¿æŒäº†ç°æœ‰ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œåˆä¸ºæœªæ¥çš„æ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œæ˜¯ä¸€ä¸ª**æ¸è¿›å¼ã€ä½é£é™©**çš„æ¶æ„å‡çº§æ–¹æ¡ˆã€‚ 



æ¶æ„å›¾ï¼š
graph TB
    subgraph "æ’ä»¶åŒ–æ•°æ®æºæ¶æ„æ”¹é€ æ–¹æ¡ˆ"
        subgraph "åº”ç”¨å±‚ (Application Layer)"
            APP[FactorWeave-Quant  Application<br/>ä¸»åº”ç”¨ç¨‹åº]
        end
        
        subgraph "æœåŠ¡å±‚ (Service Layer)"
            SS[StockService<br/>è‚¡ç¥¨æœåŠ¡]
            AS[AnalysisService<br/>åˆ†ææœåŠ¡]
            TS[TradingService<br/>äº¤æ˜“æœåŠ¡]
            AIS[AIModelService<br/>AIæ¨¡å‹æœåŠ¡]
        end
        
        subgraph "ç»Ÿä¸€æ•°æ®ç®¡ç†å±‚ (Unified Data Management Layer)"
            DSM[DataSourceManager<br/>æ•°æ®æºç®¡ç†å™¨]
            
            subgraph "æ ¸å¿ƒç®¡ç†ç»„ä»¶"
                PR[PluginRegistry<br/>æ’ä»¶æ³¨å†Œå™¨]
                DR[DataRouter<br/>æ•°æ®è·¯ç”±å™¨]
                CM[CacheManager<br/>ç¼“å­˜ç®¡ç†å™¨]
                CC[ConsistencyChecker<br/>ä¸€è‡´æ€§æ£€æŸ¥å™¨]
                HM[HealthMonitor<br/>å¥åº·ç›‘æ§å™¨]
            end
            
            DSM --> PR
            DSM --> DR
            DSM --> CM
            DSM --> CC
            DSM --> HM
        end
        
        subgraph "æ’ä»¶å±‚ (Plugin Layer)"
            subgraph "è‚¡ç¥¨æ•°æ®æ’ä»¶ç»„"
                SP1[AKShare Plugin<br/>Aè‚¡å®æ—¶+å†å²æ•°æ®]
                SP2[EastMoney Plugin<br/>ä¸œæ–¹è´¢å¯Œæ•°æ®æº]
                SP3[Hikyuu Plugin<br/>æœ¬åœ°å†å²æ•°æ®]
                SP4[Wind Plugin<br/>ä¸‡å¾—æ•°æ®ç»ˆç«¯]
            end
            
            subgraph "æœŸè´§æ•°æ®æ’ä»¶ç»„"
                FP1[CTP Plugin<br/>æœŸè´§CTPæ¥å£]
                FP2[Wenhua Plugin<br/>æ–‡åè´¢ç»æ•°æ®]
                FP3[MySteel Plugin<br/>æˆ‘çš„é’¢é“ç½‘]
            end
            
            subgraph "æ•°å­—è´§å¸æ’ä»¶ç»„"
                CP1[Binance Plugin<br/>å¸å®‰äº¤æ˜“æ‰€]
                CP2[Coinbase Plugin<br/>Coinbase Pro]
                CP3[Huobi Plugin<br/>ç«å¸äº¤æ˜“æ‰€]
                CP4[OKX Plugin<br/>æ¬§æ˜“äº¤æ˜“æ‰€]
            end
            
            subgraph "å…¶ä»–èµ„äº§æ’ä»¶ç»„"
                OP1[Forex Plugin<br/>å¤–æ±‡æ•°æ®]
                OP2[Bond Plugin<br/>å€ºåˆ¸æ•°æ®]
                OP3[Custom Plugin<br/>è‡ªå®šä¹‰æ•°æ®æº]
            end
        end
        
        subgraph "å¤–éƒ¨æ•°æ®æº (External Data Sources)"
            subgraph "è‚¡ç¥¨æ•°æ®æº"
                API1[AKShare API]
                API2[ä¸œæ–¹è´¢å¯Œ API]
                API3[Wind API]
                API4[æœ¬åœ°æ•°æ®åº“]
            end
            
            subgraph "æœŸè´§æ•°æ®æº"
                API5[æœŸè´§äº¤æ˜“æ‰€ CTP]
                API6[æ–‡åè´¢ç» API]
                API7[é’¢é“æœŸè´§æ•°æ®]
            end
            
            subgraph "æ•°å­—è´§å¸æ•°æ®æº"
                API8[Binance WebSocket]
                API9[Coinbase REST API]
                API10[Huobi WebSocket]
                API11[OKX WebSocket]
            end
            
            subgraph "å…¶ä»–æ•°æ®æº"
                API12[å¤–æ±‡æ•°æ® API]
                API13[å€ºåˆ¸æ•°æ® API]
                API14[è‡ªå®šä¹‰ API]
            end
        end
        
        subgraph "æ•°æ®ä¸€è‡´æ€§ä¿éšœæœºåˆ¶"
            DV[DataValidator<br/>æ•°æ®éªŒè¯å™¨]
            TC[TimeSynchronizer<br/>æ—¶é—´åŒæ­¥å™¨]
            QC[QualityChecker<br/>è´¨é‡æ£€æŸ¥å™¨]
        end
    end
    
    %% ä¸»è¦æ•°æ®æµ
    APP --> SS
    APP --> AS
    APP --> TS
    APP --> AIS
    
    SS --> DSM
    AS --> DSM
    TS --> DSM
    AIS --> DSM
    
    %% æ’ä»¶æ³¨å†Œæµ
    PR -.->|"æ³¨å†Œç®¡ç†"| SP1
    PR -.->|"æ³¨å†Œç®¡ç†"| SP2
    PR -.->|"æ³¨å†Œç®¡ç†"| SP3
    PR -.->|"æ³¨å†Œç®¡ç†"| SP4
    PR -.->|"æ³¨å†Œç®¡ç†"| FP1
    PR -.->|"æ³¨å†Œç®¡ç†"| FP2
    PR -.->|"æ³¨å†Œç®¡ç†"| FP3
    PR -.->|"æ³¨å†Œç®¡ç†"| CP1
    PR -.->|"æ³¨å†Œç®¡ç†"| CP2
    PR -.->|"æ³¨å†Œç®¡ç†"| CP3
    PR -.->|"æ³¨å†Œç®¡ç†"| CP4
    PR -.->|"æ³¨å†Œç®¡ç†"| OP1
    PR -.->|"æ³¨å†Œç®¡ç†"| OP2
    PR -.->|"æ³¨å†Œç®¡ç†"| OP3
    
    %% æ•°æ®è·¯ç”±æµ
    DR -->|"è·¯ç”±é€‰æ‹©"| SP1
    DR -->|"è·¯ç”±é€‰æ‹©"| FP1
    DR -->|"è·¯ç”±é€‰æ‹©"| CP1
    
    %% å¤–éƒ¨APIè¿æ¥
    SP1 --> API1
    SP2 --> API2
    SP3 --> API4
    SP4 --> API3
    
    FP1 --> API5
    FP2 --> API6
    FP3 --> API7
    
    CP1 --> API8
    CP2 --> API9
    CP3 --> API10
    CP4 --> API11
    
    OP1 --> API12
    OP2 --> API13
    OP3 --> API14
    
    %% ä¸€è‡´æ€§ä¿éšœ
    CC --> DV
    CC --> TC
    CC --> QC
    
    %% ç¼“å­˜ç®¡ç†
    CM -.->|"ç¼“å­˜ç­–ç•¥"| SP1
    CM -.->|"ç¼“å­˜ç­–ç•¥"| FP1
    CM -.->|"ç¼“å­˜ç­–ç•¥"| CP1
    
    %% å¥åº·ç›‘æ§
    HM -.->|"å¥åº·æ£€æŸ¥"| SP1
    HM -.->|"å¥åº·æ£€æŸ¥"| FP1
    HM -.->|"å¥åº·æ£€æŸ¥"| CP1
    
    %% æ ·å¼å®šä¹‰
    classDef app fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef service fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef manager fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef plugin fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef external fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef consistency fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    
    class APP app
    class SS,AS,TS,AIS service
    class DSM,PR,DR,CM,CC,HM manager
    class SP1,SP2,SP3,SP4,FP1,FP2,FP3,CP1,CP2,CP3,CP4,OP1,OP2,OP3 plugin
    class API1,API2,API3,API4,API5,API6,API7,API8,API9,API10,API11,API12,API13,API14 external
    class DV,TC,QC consistency