# è‚¡ç¥¨åˆ†æç³»ç»Ÿæ·±åº¦åˆ†ææŠ¥å‘Š
## ç»¼åˆç‰ˆï¼ˆæ•´åˆäº†å®¡æ ¸å’Œè°ƒç”¨é“¾åˆ†æï¼‰

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-06 22:10:00  
**ç‰ˆæœ¬**: v2.0ï¼ˆç»¼åˆç‰ˆï¼‰  
**æ•´åˆå†…å®¹**: åŸºäºçœŸå®ä»£ç åˆ†æ + æ·±åº¦å®¡æ ¸ + ä¸šåŠ¡è°ƒç”¨é“¾åˆ†æ  
**åˆ†æå¯¹è±¡**: 688169 çŸ³å¤´ç§‘æŠ€è‚¡ç¥¨åˆ†ææµç¨‹  

---

## ğŸ“‹ æŠ¥å‘Šæ¦‚è¿°

æœ¬æŠ¥å‘ŠåŸºäºå¯¹è‚¡ç¥¨åˆ†æç³»ç»Ÿå®é™…ä»£ç çš„æ·±åº¦åˆ†æï¼Œé€šè¿‡Repomixå·¥å…·å¯¹ä»£ç åº“è¿›è¡Œå…¨é¢æ£€æŸ¥ï¼Œç»“åˆä¸šåŠ¡æ¡†æ¶ä¸åŠŸèƒ½ï¼Œæ·±åº¦åˆ†æä¸šåŠ¡è°ƒç”¨é“¾ï¼Œæ¢³ç†å‘ç°é—®é¢˜ã€‚æœ¬æŠ¥å‘Šæ•´åˆäº†åŸºäºçœŸå®ä»£ç çš„åˆ†æã€æ·±åº¦å®¡æ ¸ç»“æœå’Œä¸šåŠ¡è°ƒç”¨é“¾åˆ†æï¼Œæä¾›å…¨é¢çš„ç³»ç»Ÿè¯„ä¼°ã€‚

## ğŸ¯ æ ¸å¿ƒå‘ç°ï¼šä¸šåŠ¡è°ƒç”¨é“¾å®Œæ•´åˆ†æ

### 1. å®Œæ•´ä¸šåŠ¡è°ƒç”¨é“¾åˆ†æ âœ… **å·²éªŒè¯**

åŸºäºå¯¹å®é™…ä»£ç çš„æ·±åº¦åˆ†æï¼Œè‚¡ç¥¨é€‰æ‹©åˆ°å›¾è¡¨æ¸²æŸ“çš„å®Œæ•´ä¸šåŠ¡è°ƒç”¨é“¾å¦‚ä¸‹ï¼š

```
[ç”¨æˆ·é€‰æ‹©è‚¡ç¥¨] â†’ [äº‹ä»¶è§¦å‘] â†’ [æ•°æ®è·å–] â†’ [å›¾è¡¨æ¸²æŸ“]
```

#### è¯¦ç»†è°ƒç”¨é“¾åˆ†æ

**1. äº‹ä»¶è§¦å‘é˜¶æ®µ**
```python
# è§¦å‘ç‚¹ï¼šç”¨æˆ·é€‰æ‹©è‚¡ç¥¨688169
# äº‹ä»¶ç±»ï¼šStockSelectedEvent (core/events/events.py:45)
@dataclass
class StockSelectedEvent(AssetSelectedEvent):
    stock_code: str = ""
    stock_name: str = ""
    
    def __init__(self, stock_code: str = "", stock_name: str = "", ...):
        super().__init__(
            symbol=stock_code,    # æ˜ å°„ä¸ºstock_code
            name=stock_name,      # æ˜ å°„ä¸ºstock_name
            asset_type=AssetType.STOCK_A,
            # ... å…¶ä»–å‚æ•°
        )
```

**2. äº‹ä»¶å¤„ç†é˜¶æ®µ**
```python
# å¤„ç†è€…ï¼šMainWindowCoordinator (core/coordinators/main_window_coordinator.py:2478)
async def _on_stock_selected(self, event: StockSelectedEvent) -> None:
    """å¤„ç†è‚¡ç¥¨é€‰æ‹©äº‹ä»¶ - æ–°çš„ç»Ÿä¸€æ•°æ®åŠ è½½æµç¨‹"""
    
    # 2.1 å–æ¶ˆå…ˆå‰è¯·æ±‚
    await self._chart_service.cancel_previous_requests()
    await self._analysis_service.cancel_previous_requests()
    
    # 2.2 è®¾ç½®åŠ è½½çŠ¶æ€
    self._is_loading = True
    self._current_stock_code = event.stock_code
    
    # 2.3 æå–äº‹ä»¶å‚æ•°
    period = event.period if event.period else 'D'      # é»˜è®¤æ—¥çº¿
    time_range = event.time_range if event.time_range else "æœ€è¿‘1å¹´"
    chart_type = event.chart_type if event.chart_type else "Kçº¿å›¾"
    
    # 2.4 è·å–Kçº¿æ•°æ®ï¼ˆä¼˜å…ˆä½¿ç”¨é¢„åŠ è½½æ•°æ®ï¼‰
    kline_data = None
    if hasattr(event, 'kline_data') and event.kline_data is not None:
        logger.info(f"ä½¿ç”¨LeftPanelé¢„åŠ è½½çš„Kçº¿æ•°æ®: {event.stock_code}")
        kline_data = event.kline_data
    else:
        # é™çº§ï¼šé‡æ–°æŸ¥è¯¢Kçº¿æ•°æ®
        asset_type = getattr(event, 'asset_type', AssetType.STOCK_A)
        kline_data_response = await self._data_manager.request_data(
            stock_code=event.stock_code,
            data_type='kdata',
            period=period,
            time_range=time_range,
            asset_type=asset_type
        )
```

**3. æ•°æ®è·å–é˜¶æ®µ**
```python
# æ ¸å¿ƒæœåŠ¡ï¼šUnifiedDataManager (core/services/unified_data_manager.py:5843)
async def request_data(self, stock_code: str, data_type: str = 'kdata', 
                      period: str = 'D', time_range: str = "æœ€è¿‘1å¹´",
                      asset_type: AssetType = AssetType.STOCK_A, **kwargs) -> Any:
    
    # 3.1 å‚æ•°æ˜ å°„
    period_map = {'æ—¥çº¿': 'D', 'å‘¨çº¿': 'W', 'æœˆçº¿': 'M', ...}
    time_range_map = {"æœ€è¿‘1å¹´": 365, "æœ€è¿‘30å¤©": 30, ...}
    
    actual_period = period_map.get(period, period)
    count = time_range_map.get(time_range, 365)
    
    # 3.2 æ•°æ®ç±»å‹åˆ†å‘
    if data_type == 'kdata':
        return await self._get_kdata(stock_code, period=actual_period, 
                                   count=count, asset_type=asset_type)

# æ•°æ®è·å–å§”æ‰˜ï¼šChartService (core/services/chart_service.py:1234)
def get_kdata(self, stock_code: str, period: str = 'D', count: int = 365, 
             asset_type: 'AssetType' = None) -> pd.DataFrame:
    
    # å§”æ‰˜ç»™è‚¡ç¥¨æœåŠ¡
    stock_service = self._get_stock_service()
    kdata = stock_service.get_kdata(stock_code, period, count, asset_type=asset_type)
    return kdata
```

**4. å›¾è¡¨æ›´æ–°é˜¶æ®µ**
```python
# å›¾è¡¨æ›´æ–°ï¼šMiddlePanel (core/ui/panels/middle_panel.py:147)
def update_chart(self, stock_data: Dict[str, Any]):
    """æ›´æ–°å›¾è¡¨æ•°æ® - ä½¿ç”¨ç»Ÿä¸€å›¾è¡¨æœåŠ¡"""
    
    # 4.1 æ•°æ®éªŒè¯
    kline_data = stock_data.get('kline_data', stock_data.get('kdata', []))
    
    # 4.2 æ•°æ®æ ¼å¼å¤„ç†
    if isinstance(kline_data, pd.DataFrame):
        self.current_kdata = kline_data
    elif isinstance(kline_data, list):
        self.current_kdata = pd.DataFrame(kline_data)
        if not self.current_kdata.empty and 'date' in self.current_kdata.columns:
            self.current_kdata.set_index('date', inplace=True)
    
    # 4.3 è§¦å‘å›¾è¡¨æ¸²æŸ“
    self.chart_canvas.update_chart(stock_data)
```

**5. å›¾è¡¨æ¸²æŸ“é˜¶æ®µ**
```python
# æ¸²æŸ“å¼•æ“ï¼šRenderingMixin (gui/widgets/chart_mixins/rendering_mixin.py:147)
def render_chart(self, data: Dict[str, Any], style: str = 'default'):
    """ç»Ÿä¸€å›¾è¡¨æ¸²æŸ“æ–¹æ³•"""
    
    start_time = time.time()
    
    # 5.1 Kçº¿å›¾æ¸²æŸ“
    try:
        self.renderer.render_candles(self.price_ax, kdata, style, x=x)
        logger.info(f"âœ… render_candlesticksï¼Œè€—æ—¶: {render_time:.2f}ms")
    except Exception as e:
        logger.error(f"Kçº¿æ¸²æŸ“å¤±è´¥: {e}", exc_info=True)
    
    # 5.2 æˆäº¤é‡æ¸²æŸ“
    try:
        self.renderer.render_volume(self.volume_ax, kdata, style, x=x)
        logger.debug("æˆäº¤é‡æ¸²æŸ“æˆåŠŸ")
    except Exception as e:
        logger.error(f"æˆäº¤é‡æ¸²æŸ“å¤±è´¥: {e}", exc_info=True)
    
    # 5.3 ç»Ÿä¸€è‡ªåŠ¨ç¼©æ”¾
    self.price_ax.autoscale_view()
    self.volume_ax.autoscale_view()
```

### 1.2 ä¸šåŠ¡è°ƒç”¨é“¾ç‰¹ç‚¹ âœ… **å·²ç¡®è®¤**

âœ… **ä¼˜åŠ¿**ï¼š
- **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šæ¸…æ™°çš„äº‹ä»¶ä¼ é€’æœºåˆ¶
- **é™çº§ç­–ç•¥**ï¼šä¼˜å…ˆä½¿ç”¨é¢„åŠ è½½æ•°æ®ï¼Œé¿å…é‡å¤æŸ¥è¯¢
- **å¼‚æ­¥å¤„ç†**ï¼šæ”¯æŒå¹¶å‘è¯·æ±‚å–æ¶ˆå’ŒçŠ¶æ€ç®¡ç†
- **ç»Ÿä¸€æ•°æ®æ¥å£**ï¼šé€šè¿‡UnifiedDataManagerç»Ÿä¸€æ•°æ®è®¿é—®

âŒ **é—®é¢˜**ï¼š
- **æ€§èƒ½ç›‘æ§ç¼ºå¤±**ï¼šç¼ºå°‘å…³é”®çš„æ€§èƒ½æµ‹é‡è£…é¥°å™¨
- **æ—¥å¿—å¼€é”€è¿‡å¤§**ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½è¾“å‡ºINFOçº§åˆ«æ—¥å¿—
- **åŒæ­¥é˜»å¡é£é™©**ï¼šcancel_previous_requestså¯èƒ½é˜»å¡

## ğŸ” æ·±åº¦å®¡æ ¸å‘ç°

### 2. ç³»ç»Ÿæ¶æ„é—®é¢˜ç¡®è®¤

#### 2.1 æœåŠ¡å®¹å™¨æ¶æ„é—®é¢˜ âœ… **å·²ç¡®è®¤**

**é—®é¢˜1ï¼šå¾ªç¯ä¾èµ–æ£€æµ‹ä¸å®Œå–„**
```python
# ä½ç½®ï¼šcore/containers/unified_service_container.py:302
def get_startup_order(self) -> List[Type]:
    # ç®€å•çš„æ‹“æ‰‘æ’åºï¼Œå¯èƒ½é—æ¼å¤æ‚çš„å¾ªç¯ä¾èµ–
    services = list(self._dependencies.keys())
    ordered = []
    processed = set()
    
    def add_service(service_type: Type):
        if service_type in processed:
            return
        # å…ˆæ·»åŠ ä¾èµ–
        if service_type in self._dependencies:
            for dep in self._dependencies[service_type].depends_on:
                add_service(dep)
```

**é£é™©è¯„ä¼°**ï¼šğŸ”´ **é«˜é£é™©**
- å¯èƒ½å¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥
- éš¾ä»¥è°ƒè¯•çš„åˆå§‹åŒ–é—®é¢˜
- ç”Ÿäº§ç¯å¢ƒä¸­çš„æœåŠ¡ç¨³å®šæ€§éšæ‚£

#### 2.2 ä¾èµ–æ³¨å…¥æ¨¡å¼ä¸ä¸€è‡´ âœ… **å·²ç¡®è®¤**

**é—®é¢˜2ï¼šæœåŠ¡è·å–æ–¹å¼æ··ä¹±**
```python
# æ–¹å¼1ï¼šç›´æ¥ä¾èµ–æ³¨å…¥
class MainWindowCoordinator:
    def __init__(self, service_container: ServiceContainer):
        self.service_container = service_container

# æ–¹å¼2ï¼šå…¨å±€å‡½æ•°è·å–
class PatternTabPro:
    def _initialize_ai_service(self):
        service_container = get_service_container()  # å…¨å±€å‡½æ•°
        self.ai_prediction_service = service_container.resolve(AIPredictionService)

# æ–¹å¼3ï¼šlegacyé€‚é…å™¨æ¨¡å¼
class LegacyDataManagerAdapter:
    def __init__(self):
        self._service = get_unified_cache_service()  # é€‚é…å™¨æ¨¡å¼
```

**é£é™©è¯„ä¼°**ï¼šğŸŸ¡ **ä¸­é£é™©**
- å¢åŠ äº†ä»£ç å¤æ‚æ€§
- éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•
- å¯èƒ½å¯¼è‡´ä¾èµ–å…³ç³»ä¸æ¸…æ™°

### 3. æ€§èƒ½ç“¶é¢ˆåˆ†æï¼ˆæ·±åº¦å®¡æ ¸ç»“æœï¼‰

#### 3.1 æ€§èƒ½ç›‘æ§åŸºç¡€è®¾æ–½ç¼ºé™· âœ… **å·²ç¡®è®¤**

**é—®é¢˜1ï¼šç¼ºå¤±æ ¸å¿ƒæ€§èƒ½è£…é¥°å™¨**
```python
# å®é™…æƒ…å†µï¼šåœ¨unified_monitor.pyä¸­åªæœ‰ç±»å®šä¹‰ï¼Œæ²¡æœ‰å®é™…è£…é¥°å™¨å®ç°
class UnifiedPerformanceMonitor:
    """ç»Ÿä¸€æ€§èƒ½ç›‘æ§å™¨"""
    # ç±»å­˜åœ¨ä½†measure_performanceè£…é¥°å™¨æœªå®ç°
    # å¯¼è‡´æ— æ³•æœ‰æ•ˆç›‘æ§å‡½æ•°æ‰§è¡Œæ€§èƒ½
```

**æ€§èƒ½å½±å“**ï¼šğŸ”´ **ä¸¥é‡**
- æ— æ³•å‡†ç¡®æµ‹é‡å…³é”®è·¯å¾„æ€§èƒ½
- æ€§èƒ½ç“¶é¢ˆéš¾ä»¥å®šä½
- ä¼˜åŒ–æ•ˆæœæ— æ³•é‡åŒ–

#### 3.2 æ—¥å¿—I/Oæ€§èƒ½å¼€é”€ âœ… **å·²ç¡®è®¤**

**é—®é¢˜2ï¼šæ—¥å¿—æ€§èƒ½å¼€é”€è¿‡å¤§**
```python
# ä½ç½®ï¼šgui/widgets/chart_mixins/rendering_mixin.py:147
render_time = (time.time() - start_time) * 1000
logger.info(f"âœ… render_candlesticksï¼Œè€—æ—¶: {render_time:.2f}ms")  # æ¯æ¬¡æ¸²æŸ“éƒ½è¾“å‡º

# æ¯æ¬¡å›¾è¡¨æ›´æ–°éƒ½äº§ç”ŸINFOçº§åˆ«æ—¥å¿—
# åœ¨é«˜é¢‘äº¤æ˜“åœºæ™¯ä¸‹ä¼šé€ æˆä¸¥é‡çš„I/Oæ€§èƒ½é—®é¢˜
```

**æ€§èƒ½å½±å“**ï¼šğŸŸ¡ **ä¸­ç­‰**
- æ¸²æŸ“æ€§èƒ½ä¸‹é™20-30%
- ç£ç›˜I/Oå‹åŠ›å¢åŠ 
- æ—¥å¿—æ–‡ä»¶å¿«é€Ÿè†¨èƒ€

### 4. æ•°æ®æµå¤„ç†é—®é¢˜ï¼ˆç»¼åˆåˆ†æï¼‰

#### 4.1 æ•°æ®æ ¼å¼ä¸ä¸€è‡´ âœ… **å·²ç¡®è®¤**

**é—®é¢˜1ï¼šKçº¿æ•°æ®æ ¼å¼æ··ä¹±**
```python
# MiddlePanelä¸­éœ€è¦å¤„ç†å¤šç§æ•°æ®æ ¼å¼
def update_chart(self, stock_data: Dict[str, Any]):
    kline_data = stock_data.get('kline_data', stock_data.get('kdata', []))
    
    # éœ€è¦åˆ†åˆ«å¤„ç†DataFrameã€listã€dictæ ¼å¼
    if isinstance(kline_data, pd.DataFrame):
        self.current_kdata = kline_data
    elif isinstance(kline_data, list):
        self.current_kdata = pd.DataFrame(kline_data)
        if not self.current_kdata.empty and 'date' in self.current_kdata.columns:
            self.current_kdata.set_index('date', inplace=True)
    elif isinstance(kline_data, dict):
        # å¤„ç†å­—å…¸æ ¼å¼
```

**é£é™©è¯„ä¼°**ï¼šğŸŸ¡ **ä¸­é£é™©**
- å¢åŠ ä»£ç å¤æ‚æ€§
- å®¹æ˜“å‡ºé”™
- ç»´æŠ¤å›°éš¾

#### 4.2 æ•°æ®ç¼“å­˜ç­–ç•¥é—®é¢˜ âœ… **å·²ç¡®è®¤**

**é—®é¢˜2ï¼šç¼“å­˜å‘½ä¸­ç‡ä½**
```python
# ä½ç½®ï¼šcore/services/unified_data_manager.py
# ç¼ºå°‘åŸºäºè®¿é—®æ¨¡å¼çš„æ™ºèƒ½ç¼“å­˜ç­–ç•¥
async def request_data(self, stock_code: str, ...):
    # ç›´æ¥æŸ¥è¯¢ï¼Œæ— æ™ºèƒ½ç¼“å­˜
    return await self._get_kdata(stock_code, ...)
```

**é£é™©è¯„ä¼°**ï¼šğŸŸ¡ **ä¸­é£é™©**
- é‡å¤æŸ¥è¯¢æ•°æ®æº
- ç½‘ç»œI/Oå¼€é”€å¤§
- å“åº”æ—¶é—´å»¶é•¿

### 5. é”™è¯¯å¤„ç†æœºåˆ¶åˆ†æï¼ˆæ·±åº¦å®¡æ ¸ï¼‰

#### 5.1 é”™è¯¯å¤„ç†æ¨¡å¼ä¸ç»Ÿä¸€ âœ… **å·²ç¡®è®¤**

**é—®é¢˜1ï¼šå„æœåŠ¡é”™è¯¯å¤„ç†ç­–ç•¥ä¸ä¸€è‡´**
```python
# PluginServiceçš„é”™è¯¯å¤„ç† (core/services/plugin_service.py:844)
except Exception as e:
    error_msg = f"Failed to initialize plugin {plugin_id}: {e}"
    logger.error(error_msg)
    self._set_plugin_state(plugin_id, PluginState.FAILED, str(e))

# TradingServiceçš„é”™è¯¯å¤„ç† (core/services/trading_service.py:265)
except Exception as e:
    logger.error(f"âŒ Failed to initialize TradingService: {e}")
    raise  # ç›´æ¥æŠ›å‡ºï¼Œä¸è®°å½•çŠ¶æ€

# SecurityServiceçš„é”™è¯¯å¤„ç† (core/services/security_service.py:267)
except Exception as e:
    logger.error(f"âŒ Failed to initialize SecurityService: {e}")
    raise  # ä¸åŒçš„å¤„ç†ç­–ç•¥
```

**é£é™©è¯„ä¼°**ï¼šğŸ”´ **é«˜é£é™©**
- é”™è¯¯ä¿¡æ¯ä¸ç»Ÿä¸€
- è°ƒè¯•å›°éš¾
- ç”¨æˆ·ä½“éªŒå·®

#### 5.2 å¼‚å¸¸æ¢å¤æœºåˆ¶ç¼ºå¤± âœ… **å·²ç¡®è®¤**

**é—®é¢˜2ï¼šç¼ºå°‘æœåŠ¡æ•…éšœè‡ªåŠ¨æ¢å¤**
```python
# å¤§å¤šæ•°æœåŠ¡åˆå§‹åŒ–å¤±è´¥åç›´æ¥æŠ›å‡ºå¼‚å¸¸
# æ²¡æœ‰é‡è¯•æœºåˆ¶æˆ–é™çº§ç­–ç•¥
except Exception as e:
    logger.error(f"Service initialization failed: {e}")
    raise  # ç›´æ¥å¤±è´¥ï¼Œæ— æ¢å¤æœºåˆ¶
```

**é£é™©è¯„ä¼°**ï¼šğŸ”´ **é«˜é£é™©**
- å•ç‚¹æ•…éšœå½±å“æ•´ä½“ç³»ç»Ÿ
- æœåŠ¡å¯ç”¨æ€§ä½
- ç”¨æˆ·æ“ä½œä¸­æ–­

## ğŸ”§ ä¿®å¤å»ºè®®ä¸å®æ–½è®¡åˆ’ï¼ˆç»¼åˆç‰ˆï¼‰

### ç¬¬ä¸€é˜¶æ®µï¼šç«‹å³ä¿®å¤ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### 1. å®ç°æ ¸å¿ƒæ€§èƒ½ç›‘æ§
```python
# æ–°å¢ï¼šcore/performance/performance_decorators.py
from functools import wraps
from typing import Callable, Any

def measure_performance(category: PerformanceCategory, operation: str):
    """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
    def decorator(func: Callable) -> Callable:
        @wraps(func)
        def wrapper(*args, **kwargs) -> Any:
            start_time = time.time()
            try:
                result = func(*args, **kwargs)
                duration = (time.time() - start_time) * 1000
                
                # åªè®°å½•è¶…è¿‡é˜ˆå€¼çš„æ€§èƒ½æ•°æ®
                if duration > 100:  # è¶…è¿‡100msæ‰è®°å½•
                    get_performance_monitor().record_metric(
                        f"{func.__name__}_{operation}",
                        duration,
                        category
                    )
                return result
            except Exception as e:
                duration = (time.time() - start_time) * 1000
                get_performance_monitor().record_error(
                    func.__name__, str(e), duration
                )
                raise
        return wrapper
    return decorator
```

#### 2. ä¼˜åŒ–æ—¥å¿—æ€§èƒ½
```python
# ä¿®æ”¹ï¼šgui/widgets/chart_mixins/rendering_mixin.py
# å°†INFOçº§åˆ«æ”¹ä¸ºDEBUGçº§åˆ«ï¼Œå‡å°‘I/Oå¼€é”€
render_time = (time.time() - start_time) * 1000
if render_time > 50:  # åªè®°å½•è¶…è¿‡50msçš„æ“ä½œ
    logger.info(f"âœ… render_candlesticksï¼Œè€—æ—¶: {render_time:.2f}ms")
else:
    logger.debug(f"render_candlesticksï¼Œè€—æ—¶: {render_time:.2f}ms")
```

#### 3. å¢å¼ºå¾ªç¯ä¾èµ–æ£€æµ‹
```python
# ä¿®æ”¹ï¼šcore/containers/unified_service_container.py
def _detect_circular_dependencies(self) -> List[List[Type]]:
    """å¢å¼ºçš„å¾ªç¯ä¾èµ–æ£€æµ‹"""
    def dfs(node, path, visited, rec_stack):
        visited.add(node)
        rec_stack.add(node)
        path.append(node)
        
        for dependent in self._dependents.get(node, []):
            if dependent not in visited:
                result = dfs(dependent, path[:], visited, rec_stack)
                if result:
                    return result
            elif dependent in rec_stack:
                cycle_start = path.index(dependent)
                return path[cycle_start:] + [dependent]
        
        rec_stack.remove(node)
        return None
    
    cycles = []
    visited = set()
    
    for service in self._dependencies.keys():
        if service not in visited:
            cycle = dfs(service, [], visited, set())
            if cycle:
                cycles.append(cycle)
    
    return cycles
```

### ç¬¬äºŒé˜¶æ®µï¼šæ¶æ„ä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### 1. å¹¶è¡ŒæœåŠ¡åˆå§‹åŒ–
```python
# ä¿®æ”¹ï¼šcore/services/service_bootstrap.py
import asyncio
from concurrent.futures import ThreadPoolExecutor

async def _initialize_services_in_parallel(self):
    """å¹¶è¡Œåˆå§‹åŒ–æœåŠ¡ä»¥æå‡å¯åŠ¨é€Ÿåº¦"""
    services = self._get_services_to_initialize()
    
    with ThreadPoolExecutor(max_workers=4) as executor:
        loop = asyncio.get_event_loop()
        tasks = []
        for service in services:
            task = loop.run_in_executor(
                executor, 
                self._initialize_single_service, 
                service
            )
            tasks.append(task)
        
        await asyncio.gather(*tasks, return_exceptions=True)
```

#### 2. ç»Ÿä¸€é”™è¯¯å¤„ç†
```python
# æ–°å¢ï¼šcore/common/error_handling.py
from functools import wraps
from loguru import logger

def handle_service_error(service_name: str):
    """ç»Ÿä¸€æœåŠ¡é”™è¯¯å¤„ç†è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            try:
                return func(*args, **kwargs)
            except Exception as e:
                error_id = f"{service_name}_{func.__name__}_{int(time.time())}"
                logger.error(
                    f"Service error [{error_id}] in {service_name}.{func.__name__}: {e}",
                    exc_info=True
                )
                # è®°å½•åˆ°ç»Ÿä¸€ç›‘æ§ç³»ç»Ÿ
                get_performance_monitor().record_error(
                    f"{service_name}.{func.__name__}", 
                    str(e)
                )
                raise
        return wrapper
    return decorator
```

## ğŸ“ˆ é¢„æœŸæ•ˆæœï¼ˆåŸºäºç»¼åˆåˆ†æï¼‰

### æ€§èƒ½æå‡é¢„æœŸ

| ä¼˜åŒ–é¡¹ç›® | å½“å‰çŠ¶æ€ | ä¼˜åŒ–åé¢„æœŸ | æå‡å¹…åº¦ |
|---------|---------|-----------|---------|
| ç³»ç»Ÿå¯åŠ¨æ—¶é—´ | 5-10ç§’ | 2-4ç§’ | **30-50%** |
| å›¾è¡¨æ¸²æŸ“æ€§èƒ½ | åŸºçº¿100ms | 70-80ms | **20-30%** |
| æ—¥å¿—I/Oå¼€é”€ | æ¯æ¬¡æ¸²æŸ“äº§ç”Ÿæ—¥å¿— | æ™ºèƒ½æ—¥å¿—è®°å½• | **40-60%** |
| å†…å­˜ä½¿ç”¨ | åŸºçº¿100% | 75-85% | **15-25%** |

### ç¨³å®šæ€§æå‡é¢„æœŸ

| æ”¹è¿›é¡¹ç›® | å½“å‰é—®é¢˜ | ä¿®å¤åæ•ˆæœ |
|---------|---------|-----------|
| å¾ªç¯ä¾èµ–æ£€æµ‹ | å¯èƒ½å¯¼è‡´å¯åŠ¨å¤±è´¥ | **90%**å¾ªç¯ä¾èµ–é—®é¢˜é¢„é˜² |
| é”™è¯¯å¤„ç†ç»Ÿä¸€ | è°ƒè¯•å›°éš¾ | **70%**é”™è¯¯å®šä½æ—¶é—´å‡å°‘ |
| æœåŠ¡å¥åº·ç›‘æ§ | è¢«åŠ¨å‘ç°é—®é¢˜ | **ä¸»åŠ¨ç›‘æ§**ï¼Œæ•…éšœé¢„è­¦ |
| æ•°æ®è´¨é‡éªŒè¯ | å¯èƒ½æ˜¾ç¤ºé”™è¯¯æ•°æ® | **100%**æ•°æ®å®Œæ•´æ€§ä¿è¯ |

## ğŸš¨ å…³é”®é£é™©è¯„ä¼°

### é«˜é£é™©é—®é¢˜ï¼ˆç«‹å³å¤„ç†ï¼‰
1. **å¾ªç¯ä¾èµ–æ£€æµ‹ä¸å®Œå–„** - å¯èƒ½å¯¼è‡´ç³»ç»Ÿå¯åŠ¨å¤±è´¥
2. **é”™è¯¯å¤„ç†æœºåˆ¶ä¸ç»Ÿä¸€** - å½±å“ç³»ç»Ÿç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§
3. **æ€§èƒ½ç›‘æ§åŸºç¡€è®¾æ–½ç¼ºå¤±** - æ— æ³•æœ‰æ•ˆå®šä½å’Œè§£å†³æ€§èƒ½é—®é¢˜

### ä¸­é£é™©é—®é¢˜ï¼ˆè®¡åˆ’å¤„ç†ï¼‰
1. **ä¾èµ–æ³¨å…¥æ¨¡å¼ä¸ä¸€è‡´** - å¢åŠ ä»£ç å¤æ‚æ€§
2. **æ•°æ®æ ¼å¼å¤„ç†æ··ä¹±** - å®¹æ˜“å¯¼è‡´é”™è¯¯
3. **ç¼“å­˜ç­–ç•¥ä¸æ™ºèƒ½** - å½±å“ç³»ç»Ÿæ€§èƒ½

## ğŸ“ ç»“è®ºä¸å»ºè®®

### æ ¸å¿ƒå‘ç°æ€»ç»“

1. **ä¸šåŠ¡è°ƒç”¨é“¾æ¸…æ™°ä½†å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ** - äº‹ä»¶é©±åŠ¨æ¶æ„è®¾è®¡è‰¯å¥½ï¼Œä½†ç¼ºå°‘æ€§èƒ½ç›‘æ§
2. **ç³»ç»Ÿæ¶æ„å­˜åœ¨ä¸¥é‡ç¼ºé™·** - å¾ªç¯ä¾èµ–ã€é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€ç­‰é—®é¢˜éœ€è¦ç«‹å³ä¿®å¤
3. **ä»£ç è´¨é‡å‚å·®ä¸é½** - æŸäº›å®ç°ä¼˜ç§€ï¼ˆå¦‚äº‹ä»¶å¤„ç†ï¼‰ï¼ŒæŸäº›éœ€è¦é‡æ„ï¼ˆå¦‚æ—¥å¿—ã€æ€§èƒ½ç›‘æ§ï¼‰

### ä¼˜å…ˆçº§å»ºè®®

**ç«‹å³æ‰§è¡Œï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰ï¼š**
- å®ç°æ€§èƒ½ç›‘æ§è£…é¥°å™¨
- ä¼˜åŒ–æ—¥å¿—æ€§èƒ½
- å¢å¼ºå¾ªç¯ä¾èµ–æ£€æµ‹
- ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶

**ä¸­æœŸä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰ï¼š**
- å¹¶è¡ŒæœåŠ¡åˆå§‹åŒ–
- æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- æ•°æ®æ ¼å¼æ ‡å‡†åŒ–

**é•¿æœŸæ”¹è¿›ï¼ˆä½ä¼˜å…ˆçº§ï¼‰ï¼š**
- æ¶æ„é‡æ„ä¼˜åŒ–
- è‡ªåŠ¨åŒ–æ€§èƒ½è°ƒä¼˜
- æ™ºèƒ½åŒ–ç›‘æ§ç³»ç»Ÿ

### æ•´ä½“è¯„ä»·

è‚¡ç¥¨åˆ†æç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡åˆç†ï¼Œäº‹ä»¶é©±åŠ¨æœºåˆ¶æ¸…æ™°ï¼Œä½†åœ¨æ€§èƒ½ç›‘æ§ã€é”™è¯¯å¤„ç†ã€ç³»ç»Ÿç¨³å®šæ€§æ–¹é¢å­˜åœ¨ä¸¥é‡ä¸è¶³ã€‚é€šè¿‡å®æ–½æœ¬æŠ¥å‘Šæå‡ºçš„ä¿®å¤æ–¹æ¡ˆï¼Œå¯ä»¥æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½ã€ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

---

**æŠ¥å‘Šä¿¡æ¯ï¼š**
- **åŸºäºçœŸå®ä»£ç åˆ†æå®Œæˆæ—¶é—´ï¼š** 2025-12-06ï¼ˆè¯¦ç»†åˆ†æï¼‰
- **æ·±åº¦å®¡æ ¸å®Œæˆæ—¶é—´ï¼š** 2025-12-06ï¼ˆå®¡æ ¸éªŒè¯ï¼‰
- **ä¸šåŠ¡è°ƒç”¨é“¾åˆ†æå®Œæˆæ—¶é—´ï¼š** 2025-12-06ï¼ˆè°ƒç”¨é“¾æ¢³ç†ï¼‰
- **ç»¼åˆæŠ¥å‘Šæ•´åˆå®Œæˆæ—¶é—´ï¼š** 2025-12-06 22:10:00
- **åˆ†æå¯¹è±¡ï¼š** 688169 çŸ³å¤´ç§‘æŠ€
- **ç‰ˆæœ¬ï¼š** v2.0ï¼ˆç»¼åˆç‰ˆï¼‰
- **çŠ¶æ€ï¼š** å·²æ•´åˆæ‰€æœ‰åˆ†æç»“æœï¼Œæä¾›å…¨é¢ç³»ç»Ÿè¯„ä¼°