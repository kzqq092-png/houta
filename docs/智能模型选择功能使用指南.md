# 智能模型选择功能使用指南

## 🎯 功能概述

智能模型选择功能是FactorWeave-Quant系统的核心AI预测功能，能够根据实时市场状态自动选择最优的预测模型组合，为投资决策提供科学依据。

## 📍 如何访问智能模型选择界面

### 主要访问方式
1. **菜单栏访问**: 点击顶部菜单栏 → **"分析"** → **"智能模型选择"**
2. **快捷键**: 直接按 **Ctrl+M** 键快速打开
3. **状态提示**: 菜单项会显示状态提示"打开智能模型选择界面，根据市场状态自动选择最优模型"

### 界面位置说明
- **主要界面**: 对话框形式，可以居中显示在屏幕中央
- **备用方案**: 如果对话框导入失败，系统会自动降级到控制面板模式
- **防止重复**: 系统会检测是否已有打开的智能模型选择窗口，避免重复打开

## 🔧 界面功能说明

### 1. 智能模型选择对话框
- **窗口标题**: "智能模型选择"
- **最小尺寸**: 500x700像素
- **主要组件**: 包含控制面板和智能选择器实例

### 2. 控制面板功能
- **系统状态监控**: 实时显示系统运行状态、活跃模型数量、今日预测次数
- **配置参数设置**: 可调整各种预测参数和选择策略
- **快捷操作控制**: 提供一键启动、停止、重置等功能

### 3. 智能选择器核心功能
- **市场状态检测**: 实时分析波动率、趋势强度、市场阶段、流动性
- **模型性能评估**: 对可用模型进行性能评估和排名
- **动态选择策略**: 基于多标准决策分析选择最优模型组合
- **预测结果融合**: 将多个模型的预测结果进行智能融合

## 🚀 使用流程

### 步骤1: 启动应用
```bash
python main.py
```

### 步骤2: 打开智能模型选择
- 使用菜单: 分析 → 智能模型选择
- 或使用快捷键: Ctrl+M

### 步骤3: 配置预测参数
1. **选择预测类型**: 
   - 价格预测
   - 趋势预测
   - 波动率预测
   - 模式识别
   - 情绪分析

2. **设置数据源**: 
   - 选择市场数据源
   - 配置时间范围
   - 设置数据频率

3. **调整选择策略**: 
   - 自动选择模式
   - 手动权重配置
   - 融合方法设置

### 步骤4: 执行智能预测
- 点击"开始智能预测"按钮
- 系统将自动执行以下流程：
  1. 市场状态检测
  2. 模型性能评估
  3. 最优模型选择
  4. 预测结果融合

### 步骤5: 查看结果
- **市场状态**: 显示当前市场波动率、趋势强度等指标
- **选择模型**: 显示被选中的模型及其权重
- **预测结果**: 展示融合后的最终预测结果
- **置信度**: 显示预测的可信度评估

## 📊 核心组件详解

### 1. 市场状态检测器 (MarketStateDetector)
- **波动率分析**: 计算市场波动程度，判断是否处于高/低波动环境
- **趋势强度**: 评估当前市场趋势的强弱程度
- **市场阶段**: 识别市场处于牛市、熊市或震荡市
- **流动性监控**: 分析市场流动性状况

### 2. 模型性能评估器 (ModelPerformanceEvaluator)
- **准确率评估**: 基于历史数据评估模型预测准确率
- **稳定性分析**: 评估模型在不同市场环境下的表现稳定性
- **延迟监控**: 记录模型推理时间，优化性能
- **内存使用**: 监控模型资源消耗

### 3. 选择策略引擎 (ModelSelectionStrategy)
- **多标准决策**: 基于AHP、TOPSIS等方法进行模型选择
- **权重优化**: 动态调整模型权重
- **约束处理**: 考虑用户设定的各种约束条件
- **适应性调整**: 根据市场环境变化调整选择策略

### 4. 预测融合引擎 (PredictionFusionEngine)
- **加权平均**: 根据模型性能分配不同权重
- **投票机制**: 多数投票或加权投票
- **置信度融合**: 考虑各模型的预测置信度
- **不确定性量化**: 提供预测结果的不确定性评估

## ⚙️ 配置参数说明

### 市场检测配置
```python
{
    'volatility': {
        'high_vol_threshold': 0.25,  # 高波动阈值
        'low_vol_threshold': 0.05,   # 低波动阈值
        'window_size': 20           # 计算窗口大小
    },
    'trend': {
        'strong_threshold': 0.8,     # 强趋势阈值
        'weak_threshold': 0.2,       # 弱趋势阈值
        'lookback_period': 50        # 回看周期
    }
}
```

### 性能评估配置
```python
{
    'evaluation_period': 30,        # 评估周期(天)
    'min_samples': 100,             # 最少样本数
    'metrics': ['accuracy', 'precision', 'recall', 'f1'],
    'weighting': 'recent_focused'    # 权重策略
}
```

### 融合策略配置
```python
{
    'fusion_method': 'weighted_average',  # 融合方法
    'confidence_weighting': True,         # 是否使用置信度加权
    'dynamic_weights': True,              # 是否动态调整权重
    'uncertainty_threshold': 0.1         # 不确定性阈值
}
```

## 🔍 高级功能

### 1. 缓存机制
- **智能缓存**: 自动缓存预测结果，提高响应速度
- **缓存大小控制**: 可配置最大缓存条目数
- **过期策略**: 基于时间戳的缓存过期机制
- **缓存统计**: 实时显示缓存命中率

### 2. 性能监控
- **处理时间统计**: 记录每次预测的处理耗时
- **成功率监控**: 跟踪预测成功率
- **资源使用**: 监控内存和CPU使用情况
- **错误日志**: 详细记录错误信息和回退策略

### 3. 错误处理与回退
- **多重保护**: 多层级的错误处理机制
- **自动回退**: 预测失败时自动切换到后备策略
- **优雅降级**: 在部分功能失败时保持核心功能可用
- **详细日志**: 完整的错误追踪和诊断信息

## 📈 使用技巧

### 1. 优化预测效果
- **数据质量**: 确保输入的市场数据质量高、时效性强
- **参数调优**: 根据实际应用场景调整选择策略参数
- **模型组合**: 根据预测类型选择合适的模型组合
- **定期更新**: 定期更新模型档案和配置参数

### 2. 性能优化建议
- **合理设置缓存**: 根据内存情况设置合适的缓存大小
- **监控资源使用**: 定期检查系统资源使用情况
- **优化模型选择**: 根据实际准确率调整模型权重
- **批处理模式**: 对于大批量预测，建议使用批处理模式

### 3. 问题排查
- **检查日志**: 查看系统日志了解详细错误信息
- **验证数据**: 确保输入数据格式正确且数据完整
- **测试单个组件**: 单独测试各个组件功能是否正常
- **重启服务**: 在遇到问题时尝试重启智能选择服务

## 🆘 常见问题解决

### Q1: 无法打开智能模型选择界面
**解决方案**:
1. 检查菜单项是否存在: 分析 → 智能模型选择
2. 尝试使用快捷键 Ctrl+M
3. 查看系统日志中的错误信息
4. 重启应用程序

### Q2: 导入错误或功能不可用
**解决方案**:
1. 确认所有依赖模块已正确安装
2. 检查Python环境配置
3. 验证智能模型选择相关文件完整性
4. 运行集成测试脚本验证功能

### Q3: 预测结果不准确
**解决方案**:
1. 检查输入数据的质量和时效性
2. 调整市场状态检测参数
3. 优化模型选择策略配置
4. 增加历史数据训练样本

### Q4: 系统性能下降
**解决方案**:
1. 清理缓存数据
2. 调整缓存大小限制
3. 优化模型选择算法参数
4. 检查系统资源使用情况

## 📞 技术支持

如果在使用过程中遇到技术问题，请：

1. **查看日志**: 检查系统日志文件中的详细错误信息
2. **运行诊断**: 使用集成测试脚本进行功能诊断
3. **检查配置**: 验证配置文件参数设置是否正确
4. **重启服务**: 尝试重启相关服务和应用程序

---

*本指南涵盖了智能模型选择功能的所有主要使用方法和配置选项。如需更详细的技术实现信息，请参考项目源代码和相关技术文档。*