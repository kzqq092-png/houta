# 数据库目录统一完成报告

## 执行日期
2025-10-23

## 统一方案

### 目标
1. 统一使用 `data/` 目录存储所有数据库文件
2. 规范文件后缀：DuckDB使用`.duckdb`，SQLite使用`.sqlite`
3. 清理`db/`目录，避免与代码目录混淆

## 已完成的配置更新

### 1. 资产数据库 (core/asset_database_manager.py)
```python
base_path: str = "data/databases"
```

### 2. 分析数据库 (core/database/factorweave_analytics_db.py)
```python
db_path: str = 'data/factorweave_analytics.duckdb'
```

### 3. 系统配置数据库
以下文件已更新：
- core/services/unified_data_manager.py
- core/ai/data_anomaly_detector.py
- gui/dialogs/database_admin_dialog.py  
- core/importdata/import_config_manager.py
- core/coordinators/main_window_coordinator.py
- core/services/database_service.py
- core/services/enhanced_data_manager.py
- gui/dialogs/settings_dialog.py
- gui/widgets/performance/unified_performance_widget.py
- optimization/version_manager.py
- optimization/database_schema.py
- evaluation/risk_evaluation.py
- analysis/system_health_checker.py
- core/database/sqlite_extensions.py
- core/integration/system_integration_manager.py
- core/importdata/intelligent_config_manager.py
- core/strategy/strategy_database.py
- core/services/progress_persistence_manager.py
- core/services/enhanced_duckdb_data_downloader.py
- core/metrics/repository.py
- core/ai/config_recommendation_engine.py
- core/ai/config_impact_analyzer.py
- core/risk_rule_manager.py
- core/adapters.py
- backtest/real_time_backtest_monitor.py
- db/models/ai_config_models.py
- db/models/duckdb_config_models.py
- db/models/performance_history_models.py
- db/models/plugin_models.py
- db/models/alert_config_models.py
- core/services/plugin_database_service.py
- core/indicator_adapter.py

## 目录结构（统一后）

```
hikyuu-ui/
├── data/                           # 数据存储目录
│   ├── databases/                  # 资产数据库
│   │   ├── stock_a/
│   │   │   └── stock_a_data.duckdb
│   │   ├── crypto/
│   │   │   └── crypto_data.duckdb
│   │   └── ...
│   ├── factorweave_analytics.duckdb   # 分析数据库
│   ├── factorweave_system.sqlite      # 系统配置
│   ├── metrics.sqlite                  # 指标数据
│   └── ...
│
├── db/                             # 数据库代码目录
│   ├── models/                     # 数据模型
│   └── init_database_and_tables.py # 初始化脚本
│
└── core/
    ├── database/                   # 数据库核心代码
    └── ...
```

## 文件后缀规范

### DuckDB文件 (.duckdb)
- 资产数据库
- 分析数据库
- K线数据
- 基本面数据

### SQLite文件 (.sqlite)
- 系统配置
- 质量监控
- 风险监控
- 任务状态
- 策略数据

## 优点总结

1. **目录职责清晰**：
   - `data/` - 数据存储
   - `db/` - 数据库代码和脚本
   - `core/database/` - 数据库核心代码

2. **易于管理**：
   - 所有数据库文件在一个目录
   - 备份和迁移更简单
   - 文件后缀规范

3. **避免混淆**：
   - `db/`不再包含数据文件
   - 减少路径歧义

