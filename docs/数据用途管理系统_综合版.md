# æ•°æ®ç”¨é€”ç®¡ç†ç³»ç»Ÿ_ç»¼åˆç‰ˆ

## ğŸ“š ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„æ™ºèƒ½æ•°æ®ç”¨é€”ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬UIå¼ºåˆ¶é€‰æ‹©ã€è‡ªåŠ¨æ ‡è®°ç®¡ç†ã€æ™ºèƒ½è¯†åˆ«ã€è´¨é‡è¯„åˆ†ä¼˜åŒ–ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç³»ç»Ÿé€šè¿‡å¤šç§æ–¹æ³•è‡ªåŠ¨è¯†åˆ«æ•°æ®ç”¨é€”ï¼Œå¹¶æ ¹æ®ç”¨é€”åŠ¨æ€è°ƒæ•´è´¨é‡è¯„åˆ†æƒé‡ï¼Œç¡®ä¿æ•°æ®è¯„ä¼°çš„å‡†ç¡®æ€§å’Œé€‚ç”¨æ€§ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. UIå¼ºåˆ¶æ•°æ®ç”¨é€”é€‰æ‹©

**åŠŸèƒ½ä½ç½®**: `gui/widgets/enhanced_data_import_widget.py`

#### ä¸‹æ‹‰æ¡†ç»„ä»¶
```python
# ğŸ¯ æ•°æ®ç”¨é€”ï¼ˆæ–°å¢ï¼‰- ç”¨äºæ™ºèƒ½æƒé‡é…ç½®
self.data_usage_combo = QComboBox()
self.data_usage_combo.addItems([
    "é€šç”¨åœºæ™¯",      # general - é»˜è®¤
    "å†å²æ•°æ®åˆ†æ",  # historical
    "å›æµ‹éªŒè¯",      # backtest
    "å®æ—¶è¡Œæƒ…",      # realtime
    "å®ç›˜äº¤æ˜“"       # live_trading
])
self.data_usage_combo.setToolTip(
    "é€‰æ‹©æ•°æ®ç”¨é€”åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´è´¨é‡è¯„åˆ†æƒé‡ï¼š\n"
    "â€¢ å†å²æ•°æ®åˆ†æï¼šæ³¨é‡å‡†ç¡®æ€§å’Œå®Œæ•´æ€§\n"
    "â€¢ å›æµ‹éªŒè¯ï¼šæ³¨é‡ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§\n"
    "â€¢ å®æ—¶è¡Œæƒ…ï¼šæé«˜åŠæ—¶æ€§æƒé‡\n"
    "â€¢ å®ç›˜äº¤æ˜“ï¼šæœ€é«˜åŠæ—¶æ€§å’Œå‡†ç¡®æ€§æƒé‡"
)
```

#### ç”¨é€”æ˜ å°„å…³ç³»

| ä¸­æ–‡æ˜¾ç¤ºåç§° | è‹±æ–‡æšä¸¾å€¼ | ä¸­æ–‡æ ‡è®° | ç”¨é€”è¯´æ˜ |
|------------|-----------|---------|---------|
| é€šç”¨åœºæ™¯ | general | [é€šç”¨] | å¹³è¡¡é…ç½®ï¼Œé€‚ç”¨äºä¸€èˆ¬åœºæ™¯ |
| å†å²æ•°æ®åˆ†æ | historical | [å†å²] | æ³¨é‡å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ |
| å›æµ‹éªŒè¯ | backtest | [å›æµ‹] | æ³¨é‡ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ |
| å®æ—¶è¡Œæƒ… | realtime | [å®æ—¶] | æé«˜åŠæ—¶æ€§æƒé‡ |
| å®ç›˜äº¤æ˜“ | live_trading | [å®ç›˜] | æœ€é«˜åŠæ—¶æ€§å’Œå‡†ç¡®æ€§æƒé‡ |

### 2. è‡ªåŠ¨æ ‡è®°ç®¡ç†ç³»ç»Ÿ

#### ä»»åŠ¡åæ ¼å¼è§„èŒƒ
```
åŸºç¡€ä»»åŠ¡å[ç”¨é€”æ ‡è®°]
```

#### åˆ›å»ºä»»åŠ¡æ—¶çš„å¤„ç†
```python
def _get_current_ui_config():
    # 1. è·å–åŸºç¡€ä»»åŠ¡å
    base_task_name = self.task_name_edit.text().strip()
    
    # 2. è·å–ç”¨é€”æ ‡è®°
    usage_tag = self._get_data_usage_tag()  # å¦‚ "[å›æµ‹]"
    
    # 3. ç§»é™¤æ—§æ ‡è®°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    import re
    base_task_name = re.sub(r'\[(é€šç”¨|å†å²|å›æµ‹|å®æ—¶|å®ç›˜)\]$', '', base_task_name).strip()
    
    # 4. è¿½åŠ æ–°æ ‡è®°
    final_task_name = f"{base_task_name}{usage_tag}"
    
    return {
        'name': final_task_name,  # å¦‚ï¼š"å¯¼å…¥ä»»åŠ¡_20251105[å›æµ‹]"
        'data_usage': self._get_data_usage_value(),  # å¦‚ï¼š"backtest"
        # ... å…¶ä»–é…ç½®
    }
```

#### ç¼–è¾‘ä»»åŠ¡æ—¶çš„å¤„ç†
```python
def edit_task():
    # UIæ˜¾ç¤ºé€»è¾‘
    # 1. ä»ä»»åŠ¡åä¸­ç§»é™¤æ ‡è®°ï¼Œæ˜¾ç¤ºåŸºç¡€åç§°
    import re
    base_name = re.sub(r'\[(é€šç”¨|å†å²|å›æµ‹|å®æ—¶|å®ç›˜)\]$', '', task.name).strip()
    name_edit.setText(base_name)
    
    # 2. ä»ä»»åŠ¡åä¸­æå–ç”¨é€”æ ‡è®°ï¼Œè®¾ç½®ä¸‹æ‹‰æ¡†
    if '[å›æµ‹]' in task.name:
        data_usage_edit_combo.setCurrentText("å›æµ‹éªŒè¯")
    # ... å…¶ä»–åˆ¤æ–­
    
    # ä¿å­˜é€»è¾‘
    def save_changes():
        # 1. è·å–åŸºç¡€åç§°å’Œæ–°ç”¨é€”
        base_name = name_edit.text().strip()
        usage_display = data_usage_edit_combo.currentText()
        
        # 2. è·å–ç”¨é€”æ ‡è®°å’Œè‹±æ–‡å€¼
        usage_tag = tag_mapping.get(usage_display, "[é€šç”¨]")
        data_usage_value = usage_mapping.get(usage_display, "general")
        
        # 3. ç»„åˆæœ€ç»ˆä»»åŠ¡å
        final_task_name = f"{base_name}{usage_tag}"
        
        # 4. æ›´æ–°é…ç½®
        self.config_manager.update_import_task(
            task_id,
            name=final_task_name,
            data_usage=data_usage_value
        )
```

### 3. æ™ºèƒ½ç”¨é€”è¯†åˆ«ç³»ç»Ÿ

#### ä¸‰ç§è¯†åˆ«æ–¹æ³•

**æ–¹æ³•1: ä»»åŠ¡IDå…³é”®è¯è¯†åˆ«ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰**
```python
def _infer_data_usage_from_task_id(task_id):
    """æ ¹æ®ä»»åŠ¡IDä¸­çš„å…³é”®è¯è¯†åˆ«æ•°æ®ç”¨é€”"""
    task_id_lower = task_id.lower()
    
    # å›æµ‹ç›¸å…³
    if any(keyword in task_id_lower for keyword in ['backtest', 'å›æµ‹']):
        return 'backtest'
    
    # å®ç›˜äº¤æ˜“ç›¸å…³
    if any(keyword in task_id_lower for keyword in ['trading', 'äº¤æ˜“', 'å®ç›˜']):
        return 'live_trading'
    
    # å®æ—¶è¡Œæƒ…ç›¸å…³
    if any(keyword in task_id_lower for keyword in ['realtime', 'å®æ—¶', 'è¡Œæƒ…']):
        return 'realtime'
    
    # å†å²æ•°æ®ç›¸å…³
    if any(keyword in task_id_lower for keyword in ['historical', 'å†å²']):
        return 'historical'
    
    return None
```

**æ–¹æ³•2: æ•°æ®æ–°é²œåº¦åˆ†æ**
```python
def _infer_data_usage_from_freshness(data):
    """æ ¹æ®æ•°æ®æ–°é²œåº¦æ¨æ–­ç”¨é€”"""
    latest_date = pd.to_datetime(data['timestamp']).max()
    time_diff = datetime.now() - latest_date
    
    if time_diff <= timedelta(minutes=5):
        return 'live_trading'  # â‰¤5åˆ†é’Ÿ â†’ å®ç›˜äº¤æ˜“
    elif time_diff <= timedelta(hours=1):
        return 'realtime'      # â‰¤1å°æ—¶ â†’ å®æ—¶è¡Œæƒ…
    elif time_diff >= timedelta(days=1):
        return 'historical'    # >1å¤© â†’ å†å²æ•°æ®
    
    return None
```

**æ–¹æ³•3: æ•°æ®é‡åˆ†æ**
```python
def _infer_data_usage_from_volume(data):
    """æ ¹æ®æ•°æ®é‡æ¨æ–­ç”¨é€”"""
    record_count = len(data)
    
    if record_count > 500:
        return 'backtest'      # >500æ¡ â†’ å›æµ‹éªŒè¯
    elif record_count < 50:
        return 'realtime'      # <50æ¡ â†’ å®æ—¶è¡Œæƒ…
    
    return None
```

### 4. æ™ºèƒ½æƒé‡é…ç½®

#### åŠ¨æ€æƒé‡é…ç½®

æ ¹æ®æ•°æ®ç”¨é€”è‡ªåŠ¨è°ƒæ•´å››å¤§ç»´åº¦çš„æƒé‡ï¼š

| æ•°æ®ç”¨é€” | å®Œæ•´æ€§ | å‡†ç¡®æ€§ | ä¸€è‡´æ€§ | åŠæ—¶æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|--------|--------|----------|
| **å†å²åˆ†æ** (historical) | 30% | **40%** â†‘ | **25%** â†‘ | **5%** â†“â†“ | ç ”ç©¶ã€å­¦ä¹ ã€å†å²å›é¡¾ |
| **å›æµ‹éªŒè¯** (backtest) | 25% | 35% | **30%** â†‘ | 10% â†“ | ç­–ç•¥å›æµ‹ã€æ€§èƒ½éªŒè¯ |
| **å®æ—¶è¡Œæƒ…** (realtime) | 25% | 30% | 15% | **30%** â†‘ | è¡Œæƒ…ç›‘æ§ã€ä¿¡æ¯æŸ¥çœ‹ |
| **å®ç›˜äº¤æ˜“** (live_trading) | 20% | 35% | 10% | **35%** â†‘â†‘ | å®ç›˜ä¸‹å•ã€äº¤æ˜“å†³ç­– |
| **é€šç”¨åœºæ™¯** (general) | 30% | 30% | 20% | 20% | é»˜è®¤å‡è¡¡é…ç½® |

#### æ•°æ®æºå¯é æ€§ç³»æ•°

æ ¹æ®æ•°æ®æºå†å²è¡¨ç°è°ƒæ•´è¯„åˆ†ï¼ˆÂ±5%ï¼‰ï¼š

| æ•°æ®æº | ç³»æ•° | è¯´æ˜ |
|--------|------|------|
| Tushare | **+5%** | ä¸“ä¸šé‡‘èæ•°æ® |
| Windä¸‡å¾— | **+5%** | ä¸“ä¸šæ•°æ®ç»ˆç«¯ |
| é€šè¾¾ä¿¡ | **+3%** | è€ç‰Œè¡Œæƒ…è½¯ä»¶ |
| ä¸œæ–¹è´¢å¯Œ | **+2%** | æ ‡å‡†æ•°æ®æº |
| AKShare | 0% | å¼€æºæ•°æ®ï¼ˆåŸºå‡†ï¼‰ |
| Unknown | **-2%** | æœªçŸ¥æ•°æ®æº |

## ğŸ”§ å®ç°ç»†èŠ‚

### æ ¸å¿ƒç±»å’Œæ–¹æ³•

#### 1. æ•°æ®è½¬æ¢æ–¹æ³•

**`_get_data_usage_value()` - è·å–è‹±æ–‡æšä¸¾å€¼**
```python
def _get_data_usage_value(self):
    """å°†ä¸­æ–‡æ˜¾ç¤ºåç§°è½¬æ¢ä¸ºè‹±æ–‡æšä¸¾å€¼"""
    mapping = {
        "é€šç”¨åœºæ™¯": "general",
        "å†å²æ•°æ®åˆ†æ": "historical", 
        "å›æµ‹éªŒè¯": "backtest",
        "å®æ—¶è¡Œæƒ…": "realtime",
        "å®ç›˜äº¤æ˜“": "live_trading"
    }
    display_name = self.data_usage_combo.currentText()
    return mapping.get(display_name, "general")
```

**`_get_data_usage_tag()` - è·å–ä¸­æ–‡æ ‡è®°**
```python
def _get_data_usage_tag(self):
    """æå–ç®€çŸ­çš„ä¸­æ–‡æ ‡è®°ç”¨äºè¿½åŠ åˆ°ä»»åŠ¡å"""
    mapping = {
        "é€šç”¨åœºæ™¯": "[é€šç”¨]",
        "å†å²æ•°æ®åˆ†æ": "[å†å²]",
        "å›æµ‹éªŒè¯": "[å›æµ‹]",
        "å®æ—¶è¡Œæƒ…": "[å®æ—¶]",
        "å®ç›˜äº¤æ˜“": "[å®ç›˜]"
    }
    display_name = self.data_usage_combo.currentText()
    return mapping.get(display_name, "[é€šç”¨]")
```

#### 2. ä»»åŠ¡åæ­£åˆ™è¡¨è¾¾å¼å¤„ç†

```python
import re

def clean_task_name(task_name):
    """æ¸…ç†ä»»åŠ¡åä¸­çš„ç”¨é€”æ ‡è®°"""
    # ç§»é™¤æœ«å°¾çš„ç”¨é€”æ ‡è®°
    cleaned_name = re.sub(r'\[(é€šç”¨|å†å²|å›æµ‹|å®æ—¶|å®ç›˜)\]$', '', task_name).strip()
    return cleaned_name

def extract_usage_from_name(task_name):
    """ä»ä»»åŠ¡åä¸­æå–ç”¨é€”æ ‡è®°"""
    match = re.search(r'\[(é€šç”¨|å†å²|å›æµ‹|å®æ—¶|å®ç›˜)\]$', task_name)
    if match:
        return match.group(1)
    return None
```

## ğŸ“Š è¯„åˆ†æå‡æ•ˆæœå¯¹æ¯”

### æ¡ˆä¾‹ï¼šå½“å‰æ•°æ®ï¼ˆ244æ¡ï¼Œç©ºå€¼ç‡0%ï¼‰

#### åŸè¯„åˆ†ä½“ç³»ï¼ˆé€šç”¨æƒé‡ï¼‰
```
å®Œæ•´æ€§: 1.00 Ã— 30% = 0.30
å‡†ç¡®æ€§: 0.95 Ã— 30% = 0.285
ä¸€è‡´æ€§: 0.90 Ã— 20% = 0.18
åŠæ—¶æ€§: 0.45 Ã— 20% = 0.09  â† æ‹–åè…¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»åˆ†: 0.855 (FAIRç­‰çº§)
```

#### æ–°è¯„åˆ†ä½“ç³» - å†å²åˆ†æç”¨é€”
```
å®Œæ•´æ€§: 1.00 Ã— 30% = 0.30
å‡†ç¡®æ€§: 0.95 Ã— 40% = 0.38  â†‘
ä¸€è‡´æ€§: 0.90 Ã— 25% = 0.225 â†‘
åŠæ—¶æ€§: 0.45 Ã— 5%  = 0.0225 â†“â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åŸºç¡€åˆ†: 0.9275
æ•°æ®æº: AKShare Ã— 1.00
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»åˆ†: 0.9275 (EXCELLENTç­‰çº§) âœ¨
```

**æå‡æ•ˆæœï¼š0.839 â†’ 0.9275 (+10.5%ï¼Œä»FAIRè·ƒå‡è‡³EXCELLENTï¼)**

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1: åˆ›å»ºæ–°ä»»åŠ¡
**æ“ä½œ**:
1. åœ¨ä»»åŠ¡åè¾“å…¥æ¡†è¾“å…¥: `Aè‚¡æ—¥çº¿æ•°æ®`
2. åœ¨æ•°æ®ç”¨é€”ä¸‹æ‹‰æ¡†é€‰æ‹©: `å›æµ‹éªŒè¯`
3. ç‚¹å‡»"æ–°å»ºä»»åŠ¡"

**é¢„æœŸç»“æœ**:
- âœ… ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º: `Aè‚¡æ—¥çº¿æ•°æ®[å›æµ‹]`
- âœ… æ•°æ®åº“ä¿å­˜: name="Aè‚¡æ—¥çº¿æ•°æ®[å›æµ‹]", data_usage="backtest"
- âœ… ä»»åŠ¡æ‰§è¡Œæ—¶æ—¥å¿—: `[æ•°æ®ç”¨é€”æ¨æ–­] âœ… æ–¹æ³•1-ä»»åŠ¡IDå…³é”®è¯è¯†åˆ« â†’ backtest`

### åœºæ™¯2: ç¼–è¾‘å·²æœ‰ä»»åŠ¡ï¼ˆä¿®æ”¹ç”¨é€”ï¼‰
**æ“ä½œ**:
1. åŒå‡»ä»»åŠ¡: `Aè‚¡æ—¥çº¿æ•°æ®[å›æµ‹]`
2. ç¼–è¾‘å¯¹è¯æ¡†æ˜¾ç¤º:
   - ä»»åŠ¡åç§°: `Aè‚¡æ—¥çº¿æ•°æ®` ï¼ˆè‡ªåŠ¨ç§»é™¤æ ‡è®°ï¼‰
   - æ•°æ®ç”¨é€”: `å›æµ‹éªŒè¯` ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰
3. ä¿®æ”¹æ•°æ®ç”¨é€”ä¸º: `å®ç›˜äº¤æ˜“`
4. ç‚¹å‡»"ä¿å­˜"

**é¢„æœŸç»“æœ**:
- âœ… ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º: `Aè‚¡æ—¥çº¿æ•°æ®[å®ç›˜]`
- âœ… æ•°æ®åº“æ›´æ–°: name="Aè‚¡æ—¥çº¿æ•°æ®[å®ç›˜]", data_usage="live_trading"
- âœ… ä¸‹æ¬¡æ‰§è¡Œè¯†åˆ«ä¸º: live_trading

### åœºæ™¯3: ä»»åŠ¡åå·²æœ‰æ ‡è®°ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰
**æ“ä½œ**:
1. åœ¨ä»»åŠ¡åè¾“å…¥æ¡†è¾“å…¥: `å†å²æ•°æ®[å›æµ‹]`ï¼ˆæ‰‹åŠ¨åŠ äº†æ ‡è®°ï¼‰
2. åœ¨æ•°æ®ç”¨é€”ä¸‹æ‹‰æ¡†é€‰æ‹©: `å®ç›˜äº¤æ˜“`
3. ç‚¹å‡»"æ–°å»ºä»»åŠ¡"

**é¢„æœŸç»“æœ**:
- âœ… æ—§æ ‡è®°è¢«ç§»é™¤
- âœ… ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º: `å†å²æ•°æ®[å®ç›˜]`ï¼ˆåªæœ‰æ–°æ ‡è®°ï¼‰
- âœ… æ•°æ®åº“ä¿å­˜: data_usage="live_trading"

## ğŸ¨ UIæ•ˆæœ

### åˆ›å»ºä»»åŠ¡ç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ åŸºæœ¬ä¿¡æ¯                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»»åŠ¡åç§°:  [å¯¼å…¥ä»»åŠ¡_20251105_123045  ]â”‚
â”‚                                         â”‚
â”‚ ä»»åŠ¡æè¿°:  [________________          ]â”‚
â”‚                                         â”‚
â”‚ ğŸ¯ æ•°æ®ç”¨é€”: [å›æµ‹éªŒè¯ â–¼]              â”‚  â† æ–°å¢
â”‚   â„¹ï¸ å›æµ‹éªŒè¯ä¼šæ³¨é‡ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§       â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š èµ„äº§ç±»å‹: [Aè‚¡ â–¼]                   â”‚
â”‚                                         â”‚
â”‚ ğŸ“ˆ æ•°æ®ç±»å‹: [Kçº¿æ•°æ® â–¼]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼–è¾‘ä»»åŠ¡ç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç¼–è¾‘ä»»åŠ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           â”‚
â”‚ ä»»åŠ¡åç§°:    [Aè‚¡æ—¥çº¿æ•°æ®            ]  â”‚
â”‚   â„¹ï¸ ä»»åŠ¡åç§°å°†è‡ªåŠ¨æ·»åŠ ç”¨é€”æ ‡è®°           â”‚
â”‚                                           â”‚
â”‚ ğŸ¯ æ•°æ®ç”¨é€”:  [å›æµ‹éªŒè¯ â–¼]               â”‚  â† æ–°å¢
â”‚   â„¹ï¸ é€‰æ‹©ç”¨é€”åï¼Œä»»åŠ¡åå°†è‡ªåŠ¨æ·»åŠ æ ‡è®°     â”‚
â”‚      ç³»ç»Ÿä¼šæ ¹æ®ç”¨é€”è°ƒæ•´è´¨é‡è¯„åˆ†æƒé‡       â”‚
â”‚                                           â”‚
â”‚ æ•°æ®æº:      [AKShareæ•°æ®æºæ’ä»¶ â–¼]       â”‚
â”‚                                           â”‚
â”‚ èµ„äº§ç±»å‹:    [Aè‚¡ â–¼]                     â”‚
â”‚                                           â”‚
â”‚          [ä¿å­˜]    [å–æ¶ˆ]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ æ•°æ®æµå›¾

```
ç”¨æˆ·æ“ä½œå±‚
    â†“
    é€‰æ‹©æ•°æ®ç”¨é€”: "å›æµ‹éªŒè¯"
    â†“
UIå¤„ç†å±‚
    â†“
    _get_data_usage_tag() â†’ "[å›æµ‹]"
    _get_data_usage_value() â†’ "backtest"
    â†“
æ•°æ®ä¿å­˜å±‚
    â†“
    config_manager.add_import_task(
        name="ä»»åŠ¡å[å›æµ‹]",
        data_usage="backtest"
    )
    â†“
ä»»åŠ¡æ‰§è¡Œå±‚
    â†“
    _execute_task(task_config)
    task_id = "ä»»åŠ¡å[å›æµ‹]"
    â†“
æ•°æ®éªŒè¯å±‚
    â†“
    _validate_imported_data(task_id="ä»»åŠ¡å[å›æµ‹]")
    â†“
æ™ºèƒ½è¯†åˆ«å±‚
    â†“
    _infer_data_usage(data, task_id="ä»»åŠ¡å[å›æµ‹]")
    æ–¹æ³•1: æ£€æµ‹åˆ°"å›æµ‹" â†’ return "backtest"
    â†“
è´¨é‡è¯„åˆ†å±‚
    â†“
    calculate_quality_score(data, data_usage="backtest")
    _get_dynamic_weights("backtest") â†’ å›æµ‹æƒé‡é…ç½®
    â†“
æœ€ç»ˆç»“æœ
    â†“
    è´¨é‡åˆ†æ•° with å›æµ‹ä¼˜åŒ–æƒé‡
```

## ğŸ” ä»£ç å®¡æŸ¥æ¸…å•

- [x] UIç»„ä»¶æ­£ç¡®æ·»åŠ 
- [x] æ•°æ®è½¬æ¢æ–¹æ³•å®ç°æ­£ç¡®
- [x] åˆ›å»ºä»»åŠ¡é€»è¾‘æ­£ç¡®å¤„ç†æ ‡è®°
- [x] ç¼–è¾‘ä»»åŠ¡é€»è¾‘æ­£ç¡®æå–å’Œæ›´æ–°æ ‡è®°
- [x] æ­£åˆ™è¡¨è¾¾å¼æ­£ç¡®åŒ¹é…æ‰€æœ‰æ ‡è®°
- [x] å¼‚å¸¸å¤„ç†å’Œé»˜è®¤å€¼è®¾ç½®
- [x] æ—¥å¿—è®°å½•å®Œæ•´
- [x] æ— linteré”™è¯¯
- [x] ç¬¦åˆPythonç¼–ç è§„èŒƒ
- [x] ç¬¦åˆé¡¹ç›®æ¶æ„è®¾è®¡

## âš™ï¸ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šè‡ªåŠ¨è¯†åˆ«ï¼ˆæ¨èï¼‰

ç³»ç»Ÿä¼šæ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨åˆ¤æ–­ç”¨é€”ï¼š

```python
# å¯¼å…¥æ—¶ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«
result = import_manager.import_kline_data(
    symbols=['000001.SZ'],
    start_date='2020-01-01',
    end_date='2023-12-31'  # å†å²æ•°æ® â†’ è‡ªåŠ¨è¯†åˆ«ä¸º'historical'
)
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨æŒ‡å®š

```python
# ç›´æ¥è°ƒç”¨è¯„åˆ†æ–¹æ³•
quality_monitor = DataQualityMonitor()

# å†å²æ•°æ®åˆ†æ
score = quality_monitor.calculate_quality_score(
    data=df,
    data_type='kline',
    data_usage='historical',  # æ‰‹åŠ¨æŒ‡å®š
    data_source='akshare'
)

# å®ç›˜äº¤æ˜“
score = quality_monitor.calculate_quality_score(
    data=realtime_df,
    data_type='kline',
    data_usage='live_trading',
    data_source='tongdaxin'
)
```

### æ–¹æ³•3ï¼šä»»åŠ¡çº§é…ç½®

åœ¨å¯¼å…¥ä»»åŠ¡é…ç½®ä¸­æ·»åŠ å…³é”®è¯ï¼š

```python
task_config = {
    'task_id': 'backtest_20240101',  # åŒ…å«'backtest' â†’ è‡ªåŠ¨è¯†åˆ«
    'symbols': ['000001.SZ'],
    # ...
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å†å²æ•°æ®ç ”ç©¶
```python
# âœ… æ¨èï¼šä½¿ç”¨å†å²æƒé‡é…ç½®
data_usage = 'historical'
# è¯„åˆ†ä¾§é‡ï¼šå‡†ç¡®æ€§ > å®Œæ•´æ€§ > ä¸€è‡´æ€§ > åŠæ—¶æ€§
```

### 2. ç­–ç•¥å›æµ‹
```python
# âœ… æ¨èï¼šä½¿ç”¨å›æµ‹æƒé‡é…ç½®  
data_usage = 'backtest'
# è¯„åˆ†ä¾§é‡ï¼šå‡†ç¡®æ€§ > ä¸€è‡´æ€§ > å®Œæ•´æ€§ > åŠæ—¶æ€§
# ä¸€è‡´æ€§é«˜åˆ†ç¡®ä¿å›æµ‹ç»“æœå¯é 
```

### 3. å®æ—¶ç›‘æ§
```python
# âœ… æ¨èï¼šä½¿ç”¨å®æ—¶æƒé‡é…ç½®
data_usage = 'realtime'
# è¯„åˆ†ä¾§é‡ï¼šåŠæ—¶æ€§ = å‡†ç¡®æ€§ > å®Œæ•´æ€§ > ä¸€è‡´æ€§
```

### 4. å®ç›˜äº¤æ˜“
```python
# âœ… æ¨èï¼šä½¿ç”¨äº¤æ˜“æƒé‡é…ç½®
data_usage = 'live_trading'
# è¯„åˆ†ä¾§é‡ï¼šåŠæ—¶æ€§ = å‡†ç¡®æ€§ > å®Œæ•´æ€§ > ä¸€è‡´æ€§
# âš ï¸ å»ºè®®è¯„åˆ†â‰¥0.90æ‰ç”¨äºå®ç›˜
```

## ğŸ› æ•…éšœæ’é™¤

### Q1: è¯„åˆ†æ²¡æœ‰å˜åŒ–ï¼Ÿ
**A:** æ£€æŸ¥æ—¥å¿—ä¸­çš„`[æƒé‡é…ç½®]`å’Œ`[è´¨é‡è¯„åˆ†]`è¾“å‡ºï¼Œç¡®è®¤ç”¨é€”è¯†åˆ«æ˜¯å¦æ­£ç¡®ã€‚

### Q2: ç”¨é€”è¯†åˆ«ä¸å‡†ç¡®ï¼Ÿ
**A:** ä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šæ–¹å¼ï¼Œæˆ–åœ¨task_idä¸­æ·»åŠ å…³é”®è¯ã€‚

### Q3: è¯„åˆ†åä½ï¼Ÿ
**A:** 
1. æ£€æŸ¥æ•°æ®æºç³»æ•°æ˜¯å¦è¿‡ä½
2. æŸ¥çœ‹å‡†ç¡®æ€§æ£€æµ‹æ—¥å¿—ï¼Œæ’æŸ¥å¼‚å¸¸æ•°æ®
3. å¯¹äºå†å²æ•°æ®ï¼Œç¡®è®¤ç”¨é€”ä¸º'historical'

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¯¦ç»†è¾“å‡ºï¼š
- `[æƒé‡é…ç½®]` - æƒé‡ä½¿ç”¨æƒ…å†µ
- `[å‡†ç¡®æ€§]` - å…·ä½“æ‰£åˆ†é¡¹
- `[æ•°æ®æºè°ƒæ•´]` - æ•°æ®æºç³»æ•°
- `[è´¨é‡è¯„åˆ†]` - æœ€ç»ˆè¯„åˆ†æ˜ç»†

## âœ¨ å…³é”®ç‰¹æ€§

1. **å¼ºåˆ¶æ€§**: å¿…é¡»é€‰æ‹©ï¼Œæ— æ³•è·³è¿‡
2. **è‡ªåŠ¨åŒ–**: æ ‡è®°è‡ªåŠ¨ç®¡ç†
3. **æ™ºèƒ½åŒ–**: ä¸è¯†åˆ«ç³»ç»Ÿæ·±åº¦é›†æˆ
4. **ç”¨æˆ·å‹å¥½**: æ¸…æ™°çš„æç¤ºå’Œåé¦ˆ
5. **ä¸€è‡´æ€§**: æ ¼å¼ç»Ÿä¸€ï¼Œæ˜“äºç®¡ç†

---

**åˆ›å»ºæ—¶é—´**: 2025-12-06  
**ç‰ˆæœ¬**: ç»¼åˆç‰ˆ v1.0  
**ç»´æŠ¤è€…**: AI Assistant  
**ç›¸å…³æ–‡æ¡£**: 
- [æ™ºèƒ½æ•°æ®è´¨é‡è¯„ä¼°ç³»ç»Ÿä½¿ç”¨æŒ‡å—](./æ™ºèƒ½æ•°æ®è´¨é‡è¯„ä¼°ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md)
- [AIæ¨¡å‹è®­ç»ƒç³»ç»Ÿ_ç»¼åˆç‰ˆ](./AIæ¨¡å‹è®­ç»ƒç³»ç»Ÿ_ç»¼åˆç‰ˆ.md)
- [PyQtGraphè¿ç§»æ–¹æ¡ˆ_ç»¼åˆç‰ˆ](./PyQtGraphè¿ç§»æ–¹æ¡ˆ_ç»¼åˆç‰ˆ.md)