# 回测UI详细使用说明

## 回测UI组件结构

FactorWeave-Quant专业回测UI组件(ProfessionalBacktestWidget)是一个功能全面的回测操作界面，采用左右分割式布局，主要由以下几个组件构成：

### 1. 主界面布局

回测UI采用水平分割布局，分为左右两个区域：

- **左侧面板**：包含所有控制选项和设置面板，采用可滚动的垂直布局
- **右侧面板**：显示回测结果和图表，包括关键指标和实时图表

### 2. 左侧控制面板

#### 2.1 控制面板 (ControlPanel)

控制面板是整个回测UI的核心，用于配置回测参数和启动/停止回测。主要功能包括：

**回测参数设置**：
- 初始资金：设置回测的起始资金，默认100万元
- 仓位大小：设置最大仓位比例，默认95%
- 手续费率：设置交易手续费，默认0.03%
- 专业级别：设置回测专业级别(RETAIL/INSTITUTIONAL/HEDGE_FUND/INVESTMENT_BANK)
- 性能级别：设置回测性能级别(STANDARD/HIGH/ULTRA/EXTREME)

**时间范围设置**：
- 开始日期：设置回测的起始日期，默认为一年前
- 结束日期：设置回测的结束日期，默认为当前日期
- 数据频率：设置数据频率(日线/小时线/30分钟/15分钟/5分钟/1分钟)

**基准对比设置**：
- 基准指数：选择对比基准(无基准/沪深300/中证500/创业板指/上证50/科创50/恒生指数/纳斯达克/标普500)

**回测引擎设置**：
- 引擎类型：选择引擎类型(自动选择/向量化引擎/标准引擎)
- 向量化选项：启用向量化优化，可提升3-5倍性能
- 自动选择选项：根据数据大小和功能需求自动选择最优引擎

**控制按钮**：
- 开始回测按钮：启动回测进程
- 停止回测按钮：终止回测进程
- 状态标签：显示当前状态(就绪/运行中/已完成/已停止/错误)

#### 2.2 预警面板 (AlertsPanel)

预警面板显示回测过程中的警告和错误信息，帮助用户快速定位问题。主要功能包括：

- 显示系统警告和错误
- 提供错误详情和解决建议
- 支持清除历史警告记录

### 3. 右侧结果面板

#### 3.1 指标面板 (MetricsPanel)

指标面板显示回测的关键绩效指标，帮助用户评估策略效果。主要功能包括：

**收益指标**：
- 总收益率：策略总收益百分比
- 年化收益率：年化后的收益率
- 日均收益率：平均每日收益率

**风险指标**：
- 最大回撤：最大亏损幅度
- 夏普比率：衡量风险调整后收益的指标
- 波动率：收益波动程度
- 风险价值(VaR)：在95%置信水平下的最大损失

**交易指标**：
- 胜率：盈利交易占比
- 盈亏比：平均盈利与平均亏损的比值
- 总交易次数：策略执行的交易总次数
- 平均持仓时间：平均每笔交易的持仓时间

#### 3.2 实时图表 (RealTimeChart)

实时图表组件显示回测过程中的动态数据，包括：

- 收益曲线：显示策略累计收益随时间变化
- 基准对比：与基准指数的收益对比
- 回撤曲线：显示策略的最大回撤情况
- 持仓分析：显示不同时期的持仓情况

### 4. 使用流程

#### 4.1 配置回测参数

1. **设置基本参数**：
   - 在控制面板的"回测参数"组中设置初始资金、仓位大小、手续费率等
   - 选择合适的专业级别和性能级别

2. **设置时间范围**：
   - 在"时间范围设置"组中选择回测的起始和结束日期
   - 选择合适的数据频率

3. **选择基准**：
   - 在"基准对比设置"组中选择对比基准指数

4. **选择引擎**：
   - 在"回测引擎设置"组中选择合适的引擎类型
   - 根据需要启用向量化优化和自动选择功能

#### 4.2 启动回测

1. 确认所有参数设置无误
2. 点击"开始回测"按钮
3. 观察状态标签的变化，确认回测已启动
4. 在右侧面板查看实时指标和图表更新

#### 4.3 监控回测进度

1. **查看预警信息**：
   - 监控左侧预警面板，及时发现潜在问题
   - 如有错误，点击查看详细错误信息

2. **观察指标变化**：
   - 实时查看右侧指标面板的关键指标变化
   - 关注收益曲线和基准对比情况

3. **分析持仓情况**：
   - 查看持仓分析，了解策略的持仓分布
   - 评估策略在不同市场环境下的表现

#### 4.4 完成回测

1. 等待回测自动完成或手动点击"停止回测"按钮
2. 查看完整的回测结果和指标
3. 导出回测报告（如果支持）
4. 保存或分享策略配置（如果支持）

### 5. 常见问题与解决方案

#### 5.1 回测无法启动

- **检查参数设置**：确认所有必要参数已正确设置
- **查看预警面板**：检查是否有错误提示
- **检查数据源**：确认数据源可用且数据完整
- **重启系统**：尝试重启应用后重新操作

#### 5.2 UI无响应或更新缓慢

- **降低数据频率**：尝试使用较低频率的数据（如从日线改为周线）
- **减少数据量**：缩短回测时间范围或减少股票数量
- **检查系统资源**：确认系统CPU和内存使用情况
- **更新图形驱动**：更新显卡驱动程序

#### 5.3 指标计算异常

- **检查数据完整性**：确认历史数据没有缺失
- **调整参数范围**：避免极端参数设置
- **检查策略逻辑**：验证策略代码是否正确
- **使用标准引擎**：尝试使用标准引擎而非向量化引擎

### 6. 高级功能

#### 6.1 自定义指标

- 在策略代码中添加自定义指标计算
- 在指标面板中添加自定义指标显示
- 配置自定义指标的计算周期和显示格式

#### 6.2 参数优化

- 使用系统的参数优化功能
- 设置参数范围和优化目标
- 运行参数扫描和优化算法

#### 6.3 批量回测

- 准备多个策略配置
- 使用批量回测功能同时测试多个策略
- 比较不同策略的表现

### 7. 技术支持

如果在使用过程中遇到问题，可以：

1. 查看系统日志获取详细错误信息
2. 联系技术支持团队
3. 参考系统文档和示例策略
4. 参与用户社区讨论

---

本说明文档提供了回测UI组件的详细结构和使用方法，帮助用户更好地理解和使用FactorWeave-Quant专业回测系统。