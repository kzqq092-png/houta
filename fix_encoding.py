#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""修复enhanced_data_import_widget.py的编码问题"""

import re

def fix_encoding_issues():
    file_path = "gui/widgets/enhanced_data_import_widget.py"
    
    # 读取文件内容
    with open(file_path, 'r', encoding='utf-8', errors='ignore') as f:
        content = f.read()
    
    # 定义需要修复的编码替换
    replacements = {
        '�?': '器',
        '�?': '化',
        '�?': '滤',
        '�?': '共',
        '�?': '项',
        '�?': '码',
        '�?': '式',
        '�?': '卡',
        '�?': '源',
        '�?': '期',
        '�?': '型',
        '�?': '据',
        '�?': '态',
        '�?': '全',
        '�?': '择',
        '�?': '能',
        '�?': '性',
        '�?': '行',
        '�?': '置',
        '�?': '制',
        '�?': '用',
        '�?': '程',
        '�?': '开',
        '�?': '始',
        '�?': '功',
        '�?': '成',
        '�?': '败',
        '�?': '入',
        '�?': '理',
        '�?': '控',
        '�?': '务',
        '�?': '页',
        '�?': '关',
        '�?': '视',
        '�?': '秒',
        '�?': '次',
        '�?': '色',
        '�?': '量',
        '�?': '度',
        '�?': '率',
        '�?': '表',
        '�?': '示',
        '�?': '在',
        '�?': '存',
        '�?': '伸',
        '�?': '版',
        '�?': '个',
        '�?': '列',
        '�?': '时',
        '�?': '完',
        '�?': '误',
        '�?': '无',
        '�?': '见',
        '�?': '看',
        '�?': '除',
        '�?': '化',
        '�?': '始',
        '�?': '可',
        '�?': '酒',
        '�?': '股',
        '�?': '数',
        '�?': '指',
        '�?': '金',
        '�?': '债',
        '�?': '国',
        '�?': '发',
        '�?': '融',
        '�?': '板',
        '�?': '系',
        '�?': '增',
        '�?': '智',
        '�?': '代',
        '�?': '配',
        '�?': '统',
        '�?': '就',
        '�?': '绪',
        '�?': '机',
        '�?': '连',
        '�?': '定',
        '�?': '应',
        '�?': '为',
        '�?': '规',
        '�?': '则',
        '�?': '经',
        '�?': '导',
        '�?': '直',
        '�?': '排',
        '�?': '显',
        '�?': '隐',
        '�?': '藏',
        '�?': '监',
        '�?': '控',
        '�?': '质',
        '�?': '整',
        '�?': '致',
        '�?': '准',
        '�?': '确',
        '�?': '标',
        '�?': '条',
        '�?': '任',
        '�?': '节',
        '�?': '点',
        '�?': '状',
        '�?': '态',
        '�?': '布',
        '�?': '式',
        '�?': '执',
        '�?': '件',
        '�?': '化',
        '创业�?0': '创业板50',
        '股票�?': '股票型',
        '指数�?': '指数型',
        '国�?': '国债',
        '金融�?': '金融债',
        '通达�?': '通达信',
        '数据�?': '数据源',
        '开始日�?': '开始日期',
        '分布式执�?': '分布式执行',
        '智能化功�?': '智能化功能',
        '扩展任务配置组（整合任务创建向导功能�?': '扩展任务配置组（整合任务创建向导功能）',
        '基本信息选项�?': '基本信息选项卡',
        '数据源配置选项�?': '数据源配置选项卡',
        '高级配置选项�?': '高级配置选项卡',
        '验证和创建按�?': '验证和创建按钮',
        '代码选择': '代码选择',
        '快速选择': '快速选择',
        '清空': '清空',
        '代码输入�?': '代码输入框',
        '初始化按钮状�?': '初始化按钮状态',
        '数据源配置选项�?': '数据源配置选项卡',
        '数据�?': '数据源',
        '智能化功�?': '智能化功能',
        '优化开�?': '优化开关',
        '自动调优开�?': '自动调优开关',
        '分布式执行开�?': '分布式执行开关',
        '智能缓存开�?': '智能缓存开关',
        '缓存加�?': '缓存加速',
        '数据质量监控开�?': '数据质量监控开关',
        '简化的执行控制�?': '简化的执行控制组',
        '开始导�?': '开始导入',
        '新建任务按钮（替代原来的向导�?': '新建任务按钮（替代原来的向导）',
        '选项�?': '选项卡',
        '任务管理选项卡（集成增强功能�?': '任务管理选项卡（集成增强功能）',
        '功能控制面板选项�?': '功能控制面板选项卡',
        '分布式状态选项�?': '分布式状态选项卡',
        '分布式状�?': '分布式状态',
        '数据质量选项�?': '数据质量选项卡',
        '数据质量': '数据质量',
        '质量报告选项�?': '质量报告选项卡'
    }
    
    # 应用替换
    for old, new in replacements.items():
        content = content.replace(old, new)
    
    # 处理特殊的模式
    # 修复百分号相关的问题
    content = re.sub(r'(\d+\.?\d*)\s*�?', r'\1%', content)
    
    # 修复其他常见模式
    content = re.sub(r'�?\s*(\d+)\s*项，已选择\s*(\d+)\s*�?', r'共 \1 项，已选择 \2 项', content)
    content = re.sub(r'任务调度控制选项�?', '任务调度控制选项卡', content)
    content = re.sub(r'创建任务调度控制选项�?', '创建任务调度控制选项卡', content)
    content = re.sub(r'任务调度控制�?', '任务调度控制器', content)
    content = re.sub(r'创建调度控制�?', '创建调度控制器', content)
    content = re.sub(r'AI功能控制面板选项�?', 'AI功能控制面板选项卡', content)
    content = re.sub(r'质量报告生成选项�?', '质量报告生成选项卡', content)
    content = re.sub(r'质量报告生成�?', '质量报告生成器', content)
    content = re.sub(r'基础质量报告选项卡（回退版本�?', '基础质量报告选项卡（回退版本）', content)
    content = re.sub(r'AI状态选项�?', 'AI状态选项卡', content)
    content = re.sub(r'AutoTuner状�?', 'AutoTuner状态', content)
    content = re.sub(r'分布式状态选项�?', '分布式状态选项卡', content)
    content = re.sub(r'节点状�?', '节点状态', content)
    content = re.sub(r'数据质量控制中�?', '数据质量控制中心', content)
    content = re.sub(r'基础数据质量选项卡（回退版本�?', '基础数据质量选项卡（回退版本）', content)
    content = re.sub(r'完整�?', '完整性', content)
    content = re.sub(r'准确�?', '准确性', content)
    content = re.sub(r'一致�?', '一致性', content)
    
    # 写回文件
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("编码问题修复完成！")

if __name__ == "__main__":
    fix_encoding_issues()

