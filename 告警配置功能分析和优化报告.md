# å‘Šè­¦é…ç½®åŠŸèƒ½åˆ†æå’Œä¼˜åŒ–æŠ¥å‘Š

## é—®é¢˜æ¦‚è¿°

ç”¨æˆ·æå‡ºäº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š
1. å‘Šè­¦é…ç½®åº•éƒ¨æŒ‰é’®ï¼ˆä¿å­˜é…ç½®ã€é‡ç½®é…ç½®ã€æµ‹è¯•å‘Šè­¦ã€åº”ç”¨é…ç½®ï¼‰ä¸å³é”®èœå•åŠŸèƒ½æ˜¯å¦é‡å¤
2. å‘Šè­¦å†å²åªåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶äº§ç”Ÿä¸€æ¡è®°å½•ï¼Œåç»­æ— æ–°è®°å½•ç”Ÿæˆ

## ä¸€ã€åŠŸèƒ½é‡å¤æ€§åˆ†æ

### åº•éƒ¨æŒ‰é’®åŠŸèƒ½åˆ†æ

é€šè¿‡ä»£ç åˆ†æå‘ç°ï¼Œåº•éƒ¨æŒ‰é’®å’Œå³é”®èœå•çš„åŠŸèƒ½å®šä½ä¸åŒï¼š

#### åº•éƒ¨æŒ‰é’®åŠŸèƒ½ï¼ˆ`alert_config_tab.py:222-225`ï¼‰
```python
self.save_btn = QPushButton("ğŸ’¾ ä¿å­˜é…ç½®")     # ä¿å­˜é€šçŸ¥é…ç½®åˆ°æ•°æ®åº“
self.reset_btn = QPushButton("ğŸ”„ é‡ç½®é…ç½®")    # é‡ç½®æ‰€æœ‰é…ç½®åˆ°é»˜è®¤å€¼  
self.test_btn = QPushButton("ğŸ§ª æµ‹è¯•å‘Šè­¦")     # ç”Ÿæˆæµ‹è¯•å‘Šè­¦è®°å½•
self.apply_btn = QPushButton("âœ… åº”ç”¨é…ç½®")    # åº”ç”¨é…ç½®åˆ°ç³»ç»ŸæœåŠ¡
```

#### å³é”®èœå•åŠŸèƒ½ï¼ˆ`alert_config_tab.py:297-327`ï¼‰
```python
"â• æ·»åŠ è§„åˆ™"    # æ·»åŠ æ–°çš„å‘Šè­¦è§„åˆ™
"âœï¸ ç¼–è¾‘è§„åˆ™"    # ç¼–è¾‘ç°æœ‰å‘Šè­¦è§„åˆ™
"ğŸ“‹ å¤åˆ¶è§„åˆ™"    # å¤åˆ¶ç°æœ‰è§„åˆ™ä¸ºæ¨¡æ¿
"â¸ï¸ ç¦ç”¨è§„åˆ™"   # åˆ‡æ¢è§„åˆ™å¯ç”¨çŠ¶æ€
"ğŸ—‘ï¸ åˆ é™¤è§„åˆ™"   # åˆ é™¤é€‰ä¸­è§„åˆ™
```

### åŠŸèƒ½èŒè´£å¯¹æ¯”

| ç±»å‹ | ç®¡ç†èŒƒå›´ | æ ¸å¿ƒèŒè´£ | æ“ä½œå¯¹è±¡ |
|------|----------|----------|----------|
| **åº•éƒ¨æŒ‰é’®** | å…¨å±€é…ç½®ç®¡ç† | é€šçŸ¥è®¾ç½®ã€ç³»ç»Ÿé›†æˆã€æµ‹è¯•åŠŸèƒ½ | æ•´ä½“é…ç½® |
| **å³é”®èœå•** | è§„åˆ™ç®¡ç† | å•ä¸ªè§„åˆ™çš„å¢åˆ æ”¹æŸ¥ | å…·ä½“è§„åˆ™ |

### ç»“è®ºï¼š**åŠŸèƒ½ä¸é‡å¤**

- **åº•éƒ¨æŒ‰é’®**ï¼šç®¡ç†å…¨å±€é…ç½®ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€ç³»ç»Ÿé›†æˆï¼‰
- **å³é”®èœå•**ï¼šç®¡ç†å…·ä½“å‘Šè­¦è§„åˆ™

**å»ºè®®ä¿ç•™æ‰€æœ‰æŒ‰é’®**ï¼Œå› ä¸ºå®ƒä»¬æœåŠ¡äºä¸åŒçš„åŠŸèƒ½å±‚é¢ã€‚

## äºŒã€å‘Šè­¦å†å²ç”Ÿæˆé—®é¢˜åˆ†æ

### é—®é¢˜æ ¹å› åˆ†æ

é€šè¿‡ä»£ç åˆ†æå‘ç°å‘Šè­¦å†å²ç”Ÿæˆä¾èµ–ä»¥ä¸‹æµç¨‹ï¼š

1. **å‘Šè­¦è§¦å‘æ¡ä»¶**ï¼šç³»ç»Ÿç›‘æ§æŒ‡æ ‡è¶…å‡ºé˜ˆå€¼
2. **äº‹ä»¶å¤„ç†**ï¼šé€šè¿‡`AlertEventHandler`å¤„ç†å‘Šè­¦äº‹ä»¶
3. **æ•°æ®åº“ä¿å­˜**ï¼šå°†å‘Šè­¦è®°å½•ä¿å­˜åˆ°`alert_config.db`
4. **UIæ˜¾ç¤º**ï¼šä»æ•°æ®åº“åŠ è½½å¹¶æ˜¾ç¤ºå†å²è®°å½•

### æ½œåœ¨é—®é¢˜ç‚¹

#### 1. ç›‘æ§æœåŠ¡æœªæ­£å¸¸è¿è¡Œ
```python
# core/services/service_bootstrap.py:512
aggregation_service.start()  # æŒ‡æ ‡èšåˆæœåŠ¡å¯èƒ½æœªå¯åŠ¨
```

#### 2. å‘Šè­¦äº‹ä»¶å¤„ç†å™¨æœªæ³¨å†Œ
```python
# core/services/service_bootstrap.py:517-521
register_alert_handlers(self.event_bus)  # å¯èƒ½æ³¨å†Œå¤±è´¥
```

#### 3. å‘Šè­¦é˜ˆå€¼æœªæ­£ç¡®è®¾ç½®
```python
# alert_config_tab.py:737-738
aggregation_service.set_alert_threshold(metric_name, threshold)
```

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1ï¼šæ·»åŠ å‘Šè­¦ç›‘æ§çŠ¶æ€æ£€æŸ¥åŠŸèƒ½

åœ¨å‘Šè­¦é…ç½®ç•Œé¢æ·»åŠ ç›‘æ§æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼š

```python
def check_monitoring_status(self):
    """æ£€æŸ¥ç›‘æ§æœåŠ¡çŠ¶æ€"""
    try:
        from core.containers import get_service_container
        service_container = get_service_container()
        
        # æ£€æŸ¥æŒ‡æ ‡èšåˆæœåŠ¡
        aggregation_service = service_container.resolve('MetricsAggregationService')
        if not aggregation_service or not aggregation_service.is_running():
            return {"status": "error", "message": "æŒ‡æ ‡èšåˆæœåŠ¡æœªè¿è¡Œ"}
            
        # æ£€æŸ¥äº‹ä»¶æ€»çº¿
        event_bus = service_container.resolve('EventBus')
        if not event_bus:
            return {"status": "error", "message": "äº‹ä»¶æ€»çº¿æœªåˆå§‹åŒ–"}
            
        return {"status": "ok", "message": "ç›‘æ§æœåŠ¡è¿è¡Œæ­£å¸¸"}
    except Exception as e:
        return {"status": "error", "message": f"æœåŠ¡æ£€æŸ¥å¤±è´¥: {e}"}
```

#### æ–¹æ¡ˆ2ï¼šå¢å¼ºæµ‹è¯•å‘Šè­¦åŠŸèƒ½

ä¿®æ”¹æµ‹è¯•å‘Šè­¦åŠŸèƒ½ï¼Œç¡®ä¿èƒ½è§¦å‘çœŸå®çš„å‘Šè­¦æµç¨‹ï¼š

```python
def enhanced_test_alerts(self):
    """å¢å¼ºçš„æµ‹è¯•å‘Šè­¦åŠŸèƒ½"""
    try:
        # ç”ŸæˆçœŸå®çš„å‘Šè­¦äº‹ä»¶
        from core.services.alert_deduplication_service import AlertMessage, AlertLevel
        
        test_alert = AlertMessage(
            id="test_alert_" + datetime.now().strftime('%Y%m%d_%H%M%S'),
            timestamp=datetime.now(),
            level=AlertLevel.WARNING,
            category="æµ‹è¯•å‘Šè­¦",
            metric_name="test_metric",
            message="è¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿæµ‹è¯•å‘Šè­¦",
            current_value=85.0,
            threshold_value=80.0
        )
        
        # é€šè¿‡å‘Šè­¦å»é‡æœåŠ¡å¤„ç†
        from core.services.alert_deduplication_service import get_alert_deduplication_service
        alert_service = get_alert_deduplication_service()
        should_send = alert_service.process_alert(test_alert)
        
        if should_send:
            # ä¿å­˜åˆ°æ•°æ®åº“
            from db.models.alert_config_models import AlertHistory
            history = AlertHistory(
                timestamp=test_alert.timestamp.strftime('%Y-%m-%d %H:%M:%S'),
                level=test_alert.level.value,
                category=test_alert.category,
                message=test_alert.message,
                status='å·²å¤„ç†'
            )
            self.db.save_alert_history(history)
            
        # åˆ·æ–°UIæ˜¾ç¤º
        self.load_alert_history_from_database()
        
        QMessageBox.information(self, "æµ‹è¯•å®Œæˆ", 
                               f"æµ‹è¯•å‘Šè­¦å·²ç”Ÿæˆå¹¶ä¿å­˜åˆ°æ•°æ®åº“\n"
                               f"å‘Šè­¦ID: {test_alert.id}\n"
                               f"å¤„ç†çŠ¶æ€: {'å·²å‘é€' if should_send else 'å·²å»é‡'}")
        
    except Exception as e:
        QMessageBox.critical(self, "æµ‹è¯•å¤±è´¥", f"å¢å¼ºæµ‹è¯•å‘Šè­¦å¤±è´¥: {e}")
```

#### æ–¹æ¡ˆ3ï¼šæ·»åŠ å®æ—¶ç›‘æ§é¢æ¿

åœ¨å‘Šè­¦é…ç½®ä¸­æ·»åŠ å®æ—¶ç›‘æ§çŠ¶æ€é¢æ¿ï¼š

```python
def create_monitoring_status_panel(self):
    """åˆ›å»ºç›‘æ§çŠ¶æ€é¢æ¿"""
    status_group = QGroupBox("ğŸ” ç›‘æ§çŠ¶æ€")
    status_layout = QVBoxLayout()
    
    # çŠ¶æ€æŒ‡ç¤ºå™¨
    self.monitoring_status_label = QLabel("æ£€æŸ¥ä¸­...")
    self.alert_count_label = QLabel("å‘Šè­¦è®¡æ•°: 0")
    self.last_alert_label = QLabel("æœ€åå‘Šè­¦: æ— ")
    
    # åˆ·æ–°æŒ‰é’®
    refresh_btn = QPushButton("ğŸ”„ åˆ·æ–°çŠ¶æ€")
    refresh_btn.clicked.connect(self.refresh_monitoring_status)
    
    status_layout.addWidget(self.monitoring_status_label)
    status_layout.addWidget(self.alert_count_label)
    status_layout.addWidget(self.last_alert_label)
    status_layout.addWidget(refresh_btn)
    
    status_group.setLayout(status_layout)
    return status_group
```

## ä¸‰ã€å®æ–½å»ºè®®

### ç«‹å³è¡ŒåŠ¨é¡¹

1. **ä¿ç•™æ‰€æœ‰åº•éƒ¨æŒ‰é’®**ï¼šåŠŸèƒ½ä¸é‡å¤ï¼Œå„æœ‰èŒè´£
2. **å¢å¼ºæµ‹è¯•å‘Šè­¦**ï¼šç¡®ä¿èƒ½è§¦å‘å®Œæ•´çš„å‘Šè­¦æµç¨‹
3. **æ·»åŠ çŠ¶æ€æ£€æŸ¥**ï¼šè®©ç”¨æˆ·èƒ½å¤Ÿè¯Šæ–­ç›‘æ§æœåŠ¡çŠ¶æ€

### ä¼˜åŒ–å»ºè®®

1. **æ”¹è¿›æŒ‰é’®å¸ƒå±€**ï¼šå¯ä»¥è€ƒè™‘å°†æŒ‰é’®åˆ†ç»„æ˜¾ç¤ºï¼Œæ›´æ¸…æ™°åœ°åŒºåˆ†èŒè´£
2. **æ·»åŠ ä½¿ç”¨æç¤º**ï¼šä¸ºæ¯ä¸ªæŒ‰é’®æ·»åŠ è¯¦ç»†çš„å·¥å…·æç¤ºè¯´æ˜
3. **çŠ¶æ€ç›‘æ§**ï¼šåœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºå‘Šè­¦æœåŠ¡çš„è¿è¡ŒçŠ¶æ€

### é•¿æœŸè§„åˆ’

1. **è‡ªåŠ¨åŒ–ç›‘æ§**ï¼šå®šæœŸæ£€æŸ¥å‘Šè­¦æœåŠ¡çŠ¶æ€ï¼Œè‡ªåŠ¨é‡å¯å¼‚å¸¸æœåŠ¡
2. **å‘Šè­¦æµ‹è¯•å¥—ä»¶**ï¼šå¼€å‘å®Œæ•´çš„å‘Šè­¦åŠŸèƒ½æµ‹è¯•å·¥å…·
3. **ç›‘æ§ä»ªè¡¨æ¿**ï¼šåˆ›å»ºä¸“é—¨çš„ç›‘æ§çŠ¶æ€ä»ªè¡¨æ¿

## å››ã€ä»£ç ä¿®æ”¹è®¡åˆ’

ä¸ºäº†è§£å†³å‘Šè­¦å†å²ç”Ÿæˆé—®é¢˜ï¼Œå»ºè®®å¯¹ä»¥ä¸‹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼š

1. **å¢å¼ºæµ‹è¯•åŠŸèƒ½**ï¼š`gui/widgets/performance/tabs/alert_config_tab.py`
2. **æ·»åŠ çŠ¶æ€æ£€æŸ¥**ï¼š`gui/widgets/performance/tabs/alert_config_tab.py`
3. **å®Œå–„ç›‘æ§æœåŠ¡**ï¼š`core/services/service_bootstrap.py`
4. **æ”¹è¿›äº‹ä»¶å¤„ç†**ï¼š`core/services/alert_event_handler.py`

é€šè¿‡è¿™äº›æ”¹è¿›ï¼Œå¯ä»¥ç¡®ä¿å‘Šè­¦å†å²èƒ½å¤Ÿæ­£å¸¸ç”Ÿæˆï¼ŒåŒæ—¶ä¿æŒç•Œé¢åŠŸèƒ½çš„å®Œæ•´æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ 