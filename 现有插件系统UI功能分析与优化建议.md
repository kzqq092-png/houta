# ç°æœ‰æ’ä»¶ç³»ç»ŸUIåŠŸèƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®®

## ç°çŠ¶åˆ†æ

ç»è¿‡æ·±å…¥åˆ†æHIkyuu-UIç°æœ‰çš„æ’ä»¶ç®¡ç†ç³»ç»Ÿï¼Œå‘ç°ç³»ç»Ÿå·²ç»å…·å¤‡äº†ç›¸å½“å®Œå–„çš„æ’ä»¶ç®¡ç†åŠŸèƒ½ï¼š

### å·²æœ‰åŠŸèƒ½ç›˜ç‚¹

#### 1. å¢å¼ºæ’ä»¶ç®¡ç†å™¨å¯¹è¯æ¡† (`enhanced_plugin_manager_dialog.py`)
- âœ… **å¤šæ ‡ç­¾é¡µç®¡ç†**ï¼šæ•°æ®æºæ’ä»¶ã€æƒ…ç»ªæ•°æ®æ’ä»¶ã€å¢å¼ºæ’ä»¶ç®¡ç†ã€æ’ä»¶å¸‚åœº
- âœ… **å®æ—¶ç›‘æ§åŠŸèƒ½**ï¼šæ’ä»¶çŠ¶æ€ç›‘æ§ã€å¥åº·æ£€æŸ¥
- âœ… **é…ç½®ç®¡ç†**ï¼šé…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
- âœ… **å¼‚æ­¥å¤„ç†**ï¼šè¡¨æ ¼å¡«å……å¼‚æ­¥å·¥ä½œçº¿ç¨‹
- âœ… **ä¼ä¸šçº§è®¾è®¡**ï¼šä¸“ä¸šçš„UIè®¾è®¡å’Œç”¨æˆ·ä½“éªŒ

#### 2. æ•°æ®æºæ’ä»¶é…ç½®å¯¹è¯æ¡† (`data_source_plugin_config_dialog.py`)
- âœ… **è¯¦ç»†é…ç½®åŠŸèƒ½**ï¼šè¿æ¥å‚æ•°ã€è®¤è¯ä¿¡æ¯ç­‰
- âœ… **è·¯ç”±æƒé‡è®¾ç½®**ï¼šæƒé‡æ»‘å—ã€ä¼˜å…ˆçº§è®¾ç½®
- âœ… **èµ„äº§ç±»å‹é…ç½®**ï¼šæ”¯æŒä¸åŒèµ„äº§ç±»å‹çš„å¯ç”¨å’Œä¼˜å…ˆçº§è®¾ç½®
- âœ… **è´Ÿè½½å‡è¡¡é…ç½®**ï¼šä¼˜å…ˆçº§ã€è½®è¯¢ã€åŠ æƒè½®è¯¢ç­–ç•¥
- âœ… **å¥åº·æ£€æŸ¥**ï¼šå¼‚æ­¥å¥åº·æ£€æŸ¥å·¥ä½œçº¿ç¨‹
- âœ… **æµ‹è¯•éªŒè¯**ï¼šæ’ä»¶è¿æ¥æµ‹è¯•åŠŸèƒ½

#### 3. æ•°æ®æºçŠ¶æ€ç›‘æ§ç»„ä»¶ (`data_source_status_widget.py`)
- âœ… **å®æ—¶çŠ¶æ€æ˜¾ç¤º**ï¼šå¥åº·çŠ¶æ€ã€è·¯ç”±ç»Ÿè®¡
- âœ… **å‘Šè­¦é€šçŸ¥**ï¼šå¤±æ•ˆé€šçŸ¥å’Œå‘Šè­¦
- âœ… **å¼‚æ­¥æ›´æ–°**ï¼šçŠ¶æ€å¼‚æ­¥æ›´æ–°å·¥ä½œçº¿ç¨‹
- âœ… **æ€§èƒ½æŒ‡æ ‡**ï¼šå“åº”æ—¶é—´ã€æˆåŠŸç‡ç­‰æŒ‡æ ‡ç›‘æ§

#### 4. å…¶ä»–ç›¸å…³ç»„ä»¶
- âœ… **TDXæœåŠ¡å™¨ç®¡ç†**ï¼š`tdx_server_manager_widget.py`
- âœ… **é€šç”¨ç½‘ç»œé…ç½®**ï¼š`universal_network_config_widget.py`
- âœ… **æƒ…æ„Ÿæ’ä»¶é…ç½®**ï¼š`sentiment_plugin_config_dialog.py`

### ç°æœ‰ç³»ç»Ÿçš„ä¼˜åŠ¿

1. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šåŸºæœ¬è¦†ç›–äº†æ’ä»¶ç®¡ç†çš„æ ¸å¿ƒåŠŸèƒ½
2. **æŠ€æœ¯æˆç†Ÿåº¦**ï¼šä½¿ç”¨äº†å¼‚æ­¥å¤„ç†ã€å·¥ä½œçº¿ç¨‹ç­‰å…ˆè¿›æŠ€æœ¯
3. **ç”¨æˆ·ä½“éªŒ**ï¼šä¼ä¸šçº§è®¾è®¡ï¼Œç•Œé¢ä¸“ä¸š
4. **æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šç§æ’ä»¶ç±»å‹å’Œé…ç½®æ–¹å¼
5. **ç¨³å®šæ€§**ï¼šæœ‰å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## å†—ä½™åˆ†æ

### æˆ‘åŸæ–¹æ¡ˆä¸­çš„å†—ä½™éƒ¨åˆ†

ç»è¿‡å¯¹æ¯”åˆ†æï¼Œæˆ‘åŸæ–¹æ¡ˆä¸­ä»¥ä¸‹åŠŸèƒ½ç¡®å®ä¸ç°æœ‰ç³»ç»Ÿé‡å¤ï¼š

âŒ **é‡å¤åŠŸèƒ½**ï¼š
1. **æ•°æ®æºçŠ¶æ€ç›‘æ§** - ç°æœ‰ `data_source_status_widget.py` å·²å®ç°
2. **æ’ä»¶é…ç½®ç®¡ç†** - ç°æœ‰ `data_source_plugin_config_dialog.py` å·²å®ç°
3. **å¥åº·æ£€æŸ¥åŠŸèƒ½** - ç°æœ‰ `HealthCheckWorker` å·²å®ç°
4. **æ’ä»¶ç®¡ç†å¯¹è¯æ¡†** - ç°æœ‰ `enhanced_plugin_manager_dialog.py` å·²å®ç°
5. **é…ç½®å¯¼å…¥å¯¼å‡º** - ç°æœ‰ç³»ç»Ÿå·²æ”¯æŒ
6. **å¼‚æ­¥çŠ¶æ€æ›´æ–°** - ç°æœ‰ `StatusUpdateWorker` å·²å®ç°
7. **è·¯ç”±æƒé‡é…ç½®** - ç°æœ‰ç³»ç»Ÿå·²æœ‰æƒé‡æ»‘å—å’Œä¼˜å…ˆçº§è®¾ç½®

### æˆ‘åŸæ–¹æ¡ˆä¸­çš„å¢å€¼éƒ¨åˆ†

âœ… **ä»æœ‰ä»·å€¼çš„åŠŸèƒ½**ï¼š
1. **æ™ºèƒ½é…ç½®å‘å¯¼** - ç°æœ‰ç³»ç»Ÿç¼ºä¹æ–°ç”¨æˆ·å¼•å¯¼
2. **é…ç½®æ¨¡æ¿ç³»ç»Ÿ** - ç°æœ‰ç³»ç»Ÿæ²¡æœ‰é¢„è®¾é…ç½®æ¨¡æ¿
3. **æ™ºèƒ½æ¨èå¼•æ“** - åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½æ¨è
4. **æ‹–æ‹½å¼è·¯ç”±é…ç½®** - æ›´ç›´è§‚çš„ä¼˜å…ˆçº§è®¾ç½®æ–¹å¼
5. **åœºæ™¯åŒ–é…ç½®** - é’ˆå¯¹ä¸åŒä½¿ç”¨åœºæ™¯çš„ä¼˜åŒ–é…ç½®

## ä¼˜åŒ–å»ºè®®

### æ–¹æ¡ˆä¸€ï¼šå¢å¼ºç°æœ‰ç³»ç»Ÿï¼ˆæ¨èï¼‰

åŸºäºç°æœ‰ç³»ç»Ÿè¿›è¡ŒåŠŸèƒ½å¢å¼ºï¼Œè€Œä¸æ˜¯é‡æ–°å¼€å‘ï¼š

#### 1. å¢å¼º `enhanced_plugin_manager_dialog.py`

**æ·»åŠ é…ç½®æ¨¡æ¿åŠŸèƒ½**ï¼š
```python
# åœ¨ç°æœ‰å¯¹è¯æ¡†ä¸­æ·»åŠ æ¨¡æ¿æ ‡ç­¾é¡µ
def create_template_tab(self):
    """åˆ›å»ºé…ç½®æ¨¡æ¿æ ‡ç­¾é¡µ"""
    # é¢„è®¾æ¨¡æ¿ï¼šé€Ÿåº¦ä¼˜å…ˆã€ç¨³å®šä¼˜å…ˆã€å…¨é¢è¦†ç›–ã€å›æµ‹ä¸“ç”¨ã€å®æ—¶äº¤æ˜“
    # æ”¯æŒæ¨¡æ¿çš„ä¿å­˜ã€åŠ è½½ã€åˆ é™¤
```

**æ·»åŠ æ™ºèƒ½æ¨èåŠŸèƒ½**ï¼š
```python
def create_recommendation_panel(self):
    """åˆ›å»ºæ™ºèƒ½æ¨èé¢æ¿"""
    # åŸºäºå†å²æ€§èƒ½æ•°æ®æ¨èæœ€ä½³é…ç½®
    # æ˜¾ç¤ºæ¨èåŸå› å’Œé¢„æœŸæ•ˆæœ
```

#### 2. å¢å¼º `data_source_plugin_config_dialog.py`

**æ”¹è¿›è·¯ç”±é…ç½®ç•Œé¢**ï¼š
```python
def create_enhanced_routing_tab(self):
    """åˆ›å»ºå¢å¼ºçš„è·¯ç”±é…ç½®æ ‡ç­¾é¡µ"""
    # æ·»åŠ æ‹–æ‹½å¼ä¼˜å…ˆçº§è®¾ç½®
    # æ·»åŠ èµ„äº§ç±»å‹å’Œæ•°æ®ç±»å‹çš„ç»„åˆé…ç½®
    # æ·»åŠ å¯è§†åŒ–çš„è·¯ç”±ç­–ç•¥é¢„è§ˆ
```

**æ·»åŠ é…ç½®å‘å¯¼**ï¼š
```python
def launch_config_wizard(self):
    """å¯åŠ¨é…ç½®å‘å¯¼"""
    # å¼•å¯¼æ–°ç”¨æˆ·å®Œæˆåˆå§‹é…ç½®
    # æä¾›åˆ†æ­¥éª¤çš„é…ç½®æŒ‡å¯¼
```

#### 3. å¢å¼º `data_source_status_widget.py`

**æ·»åŠ æ€§èƒ½è¶‹åŠ¿åˆ†æ**ï¼š
```python
def create_performance_trends_panel(self):
    """åˆ›å»ºæ€§èƒ½è¶‹åŠ¿åˆ†æé¢æ¿"""
    # æ·»åŠ å†å²æ€§èƒ½æ•°æ®å›¾è¡¨
    # æ·»åŠ æ€§èƒ½å¯¹æ¯”åˆ†æ
```

### æ–¹æ¡ˆäºŒï¼šæ–°å¢ç‹¬ç«‹ç»„ä»¶

å¦‚æœç°æœ‰ç³»ç»Ÿæ¶æ„ä¸ä¾¿ä¿®æ”¹ï¼Œå¯ä»¥æ–°å¢ä»¥ä¸‹ç‹¬ç«‹ç»„ä»¶ï¼š

#### 1. é…ç½®æ¨¡æ¿ç®¡ç†å™¨
```python
class ConfigTemplateManager(QDialog):
    """é…ç½®æ¨¡æ¿ç®¡ç†å™¨"""
    # ç®¡ç†é¢„è®¾é…ç½®æ¨¡æ¿
    # æ”¯æŒæ¨¡æ¿çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€åº”ç”¨
```

#### 2. æ™ºèƒ½é…ç½®åŠ©æ‰‹
```python
class SmartConfigAssistant(QWidget):
    """æ™ºèƒ½é…ç½®åŠ©æ‰‹"""
    # æä¾›é…ç½®å»ºè®®å’Œä¼˜åŒ–æ–¹æ¡ˆ
    # åŸºäºä½¿ç”¨æ¨¡å¼è¿›è¡Œæ™ºèƒ½æ¨è
```

#### 3. é…ç½®å‘å¯¼å¯¹è¯æ¡†
```python
class ConfigWizardDialog(QDialog):
    """é…ç½®å‘å¯¼å¯¹è¯æ¡†"""
    # ä¸ºæ–°ç”¨æˆ·æä¾›åˆ†æ­¥é…ç½®æŒ‡å¯¼
    # è‡ªåŠ¨æ£€æµ‹å’Œé…ç½®æœ€ä½³è®¾ç½®
```

## å…·ä½“å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šæ¨¡æ¿ç³»ç»Ÿé›†æˆï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

1. **åœ¨ç°æœ‰ `enhanced_plugin_manager_dialog.py` ä¸­æ·»åŠ æ¨¡æ¿æ ‡ç­¾é¡µ**
   - é¢„è®¾5-6ä¸ªå¸¸ç”¨é…ç½®æ¨¡æ¿
   - æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿çš„ä¿å­˜å’Œç®¡ç†
   - ä¸€é”®åº”ç”¨æ¨¡æ¿åŠŸèƒ½

2. **æ‰©å±•ç°æœ‰é…ç½®å­˜å‚¨æœºåˆ¶**
   - åœ¨ç°æœ‰æ•°æ®åº“ä¸­æ·»åŠ é…ç½®æ¨¡æ¿è¡¨
   - å®ç°æ¨¡æ¿çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

### é˜¶æ®µäºŒï¼šæ™ºèƒ½æ¨èåŠŸèƒ½ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

1. **åœ¨ç°æœ‰çŠ¶æ€ç›‘æ§åŸºç¡€ä¸Šæ·»åŠ æ€§èƒ½åˆ†æ**
   - æ”¶é›†å†å²æ€§èƒ½æ•°æ®
   - åŸºäºæ•°æ®ç”Ÿæˆé…ç½®å»ºè®®
   - åœ¨é…ç½®å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºæ¨èä¿¡æ¯

2. **ä¼˜åŒ–ç°æœ‰è·¯ç”±é…ç½®ç•Œé¢**
   - æ”¹è¿›ä¼˜å…ˆçº§è®¾ç½®çš„ç”¨æˆ·ä½“éªŒ
   - æ·»åŠ é…ç½®é¢„è§ˆå’Œæ•ˆæœé¢„æµ‹

### é˜¶æ®µä¸‰ï¼šæ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†ç³»ç»Ÿï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

#### 3.1 æ•°æ®ç¼ºå¤±æ£€æµ‹ä¸å¼•å¯¼æœºåˆ¶

**æ ¸å¿ƒåŠŸèƒ½è®¾è®¡ï¼š**

1. **æ™ºèƒ½æ•°æ®ç¼ºå¤±æ£€æµ‹**
   - åœ¨ç”¨æˆ·æŸ¥è¯¢å†å²æ•°æ®æ—¶è‡ªåŠ¨æ£€æµ‹æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨æ‰€éœ€æ•°æ®
   - è¯†åˆ«ç¼ºå¤±çš„å…·ä½“æ•°æ®ç±»å‹ï¼ˆKçº¿æ•°æ®ã€åŸºæœ¬é¢æ•°æ®ã€å®æ—¶æ•°æ®ç­‰ï¼‰
   - åˆ†æç¼ºå¤±çš„æ—¶é—´èŒƒå›´ã€è‚¡ç¥¨ä»£ç ã€æ•°æ®é¢‘ç‡ï¼ˆæ—¥çº¿ã€åˆ†é’Ÿçº¿ç­‰ï¼‰
   - è¯„ä¼°æ•°æ®å®Œæ•´æ€§ï¼Œè¯†åˆ«éƒ¨åˆ†ç¼ºå¤±å’Œå®Œå…¨ç¼ºå¤±çš„æƒ…å†µ

2. **ç”¨æˆ·å‹å¥½çš„ç¼ºå¤±æ•°æ®æç¤ºç•Œé¢**

**æç¤ºå¯¹è¯æ¡†è®¾è®¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  æ£€æµ‹åˆ°å†å²æ•°æ®ç¼ºå¤±                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç¼ºå¤±æ•°æ®è¯¦æƒ…ï¼š                                             â”‚
â”‚  ğŸ“Š è‚¡ç¥¨ä»£ç : 000001.SZ (å¹³å®‰é“¶è¡Œ)                          â”‚
â”‚  ğŸ“… æ—¶é—´èŒƒå›´: 2023-01-01 è‡³ 2024-12-31                     â”‚
â”‚  ğŸ“ˆ æ•°æ®ç±»å‹: æ—¥çº¿Kçº¿æ•°æ®                                   â”‚
â”‚  ğŸ“‰ ç¼ºå¤±ç¨‹åº¦: å®Œå…¨ç¼ºå¤± (0/365å¤©)                            â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š                                              â”‚
â”‚  æˆ‘ä»¬ä¸ºæ‚¨æ‰¾åˆ°äº†ä»¥ä¸‹å¯ä»¥è·å–å†å²æ•°æ®çš„æ•°æ®æºï¼š               â”‚
â”‚                                                             â”‚
â”‚  ğŸ† æ¨èæ•°æ®æº (æŒ‰ç¨³å®šæ€§æ’åº):                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. ğŸŸ¢ ä¸œæ–¹è´¢å¯Œ - æ•°æ®å®Œæ•´åº¦:95% å†å²è¦†ç›–:20å¹´           â”‚â”‚
â”‚  â”‚    ç‰¹ç‚¹: æ•°æ®è´¨é‡é«˜ï¼Œæ”¯æŒå¤æƒå¤„ç†                       â”‚â”‚
â”‚  â”‚    [ç«‹å³ä½¿ç”¨æ­¤æ•°æ®æºä¸‹è½½] [æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯]                â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚ 2. ğŸŸ¢ é€šè¾¾ä¿¡ - æ•°æ®å®Œæ•´åº¦:90% å†å²è¦†ç›–:15å¹´             â”‚â”‚
â”‚  â”‚    ç‰¹ç‚¹: æ›´æ–°åŠæ—¶ï¼Œæ”¯æŒåˆ†é’Ÿçº§æ•°æ®                       â”‚â”‚
â”‚  â”‚    [ç«‹å³ä½¿ç”¨æ­¤æ•°æ®æºä¸‹è½½] [æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯]                â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚ 3. ğŸŸ¡ æ–°æµªè´¢ç» - æ•°æ®å®Œæ•´åº¦:85% å†å²è¦†ç›–:10å¹´           â”‚â”‚
â”‚  â”‚    ç‰¹ç‚¹: å…è´¹ä½¿ç”¨ï¼ŒåŸºç¡€æ•°æ®å……è¶³                         â”‚â”‚
â”‚  â”‚    [ç«‹å³ä½¿ç”¨æ­¤æ•°æ®æºä¸‹è½½] [æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯]                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  ğŸ¯ å¿«é€Ÿæ“ä½œï¼š                                              â”‚
â”‚  [ğŸš€ ä¸€é”®ä¸‹è½½æ¨èæ•°æ®æº] [ğŸ“‹ è·³è½¬åˆ°æ•°æ®ç®¡ç†] [âŒ æš‚ä¸ä¸‹è½½] â”‚
â”‚                                                             â”‚
â”‚  ğŸ’­ å°æç¤ºï¼š                                                â”‚
â”‚  å»ºè®®é€‰æ‹©æ•°æ®å®Œæ•´åº¦é«˜çš„æ•°æ®æºä»¥è·å¾—æ›´å‡†ç¡®çš„åˆ†æç»“æœ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

3. **æ™ºèƒ½æ•°æ®æºç­›é€‰ä¸æ¨èæœºåˆ¶**

**ç­›é€‰é€»è¾‘ï¼š**
- **æŒ‰æ•°æ®ç±»å‹ç­›é€‰**ï¼šåªæ˜¾ç¤ºæ”¯æŒæ‰€éœ€æ•°æ®ç±»å‹çš„æ’ä»¶
  - Kçº¿å†å²æ•°æ®ï¼šä¸œæ–¹è´¢å¯Œã€é€šè¾¾ä¿¡ã€æ–°æµªè´¢ç»ã€è…¾è®¯è´¢ç»
  - åŸºæœ¬é¢æ•°æ®ï¼šä¸œæ–¹è´¢å¯Œã€åŒèŠ±é¡º
  - å®æ—¶æ•°æ®ï¼šé€šè¾¾ä¿¡ã€æ–°æµªè´¢ç»ã€è…¾è®¯è´¢ç»
- **æŒ‰å†å²è¦†ç›–èƒ½åŠ›ç­›é€‰**ï¼šè¿‡æ»¤æ‰åªæ”¯æŒå®æ—¶æ•°æ®çš„æ’ä»¶
- **æŒ‰æ•°æ®è´¨é‡æ’åº**ï¼šåŸºäºå†å²æˆåŠŸç‡ã€æ•°æ®å®Œæ•´åº¦ã€ç”¨æˆ·è¯„ä»·æ’åº
- **æŒ‰ç”¨æˆ·åå¥½æ’åº**ï¼šç»“åˆç”¨æˆ·å†å²ä½¿ç”¨è®°å½•å’Œé…ç½®åå¥½

**æ¨èç®—æ³•ï¼š**
```
æ•°æ®æºè¯„åˆ† = æ•°æ®å®Œæ•´åº¦(40%) + å†å²è¦†ç›–å¹´é™(25%) + è¿æ¥ç¨³å®šæ€§(20%) + æ›´æ–°åŠæ—¶æ€§(15%)
```

4. **ä¸€é”®è·³è½¬ä¸è‡ªåŠ¨é…ç½®åŠŸèƒ½**

**è·³è½¬æ•°æ®ç®¡ç†ç•Œé¢ï¼š**
- è‡ªåŠ¨è·³è½¬åˆ°ç°æœ‰çš„æ•°æ®å¯¼å…¥/ç®¡ç†ç•Œé¢
- é¢„å¡«å……ç›¸å…³å‚æ•°ï¼š
  - è‚¡ç¥¨ä»£ç ï¼šè‡ªåŠ¨å¡«å…¥ç¼ºå¤±æ•°æ®çš„è‚¡ç¥¨ä»£ç 
  - æ—¶é—´èŒƒå›´ï¼šæ™ºèƒ½æ¨èåˆç†çš„æ—¶é—´èŒƒå›´
  - æ•°æ®ç±»å‹ï¼šè‡ªåŠ¨é€‰æ‹©æ‰€éœ€çš„æ•°æ®ç±»å‹
  - æ•°æ®é¢‘ç‡ï¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚é€‰æ‹©æ—¥çº¿/åˆ†é’Ÿçº¿ç­‰

**è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ•°æ®æºï¼š**
- æ ¹æ®æ¨èç®—æ³•è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„æ•°æ®æºæ’ä»¶
- æä¾›æ•°æ®æºåˆ‡æ¢é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥æ‰‹åŠ¨è°ƒæ•´
- æ˜¾ç¤ºé¢„è®¡ä¸‹è½½æ—¶é—´å’Œæ•°æ®é‡

5. **æ‰¹é‡æ•°æ®å¤„ç†å»ºè®®**

**æ™ºèƒ½æ‰¹é‡ä¸‹è½½å»ºè®®ï¼š**
å½“æ£€æµ‹åˆ°å¤šä¸ªè‚¡ç¥¨æˆ–å¤šä¸ªæ—¶é—´æ®µçš„æ•°æ®ç¼ºå¤±æ—¶ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š æ£€æµ‹åˆ°æ‰¹é‡æ•°æ®ç¼ºå¤±                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç¼ºå¤±ç»Ÿè®¡ï¼š                                                 â”‚
â”‚  â€¢ æ¶‰åŠè‚¡ç¥¨: 15ä¸ª                                           â”‚
â”‚  â€¢ ç¼ºå¤±æ—¶é—´æ®µ: 2023-01-01 è‡³ 2024-12-31                    â”‚
â”‚  â€¢ é¢„è®¡æ•°æ®é‡: çº¦ 2.3GB                                     â”‚
â”‚  â€¢ é¢„è®¡ä¸‹è½½æ—¶é—´: 15-25åˆ†é’Ÿ                                  â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¡ æ‰¹é‡ä¸‹è½½å»ºè®®ï¼š                                          â”‚
â”‚  [ğŸ¯ æ™ºèƒ½æ‰¹é‡ä¸‹è½½] - ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ•°æ®æºå’Œä¸‹è½½ç­–ç•¥       â”‚
â”‚  [ğŸ“‹ è‡ªå®šä¹‰æ‰¹é‡ä¸‹è½½] - æ‰‹åŠ¨é€‰æ‹©è‚¡ç¥¨å’Œæ•°æ®æº                 â”‚
â”‚  [â° å®šæ—¶ä¸‹è½½] - å®‰æ’åœ¨ç³»ç»Ÿç©ºé—²æ—¶é—´ä¸‹è½½                     â”‚
â”‚                                                             â”‚
â”‚  âš™ï¸ ä¸‹è½½ç­–ç•¥é€‰é¡¹ï¼š                                          â”‚
â”‚  â—‹ é€Ÿåº¦ä¼˜å…ˆ - å¤šæ•°æ®æºå¹¶è¡Œä¸‹è½½ï¼Œå¯èƒ½æ•°æ®è´¨é‡ç•¥æœ‰å·®å¼‚       â”‚
â”‚  â— è´¨é‡ä¼˜å…ˆ - ä½¿ç”¨æœ€ç¨³å®šæ•°æ®æºï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ (æ¨è)       â”‚
â”‚  â—‹ å‡è¡¡æ¨¡å¼ - å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆ

**ä¸æ•°æ®ç®¡ç†ç³»ç»Ÿé›†æˆï¼š**
- é›†æˆç°æœ‰çš„ `data_import_widget.py` å’Œç›¸å…³æ•°æ®å¯¼å…¥åŠŸèƒ½
- åˆ©ç”¨ç°æœ‰çš„ `enhanced_data_import_features.py` å¢å¼ºåŠŸèƒ½
- ä¸ `data_import_dashboard.py` æ•°æ®å¯¼å…¥ä»ªè¡¨æ¿è”åŠ¨

**ä¸TETæ¡†æ¶é›†æˆï¼š**
- åˆ©ç”¨TETæ¡†æ¶çš„æ•°æ®æ£€æµ‹æœºåˆ¶è¯†åˆ«æ•°æ®ç¼ºå¤±
- é€šè¿‡ `DataSourceRouter` è·å–å¯ç”¨æ•°æ®æºä¿¡æ¯
- ç»“åˆ `FieldMappingEngine` ç¡®ä¿æ•°æ®æ ¼å¼ä¸€è‡´æ€§

**ä¸æ’ä»¶ç®¡ç†ç³»ç»Ÿé›†æˆï¼š**
- ä»ç°æœ‰æ’ä»¶ç®¡ç†ç³»ç»Ÿè·å–æ’ä»¶èƒ½åŠ›ä¿¡æ¯
- åˆ©ç”¨æ’ä»¶çš„å¥åº·çŠ¶æ€æ•°æ®è¿›è¡Œæ¨èæ’åº
- ä¸æ’ä»¶é…ç½®ç³»ç»Ÿè”åŠ¨ï¼Œåº”ç”¨æœ€ä½³é…ç½®

#### 3.3 ç”¨æˆ·ä½“éªŒåˆ†å±‚è®¾è®¡

**æ–°æ‰‹ç”¨æˆ·æ¨¡å¼ï¼š**
- æä¾›è¯¦ç»†çš„è§£é‡Šå’Œå¼•å¯¼
- è‡ªåŠ¨æ¨èæœ€ä½³æ–¹æ¡ˆï¼Œå‡å°‘é€‰æ‹©å›°æ‰°
- æä¾›è¿›åº¦è·Ÿè¸ªå’Œå®Œæˆæç¤º

**è¿›é˜¶ç”¨æˆ·æ¨¡å¼ï¼š**
- æ˜¾ç¤ºæ›´å¤šæŠ€æœ¯ç»†èŠ‚å’Œé€‰é¡¹
- æ”¯æŒè‡ªå®šä¹‰ä¸‹è½½ç­–ç•¥
- æä¾›æ•°æ®è´¨é‡å¯¹æ¯”ä¿¡æ¯

**ä¸“å®¶ç”¨æˆ·æ¨¡å¼ï¼š**
- æ˜¾ç¤ºå®Œæ•´çš„æŠ€æœ¯å‚æ•°å’Œé…ç½®é€‰é¡¹
- æ”¯æŒé«˜çº§æ‰¹é‡æ“ä½œå’Œè‡ªåŠ¨åŒ–è„šæœ¬
- æä¾›APIè°ƒç”¨å’Œè‡ªå®šä¹‰æ‰©å±•æ¥å£

#### 3.4 ä¸‹è½½è¿›åº¦è·Ÿè¸ªä¸å®Œæˆå¤„ç†

**è¿›åº¦è·Ÿè¸ªç•Œé¢ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ æ­£åœ¨ä¸‹è½½å†å²æ•°æ®...                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å½“å‰ä»»åŠ¡: 000001.SZ æ—¥çº¿æ•°æ® (2023-2024)                  â”‚
â”‚  æ•°æ®æº: ä¸œæ–¹è´¢å¯Œ                                           â”‚
â”‚  è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 85% (310/365å¤©)â”‚
â”‚  é€Ÿåº¦: 2.3MB/s                                              â”‚
â”‚  å‰©ä½™æ—¶é—´: çº¦2åˆ†é’Ÿ                                          â”‚
â”‚                                                             â”‚
â”‚  æ€»ä½“è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 67% (10/15ä¸ªè‚¡ç¥¨)   â”‚
â”‚                                                             â”‚
â”‚  ğŸ“Š å·²å®Œæˆ:                                                 â”‚
â”‚  âœ… 000002.SZ - ä¸‡ç§‘A (365å¤©æ•°æ®)                          â”‚
â”‚  âœ… 000858.SZ - äº”ç²®æ¶² (365å¤©æ•°æ®)                         â”‚
â”‚  âœ… 600036.SH - æ‹›å•†é“¶è¡Œ (365å¤©æ•°æ®)                       â”‚
â”‚                                                             â”‚
â”‚  [â¸ï¸ æš‚åœä¸‹è½½] [âŒ å–æ¶ˆä¸‹è½½] [ğŸ“‹ æŸ¥çœ‹è¯¦ç»†æ—¥å¿—]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸‹è½½å®Œæˆåçš„è‡ªåŠ¨å¤„ç†ï¼š**
1. **æ•°æ®æ ‡å‡†åŒ–å¤„ç†**ï¼šå°†ä¸åŒæ•°æ®æºçš„åŸå§‹æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼å¹¶å­˜å‚¨
2. **è‡ªåŠ¨åˆ·æ–°æ•°æ®**ï¼šä¸‹è½½å®Œæˆåè‡ªåŠ¨åˆ·æ–°ç›¸å…³çš„æ•°æ®è§†å›¾
3. **é‡è¯•åŸå§‹æ“ä½œ**ï¼šè‡ªåŠ¨é‡æ–°æ‰§è¡Œç”¨æˆ·æœ€åˆæƒ³è¦è¿›è¡Œçš„æ“ä½œ
4. **ç»“æœåé¦ˆ**ï¼šæ˜¾ç¤ºä¸‹è½½ç»“æœæ‘˜è¦å’Œæ•°æ®è´¨é‡æŠ¥å‘Š
5. **åç»­å»ºè®®**ï¼šæä¾›ç›¸å…³çš„åˆ†æå»ºè®®å’Œæ“ä½œæŒ‡å¼•

#### 3.5 å¤šæ•°æ®æºå†å²æ•°æ®æ ‡å‡†åŒ–å­˜å‚¨æ–¹æ¡ˆ

**æ ¸å¿ƒæŒ‘æˆ˜ï¼š**
ä¸åŒæ•°æ®æºè¿”å›çš„å†å²æ•°æ®æ ¼å¼ã€å­—æ®µåç§°ã€æ•°æ®ç±»å‹ã€ç²¾åº¦ç­‰å­˜åœ¨å·®å¼‚ï¼Œéœ€è¦å»ºç«‹ç»Ÿä¸€çš„æ ‡å‡†åŒ–å­˜å‚¨æœºåˆ¶ã€‚

##### 3.5.1 æ•°æ®æ ‡å‡†åŒ–å¤„ç†æµç¨‹

**æ ‡å‡†åŒ–å¤„ç†ç®¡é“ï¼š**
```
åŸå§‹æ•°æ®æ¥æ”¶ â†’ æ ¼å¼è¯†åˆ« â†’ å­—æ®µæ˜ å°„ â†’ æ•°æ®æ¸…æ´— â†’ è´¨é‡éªŒè¯ â†’ æ ‡å‡†åŒ–å­˜å‚¨ â†’ å…ƒæ•°æ®è®°å½•
```

**1. åŸå§‹æ•°æ®æ¥æ”¶ä¸æ ¼å¼è¯†åˆ«**
- è‡ªåŠ¨è¯†åˆ«æ•°æ®æºç±»å‹ï¼ˆä¸œæ–¹è´¢å¯Œã€é€šè¾¾ä¿¡ã€æ–°æµªè´¢ç»ç­‰ï¼‰
- è§£æåŸå§‹æ•°æ®æ ¼å¼ï¼ˆJSONã€CSVã€XMLç­‰ï¼‰
- æå–æ•°æ®æºç‰¹æœ‰çš„å…ƒä¿¡æ¯ï¼ˆæ—¶é—´æˆ³æ ¼å¼ã€å¸‚åœºæ ‡è¯†ç­‰ï¼‰

**2. ç»Ÿä¸€å­—æ®µæ˜ å°„æœºåˆ¶**
åŸºäºç°æœ‰TETæ¡†æ¶çš„ `FieldMappingEngine`ï¼Œå»ºç«‹æ•°æ®æºå­—æ®µæ˜ å°„è§„åˆ™ï¼š

```
æ ‡å‡†å­—æ®µæ˜ å°„è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ‡å‡†å­—æ®µ    â”‚ ä¸œæ–¹è´¢å¯Œ    â”‚ é€šè¾¾ä¿¡      â”‚ æ–°æµªè´¢ç»    â”‚ è…¾è®¯è´¢ç»    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ stock_code  â”‚ code        â”‚ code        â”‚ symbol      â”‚ code        â”‚
â”‚ trade_date  â”‚ trade_date  â”‚ datetime    â”‚ date        â”‚ date        â”‚
â”‚ open_price  â”‚ open        â”‚ open        â”‚ open        â”‚ open        â”‚
â”‚ high_price  â”‚ high        â”‚ high        â”‚ high        â”‚ high        â”‚
â”‚ low_price   â”‚ low         â”‚ low         â”‚ low         â”‚ low         â”‚
â”‚ close_price â”‚ close       â”‚ close       â”‚ close       â”‚ now_price   â”‚
â”‚ volume      â”‚ volume      â”‚ vol         â”‚ volume      â”‚ volume      â”‚
â”‚ amount      â”‚ amount      â”‚ amount      â”‚ -           â”‚ amount      â”‚
â”‚ adj_factor  â”‚ adj_factor  â”‚ -           â”‚ -           â”‚ -           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3. æ•°æ®ç±»å‹æ ‡å‡†åŒ–**
- **æ—¥æœŸæ—¶é—´æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€è½¬æ¢ä¸º `YYYY-MM-DD HH:MM:SS` æ ¼å¼
- **æ•°å€¼ç²¾åº¦æ ‡å‡†åŒ–**ï¼šä»·æ ¼ä¿ç•™4ä½å°æ•°ï¼Œæˆäº¤é‡ä¿ç•™æ•´æ•°
- **è‚¡ç¥¨ä»£ç æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€ä¸º `XXXXXX.XX` æ ¼å¼ï¼ˆå¦‚ï¼š000001.SZï¼‰
- **å¸‚åœºæ ‡è¯†æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€å¸‚åœºä»£ç ï¼ˆSHã€SZã€BJç­‰ï¼‰

##### 3.5.2 æŒ‰èµ„äº§ç±»å‹åˆ†æ•°æ®åº“çš„æ ‡å‡†åŒ–å­˜å‚¨è®¾è®¡

**æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š**
åŸºäºç°æœ‰é¡¹ç›®çš„ `AssetType` æšä¸¾å’Œ `DataSourceSeparatedStorageManager`ï¼Œè®¾è®¡æŒ‰èµ„äº§ç±»å‹åˆ†æ•°æ®åº“çš„å­˜å‚¨æ¶æ„ï¼Œç¡®ä¿ä¸åŒèµ„äº§æ•°æ®éš”ç¦»å­˜å‚¨ï¼ŒåŒèµ„äº§æ•°æ®ç»Ÿä¸€ç®¡ç†ã€‚

**1. èµ„äº§æ•°æ®åº“åˆ†ç¦»æ¶æ„**

**æ•°æ®åº“æ–‡ä»¶ç»„ç»‡ç»“æ„ï¼š**
```
db/
â”œâ”€â”€ asset_databases/
â”‚   â”œâ”€â”€ stock_data.duckdb          # è‚¡ç¥¨æ•°æ®åº“(å«Aè‚¡ã€Bè‚¡ã€Hè‚¡ã€ç¾è‚¡ã€æ¸¯è‚¡)
â”‚   â”œâ”€â”€ futures_data.duckdb        # æœŸè´§æ•°æ®åº“
â”‚   â”œâ”€â”€ crypto_data.duckdb         # æ•°å­—è´§å¸æ•°æ®åº“
â”‚   â”œâ”€â”€ forex_data.duckdb          # å¤–æ±‡æ•°æ®åº“
â”‚   â”œâ”€â”€ bond_data.duckdb           # å€ºåˆ¸æ•°æ®åº“
â”‚   â”œâ”€â”€ fund_data.duckdb           # åŸºé‡‘æ•°æ®åº“
â”‚   â”œâ”€â”€ index_data.duckdb          # æŒ‡æ•°æ•°æ®åº“
â”‚   â”œâ”€â”€ commodity_data.duckdb      # å•†å“æ•°æ®åº“
â”‚   â””â”€â”€ macro_data.duckdb          # å®è§‚ç»æµæ•°æ®åº“
â”œâ”€â”€ metadata/
â”‚   â””â”€â”€ asset_database_registry.db # èµ„äº§æ•°æ®åº“æ³¨å†Œè¡¨(SQLite)
â””â”€â”€ backups/                       # æ•°æ®åº“å¤‡ä»½ç›®å½•
```

**èµ„äº§ç±»å‹ä¸æ•°æ®åº“æ˜ å°„å…³ç³»ï¼š**
```python
ASSET_DATABASE_MAPPING = {
    # è‚¡ç¥¨ç›¸å…³èµ„äº§ç±»å‹ -> è‚¡ç¥¨æ•°æ®åº“
    AssetType.STOCK: "stock_data.duckdb",
    AssetType.STOCK_A: "stock_data.duckdb",
    AssetType.STOCK_B: "stock_data.duckdb", 
    AssetType.STOCK_H: "stock_data.duckdb",
    AssetType.STOCK_US: "stock_data.duckdb",
    AssetType.STOCK_HK: "stock_data.duckdb",
    
    # å…¶ä»–èµ„äº§ç±»å‹ -> ä¸“ç”¨æ•°æ®åº“
    AssetType.FUTURES: "futures_data.duckdb",
    AssetType.CRYPTO: "crypto_data.duckdb",
    AssetType.FOREX: "forex_data.duckdb",
    AssetType.BOND: "bond_data.duckdb",
    AssetType.FUND: "fund_data.duckdb",
    AssetType.INDEX: "index_data.duckdb",
    AssetType.COMMODITY: "commodity_data.duckdb",
    AssetType.MACRO: "macro_data.duckdb",
    
    # æ¿å—æ•°æ® -> è‚¡ç¥¨æ•°æ®åº“(ä¸è‚¡ç¥¨ç›¸å…³)
    AssetType.SECTOR: "stock_data.duckdb",
    AssetType.INDUSTRY_SECTOR: "stock_data.duckdb",
    AssetType.CONCEPT_SECTOR: "stock_data.duckdb",
}
```

**2. åŒèµ„äº§å†…çš„è¡¨ç»“æ„è®¾è®¡**

ä»¥è‚¡ç¥¨æ•°æ®åº“ä¸ºä¾‹ï¼Œæ¯ä¸ªèµ„äº§æ•°æ®åº“å†…æŒ‰æ•°æ®æºå’Œæ•°æ®ç±»å‹ç»„ç»‡è¡¨ï¼š

**æ ¸å¿ƒå†å²Kçº¿æ•°æ®è¡¨ (æŒ‰æ•°æ®æºåˆ†è¡¨)**
```sql
-- ä¸œæ–¹è´¢å¯Œå†å²Kçº¿æ•°æ®
CREATE TABLE historical_kline_eastmoney (
    id BIGINT PRIMARY KEY,
    symbol VARCHAR(12) NOT NULL,              -- æ ‡å‡†åŒ–ä»£ç (000001.SZ)
    trade_date DATE NOT NULL,                 -- äº¤æ˜“æ—¥æœŸ
    period VARCHAR(10) NOT NULL,              -- æ•°æ®å‘¨æœŸ(1d,1h,5mç­‰)
    open_price DECIMAL(10,4) NOT NULL,        -- å¼€ç›˜ä»·
    high_price DECIMAL(10,4) NOT NULL,        -- æœ€é«˜ä»·
    low_price DECIMAL(10,4) NOT NULL,         -- æœ€ä½ä»·
    close_price DECIMAL(10,4) NOT NULL,       -- æ”¶ç›˜ä»·
    volume BIGINT DEFAULT 0,                  -- æˆäº¤é‡
    amount DECIMAL(20,2) DEFAULT 0,           -- æˆäº¤é¢
    adj_factor DECIMAL(10,6) DEFAULT 1.0,     -- å¤æƒå› å­
    
    -- æ•°æ®è´¨é‡å’Œæ¥æºä¿¡æ¯
    data_source VARCHAR(50) DEFAULT 'eastmoney',
    data_quality_score DECIMAL(3,2),          -- æ•°æ®è´¨é‡è¯„åˆ†(0-1)
    fetch_time TIMESTAMP,                     -- åŸå§‹è·å–æ—¶é—´
    process_time TIMESTAMP,                   -- å¤„ç†æ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•ä¼˜åŒ–
    UNIQUE KEY uk_symbol_date_period (symbol, trade_date, period),
    KEY idx_trade_date (trade_date),
    KEY idx_symbol (symbol),
    KEY idx_period (period),
    KEY idx_data_quality_score (data_quality_score)
);

-- é€šè¾¾ä¿¡å†å²Kçº¿æ•°æ®
CREATE TABLE historical_kline_tongdaxin (
    -- ç›¸åŒç»“æ„ï¼Œdata_sourceé»˜è®¤ä¸º'tongdaxin'
    ...
);

-- æ–°æµªè´¢ç»å†å²Kçº¿æ•°æ®  
CREATE TABLE historical_kline_sina (
    -- ç›¸åŒç»“æ„ï¼Œdata_sourceé»˜è®¤ä¸º'sina'
    ...
);
```

**ç»Ÿä¸€æ ‡å‡†åŒ–è§†å›¾**
```sql
-- åˆ›å»ºç»Ÿä¸€çš„å†å²Kçº¿æ•°æ®è§†å›¾ï¼Œåˆå¹¶æ‰€æœ‰æ•°æ®æº
CREATE VIEW unified_historical_kline AS
SELECT 
    symbol, trade_date, period, open_price, high_price, low_price, close_price,
    volume, amount, adj_factor, data_source, data_quality_score,
    fetch_time, process_time, created_at, updated_at,
    ROW_NUMBER() OVER (
        PARTITION BY symbol, trade_date, period 
        ORDER BY data_quality_score DESC, process_time DESC
    ) as priority_rank
FROM (
    SELECT * FROM historical_kline_eastmoney
    UNION ALL
    SELECT * FROM historical_kline_tongdaxin  
    UNION ALL
    SELECT * FROM historical_kline_sina
) all_sources;

-- åˆ›å»ºæœ€ä½³æ•°æ®æºè§†å›¾(æ¯ä¸ªsymbol+date+periodåªä¿ç•™è´¨é‡æœ€é«˜çš„è®°å½•)
CREATE VIEW best_quality_kline AS
SELECT 
    symbol, trade_date, period, open_price, high_price, low_price, close_price,
    volume, amount, adj_factor, data_source, data_quality_score,
    fetch_time, process_time, created_at, updated_at
FROM unified_historical_kline
WHERE priority_rank = 1;
```

**3. åŸå§‹æ•°æ®ä¿å­˜è¡¨**
```sql
-- åŸå§‹æ•°æ®è®°å½•è¡¨(ä¿ç•™å„æ•°æ®æºçš„åŸå§‹æ ¼å¼)
CREATE TABLE raw_data_records (
    id BIGINT PRIMARY KEY,
    symbol VARCHAR(12) NOT NULL,
    trade_date DATE NOT NULL,
    period VARCHAR(10) NOT NULL,
    data_source VARCHAR(50) NOT NULL,         -- æ•°æ®æºåç§°
    raw_data_json TEXT,                       -- åŸå§‹JSONæ•°æ®
    raw_data_format VARCHAR(20),              -- åŸå§‹æ•°æ®æ ¼å¼(json/csv/xml)
    processing_status VARCHAR(20),            -- pending/processed/failed/skipped
    error_message TEXT,                       -- å¤„ç†é”™è¯¯ä¿¡æ¯
    quality_metrics JSON,                     -- æ•°æ®è´¨é‡æŒ‡æ ‡
    fetch_time TIMESTAMP,                     -- è·å–æ—¶é—´
    process_time TIMESTAMP,                   -- å¤„ç†æ—¶é—´
    
    KEY idx_symbol_date_source (symbol, trade_date, data_source),
    KEY idx_processing_status (processing_status),
    KEY idx_fetch_time (fetch_time)
);
```

**4. æ•°æ®è´¨é‡ç›‘æ§è¡¨**
```sql
CREATE TABLE data_quality_monitor (
    id BIGINT PRIMARY KEY,
    symbol VARCHAR(12),
    trade_date DATE,
    period VARCHAR(10),
    data_source VARCHAR(50),
    quality_check_type VARCHAR(50),           -- price_logic/volume_anomaly/continuityç­‰
    quality_score DECIMAL(3,2),               -- è´¨é‡å¾—åˆ†
    issue_description TEXT,                   -- é—®é¢˜æè¿°
    auto_fixed BOOLEAN DEFAULT FALSE,         -- æ˜¯å¦è‡ªåŠ¨ä¿®å¤
    fix_description TEXT,                     -- ä¿®å¤è¯´æ˜
    check_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    KEY idx_symbol_date (symbol, trade_date),
    KEY idx_quality_check_type (quality_check_type),
    KEY idx_quality_score (quality_score)
);
```

**5. èµ„äº§æ•°æ®åº“å…ƒæ•°æ®ç®¡ç†**

**èµ„äº§æ•°æ®åº“æ³¨å†Œè¡¨ (SQLiteå­˜å‚¨)**
```sql
-- å­˜å‚¨åœ¨ metadata/asset_database_registry.db
CREATE TABLE asset_database_registry (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    asset_type VARCHAR(50) NOT NULL UNIQUE,   -- èµ„äº§ç±»å‹
    database_name VARCHAR(100) NOT NULL,      -- æ•°æ®åº“æ–‡ä»¶å
    database_path TEXT NOT NULL,              -- å®Œæ•´æ•°æ®åº“è·¯å¾„
    description TEXT,                         -- æ•°æ®åº“æè¿°
    max_size_gb INTEGER DEFAULT 100,          -- æœ€å¤§å¤§å°é™åˆ¶(GB)
    current_size_mb DECIMAL(10,2),            -- å½“å‰å¤§å°(MB)
    table_count INTEGER DEFAULT 0,            -- è¡¨æ•°é‡
    record_count BIGINT DEFAULT 0,            -- è®°å½•æ€»æ•°
    last_backup_time TIMESTAMP,               -- æœ€åå¤‡ä»½æ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ•°æ®æºæ”¯æŒæƒ…å†µè®°å½•
CREATE TABLE asset_datasource_support (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    asset_type VARCHAR(50) NOT NULL,
    data_source VARCHAR(50) NOT NULL,
    data_types JSON,                          -- æ”¯æŒçš„æ•°æ®ç±»å‹åˆ—è¡¨
    historical_coverage_years INTEGER,        -- å†å²æ•°æ®è¦†ç›–å¹´é™
    data_quality_avg DECIMAL(3,2),            -- å¹³å‡æ•°æ®è´¨é‡
    is_active BOOLEAN DEFAULT TRUE,           -- æ˜¯å¦æ¿€æ´»
    last_update_time TIMESTAMP,
    
    UNIQUE(asset_type, data_source),
    KEY idx_asset_type (asset_type),
    KEY idx_data_source (data_source)
);
```

##### 3.5.3 æ•°æ®è´¨é‡æ§åˆ¶æœºåˆ¶

**1. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥**
- **ä»·æ ¼åˆç†æ€§æ£€æŸ¥**ï¼šå¼€é«˜ä½æ”¶ä»·æ ¼çš„é€»è¾‘å…³ç³»éªŒè¯
- **æ¶¨è·Œå¹…é™åˆ¶æ£€æŸ¥**ï¼šåŸºäºäº¤æ˜“æ‰€æ¶¨è·Œåœè§„åˆ™éªŒè¯
- **æˆäº¤é‡å¼‚å¸¸æ£€æŸ¥**ï¼šæ£€æµ‹å¼‚å¸¸çš„æˆäº¤é‡æ•°æ®
- **æ—¶é—´åºåˆ—è¿ç»­æ€§æ£€æŸ¥**ï¼šæ£€æŸ¥æ•°æ®çš„æ—¶é—´è¿ç»­æ€§

**2. å¤šæ•°æ®æºå†²çªå¤„ç†**

**æ•°æ®ä¼˜å…ˆçº§ç­–ç•¥ï¼š**
```
æ•°æ®æºä¼˜å…ˆçº§æ’åºï¼ˆå¯é…ç½®ï¼‰ï¼š
1. ä¸œæ–¹è´¢å¯Œ - æ•°æ®å®Œæ•´åº¦é«˜ï¼Œå¤æƒå¤„ç†å‡†ç¡®
2. é€šè¾¾ä¿¡ - å®æ—¶æ€§å¥½ï¼Œåˆ†é’Ÿçº§æ•°æ®ä¸°å¯Œ
3. æ–°æµªè´¢ç» - è¦†ç›–é¢å¹¿ï¼Œå…è´¹æ•°æ®æº
4. è…¾è®¯è´¢ç» - ç¨³å®šæ€§è¾ƒå¥½ï¼ŒåŸºç¡€æ•°æ®å……è¶³
```

**å†²çªè§£å†³ç®—æ³•ï¼š**
- **å®Œå…¨ä¸€è‡´**ï¼šå¤šä¸ªæ•°æ®æºæ•°æ®å®Œå…¨ä¸€è‡´ï¼Œç›´æ¥å­˜å‚¨
- **å¾®å°å·®å¼‚**ï¼šå·®å¼‚åœ¨å®¹å¿èŒƒå›´å†…(å¦‚ä»·æ ¼å·®å¼‚<0.01%)ï¼Œé€‰æ‹©ä¸»è¦æ•°æ®æº
- **æ˜¾è‘—å·®å¼‚**ï¼šæ ‡è®°ä¸ºæ•°æ®å¼‚å¸¸ï¼Œéœ€è¦äººå·¥å®¡æ ¸æˆ–ä½¿ç”¨å¤šæ•°æ®æºåŠ æƒå¹³å‡
- **æ•°æ®ç¼ºå¤±**ï¼šä¼˜å…ˆä½¿ç”¨æœ‰æ•°æ®çš„æºï¼Œè®°å½•ç¼ºå¤±æƒ…å†µ

**3. è‡ªåŠ¨æ•°æ®ä¿®å¤æœºåˆ¶**
- **æ’å€¼ä¿®å¤**ï¼šå¯¹äºä¸ªåˆ«ç¼ºå¤±çš„æ•°æ®ç‚¹è¿›è¡Œåˆç†æ’å€¼
- **å¼‚å¸¸å€¼ä¿®æ­£**ï¼šåŸºäºç»Ÿè®¡æ–¹æ³•è¯†åˆ«å¹¶ä¿®æ­£æ˜æ˜¾çš„å¼‚å¸¸å€¼
- **å¤æƒæ•°æ®é‡ç®—**ï¼šåŸºäºåˆ†çº¢é…è‚¡ä¿¡æ¯é‡æ–°è®¡ç®—å¤æƒä»·æ ¼
- **æ•°æ®ç‰ˆæœ¬ç®¡ç†**ï¼šä¿ç•™åŸå§‹æ•°æ®å’Œä¿®å¤åæ•°æ®çš„ç‰ˆæœ¬è®°å½•

##### 3.5.4 æ ‡å‡†åŒ–å­˜å‚¨å®ç°æœºåˆ¶

**1. æ•°æ®å¤„ç†å·¥ä½œæµ**

```
æ•°æ®å¤„ç†å·¥ä½œæµï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹æ•°æ®æ¥æ”¶   â”‚ -> â”‚   æ ¼å¼è½¬æ¢      â”‚ -> â”‚   è´¨é‡æ£€æŸ¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          v                      v                      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­—æ®µæ˜ å°„è½¬æ¢   â”‚ -> â”‚   å†²çªè§£å†³      â”‚ -> â”‚   æ ‡å‡†åŒ–å­˜å‚¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          v                      v                      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…ƒæ•°æ®è®°å½•     â”‚ -> â”‚   è´¨é‡è¯„åˆ†      â”‚ -> â”‚   ç´¢å¼•æ›´æ–°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. ä¸TETæ¡†æ¶é›†æˆ**

**åˆ©ç”¨ç°æœ‰ç»„ä»¶ï¼š**
- **StandardDataæ¨¡å‹**ï¼šå®šä¹‰ç»Ÿä¸€çš„æ•°æ®ç»“æ„
- **FieldMappingEngine**ï¼šå¤„ç†å­—æ®µæ˜ å°„å’Œè½¬æ¢
- **DataValidator**ï¼šæ‰§è¡Œæ•°æ®è´¨é‡æ£€æŸ¥
- **CacheManager**ï¼šç®¡ç†å¤„ç†åçš„æ•°æ®ç¼“å­˜

**æ‰©å±•TETæ¡†æ¶ï¼š**
- **AssetSeparatedDatabaseManager**ï¼šæŒ‰èµ„äº§ç±»å‹åˆ†æ•°æ®åº“ç®¡ç†å™¨
- **MultiSourceDataProcessor**ï¼šå¤šæ•°æ®æºæ•°æ®å¤„ç†å™¨
- **DataQualityManager**ï¼šæ•°æ®è´¨é‡ç®¡ç†å™¨
- **ConflictResolver**ï¼šæ•°æ®å†²çªè§£å†³å™¨
- **MetadataManager**ï¼šå…ƒæ•°æ®ç®¡ç†å™¨

##### 3.5.6 æŒ‰èµ„äº§ç±»å‹åˆ†æ•°æ®åº“çš„å®ç°æœºåˆ¶

**1. èµ„äº§æ•°æ®åº“ç®¡ç†å™¨è®¾è®¡**

åŸºäºç°æœ‰çš„ `DataSourceSeparatedStorageManager`ï¼Œè®¾è®¡æ–°çš„ `AssetSeparatedDatabaseManager`ï¼š

```python
class AssetSeparatedDatabaseManager:
    """æŒ‰èµ„äº§ç±»å‹åˆ†æ•°æ®åº“ç®¡ç†å™¨"""
    
    def __init__(self, base_db_dir: str = "db/asset_databases"):
        self.base_db_dir = Path(base_db_dir)
        self.metadata_db_path = "db/metadata/asset_database_registry.db"
        self.asset_database_mapping = ASSET_DATABASE_MAPPING
        self.connection_managers = {}  # æ¯ä¸ªèµ„äº§æ•°æ®åº“çš„è¿æ¥ç®¡ç†å™¨
        
    def get_database_for_asset(self, asset_type: AssetType) -> str:
        """æ ¹æ®èµ„äº§ç±»å‹è·å–å¯¹åº”çš„æ•°æ®åº“æ–‡ä»¶å"""
        return self.asset_database_mapping.get(asset_type, "unknown_data.duckdb")
        
    def get_connection_manager(self, asset_type: AssetType) -> DuckDBConnectionManager:
        """è·å–æŒ‡å®šèµ„äº§ç±»å‹çš„æ•°æ®åº“è¿æ¥ç®¡ç†å™¨"""
        db_name = self.get_database_for_asset(asset_type)
        if db_name not in self.connection_managers:
            db_path = self.base_db_dir / db_name
            self.connection_managers[db_name] = DuckDBConnectionManager(str(db_path))
        return self.connection_managers[db_name]
        
    def route_data_to_asset_database(self, symbol: str, asset_type: AssetType, 
                                   data_source: str, data: pd.DataFrame) -> bool:
        """å°†æ•°æ®è·¯ç”±åˆ°å¯¹åº”çš„èµ„äº§æ•°æ®åº“"""
        try:
            # è·å–ç›®æ ‡æ•°æ®åº“è¿æ¥
            conn_manager = self.get_connection_manager(asset_type)
            
            # ç¡®å®šç›®æ ‡è¡¨å
            table_name = f"historical_kline_{data_source.lower()}"
            
            # æ•°æ®æ ‡å‡†åŒ–å¤„ç†
            standardized_data = self.standardize_data_for_asset(data, asset_type, data_source)
            
            # ä¿å­˜åˆ°å¯¹åº”çš„èµ„äº§æ•°æ®åº“
            return self.save_to_asset_database(conn_manager, table_name, standardized_data)
            
        except Exception as e:
            logger.error(f"æ•°æ®è·¯ç”±å¤±è´¥: {symbol}, {asset_type}, {data_source}, é”™è¯¯: {e}")
            return False
```

**2. æ•°æ®è·¯ç”±ä¸èµ„äº§è¯†åˆ«æœºåˆ¶**

```python
class AssetTypeIdentifier:
    """èµ„äº§ç±»å‹è¯†åˆ«å™¨"""
    
    @staticmethod
    def identify_asset_type_by_symbol(symbol: str) -> AssetType:
        """æ ¹æ®è‚¡ç¥¨ä»£ç è¯†åˆ«èµ„äº§ç±»å‹"""
        symbol = symbol.upper()
        
        # Aè‚¡è¯†åˆ«è§„åˆ™
        if symbol.endswith('.SZ') or symbol.endswith('.SH'):
            if symbol.startswith('000') or symbol.startswith('002') or symbol.startswith('300'):
                return AssetType.STOCK_A
            elif symbol.startswith('600') or symbol.startswith('601') or symbol.startswith('603'):
                return AssetType.STOCK_A
            elif symbol.startswith('200') or symbol.startswith('900'):
                return AssetType.STOCK_B
                
        # æ¸¯è‚¡è¯†åˆ«è§„åˆ™
        elif symbol.endswith('.HK'):
            return AssetType.STOCK_HK
            
        # ç¾è‚¡è¯†åˆ«è§„åˆ™
        elif '.' not in symbol and len(symbol) <= 5 and symbol.isalpha():
            return AssetType.STOCK_US
            
        # æ•°å­—è´§å¸è¯†åˆ«è§„åˆ™
        elif 'USDT' in symbol or 'BTC' in symbol or 'ETH' in symbol:
            return AssetType.CRYPTO
            
        # æœŸè´§è¯†åˆ«è§„åˆ™
        elif any(keyword in symbol for keyword in ['IF', 'IC', 'IH', 'CU', 'AL', 'ZN']):
            return AssetType.FUTURES
            
        # é»˜è®¤è¿”å›è‚¡ç¥¨ç±»å‹
        return AssetType.STOCK

class DataRouter:
    """æ•°æ®è·¯ç”±å™¨"""
    
    def __init__(self, asset_db_manager: AssetSeparatedDatabaseManager):
        self.asset_db_manager = asset_db_manager
        self.asset_identifier = AssetTypeIdentifier()
        
    def route_historical_data(self, symbol: str, data_source: str, 
                            raw_data: Dict, data_type: DataType) -> bool:
        """è·¯ç”±å†å²æ•°æ®åˆ°å¯¹åº”çš„èµ„äº§æ•°æ®åº“"""
        try:
            # 1. è¯†åˆ«èµ„äº§ç±»å‹
            asset_type = self.asset_identifier.identify_asset_type_by_symbol(symbol)
            
            # 2. æ•°æ®æ ¼å¼æ ‡å‡†åŒ–
            standardized_data = self.standardize_raw_data(raw_data, data_source, data_type)
            
            # 3. è·¯ç”±åˆ°å¯¹åº”èµ„äº§æ•°æ®åº“
            return self.asset_db_manager.route_data_to_asset_database(
                symbol, asset_type, data_source, standardized_data
            )
            
        except Exception as e:
            logger.error(f"æ•°æ®è·¯ç”±å¤±è´¥: {symbol}, {data_source}, é”™è¯¯: {e}")
            return False
```

**3. è·¨èµ„äº§æ•°æ®åº“æŸ¥è¯¢æœºåˆ¶**

```python
class UnifiedAssetDataQuery:
    """ç»Ÿä¸€èµ„äº§æ•°æ®æŸ¥è¯¢æ¥å£"""
    
    def __init__(self, asset_db_manager: AssetSeparatedDatabaseManager):
        self.asset_db_manager = asset_db_manager
        
    def query_historical_kline(self, symbols: List[str], start_date: str, end_date: str, 
                             period: str = '1d') -> pd.DataFrame:
        """è·¨èµ„äº§æ•°æ®åº“æŸ¥è¯¢å†å²Kçº¿æ•°æ®"""
        all_results = []
        
        # æŒ‰èµ„äº§ç±»å‹åˆ†ç»„æŸ¥è¯¢
        symbol_groups = self.group_symbols_by_asset_type(symbols)
        
        for asset_type, symbol_list in symbol_groups.items():
            try:
                # è·å–å¯¹åº”èµ„äº§æ•°æ®åº“è¿æ¥
                conn_manager = self.asset_db_manager.get_connection_manager(asset_type)
                
                # æ„é€ æŸ¥è¯¢SQL
                symbol_list_str = "', '".join(symbol_list)
                query_sql = f"""
                SELECT * FROM best_quality_kline 
                WHERE symbol IN ('{symbol_list_str}')
                AND trade_date BETWEEN '{start_date}' AND '{end_date}'
                AND period = '{period}'
                ORDER BY symbol, trade_date
                """
                
                # æ‰§è¡ŒæŸ¥è¯¢
                with conn_manager.get_connection() as conn:
                    result_df = conn.execute(query_sql).fetchdf()
                    if not result_df.empty:
                        result_df['asset_type'] = asset_type.value
                        all_results.append(result_df)
                        
            except Exception as e:
                logger.error(f"æŸ¥è¯¢èµ„äº§æ•°æ®åº“å¤±è´¥: {asset_type}, é”™è¯¯: {e}")
                
        # åˆå¹¶æ‰€æœ‰ç»“æœ
        if all_results:
            return pd.concat(all_results, ignore_index=True)
        else:
            return pd.DataFrame()
            
    def group_symbols_by_asset_type(self, symbols: List[str]) -> Dict[AssetType, List[str]]:
        """å°†è‚¡ç¥¨ä»£ç æŒ‰èµ„äº§ç±»å‹åˆ†ç»„"""
        groups = {}
        identifier = AssetTypeIdentifier()
        
        for symbol in symbols:
            asset_type = identifier.identify_asset_type_by_symbol(symbol)
            if asset_type not in groups:
                groups[asset_type] = []
            groups[asset_type].append(symbol)
            
        return groups
```

**4. æ•°æ®åº“ç»´æŠ¤ä¸ä¼˜åŒ–**

```python
class AssetDatabaseMaintenance:
    """èµ„äº§æ•°æ®åº“ç»´æŠ¤"""
    
    def __init__(self, asset_db_manager: AssetSeparatedDatabaseManager):
        self.asset_db_manager = asset_db_manager
        
    def optimize_database_performance(self, asset_type: AssetType):
        """ä¼˜åŒ–æŒ‡å®šèµ„äº§æ•°æ®åº“æ€§èƒ½"""
        conn_manager = self.asset_db_manager.get_connection_manager(asset_type)
        
        with conn_manager.get_connection() as conn:
            # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            conn.execute("ANALYZE;")
            
            # ä¼˜åŒ–ç´¢å¼•
            conn.execute("PRAGMA optimize;")
            
            # æ¸…ç†ç¢ç‰‡
            conn.execute("VACUUM;")
            
    def backup_asset_database(self, asset_type: AssetType, backup_path: str):
        """å¤‡ä»½æŒ‡å®šèµ„äº§æ•°æ®åº“"""
        db_path = self.asset_db_manager.base_db_dir / self.asset_db_manager.get_database_for_asset(asset_type)
        backup_file = Path(backup_path) / f"{asset_type.value}_backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}.duckdb"
        
        # æ‰§è¡Œå¤‡ä»½
        shutil.copy2(db_path, backup_file)
        logger.info(f"èµ„äº§æ•°æ®åº“å¤‡ä»½å®Œæˆ: {asset_type.value} -> {backup_file}")
        
    def get_database_statistics(self) -> Dict[str, Dict]:
        """è·å–æ‰€æœ‰èµ„äº§æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯"""
        stats = {}
        
        for asset_type in AssetType:
            try:
                conn_manager = self.asset_db_manager.get_connection_manager(asset_type)
                with conn_manager.get_connection() as conn:
                    # è·å–è¡¨ä¿¡æ¯
                    tables_info = conn.execute("SHOW TABLES;").fetchall()
                    
                    # è·å–æ•°æ®åº“å¤§å°
                    db_size = conn.execute("SELECT pg_database_size(current_database());").fetchone()
                    
                    stats[asset_type.value] = {
                        'table_count': len(tables_info),
                        'database_size_mb': db_size[0] / (1024 * 1024) if db_size else 0,
                        'tables': [table[0] for table in tables_info]
                    }
                    
            except Exception as e:
                logger.error(f"è·å–æ•°æ®åº“ç»Ÿè®¡å¤±è´¥: {asset_type.value}, é”™è¯¯: {e}")
                stats[asset_type.value] = {'error': str(e)}
                
        return stats
```

**5. ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ**

**æ‰©å±•ç°æœ‰çš„TETæ¡†æ¶ç»„ä»¶ï¼š**

```python
# æ‰©å±•ç°æœ‰çš„UnifiedDataManager
class EnhancedUnifiedDataManager(UnifiedDataManager):
    """å¢å¼ºçš„ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨ï¼Œæ”¯æŒæŒ‰èµ„äº§ç±»å‹åˆ†æ•°æ®åº“"""
    
    def __init__(self):
        super().__init__()
        self.asset_db_manager = AssetSeparatedDatabaseManager()
        self.data_router = DataRouter(self.asset_db_manager)
        self.unified_query = UnifiedAssetDataQuery(self.asset_db_manager)
        
    def save_historical_data(self, symbol: str, data_source: str, 
                           raw_data: Dict, data_type: DataType) -> bool:
        """ä¿å­˜å†å²æ•°æ®åˆ°å¯¹åº”çš„èµ„äº§æ•°æ®åº“"""
        return self.data_router.route_historical_data(symbol, data_source, raw_data, data_type)
        
    def query_cross_asset_data(self, symbols: List[str], start_date: str, 
                              end_date: str, period: str = '1d') -> pd.DataFrame:
        """è·¨èµ„äº§æŸ¥è¯¢æ•°æ®"""
        return self.unified_query.query_historical_kline(symbols, start_date, end_date, period)

# æ‰©å±•ç°æœ‰çš„DataSourceRouter
class AssetAwareDataSourceRouter(DataSourceRouter):
    """èµ„äº§æ„ŸçŸ¥çš„æ•°æ®æºè·¯ç”±å™¨"""
    
    def __init__(self):
        super().__init__()
        self.asset_db_manager = AssetSeparatedDatabaseManager()
        
    def route_data_request(self, request: DataRequest) -> Any:
        """è·¯ç”±æ•°æ®è¯·æ±‚ï¼Œè€ƒè™‘èµ„äº§ç±»å‹"""
        # è¯†åˆ«è¯·æ±‚ä¸­çš„èµ„äº§ç±»å‹
        asset_type = AssetTypeIdentifier.identify_asset_type_by_symbol(request.symbol)
        
        # æ ¹æ®èµ„äº§ç±»å‹é€‰æ‹©æœ€ä½³æ•°æ®æº
        best_sources = self.get_best_sources_for_asset(asset_type, request.data_type)
        
        # æ‰§è¡Œæ•°æ®è¯·æ±‚è·¯ç”±
        return self.execute_request_with_sources(request, best_sources)
```

**3. æ‰¹é‡å¤„ç†ä¼˜åŒ–**

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š**
- **æ‰¹é‡æ’å…¥**ï¼šä½¿ç”¨æ‰¹é‡æ’å…¥å‡å°‘æ•°æ®åº“æ“ä½œæ¬¡æ•°
- **å¹¶è¡Œå¤„ç†**ï¼šå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ä¸åŒè‚¡ç¥¨çš„æ•°æ®
- **å¢é‡æ›´æ–°**ï¼šåªå¤„ç†æ–°å¢æˆ–å˜æ›´çš„æ•°æ®
- **åˆ†åŒºå­˜å‚¨**ï¼šæŒ‰æ—¶é—´æˆ–è‚¡ç¥¨ä»£ç åˆ†åŒºå­˜å‚¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡

**å†…å­˜ç®¡ç†ï¼š**
- **æµå¼å¤„ç†**ï¼šå¤§æ‰¹é‡æ•°æ®é‡‡ç”¨æµå¼å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
- **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
- **åƒåœ¾å›æ”¶**ï¼šåŠæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å†…å­˜èµ„æº

##### 3.5.5 æ•°æ®å®Œæ•´æ€§ä¿éšœ

**1. äº‹åŠ¡å¤„ç†**
- ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- æ‰¹é‡æ“ä½œå¤±è´¥æ—¶æ”¯æŒå›æ»š
- è®°å½•å¤„ç†æ—¥å¿—ä¾¿äºé—®é¢˜è¿½è¸ª

**2. æ•°æ®å¤‡ä»½ä¸æ¢å¤**
- å®šæœŸå¤‡ä»½æ ‡å‡†åŒ–æ•°æ®
- æ”¯æŒå¢é‡å¤‡ä»½å‡å°‘å­˜å‚¨ç©ºé—´
- æä¾›æ•°æ®æ¢å¤æœºåˆ¶

**3. ç›‘æ§ä¸å‘Šè­¦**
- å®æ—¶ç›‘æ§æ•°æ®å¤„ç†çŠ¶æ€
- å¼‚å¸¸æƒ…å†µè‡ªåŠ¨å‘Šè­¦
- æä¾›æ•°æ®è´¨é‡æŠ¥å‘Šå’Œç»Ÿè®¡

### é˜¶æ®µå››ï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰

1. **æ·»åŠ é…ç½®å‘å¯¼åŠŸèƒ½**
   - ä¸ºé¦–æ¬¡ä½¿ç”¨çš„ç”¨æˆ·æä¾›å¼•å¯¼
   - è‡ªåŠ¨æ£€æµ‹å’Œæ¨èæœ€ä½³é…ç½®

2. **å¢å¼ºå¯è§†åŒ–æ•ˆæœ**
   - æ”¹è¿›çŠ¶æ€æ˜¾ç¤ºçš„è§†è§‰æ•ˆæœ
   - æ·»åŠ é…ç½®å˜æ›´çš„å¯è§†åŒ–åé¦ˆ

## ç»“è®º

ç°æœ‰çš„HIkyuu-UIæ’ä»¶ç®¡ç†ç³»ç»Ÿå·²ç»ç›¸å½“å®Œå–„ï¼Œæˆ‘åŸæ–¹æ¡ˆä¸­çš„å¤§éƒ¨åˆ†åŠŸèƒ½ç¡®å®å­˜åœ¨å†—ä½™ã€‚**å»ºè®®é‡‡ç”¨æ–¹æ¡ˆä¸€**ï¼Œåœ¨ç°æœ‰ç³»ç»ŸåŸºç¡€ä¸Šè¿›è¡Œå¢å¼ºï¼Œé‡ç‚¹æ·»åŠ ä»¥ä¸‹å‡ ä¸ªå¢å€¼åŠŸèƒ½ï¼š

1. **é…ç½®æ¨¡æ¿ç³»ç»Ÿ** - æä¾›é¢„è®¾é…ç½®æ¨¡æ¿ï¼Œç®€åŒ–ç”¨æˆ·æ“ä½œ
2. **æ™ºèƒ½æ¨èåŠŸèƒ½** - åŸºäºå†å²æ•°æ®æä¾›é…ç½®å»ºè®®
3. **æ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†ç³»ç»Ÿ** - å½“å†å²æ•°æ®ä¸å­˜åœ¨æ—¶çš„æ™ºèƒ½å¼•å¯¼å’Œè‡ªåŠ¨ä¸‹è½½æœºåˆ¶
4. **é…ç½®å‘å¯¼** - ä¸ºæ–°ç”¨æˆ·æä¾›å‹å¥½çš„å¼•å¯¼ä½“éªŒ
5. **å¢å¼ºçš„å¯è§†åŒ–** - æ”¹è¿›ç”¨æˆ·ç•Œé¢çš„ç›´è§‚æ€§å’Œæ˜“ç”¨æ€§

å…¶ä¸­ï¼Œ**æ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†ç³»ç»Ÿ**æ˜¯ä¸€ä¸ªç‰¹åˆ«æœ‰ä»·å€¼çš„æ–°å¢åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿï¼š
- è‡ªåŠ¨æ£€æµ‹æ•°æ®åº“ä¸­ç¼ºå¤±çš„å†å²æ•°æ®
- æ™ºèƒ½ç­›é€‰å’Œæ¨èåˆé€‚çš„å†å²æ•°æ®æºæ’ä»¶
- æä¾›ç”¨æˆ·å‹å¥½çš„å¼•å¯¼ç•Œé¢å’Œä¸€é”®ä¸‹è½½åŠŸèƒ½
- ä¸ç°æœ‰çš„æ•°æ®ç®¡ç†å’ŒTETæ¡†æ¶æ— ç¼é›†æˆ
- æ”¯æŒæ‰¹é‡æ•°æ®ä¸‹è½½å’Œè¿›åº¦è·Ÿè¸ª
- ä¸ºä¸åŒå±‚æ¬¡çš„ç”¨æˆ·æä¾›åˆ†å±‚çš„ä½¿ç”¨ä½“éªŒ

è¿™æ ·æ—¢é¿å…äº†é‡å¤å¼€å‘ï¼Œåˆèƒ½ä¸ºç³»ç»Ÿå¸¦æ¥å®é™…çš„ä»·å€¼æå‡ï¼Œç‰¹åˆ«æ˜¯è§£å†³äº†ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°æ•°æ®ç¼ºå¤±æ—¶çš„å›°æ‰°ï¼Œæ›´ç¬¦åˆ"åœ¨ç°æœ‰åŸºç¡€ä¸Šä¼˜åŒ–"çš„åŸåˆ™ã€‚

## åŸºäºç°æœ‰æ¶æ„çš„å®Œæ•´å®æ–½æ–¹æ¡ˆ

### ğŸ“‹ ç°æœ‰ç³»ç»Ÿæ¶æ„åˆ†ææ€»ç»“

**æ ¸å¿ƒå‘ç°ï¼š**
é€šè¿‡æ·±å…¥åˆ†æç°æœ‰ä»£ç ï¼Œå‘ç°ç³»ç»Ÿå·²å…·å¤‡ä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š

1. **TETæ•°æ®ç®¡é“** (`core/tet_data_pipeline.py`)ï¼š
   - å·²å®ç°Transform-Extract-Transformä¸‰é˜¶æ®µæ•°æ®å¤„ç†
   - æ”¯æŒå¤šæ•°æ®æºè·¯ç”±å’Œè´Ÿè½½å‡è¡¡
   - å…·å¤‡æ™ºèƒ½æ•…éšœè½¬ç§»æœºåˆ¶
   - æ”¯æŒå¼‚æ­¥å¹¶å‘å¤„ç†å’Œç¼“å­˜ä¼˜åŒ–

2. **ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨** (`core/services/unified_data_manager.py`)ï¼š
   - åè°ƒå„æœåŠ¡çš„æ•°æ®åŠ è½½è¯·æ±‚
   - é›†æˆDuckDBæ™ºèƒ½è·¯ç”±æœºåˆ¶
   - æ”¯æŒå¤šçº§ç¼“å­˜ç­–ç•¥
   - æä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£

3. **æ•°æ®å¯¼å…¥æ‰§è¡Œå¼•æ“** (`core/importdata/import_execution_engine.py`)ï¼š
   - å¤„ç†æ‰¹é‡æ•°æ®å¯¼å…¥ä»»åŠ¡
   - æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½
   - é›†æˆè¿›åº¦è·Ÿè¸ªå’Œé”™è¯¯å¤„ç†

4. **ç°æœ‰æ•°æ®æºåˆ†ç¦»å­˜å‚¨** (`core/database/data_source_separated_storage.py`)ï¼š
   - æ”¯æŒæŒ‰æ•°æ®æºè¿›è¡Œæ•°æ®åº“çº§åˆ«éš”ç¦»
   - æœ‰å®Œæ•´çš„éš”ç¦»çº§åˆ«æšä¸¾å’Œé…ç½®ç®¡ç†

**ç°æœ‰è°ƒç”¨é“¾åˆ†æï¼š**
```
UIå±‚ â†’ DataImportExecutionEngine â†’ TETDataPipeline â†’ UnifiedDataManager â†’ DuckDBConnectionManager â†’ æ•°æ®åº“å­˜å‚¨
```

### ğŸ¯ åŸºäºç°æœ‰æ¶æ„çš„é›†æˆæ–¹æ¡ˆ

#### 1. æ ¸å¿ƒé›†æˆç‚¹è¯†åˆ«

**ä¸»è¦é›†æˆç‚¹ï¼š**
1. **æ‰©å±•DuckDBConnectionManager**ï¼šæ”¯æŒå¤šèµ„äº§æ•°æ®åº“è¿æ¥ç®¡ç†
2. **å¢å¼ºTETDataPipeline**ï¼šåœ¨æ•°æ®å¤„ç†æµç¨‹ä¸­åŠ å…¥èµ„äº§è·¯ç”±å±‚
3. **æ‰©å±•UnifiedDataManager**ï¼šå¢åŠ èµ„äº§æ„ŸçŸ¥çš„æ•°æ®è·¯ç”±å†³ç­–
4. **åˆ©ç”¨ç°æœ‰UIæ¡†æ¶**ï¼šé›†æˆæ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†åˆ°ç°æœ‰æ’ä»¶ç®¡ç†ç³»ç»Ÿ

#### 2. æŠ€æœ¯å®ç°è·¯å¾„

**é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ•°æ®åº“ç®¡ç†æ‰©å±•**

åŸºäºç°æœ‰çš„ `DuckDBConnectionManager` å’Œ `DataSourceSeparatedStorageManager`ï¼Œåˆ›å»ºæ–°çš„èµ„äº§æ•°æ®åº“ç®¡ç†å±‚ï¼š

```python
# æ‰©å±•ç°æœ‰çš„ core/database/duckdb_manager.py
class AssetAwareDuckDBManager(DuckDBConnectionManager):
    """èµ„äº§æ„ŸçŸ¥çš„DuckDBè¿æ¥ç®¡ç†å™¨"""
    
    def __init__(self):
        super().__init__()
        self.asset_database_mapping = ASSET_DATABASE_MAPPING
        self.asset_connections = {}  # æŒ‰èµ„äº§ç±»å‹ç¼“å­˜è¿æ¥
        
    def get_connection_for_asset(self, asset_type: AssetType):
        """è·å–æŒ‡å®šèµ„äº§ç±»å‹çš„æ•°æ®åº“è¿æ¥"""
        db_name = self.asset_database_mapping.get(asset_type)
        if db_name not in self.asset_connections:
            db_path = os.path.join(self.base_db_dir, "asset_databases", db_name)
            self.asset_connections[db_name] = self._create_connection(db_path)
        return self.asset_connections[db_name]
```

**é˜¶æ®µäºŒï¼šTETæ¡†æ¶é›†æˆ**

åœ¨ç°æœ‰çš„ `TETDataPipeline` ä¸­å¢åŠ èµ„äº§è·¯ç”±å±‚ï¼š

```python
# æ‰©å±• core/tet_data_pipeline.py
class EnhancedTETDataPipeline(TETDataPipeline):
    """å¢å¼ºçš„TETæ•°æ®ç®¡é“ï¼Œæ”¯æŒæŒ‰èµ„äº§ç±»å‹è·¯ç”±"""
    
    def __init__(self):
        super().__init__()
        self.asset_db_manager = AssetAwareDuckDBManager()
        self.asset_identifier = AssetTypeIdentifier()
        
    def process_with_asset_routing(self, query: StandardQuery) -> StandardData:
        """å¢å¼ºçš„å¤„ç†æµç¨‹ï¼ŒåŒ…å«èµ„äº§è·¯ç”±"""
        # 1. è¯†åˆ«èµ„äº§ç±»å‹
        asset_type = self.asset_identifier.identify_asset_type_by_symbol(query.symbol)
        
        # 2. è°ƒç”¨åŸæœ‰çš„TETæµç¨‹
        result = super().process(query)
        
        # 3. æ ¹æ®èµ„äº§ç±»å‹è·¯ç”±åˆ°å¯¹åº”æ•°æ®åº“
        if result.data is not None and not result.data.empty:
            self._save_to_asset_database(result.data, asset_type, query)
            
        return result
```

**é˜¶æ®µä¸‰ï¼šç»Ÿä¸€æ•°æ®ç®¡ç†å™¨å¢å¼º**

æ‰©å±•ç°æœ‰çš„ `UnifiedDataManager`ï¼š

```python
# æ‰©å±• core/services/unified_data_manager.py
class AssetAwareUnifiedDataManager(UnifiedDataManager):
    """èµ„äº§æ„ŸçŸ¥çš„ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨"""
    
    def __init__(self):
        super().__init__()
        self.enhanced_tet_pipeline = EnhancedTETDataPipeline()
        
    def get_kdata_with_asset_routing(self, stock_code: str, period: str = 'D', count: int = 365) -> pd.DataFrame:
        """æ”¯æŒèµ„äº§è·¯ç”±çš„Kçº¿æ•°æ®è·å–"""
        # 1. è¯†åˆ«èµ„äº§ç±»å‹
        asset_type = AssetTypeIdentifier.identify_asset_type_by_symbol(stock_code)
        
        # 2. æ£€æŸ¥å¯¹åº”èµ„äº§æ•°æ®åº“ä¸­æ˜¯å¦æœ‰æ•°æ®
        cached_data = self._check_asset_database(stock_code, asset_type, period, count)
        if cached_data is not None:
            return cached_data
            
        # 3. å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œè§¦å‘æ™ºèƒ½ä¸‹è½½æµç¨‹
        return self._trigger_smart_download(stock_code, asset_type, period, count)
```

#### 3. æ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†é›†æˆ

**é›†æˆåˆ°ç°æœ‰UIç³»ç»Ÿï¼š**

åˆ©ç”¨ç°æœ‰çš„ `enhanced_plugin_manager_dialog.py` å’Œç›¸å…³UIç»„ä»¶ï¼Œæ·»åŠ æ•°æ®ç¼ºå¤±æ£€æµ‹å’Œå¤„ç†åŠŸèƒ½ï¼š

```python
# æ‰©å±• gui/dialogs/enhanced_plugin_manager_dialog.py
class DataMissingHandler(QObject):
    """æ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†å™¨"""
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.asset_manager = AssetAwareUnifiedDataManager()
        
    def check_and_handle_missing_data(self, symbol: str, start_date: str, end_date: str, data_type: str):
        """æ£€æŸ¥å¹¶å¤„ç†ç¼ºå¤±æ•°æ®"""
        # 1. æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
        missing_info = self._check_data_completeness(symbol, start_date, end_date, data_type)
        
        if missing_info['is_missing']:
            # 2. æ˜¾ç¤ºæ™ºèƒ½æç¤ºå¯¹è¯æ¡†
            dialog = DataMissingDialog(missing_info, parent=self.parent())
            if dialog.exec_() == QDialog.Accepted:
                # 3. æ‰§è¡Œæ•°æ®ä¸‹è½½
                self._execute_data_download(missing_info, dialog.get_selected_sources())
```

#### 4. ä¸€æ¬¡æ€§è¿ç§»ç­–ç•¥

**è¿ç§»æ­¥éª¤ï¼š**

1. **å‡†å¤‡é˜¶æ®µ**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå®Œæˆæ–°æ¶æ„å¼€å‘å’Œå……åˆ†éªŒè¯
2. **å¤‡ä»½é˜¶æ®µ**ï¼šè¿ç§»å‰å¯¹æ‰€æœ‰ç°æœ‰æ•°æ®è¿›è¡Œå®Œæ•´å¤‡ä»½
3. **è¿ç§»é˜¶æ®µ**ï¼šåœ¨ç»´æŠ¤çª—å£å†…ä¸€æ¬¡æ€§è¿ç§»åˆ°æ–°æ¶æ„
4. **éªŒè¯é˜¶æ®µ**ï¼šè¿ç§»å®Œæˆåè¿›è¡Œå…¨é¢æ•°æ®å®Œæ•´æ€§éªŒè¯

**é£é™©æ§åˆ¶æªæ–½ï¼š**

1. **å®Œæ•´å¤‡ä»½**ï¼šè¿ç§»å‰å¯¹æ‰€æœ‰æ•°æ®åº“æ–‡ä»¶è¿›è¡Œå®Œæ•´å¤‡ä»½
2. **å……åˆ†æµ‹è¯•**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒè¿›è¡Œå¤šè½®å®Œæ•´è¿ç§»æµ‹è¯•
3. **æ•°æ®éªŒè¯**ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·éªŒè¯è¿ç§»åçš„æ•°æ®å®Œæ•´æ€§
4. **åº”æ€¥é¢„æ¡ˆ**ï¼šåˆ¶å®šè¯¦ç»†çš„åº”æ€¥æ¢å¤ç¨‹åº

#### 5. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**åŸºäºç°æœ‰æ¶æ„çš„ä¼˜åŒ–ï¼š**

1. **è¿æ¥æ± å¤ç”¨**ï¼šåˆ©ç”¨ç°æœ‰çš„DuckDBè¿æ¥æ± æœºåˆ¶
2. **ç¼“å­˜ç­–ç•¥**ï¼šæ‰©å±•ç°æœ‰çš„å¤šçº§ç¼“å­˜åˆ°èµ„äº§æ•°æ®åº“
3. **å¹¶å‘å¤„ç†**ï¼šåˆ©ç”¨ç°æœ‰çš„å¼‚æ­¥å¹¶å‘æ¡†æ¶
4. **ç´¢å¼•ä¼˜åŒ–**ï¼šåŸºäºç°æœ‰çš„è¡¨ç»“æ„ç®¡ç†å™¨ä¼˜åŒ–ç´¢å¼•

### ğŸ“Š è¯¦ç»†å®æ–½è®¡åˆ’

#### Phase 1: åŸºç¡€æ¶æ„æ­å»º (é¢„è®¡2-3å‘¨)

**Week 1: æ ¸å¿ƒç»„ä»¶å®ç°**
- [ ] å®ç° `AssetTypeIdentifier` èµ„äº§ç±»å‹è¯†åˆ«å™¨
- [ ] åˆ›å»º `AssetAwareDuckDBManager` æ•°æ®åº“ç®¡ç†å™¨
- [ ] æ‰©å±•ç°æœ‰çš„è¡¨ç»“æ„ç®¡ç†å™¨æ”¯æŒèµ„äº§åˆ†ç±»

**Week 2: TETæ¡†æ¶é›†æˆ**
- [ ] å®ç° `EnhancedTETDataPipeline` å¢å¼ºç®¡é“
- [ ] é›†æˆèµ„äº§è·¯ç”±åˆ°æ•°æ®å¤„ç†æµç¨‹
- [ ] å®ç°æ•°æ®æ ‡å‡†åŒ–å­˜å‚¨æœºåˆ¶

**Week 3: æ’ä»¶ç³»ç»Ÿé€‚é…**
- [ ] é€‚é…ç°æœ‰æ•°æ®æºæ’ä»¶æ”¯æŒèµ„äº§è·¯ç”±ï¼ˆé€šè¾¾ä¿¡ã€ä¸œæ–¹è´¢å¯Œã€æ–°æµªã€è…¾è®¯ã€åŒèŠ±é¡ºï¼‰
- [ ] æ‰©å±•æ’ä»¶åŸºç±»æ”¯æŒèµ„äº§ç±»å‹è¯†åˆ«
- [ ] ä¿®æ”¹æ’ä»¶é…ç½®ç®¡ç†æ”¯æŒèµ„äº§åˆ†ç±»
- [ ] å®ç°æ’ä»¶å¥åº·æ£€æŸ¥çš„èµ„äº§æ„ŸçŸ¥åŠŸèƒ½

#### Phase 2: ç»Ÿä¸€ç®¡ç†å™¨ä¸æ’ä»¶é›†æˆ (é¢„è®¡2-3å‘¨)

**Week 4: ç»Ÿä¸€ç®¡ç†å™¨æ‰©å±•**
- [ ] æ‰©å±• `UnifiedDataManager` æ”¯æŒèµ„äº§è·¯ç”±
- [ ] å®ç°è·¨èµ„äº§æ•°æ®åº“æŸ¥è¯¢æ¥å£
- [ ] é›†æˆç°æœ‰ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–æœºåˆ¶

**Week 5: æ’ä»¶æ¥å£å®Œå–„**
- [ ] å®ç°æ’ä»¶æ•°æ®æ ‡å‡†åŒ–æ¥å£
- [ ] å¼€å‘æ’ä»¶é…ç½®è¿ç§»å·¥å…·
- [ ] å®ç°æ’ä»¶çŠ¶æ€ç®¡ç†çš„èµ„äº§æ„ŸçŸ¥åŠŸèƒ½
- [ ] å®Œå–„æ’ä»¶é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**Week 6: UIæ™ºèƒ½å¤„ç†é›†æˆ**
- [ ] å®ç°æ•°æ®ç¼ºå¤±æ™ºèƒ½æ£€æµ‹æœºåˆ¶
- [ ] è®¾è®¡å¹¶å®ç°æ•°æ®ç¼ºå¤±æç¤ºå¯¹è¯æ¡†
- [ ] é›†æˆæ’ä»¶ç­›é€‰å’Œæ¨èæœºåˆ¶
- [ ] å®ç°ä¸€é”®ä¸‹è½½å’Œæ‰¹é‡å¤„ç†åŠŸèƒ½

#### Phase 3: æ•°æ®è¿ç§»ä¸ä¼˜åŒ– (é¢„è®¡2-3å‘¨)

**Week 7: æ’ä»¶æµ‹è¯•ä¸éªŒè¯**
- [ ] å…¨é¢æµ‹è¯•æ‰€æœ‰é€‚é…åçš„æ•°æ®æºæ’ä»¶
- [ ] éªŒè¯æ’ä»¶é…ç½®è¿ç§»çš„æ­£ç¡®æ€§
- [ ] æµ‹è¯•æ’ä»¶åœ¨æ–°æ¶æ„ä¸‹çš„æ€§èƒ½è¡¨ç°
- [ ] éªŒè¯æ’ä»¶é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

**Week 8: è¿ç§»å·¥å…·å¼€å‘**
- [ ] å¼€å‘å†å²æ•°æ®ä¸€æ¬¡æ€§è¿ç§»å·¥å…·
- [ ] å®ç°æ•°æ®å®Œæ•´æ€§éªŒè¯æœºåˆ¶
- [ ] åˆ›å»ºè¿ç§»è¿›åº¦è·Ÿè¸ªå’ŒæŠ¥å‘Šç³»ç»Ÿ
- [ ] å¼€å‘åº”æ€¥æ¢å¤å·¥å…·

**Week 9: ç³»ç»Ÿé›†æˆæµ‹è¯•**
- [ ] å…¨é¢åŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•
- [ ] æ’ä»¶ç³»ç»Ÿé›†æˆæµ‹è¯•
- [ ] æ•°æ®è¿ç§»å®Œæ•´æ€§æµ‹è¯•
- [ ] ç”¨æˆ·éªŒæ”¶æµ‹è¯•

#### Phase 4: éƒ¨ç½²ä¸ç›‘æ§ (é¢„è®¡1-2å‘¨)

**Week 10: ç”Ÿäº§éƒ¨ç½²**
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œé…ç½®
- [ ] ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿè®¾ç½®
- [ ] ç”¨æˆ·åŸ¹è®­å’Œæ”¯æŒ

**Week 11: æŒç»­ä¼˜åŒ–**
- [ ] æ”¶é›†ç”¨æˆ·åé¦ˆå¹¶ä¼˜åŒ–
- [ ] æ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜
- [ ] åŠŸèƒ½è¿­ä»£å’Œå¢å¼º

### âš ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£

**é«˜é£é™©é¡¹ï¼š**
1. **æ•°æ®è¿ç§»é£é™©**ï¼šå¤§é‡å†å²æ•°æ®è¿ç§»å¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±
   - **ç¼“è§£æªæ–½**ï¼šå®Œæ•´å¤‡ä»½ã€åˆ†æ‰¹è¿ç§»ã€å®æ—¶éªŒè¯
   
2. **æ€§èƒ½å½±å“é£é™©**ï¼šæ–°æ¶æ„å¯èƒ½å½±å“ç°æœ‰ç³»ç»Ÿæ€§èƒ½
   - **ç¼“è§£æªæ–½**ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•ã€å……åˆ†çš„æ€§èƒ½ä¼˜åŒ–ã€åº”æ€¥æ¢å¤é¢„æ¡ˆ

**ä¸­é£é™©é¡¹ï¼š**
1. **æ’ä»¶å…¼å®¹æ€§é£é™©**ï¼šç°æœ‰æ’ä»¶å¯èƒ½ä¸æ–°æ¶æ„ä¸å…¼å®¹
   - **ç¼“è§£æªæ–½**ï¼šé€ä¸ªæ’ä»¶é€‚é…æµ‹è¯•ã€æä¾›æ’ä»¶è¿ç§»æŒ‡å—ã€å»ºç«‹æ’ä»¶æµ‹è¯•ç¯å¢ƒ

2. **ç”¨æˆ·ä½“éªŒé£é™©**ï¼šUIå˜åŒ–å¯èƒ½å½±å“ç”¨æˆ·ä¹ æƒ¯
   - **ç¼“è§£æªæ–½**ï¼šä¿æŒUIä¸€è‡´æ€§ã€ç”¨æˆ·åŸ¹è®­ã€åé¦ˆæ”¶é›†

### ğŸ¯ æˆåŠŸæ ‡å‡†

**æŠ€æœ¯æŒ‡æ ‡ï¼š**
- æ•°æ®æŸ¥è¯¢æ€§èƒ½æå‡30%ä»¥ä¸Š
- è·¨èµ„äº§æŸ¥è¯¢å“åº”æ—¶é—´<2ç§’
- æ•°æ®è¿ç§»å®Œæ•´æ€§100%
- ç³»ç»Ÿç¨³å®šæ€§99.9%ä»¥ä¸Š

**ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ï¼š**
- æ•°æ®ç¼ºå¤±æ™ºèƒ½å¤„ç†æˆåŠŸç‡>95%
- ç”¨æˆ·æ“ä½œæ­¥éª¤å‡å°‘50%ä»¥ä¸Š
- æ–°ç”¨æˆ·ä¸Šæ‰‹æ—¶é—´ç¼©çŸ­60%
- ç”¨æˆ·æ»¡æ„åº¦è¯„åˆ†>4.5/5

**ä¸šåŠ¡æŒ‡æ ‡ï¼š**
- æ”¯æŒèµ„äº§ç±»å‹è¦†ç›–ç‡100%
- æ•°æ®æºæ’ä»¶å…¼å®¹ç‡>90%
- ç³»ç»Ÿæ‰©å±•æ€§æ”¯æŒæœªæ¥3å¹´éœ€æ±‚
- ç»´æŠ¤æˆæœ¬é™ä½40%ä»¥ä¸Š

è¿™ä¸ªå®Œæ•´çš„å®æ–½æ–¹æ¡ˆåŸºäºç°æœ‰æ¶æ„ï¼Œç¡®ä¿æ¯ä¸€æ­¥éƒ½æ˜¯æŠ€æœ¯å¯è¡Œã€é£é™©å¯æ§çš„æ¸è¿›å¼æ”¹è¿›ï¼Œä¸ºæœ€ç»ˆçš„ç³»ç»Ÿå‡çº§å¥ å®šåšå®åŸºç¡€ã€‚
