<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易系统风险分析报告</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f8f9fa;
            color: #2c3e50;
        }
        .report-header {
            background-color: #2c3e50;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .report-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .system-component {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .component-status {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        .parameter-table {
            width: 100%;
            margin-top: 1rem;
        }
        .parameter-table th {
            background-color: #e9ecef;
        }
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .metric-item {
            text-align: center;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .metric-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .trade-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .trade-item {
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        .trade-profit {
            font-weight: bold;
        }
        .profit-positive {
            color: #28a745;
        }
        .profit-negative {
            color: #dc3545;
        }
        .strategy-chart {
            height: 400px;
            margin: 1rem 0;
        }
        .component-details {
            margin-top: 1rem;
        }
        .component-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
        }
        .component-metric {
            text-align: center;
            padding: 0.5rem;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .recommendation-item {
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .priority-high {
            border-left: 4px solid #dc3545;
        }
        .priority-medium {
            border-left: 4px solid #ffc107;
        }
        .priority-low {
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="report-header text-center">
        <h1>交易系统风险分析报告</h1>
        <p class="mb-0">报告生成时间: {{ timestamp }}</p>
    </div>

    <div class="container">
        <!-- 交易系统组件分析 -->
        <div class="report-section">
            <h2 class="section-title">1. 交易系统组件分析</h2>
            
            <!-- 信号系统 -->
            <div class="system-component">
                <div class="component-header">
                    <h3>信号系统</h3>
                    <span class="component-status status-{{ 'active' if report.signal_system.status else 'inactive' }}">
                        {{ '运行中' if report.signal_system.status else '已停止' }}
                    </span>
                </div>
                <div class="component-details">
                    <div class="component-metrics">
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.signal_system.accuracy * 100) }}%</div>
                            <div class="metric-label">信号准确率</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ report.signal_system.total_signals }}</div>
                            <div class="metric-label">总信号数</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ report.signal_system.buy_signals }}</div>
                            <div class="metric-label">买入信号</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ report.signal_system.sell_signals }}</div>
                            <div class="metric-label">卖出信号</div>
                        </div>
                    </div>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>参数名称</th>
                                <th>当前值</th>
                                <th>默认值</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param in report.signal_system.parameters %}
                            <tr>
                                <td>{{ param.name }}</td>
                                <td>{{ param.current_value }}</td>
                                <td>{{ param.default_value }}</td>
                                <td>{{ param.description }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 资金管理系统 -->
            <div class="system-component">
                <div class="component-header">
                    <h3>资金管理系统</h3>
                    <span class="component-status status-{{ 'active' if report.money_manager.status else 'inactive' }}">
                        {{ '运行中' if report.money_manager.status else '已停止' }}
                    </span>
                </div>
                <div class="component-details">
                    <div class="component-metrics">
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.money_manager.risk_per_trade * 100) }}%</div>
                            <div class="metric-label">单笔风险</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.money_manager.position_size) }}</div>
                            <div class="metric-label">持仓规模</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.money_manager.max_drawdown * 100) }}%</div>
                            <div class="metric-label">最大回撤</div>
                        </div>
                    </div>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>参数名称</th>
                                <th>当前值</th>
                                <th>默认值</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param in report.money_manager.parameters %}
                            <tr>
                                <td>{{ param.name }}</td>
                                <td>{{ param.current_value }}</td>
                                <td>{{ param.default_value }}</td>
                                <td>{{ param.description }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 止损系统 -->
            <div class="system-component">
                <div class="component-header">
                    <h3>止损系统</h3>
                    <span class="component-status status-{{ 'active' if report.stop_loss.status else 'inactive' }}">
                        {{ '运行中' if report.stop_loss.status else '已停止' }}
                    </span>
                </div>
                <div class="component-details">
                    <div class="component-metrics">
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.stop_loss.avg_stop_loss * 100) }}%</div>
                            <div class="metric-label">平均止损</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ report.stop_loss.total_stops }}</div>
                            <div class="metric-label">总止损数</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.stop_loss.stop_accuracy * 100) }}%</div>
                            <div class="metric-label">止损准确率</div>
                        </div>
                    </div>
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>参数名称</th>
                                <th>当前值</th>
                                <th>默认值</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param in report.stop_loss.parameters %}
                            <tr>
                                <td>{{ param.name }}</td>
                                <td>{{ param.current_value }}</td>
                                <td>{{ param.default_value }}</td>
                                <td>{{ param.description }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 交易绩效分析 -->
        <div class="report-section">
            <h2 class="section-title">2. 交易绩效分析</h2>
            <div class="performance-metrics">
                <div class="metric-item">
                    <div class="metric-value">{{ "%.2f"|format(report.performance.total_return * 100) }}%</div>
                    <div class="metric-label">总收益率</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.2f"|format(report.performance.sharpe_ratio) }}</div>
                    <div class="metric-label">夏普比率</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.2f"|format(report.performance.max_drawdown * 100) }}%</div>
                    <div class="metric-label">最大回撤</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.2f"|format(report.performance.win_rate * 100) }}%</div>
                    <div class="metric-label">胜率</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.2f"|format(report.performance.profit_factor) }}</div>
                    <div class="metric-label">盈亏比</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ report.performance.total_trades }}</div>
                    <div class="metric-label">总交易数</div>
                </div>
            </div>
            <div class="strategy-chart">
                {{ charts.equity_curve|safe }}
            </div>
            <div class="trade-list">
                <h4>最近交易记录</h4>
                {% for trade in report.recent_trades %}
                <div class="trade-item">
                    <div class="row">
                        <div class="col-md-2">
                            <strong>{{ trade.code }}</strong>
                        </div>
                        <div class="col-md-2">
                            {{ trade.type }}
                        </div>
                        <div class="col-md-2">
                            {{ trade.entry_time }}
                        </div>
                        <div class="col-md-2">
                            {{ trade.exit_time }}
                        </div>
                        <div class="col-md-2">
                            {{ "%.2f"|format(trade.quantity) }}
                        </div>
                        <div class="col-md-2">
                            <span class="trade-profit {{ 'profit-positive' if trade.profit > 0 else 'profit-negative' }}">
                                {{ "%.2f"|format(trade.profit) }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- 风险分析部分 -->
        <div class="report-section">
            <h2 class="section-title">3. 风险分析</h2>
            <div class="row">
                <div class="col-md-6">
                    <h4>市场风险</h4>
                    <div class="component-metrics">
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.risk_metrics.beta) }}</div>
                            <div class="metric-label">Beta</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.risk_metrics.alpha * 100) }}%</div>
                            <div class="metric-label">Alpha</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.risk_metrics.volatility * 100) }}%</div>
                            <div class="metric-label">波动率</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h4>组合风险</h4>
                    <div class="component-metrics">
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.risk_metrics.var * 100) }}%</div>
                            <div class="metric-label">VaR</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.risk_metrics.es * 100) }}%</div>
                            <div class="metric-label">ES</div>
                        </div>
                        <div class="component-metric">
                            <div class="metric-value">{{ "%.2f"|format(report.risk_metrics.correlation) }}</div>
                            <div class="metric-label">相关性</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="strategy-chart">
                {{ charts.risk_metrics|safe }}
            </div>
        </div>

        <!-- 系统优化建议 -->
        <div class="report-section">
            <h2 class="section-title">4. 系统优化建议</h2>
            {% for suggestion in report.optimization_suggestions %}
            <div class="recommendation-item priority-{{ suggestion.priority|lower }}">
                <h4>{{ suggestion.component }} - {{ suggestion.type }}</h4>
                <p>{{ suggestion.content }}</p>
                <div class="component-metrics">
                    <div class="component-metric">
                        <div class="metric-value">{{ "%.2f"|format(suggestion.expected_improvement * 100) }}%</div>
                        <div class="metric-label">预期提升</div>
                    </div>
                    <div class="component-metric">
                        <div class="metric-value">{{ suggestion.implementation_difficulty }}</div>
                        <div class="metric-label">实现难度</div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 