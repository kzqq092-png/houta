# é‡æ„åè°ƒç”¨é“¾åˆ†æä¸éªŒè¯æŠ¥å‘Š

## ğŸ“‹ **åˆ†ææ¦‚è¿°**

æœ¬æŠ¥å‘Šè¯¦ç»†åˆ†æmain.pyé‡æ„æ–¹æ¡ˆä¸­çš„è°ƒç”¨é“¾å˜åŒ–ï¼Œç¡®ä¿ä»£ç è¿ç§»åæ‰€æœ‰åŠŸèƒ½è°ƒç”¨å…³ç³»ä¿æŒæ­£ç¡®ï¼Œä¸ä¼šå‡ºç°è°ƒç”¨ä¸­æ–­æˆ–å¾ªç¯ä¾èµ–é—®é¢˜ã€‚

---

## ğŸ” **åŸæœ‰è°ƒç”¨é“¾åˆ†æ**

### **å½“å‰main.pyä¸­çš„å…³é”®è°ƒç”¨é“¾**

#### **1. è‚¡ç¥¨é€‰æ‹©è°ƒç”¨é“¾** (æ ¸å¿ƒä¸šåŠ¡æµç¨‹)
```
å½“å‰è°ƒç”¨é“¾:
ç”¨æˆ·ç‚¹å‡»è‚¡ç¥¨ â†’ QListWidget.itemClicked 
â†’ TradingGUI.on_stock_selected() 
â†’ TradingGUI.data_manager.get_k_data()
â†’ TradingGUI.update_chart() 
â†’ ChartWidget.update_chart()
â†’ TradingGUI.broadcast_kdata_to_tabs()
â†’ AnalysisTab.set_kdata()
â†’ TradingWidget.set_stock()

ä¾èµ–å…³ç³»:
â”œâ”€â”€ TradingGUIç›´æ¥è°ƒç”¨data_manager
â”œâ”€â”€ TradingGUIç›´æ¥è°ƒç”¨ChartWidget
â”œâ”€â”€ TradingGUIç›´æ¥è°ƒç”¨å„ä¸ªåˆ†ææ ‡ç­¾
â””â”€â”€ æ‰€æœ‰ç»„ä»¶éƒ½ä¾èµ–TradingGUIå®ä¾‹
```

#### **2. åˆ†ææ‰§è¡Œè°ƒç”¨é“¾** (åˆ†æä¸šåŠ¡æµç¨‹)
```
å½“å‰è°ƒç”¨é“¾:
ç”¨æˆ·ç‚¹å‡»åˆ†æ â†’ QPushButton.clicked
â†’ TradingGUI.analyze()
â†’ TradingGUI.get_kdata()
â†’ TradingGUI._execute_analysis()
â†’ QThreadPool.start()
â†’ TradingGUI.analysis_completedä¿¡å·
â†’ TradingGUI.handle_analysis_complete()
â†’ æ›´æ–°UIæ˜¾ç¤ºç»“æœ

ä¾èµ–å…³ç³»:
â”œâ”€â”€ TradingGUIç®¡ç†çº¿ç¨‹æ± 
â”œâ”€â”€ TradingGUIå¤„ç†åˆ†æé€»è¾‘
â”œâ”€â”€ TradingGUIæ›´æ–°UIçŠ¶æ€
â””â”€â”€ åˆ†æç»“æœç›´æ¥æ›´æ–°åˆ°TradingGUIçš„UIç»„ä»¶
```

#### **3. ä¸»é¢˜åˆ‡æ¢è°ƒç”¨é“¾** (UIä¸»é¢˜ç®¡ç†)
```
å½“å‰è°ƒç”¨é“¾:
ç”¨æˆ·é€‰æ‹©ä¸»é¢˜ â†’ QComboBox.currentTextChanged
â†’ TradingGUI.on_theme_changed()
â†’ ThemeManager.set_theme()
â†’ TradingGUI.theme_changedä¿¡å·
â†’ TradingGUI.apply_theme()
â†’ éå†æ‰€æœ‰å­ç»„ä»¶åº”ç”¨ä¸»é¢˜

ä¾èµ–å…³ç³»:
â”œâ”€â”€ TradingGUIç›´æ¥ç®¡ç†ä¸»é¢˜åˆ‡æ¢
â”œâ”€â”€ TradingGUIéå†æ‰€æœ‰å­ç»„ä»¶
â”œâ”€â”€ æ‰€æœ‰UIç»„ä»¶éƒ½é€šè¿‡TradingGUIè·å–ä¸»é¢˜
â””â”€â”€ ä¸»é¢˜çŠ¶æ€ä¿å­˜åœ¨TradingGUIä¸­
```

---

## ğŸ”„ **é‡æ„åè°ƒç”¨é“¾è®¾è®¡**

### **æ–°æ¶æ„çš„è°ƒç”¨é“¾**

#### **1. è‚¡ç¥¨é€‰æ‹©è°ƒç”¨é“¾** (é‡æ„å)
```
é‡æ„åè°ƒç”¨é“¾:
ç”¨æˆ·ç‚¹å‡»è‚¡ç¥¨ â†’ QListWidget.itemClicked
â†’ LeftPanel.on_stock_selected()
â†’ EventBus.publish(StockSelectedEvent)
â†’ StockService.handle_stock_selected() [è®¢é˜…è€…]
â†’ StockService.select_stock()
â†’ DataService.get_k_data()
â†’ EventBus.publish(StockDataUpdatedEvent)
â†’ ChartService.handle_data_updated() [è®¢é˜…è€…]
â†’ ChartService.update_chart()
â†’ ChartWidget.update_chart()
â†’ AnalysisService.handle_data_updated() [è®¢é˜…è€…]
â†’ AnalysisService.broadcast_to_tabs()
â†’ AnalysisTab.set_kdata()

æ–°çš„ä¾èµ–å…³ç³»:
â”œâ”€â”€ LeftPanel â†’ EventBus (å‘å¸ƒäº‹ä»¶)
â”œâ”€â”€ StockService â†’ EventBus (è®¢é˜…/å‘å¸ƒ)
â”œâ”€â”€ ChartService â†’ EventBus (è®¢é˜…)
â”œâ”€â”€ AnalysisService â†’ EventBus (è®¢é˜…)
â””â”€â”€ ç»„ä»¶é—´é€šè¿‡EventBusè§£è€¦
```

#### **2. åˆ†ææ‰§è¡Œè°ƒç”¨é“¾** (é‡æ„å)
```
é‡æ„åè°ƒç”¨é“¾:
ç”¨æˆ·ç‚¹å‡»åˆ†æ â†’ QPushButton.clicked
â†’ RightPanel.on_analyze_clicked()
â†’ EventBus.publish(AnalysisRequestEvent)
â†’ AnalysisService.handle_analysis_request() [è®¢é˜…è€…]
â†’ AnalysisService.run_analysis()
â†’ QThreadPool.start() [é€šè¿‡ServiceContainerè·å–]
â†’ AnalysisService.analysis_completed()
â†’ EventBus.publish(AnalysisCompletedEvent)
â†’ RightPanel.handle_analysis_completed() [è®¢é˜…è€…]
â†’ RightPanel.update_analysis_display()

æ–°çš„ä¾èµ–å…³ç³»:
â”œâ”€â”€ RightPanel â†’ EventBus (å‘å¸ƒäº‹ä»¶)
â”œâ”€â”€ AnalysisService â†’ EventBus (è®¢é˜…/å‘å¸ƒ)
â”œâ”€â”€ AnalysisService â†’ ServiceContainer (è·å–çº¿ç¨‹æ± )
â”œâ”€â”€ RightPanel â†’ EventBus (è®¢é˜…ç»“æœ)
â””â”€â”€ UIæ›´æ–°é€šè¿‡äº‹ä»¶æœºåˆ¶è§£è€¦
```

#### **3. ä¸»é¢˜åˆ‡æ¢è°ƒç”¨é“¾** (é‡æ„å)
```
é‡æ„åè°ƒç”¨é“¾:
ç”¨æˆ·é€‰æ‹©ä¸»é¢˜ â†’ QComboBox.currentTextChanged
â†’ MainWindowCoordinator.on_theme_changed()
â†’ ThemeManager.set_theme() [é€šè¿‡ServiceContainerè·å–]
â†’ EventBus.publish(ThemeChangedEvent)
â†’ LeftPanel.handle_theme_changed() [è®¢é˜…è€…]
â†’ MiddlePanel.handle_theme_changed() [è®¢é˜…è€…]  
â†’ RightPanel.handle_theme_changed() [è®¢é˜…è€…]
â†’ ChartService.handle_theme_changed() [è®¢é˜…è€…]
â†’ å„ç»„ä»¶æ›´æ–°è‡ªå·±çš„ä¸»é¢˜

æ–°çš„ä¾èµ–å…³ç³»:
â”œâ”€â”€ MainWindowCoordinator â†’ ServiceContainer (è·å–ThemeManager)
â”œâ”€â”€ MainWindowCoordinator â†’ EventBus (å‘å¸ƒäº‹ä»¶)
â”œâ”€â”€ å„Panel â†’ EventBus (è®¢é˜…ä¸»é¢˜äº‹ä»¶)
â”œâ”€â”€ ChartService â†’ EventBus (è®¢é˜…ä¸»é¢˜äº‹ä»¶)
â””â”€â”€ ä¸»é¢˜åº”ç”¨åˆ†æ•£åˆ°å„ä¸ªç»„ä»¶è‡ªå·±å¤„ç†
```

---

## âš ï¸ **è°ƒç”¨é“¾é£é™©ç‚¹åˆ†æ**

### **1. æ½œåœ¨çš„è°ƒç”¨é“¾é—®é¢˜** ğŸ”´

#### **é—®é¢˜1: äº‹ä»¶å¾ªç¯é£é™©**
```
é£é™©åœºæ™¯:
StockService.select_stock() 
â†’ EventBus.publish(StockDataUpdatedEvent)
â†’ ChartService.handle_data_updated()
â†’ ChartService.update_chart()
â†’ å¦‚æœChartServiceå†æ¬¡å‘å¸ƒStockSelectedEvent
â†’ å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯

è§£å†³æ–¹æ¡ˆ:
â”œâ”€â”€ äº‹ä»¶ç±»å‹æ˜ç¡®åŒºåˆ† (StockSelectedEvent vs StockDataUpdatedEvent)
â”œâ”€â”€ äº‹ä»¶å¤„ç†ä¸­æ·»åŠ çŠ¶æ€æ£€æŸ¥
â”œâ”€â”€ EventBusæ·»åŠ å¾ªç¯æ£€æµ‹æœºåˆ¶
â””â”€â”€ ä¸¥æ ¼å®šä¹‰äº‹ä»¶å‘å¸ƒè§„åˆ™
```

#### **é—®é¢˜2: æœåŠ¡ä¾èµ–é¡ºåº**
```
é£é™©åœºæ™¯:
ServiceContaineråˆå§‹åŒ–æ—¶:
â”œâ”€â”€ StockServiceä¾èµ–DataManager
â”œâ”€â”€ AnalysisServiceä¾èµ–StockService
â”œâ”€â”€ ChartServiceä¾èµ–AnalysisService
â””â”€â”€ å¦‚æœåˆå§‹åŒ–é¡ºåºé”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ä¾èµ–æ³¨å…¥å¤±è´¥

è§£å†³æ–¹æ¡ˆ:
â”œâ”€â”€ æ˜ç¡®å®šä¹‰æœåŠ¡åˆå§‹åŒ–é¡ºåº
â”œâ”€â”€ ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ– (Lazy Initialization)
â”œâ”€â”€ æ·»åŠ ä¾èµ–æ£€æŸ¥å’Œé”™è¯¯å¤„ç†
â””â”€â”€ æä¾›æœåŠ¡å¯ç”¨æ€§éªŒè¯æœºåˆ¶
```

#### **é—®é¢˜3: å¼‚æ­¥è°ƒç”¨åŒæ­¥é—®é¢˜**
```
é£é™©åœºæ™¯:
AnalysisService.run_analysis() [å¼‚æ­¥]
â†’ QThreadPool.start()
â†’ EventBus.publish(AnalysisCompletedEvent) [å¼‚æ­¥å‘å¸ƒ]
â†’ RightPanel.handle_analysis_completed() [å¯èƒ½åœ¨UIçº¿ç¨‹å¤–]
â†’ å¯èƒ½å¯¼è‡´UIæ›´æ–°çº¿ç¨‹å®‰å…¨é—®é¢˜

è§£å†³æ–¹æ¡ˆ:
â”œâ”€â”€ EventBusç¡®ä¿UIç›¸å…³äº‹ä»¶åœ¨ä¸»çº¿ç¨‹å¤„ç†
â”œâ”€â”€ ä½¿ç”¨QTimer.singleShotç¡®ä¿çº¿ç¨‹å®‰å…¨
â”œâ”€â”€ å¼‚æ­¥ç»“æœé€šè¿‡Qtä¿¡å·æœºåˆ¶ä¼ é€’
â””â”€â”€ æ·»åŠ çº¿ç¨‹å®‰å…¨æ£€æŸ¥
```

### **2. æ•°æ®æµä¸€è‡´æ€§é£é™©** ğŸŸ¡

#### **é—®é¢˜4: æ•°æ®çŠ¶æ€åŒæ­¥**
```
é£é™©åœºæ™¯:
å¤šä¸ªæœåŠ¡åŒæ—¶å¤„ç†åŒä¸€è‚¡ç¥¨æ•°æ®:
â”œâ”€â”€ StockService.current_stock
â”œâ”€â”€ AnalysisService.current_analysis_data  
â”œâ”€â”€ ChartService.current_chart_data
â””â”€â”€ å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´

è§£å†³æ–¹æ¡ˆ:
â”œâ”€â”€ å»ºç«‹ç»Ÿä¸€çš„æ•°æ®çŠ¶æ€ç®¡ç†
â”œâ”€â”€ é€šè¿‡äº‹ä»¶ç¡®ä¿çŠ¶æ€åŒæ­¥
â”œâ”€â”€ æ·»åŠ æ•°æ®ç‰ˆæœ¬æ§åˆ¶
â””â”€â”€ å®ç°æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
```

#### **é—®é¢˜5: é…ç½®ä¼ é€’é“¾**
```
é£é™©åœºæ™¯:
é…ç½®æ›´æ–°æ—¶:
ConfigManager.set() 
â†’ éœ€è¦é€šçŸ¥æ‰€æœ‰ç›¸å…³æœåŠ¡
â†’ ä½†æœåŠ¡ä¹‹é—´æ²¡æœ‰ç›´æ¥ä¾èµ–å…³ç³»
â†’ å¯èƒ½å¯¼è‡´é…ç½®æ›´æ–°ä¸¢å¤±

è§£å†³æ–¹æ¡ˆ:
â”œâ”€â”€ é…ç½®æ›´æ–°é€šè¿‡EventBuså¹¿æ’­
â”œâ”€â”€ æœåŠ¡ä¸»åŠ¨è®¢é˜…é…ç½®å˜æ›´äº‹ä»¶
â”œâ”€â”€ æ·»åŠ é…ç½®åŒæ­¥éªŒè¯æœºåˆ¶
â””â”€â”€ å®ç°é…ç½®çƒ­æ›´æ–°æ”¯æŒ
```

---

## âœ… **è°ƒç”¨é“¾ä¿®æ­£æ–¹æ¡ˆ**

### **1. äº‹ä»¶ç³»ç»Ÿä¼˜åŒ–**

#### **äº‹ä»¶å¾ªç¯é˜²æŠ¤**
```python
# core/events/event_bus.py
class EventBus:
    def __init__(self):
        self.processing_events = set()  # æ­£åœ¨å¤„ç†çš„äº‹ä»¶
        self.event_depth = 0            # äº‹ä»¶å¤„ç†æ·±åº¦
        self.max_depth = 10             # æœ€å¤§å¤„ç†æ·±åº¦
    
    def publish(self, event: Event):
        # å¾ªç¯æ£€æµ‹
        event_id = f"{type(event).__name__}_{event.timestamp}"
        if event_id in self.processing_events:
            self.log_manager.warning(f"æ£€æµ‹åˆ°äº‹ä»¶å¾ªç¯: {event_id}")
            return
            
        if self.event_depth > self.max_depth:
            self.log_manager.error(f"äº‹ä»¶å¤„ç†æ·±åº¦è¶…é™: {self.event_depth}")
            return
            
        self.processing_events.add(event_id)
        self.event_depth += 1
        
        try:
            self._do_publish(event)
        finally:
            self.processing_events.remove(event_id)
            self.event_depth -= 1
```

#### **çº¿ç¨‹å®‰å…¨äº‹ä»¶å¤„ç†**
```python
# core/events/event_bus.py
def publish(self, event: Event):
    if self._is_ui_event(event) and not self._is_main_thread():
        # UIç›¸å…³äº‹ä»¶å¿…é¡»åœ¨ä¸»çº¿ç¨‹å¤„ç†
        QTimer.singleShot(0, lambda: self._publish_in_main_thread(event))
    else:
        self._do_publish(event)

def _is_ui_event(self, event: Event) -> bool:
    ui_events = [ThemeChangedEvent, UIUpdateEvent, ChartUpdateEvent]
    return any(isinstance(event, event_type) for event_type in ui_events)
```

### **2. æœåŠ¡ä¾èµ–ç®¡ç†ä¼˜åŒ–**

#### **ä¾èµ–æ³¨å…¥é¡ºåºæ§åˆ¶**
```python
# core/containers/service_container.py
class ServiceContainer:
    def __init__(self):
        self.services = {}
        self.initialization_order = [
            'ConfigManager',
            'LogManager', 
            'DataManager',
            'EventBus',
            'StockService',
            'AnalysisService',
            'ChartService'
        ]
    
    def initialize_all_services(self):
        for service_name in self.initialization_order:
            if service_name not in self.services:
                self._initialize_service(service_name)
```

#### **å»¶è¿Ÿä¾èµ–æ³¨å…¥**
```python
# core/services/stock_service.py
class StockService:
    def __init__(self, container: ServiceContainer):
        self.container = container
        self._data_manager = None
        self._event_bus = None
    
    @property
    def data_manager(self):
        if self._data_manager is None:
            self._data_manager = self.container.get(DataManager)
        return self._data_manager
    
    @property  
    def event_bus(self):
        if self._event_bus is None:
            self._event_bus = self.container.get(EventBus)
        return self._event_bus
```

### **3. æ•°æ®çŠ¶æ€åŒæ­¥æœºåˆ¶**

#### **ç»Ÿä¸€çŠ¶æ€ç®¡ç†**
```python
# core/services/state_service.py
class StateService:
    def __init__(self, event_bus: EventBus):
        self.event_bus = event_bus
        self.current_state = {
            'selected_stock': None,
            'analysis_results': {},
            'chart_data': {},
            'ui_theme': 'default'
        }
        
    def update_state(self, key: str, value: Any):
        old_value = self.current_state.get(key)
        self.current_state[key] = value
        
        # å‘å¸ƒçŠ¶æ€å˜æ›´äº‹ä»¶
        event = StateChangedEvent(key, old_value, value)
        self.event_bus.publish(event)
```

---

## ğŸ“Š **è°ƒç”¨é“¾éªŒè¯æµ‹è¯•**

### **1. å…³é”®è·¯å¾„æµ‹è¯•**

#### **è‚¡ç¥¨é€‰æ‹©è·¯å¾„æµ‹è¯•**
```python
def test_stock_selection_chain():
    """æµ‹è¯•è‚¡ç¥¨é€‰æ‹©è°ƒç”¨é“¾"""
    # 1. æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»
    left_panel.stock_list.setCurrentRow(0)
    
    # 2. éªŒè¯äº‹ä»¶å‘å¸ƒ
    assert event_bus.last_published_event.type == 'StockSelectedEvent'
    
    # 3. éªŒè¯æœåŠ¡å“åº”
    assert stock_service.current_stock == 'sh000001'
    
    # 4. éªŒè¯æ•°æ®æ›´æ–°
    assert chart_service.current_chart_data is not None
    
    # 5. éªŒè¯UIæ›´æ–°
    assert chart_widget.has_data()
```

#### **åˆ†ææ‰§è¡Œè·¯å¾„æµ‹è¯•**
```python
def test_analysis_execution_chain():
    """æµ‹è¯•åˆ†ææ‰§è¡Œè°ƒç”¨é“¾"""
    # 1. è®¾ç½®å‰ç½®æ¡ä»¶
    stock_service.select_stock('sh000001')
    
    # 2. æ¨¡æ‹Ÿåˆ†æè¯·æ±‚
    right_panel.analyze_button.click()
    
    # 3. éªŒè¯å¼‚æ­¥æ‰§è¡Œ
    assert analysis_service.is_running()
    
    # 4. ç­‰å¾…å®Œæˆå¹¶éªŒè¯ç»“æœ
    wait_for_analysis_completion()
    assert analysis_service.has_results()
    
    # 5. éªŒè¯UIæ›´æ–°
    assert right_panel.analysis_widget.has_results()
```

### **2. è¾¹ç•Œæ¡ä»¶æµ‹è¯•**

#### **äº‹ä»¶å¾ªç¯æµ‹è¯•**
```python
def test_event_loop_detection():
    """æµ‹è¯•äº‹ä»¶å¾ªç¯æ£€æµ‹"""
    # åˆ›å»ºå¯èƒ½å¯¼è‡´å¾ªç¯çš„äº‹ä»¶åºåˆ—
    event1 = StockSelectedEvent('sh000001')
    event2 = StockDataUpdatedEvent('sh000001', data)
    
    # æ¨¡æ‹Ÿå¾ªç¯å‘å¸ƒ
    event_bus.publish(event1)
    # åœ¨å¤„ç†è¿‡ç¨‹ä¸­å†æ¬¡å‘å¸ƒç›¸åŒäº‹ä»¶
    event_bus.publish(event1)  # åº”è¯¥è¢«æ£€æµ‹å¹¶é˜»æ­¢
    
    assert event_bus.loop_detected == True
```

#### **æœåŠ¡ä¾èµ–æµ‹è¯•**
```python
def test_service_dependency_resolution():
    """æµ‹è¯•æœåŠ¡ä¾èµ–è§£æ"""
    container = ServiceContainer()
    
    # éªŒè¯ä¾èµ–é¡ºåº
    stock_service = container.get(StockService)
    assert stock_service.data_manager is not None
    assert stock_service.event_bus is not None
    
    # éªŒè¯å¾ªç¯ä¾èµ–æ£€æµ‹
    with pytest.raises(CircularDependencyError):
        container.register_dependency(ServiceA, ServiceB)
        container.register_dependency(ServiceB, ServiceA)
```

---

## ğŸ“‹ **è°ƒç”¨é“¾å…¼å®¹æ€§ä¿éšœ**

### **1. å‘åå…¼å®¹æ¥å£**

#### **ä¿æŒåŸæœ‰æ–¹æ³•ç­¾å**
```python
# core/coordinators/main_window_coordinator.py
class MainWindowCoordinator(QMainWindow):
    """ä¿æŒä¸åŸTradingGUIç›¸åŒçš„å…¬å…±æ¥å£"""
    
    def on_stock_selected(self):
        """ä¿æŒåŸæœ‰æ–¹æ³•åï¼Œå†…éƒ¨å§”æ‰˜ç»™æ–°çš„äº‹ä»¶ç³»ç»Ÿ"""
        # å§”æ‰˜ç»™äº‹ä»¶ç³»ç»Ÿå¤„ç†
        event = StockSelectedEvent(self.get_selected_stock())
        self.event_bus.publish(event)
    
    def analyze(self):
        """ä¿æŒåŸæœ‰æ–¹æ³•åï¼Œå†…éƒ¨å§”æ‰˜ç»™åˆ†ææœåŠ¡"""
        # å§”æ‰˜ç»™åˆ†ææœåŠ¡å¤„ç†
        event = AnalysisRequestEvent(self.get_current_strategy())
        self.event_bus.publish(event)
    
    def update_chart(self, data=None):
        """ä¿æŒåŸæœ‰æ–¹æ³•åï¼Œå†…éƒ¨å§”æ‰˜ç»™å›¾è¡¨æœåŠ¡"""
        # å§”æ‰˜ç»™å›¾è¡¨æœåŠ¡å¤„ç†
        event = ChartUpdateRequestEvent(data)
        self.event_bus.publish(event)
```

#### **é…ç½®å…¼å®¹æ€§ä¿éšœ**
```python
# ç¡®ä¿é…ç½®é”®åä¸å˜
COMPATIBLE_CONFIG_KEYS = {
    'theme.theme_name': 'theme.theme_name',
    'data.source': 'data.source', 
    'analysis.default_strategy': 'analysis.default_strategy'
}

def get_config_with_compatibility(key: str):
    """æä¾›é…ç½®å‘åå…¼å®¹æ€§"""
    if key in COMPATIBLE_CONFIG_KEYS:
        return config_manager.get(COMPATIBLE_CONFIG_KEYS[key])
    return config_manager.get(key)
```

### **2. æ¸è¿›å¼è¿ç§»ç­–ç•¥**

#### **åŒæ¨¡å¼è¿è¡Œ**
```python
# æ”¯æŒæ–°æ—§æ¨¡å¼å¹¶å­˜
class HybridCoordinator(MainWindowCoordinator):
    def __init__(self):
        self.use_new_event_system = True  # å¯é…ç½®å¼€å…³
        
    def on_stock_selected(self):
        if self.use_new_event_system:
            # ä½¿ç”¨æ–°çš„äº‹ä»¶ç³»ç»Ÿ
            super().on_stock_selected()
        else:
            # ä½¿ç”¨åŸæœ‰çš„ç›´æ¥è°ƒç”¨
            self._legacy_on_stock_selected()
```

---

## ğŸ¯ **æœ€ç»ˆè°ƒç”¨é“¾éªŒè¯ç»“è®º**

### **è°ƒç”¨é“¾æ­£ç¡®æ€§è¯„ä¼°** âœ…

| è°ƒç”¨é“¾ç±»å‹ | åŸæœ‰å¤æ‚åº¦ | é‡æ„åå¤æ‚åº¦ | æ­£ç¡®æ€§ | é£é™©ç­‰çº§ |
|-----------|-----------|-------------|--------|----------|
| è‚¡ç¥¨é€‰æ‹© | ç›´æ¥è°ƒç”¨(ç®€å•) | äº‹ä»¶é©±åŠ¨(ä¸­ç­‰) | âœ… æ­£ç¡® | ğŸŸ¡ ä¸­ç­‰ |
| åˆ†ææ‰§è¡Œ | ç›´æ¥è°ƒç”¨(ç®€å•) | äº‹ä»¶é©±åŠ¨(ä¸­ç­‰) | âœ… æ­£ç¡® | ğŸŸ¡ ä¸­ç­‰ |
| ä¸»é¢˜åˆ‡æ¢ | éå†è°ƒç”¨(å¤æ‚) | äº‹ä»¶å¹¿æ’­(ç®€å•) | âœ… æ­£ç¡® | ğŸŸ¢ ä½ |
| æ•°æ®åŒæ­¥ | æ‰‹åŠ¨åŒæ­¥(å¤æ‚) | äº‹ä»¶åŒæ­¥(ç®€å•) | âœ… æ­£ç¡® | ğŸŸ¢ ä½ |
| é”™è¯¯å¤„ç† | é›†ä¸­å¤„ç†(ç®€å•) | åˆ†å¸ƒå¤„ç†(å¤æ‚) | âš ï¸ éœ€æ³¨æ„ | ğŸŸ¡ ä¸­ç­‰ |

### **å…³é”®é£é™©å’Œç¼“è§£æªæ–½** ğŸ›¡ï¸

| é£é™©ç±»å‹ | é£é™©æè¿° | ç¼“è§£æªæ–½ | éªŒè¯æ–¹æ³• |
|---------|---------|---------|---------|
| äº‹ä»¶å¾ªç¯ | å¯èƒ½å¯¼è‡´æ— é™é€’å½’ | å¾ªç¯æ£€æµ‹æœºåˆ¶ | å•å…ƒæµ‹è¯• |
| çº¿ç¨‹å®‰å…¨ | UIæ›´æ–°çº¿ç¨‹é—®é¢˜ | ä¸»çº¿ç¨‹äº‹ä»¶å¤„ç† | å¹¶å‘æµ‹è¯• |
| ä¾èµ–é¡ºåº | æœåŠ¡åˆå§‹åŒ–é¡ºåº | å»¶è¿Ÿåˆå§‹åŒ– | é›†æˆæµ‹è¯• |
| çŠ¶æ€åŒæ­¥ | æ•°æ®ä¸ä¸€è‡´ | ç»Ÿä¸€çŠ¶æ€ç®¡ç† | çŠ¶æ€æµ‹è¯• |
| æ€§èƒ½å½±å“ | äº‹ä»¶å¼€é”€ | äº‹ä»¶ä¼˜åŒ– | æ€§èƒ½æµ‹è¯• |

### **æœ€ç»ˆå»ºè®®** ğŸ’¡

**è°ƒç”¨é“¾è¿ç§»å¯è¡Œæ€§**: âœ… **é«˜åº¦å¯è¡Œ**

1. **æŠ€æœ¯å¯è¡Œæ€§**: äº‹ä»¶é©±åŠ¨æ¶æ„æˆç†Ÿï¼Œé£é™©å¯æ§
2. **å…¼å®¹æ€§ä¿éšœ**: ä¿æŒåŸæœ‰æ¥å£ï¼Œæ¸è¿›å¼è¿ç§»
3. **æµ‹è¯•è¦†ç›–**: å®Œæ•´çš„æµ‹è¯•ç­–ç•¥ç¡®ä¿æ­£ç¡®æ€§
4. **å›æ»šæœºåˆ¶**: åŒæ¨¡å¼è¿è¡Œæ”¯æŒå¿«é€Ÿå›æ»š

**å…³é”®æˆåŠŸå› ç´ **:
- ä¸¥æ ¼çš„äº‹ä»¶ç±»å‹å®šä¹‰å’Œæ–‡æ¡£
- å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- æ¸è¿›å¼è¿ç§»å’Œå……åˆ†éªŒè¯
- å›¢é˜Ÿå¯¹æ–°æ¶æ„çš„å……åˆ†ç†è§£

**ç»“è®º**: é‡æ„æ–¹æ¡ˆä¸­çš„è°ƒç”¨é“¾è®¾è®¡åˆç†ï¼Œé€šè¿‡é€‚å½“çš„é£é™©ç¼“è§£æªæ–½ï¼Œå¯ä»¥ç¡®ä¿è¿ç§»åçš„è°ƒç”¨é“¾æ­£ç¡®æ€§å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚å»ºè®®æŒ‰è®¡åˆ’å®æ–½ï¼Œä½†éœ€è¦ç‰¹åˆ«å…³æ³¨äº‹ä»¶å¾ªç¯æ£€æµ‹å’Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ 