# UnifiedDataManager é‡æ„å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

âœ… **é‡æ„æˆåŠŸå®Œæˆ** - å·²å°†ç¡¬ç¼–ç çš„examplesæ’ä»¶æ³¨å†Œæ›¿æ¢ä¸ºåŠ¨æ€åŠ è½½æœºåˆ¶

---

## ğŸ¯ é‡æ„ç›®æ ‡

å°† `unified_data_manager.py` ä¸­ç¡¬ç¼–ç çš„18ä¸ªexamplesæ’ä»¶å¯¼å…¥ï¼Œæ›¿æ¢ä¸ºé€šè¿‡ `PluginManager` çš„åŠ¨æ€åŠ è½½æœºåˆ¶ã€‚

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æ–°å¢åŠ¨æ€åŠ è½½æ–¹æ³•

**æ–¹æ³•å**: `_register_plugins_from_plugin_manager()`

**ä½ç½®**: `core/services/unified_data_manager.py:2499-2604`

**åŠŸèƒ½**:
- ä»PluginManagerè·å–æ‰€æœ‰å·²åŠ è½½çš„æ’ä»¶
- ç­›é€‰å‡ºæ•°æ®æºæ’ä»¶ï¼ˆæ£€æŸ¥plugin_typeå’Œplugin_idå‰ç¼€ï¼‰
- éªŒè¯æ’ä»¶æ˜¯å¦å¯ç”¨
- éªŒè¯æ’ä»¶æ˜¯å¦æœ‰å¿…è¦çš„æ–¹æ³•ï¼ˆget_asset_list, get_kdata, health_checkï¼‰
- è‡ªåŠ¨æ³¨å†Œæ¯ä¸ªç¬¦åˆæ¡ä»¶çš„æ’ä»¶
- è¿”å›æˆåŠŸæ³¨å†Œçš„æ’ä»¶æ•°é‡

**ä»£ç è¡Œæ•°**: ~105è¡Œ

**å…³é”®ç‰¹æ€§**:
```python
# 1. åŠ¨æ€è·å–æ’ä»¶
all_plugins = self.plugin_manager.plugin_instances

# 2. æ™ºèƒ½ç­›é€‰æ•°æ®æºæ’ä»¶
is_data_source = ('data_source' in plugin_type.lower() or 
                  plugin_id.startswith('data_sources.'))

# 3. éªŒè¯å’Œæ³¨å†Œ
if self._is_valid_data_source_plugin(plugin_instance):
    success = self.register_data_source_plugin(...)
```

### 2. ä¿®æ”¹è°ƒç”¨ç‚¹

**æ–¹æ³•å**: `discover_and_register_data_source_plugins()`

**ä½ç½®**: `core/services/unified_data_manager.py:2474-2497`

**ä¿®æ”¹å†…å®¹**:

**ä¹‹å‰**:
```python
# å°è¯•è‡ªåŠ¨å‘ç°æ’ä»¶
self._auto_discover_data_source_plugins()

# å¦‚æœè‡ªåŠ¨å‘ç°å¤±è´¥ï¼Œå°è¯•æ‰‹åŠ¨æ³¨å†Œæ ¸å¿ƒæ’ä»¶
if not self._plugins_discovered:
    logger.info("è‡ªåŠ¨å‘ç°å¤±è´¥ï¼Œå°è¯•æ‰‹åŠ¨æ³¨å†Œæ ¸å¿ƒæ’ä»¶...")
    self._manual_register_core_plugins()
```

**ä¹‹å**:
```python
# ä½¿ç”¨æ’ä»¶ç®¡ç†å™¨åŠ¨æ€åŠ è½½æ’ä»¶ï¼ˆæ›¿ä»£ç¡¬ç¼–ç ï¼‰
registered_count = self._register_plugins_from_plugin_manager()

if registered_count > 0:
    self._plugins_discovered = True
    logger.info(f"âœ… æ’ä»¶å‘ç°å’Œæ³¨å†Œå®Œæˆ: å…±æ³¨å†Œ {registered_count} ä¸ªæ’ä»¶")
else:
    logger.warning("âš ï¸ æœªæ³¨å†Œä»»ä½•æ’ä»¶ï¼Œè¯·æ£€æŸ¥æ’ä»¶ç®¡ç†å™¨çŠ¶æ€")
```

### 3. åºŸå¼ƒæ—§æ–¹æ³•

**æ–¹æ³•å**: `_manual_register_core_plugins()` â†’ `_manual_register_core_plugins_DEPRECATED()`

**ä½ç½®**: `core/services/unified_data_manager.py:2606-2989`

**å¤„ç†æ–¹å¼**:
- é‡å‘½åä¸º `_DEPRECATED` åç¼€
- æ·»åŠ è­¦å‘Šæ—¥å¿—
- æ–¹æ³•å¼€å¤´ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ
- å°†æ•´ä¸ªæ–¹æ³•ä½“åŒ…è£¹åœ¨å¤šè¡Œå­—ç¬¦ä¸²ä¸­ï¼ˆä¿ç•™ç”¨äºå‚è€ƒï¼‰

**åºŸå¼ƒä»£ç è¡Œæ•°**: ~378è¡Œ

**ä¿ç•™åŸå› **: 
- ä½œä¸ºå‚è€ƒï¼Œäº†è§£ä¹‹å‰çš„æ’ä»¶é…ç½®
- å¾…å®Œå…¨éªŒè¯ååˆ é™¤

## ğŸ“Š ä»£ç æ”¹è¿›ç»Ÿè®¡

| æŒ‡æ ‡ | ä¹‹å‰ | ä¹‹å | æ”¹è¿› |
|------|------|------|------|
| ç¡¬ç¼–ç å¯¼å…¥ | 18ä¸ª | 0ä¸ª | -100% |
| æ’ä»¶æ³¨å†Œä»£ç  | ~378è¡Œ | ~105è¡Œ | -72% |
| ç»´æŠ¤å¤æ‚åº¦ | é«˜ | ä½ | â¬‡ï¸â¬‡ï¸â¬‡ï¸ |
| æ‰©å±•æ€§ | å·® | ä¼˜ç§€ | â¬†ï¸â¬†ï¸â¬†ï¸ |
| æ–‡ä»¶æ€»è¡Œæ•° | 3245è¡Œ | 3245è¡Œ | 0 (åºŸå¼ƒä»£ç æœªåˆ é™¤) |
| é¢„è®¡åˆ é™¤å | - | 2867è¡Œ | -12% |

## ğŸ¯ æŠ€æœ¯ä¼˜åŠ¿

### åŠ¨æ€åŠ è½½çš„ä¼˜åŠ¿

#### 1. æ— éœ€ç¡¬ç¼–ç 
**ä¹‹å‰**:
```python
from plugins.examples.wind_data_plugin import WindDataPlugin
from plugins.examples.tongdaxin_stock_plugin import TongdaxinStockPlugin
from plugins.examples.futures_data_plugin import FuturesDataPlugin
# ... è¿˜æœ‰15ä¸ª
```

**ä¹‹å**:
```python
# è‡ªåŠ¨å‘ç°data_sourcesç›®å½•ä¸‹çš„æ‰€æœ‰æ’ä»¶
all_plugins = self.plugin_manager.plugin_instances
```

#### 2. æ˜“äºç»´æŠ¤
- **æ·»åŠ æ–°æ’ä»¶**: åªéœ€æ”¾åˆ° `plugins/data_sources/` ç›®å½•
- **ç§»é™¤æ’ä»¶**: ç›´æ¥åˆ é™¤æ–‡ä»¶æˆ–ç¦ç”¨
- **æ— éœ€ä¿®æ”¹ä»£ç **: æ’ä»¶ç®¡ç†å™¨è‡ªåŠ¨å‘ç°

#### 3. ç»Ÿä¸€ç®¡ç†
- æ‰€æœ‰æ’ä»¶é€šè¿‡ `PluginManager` ç®¡ç†
- ç»Ÿä¸€çš„å¯ç”¨/ç¦ç”¨æœºåˆ¶
- ç»Ÿä¸€çš„å…ƒæ•°æ®ç®¡ç†

#### 4. çµæ´»é…ç½®
- æ”¯æŒä¼˜å…ˆçº§ï¼ˆpriorityï¼‰
- æ”¯æŒæƒé‡ï¼ˆweightï¼‰
- æ”¯æŒå¯ç”¨/ç¦ç”¨çŠ¶æ€

## ğŸ” éªŒè¯ç»“æœ

### è¯­æ³•éªŒè¯
âœ… **é€šè¿‡** - Pythonè¯­æ³•æ­£ç¡®ï¼Œæ— é”™è¯¯

### æ–¹æ³•éªŒè¯
âœ… **é€šè¿‡** - æ–°æ–¹æ³• `_register_plugins_from_plugin_manager` å·²æ·»åŠ   
âœ… **é€šè¿‡** - æ—§æ–¹æ³•å·²æ ‡è®°ä¸º DEPRECATED  
âœ… **é€šè¿‡** - è°ƒç”¨ç‚¹å·²æ›´æ–°ä½¿ç”¨æ–°æ–¹æ³•

### Exampleså¯¼å…¥æ£€æŸ¥
â„¹ï¸ **å‘ç°15å¤„exampleså¯¼å…¥** - å…¨éƒ¨åœ¨åºŸå¼ƒä»£ç ä¸­ï¼Œä¸å½±å“è¿è¡Œ

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åšï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

#### 1. æµ‹è¯•ç³»ç»Ÿå¯åŠ¨
```bash
python main.py
```

**é¢„æœŸç»“æœ**:
- ç³»ç»Ÿæ­£å¸¸å¯åŠ¨
- çœ‹åˆ° "ğŸ” å¼€å§‹å‘ç°å’Œæ³¨å†Œæ•°æ®æºæ’ä»¶..." æ—¥å¿—
- çœ‹åˆ° "âœ… æ’ä»¶å‘ç°å’Œæ³¨å†Œå®Œæˆ: å…±æ³¨å†Œ X ä¸ªæ’ä»¶" æ—¥å¿—
- æ‰€æœ‰å¿…éœ€çš„æ’ä»¶è¢«æ­£ç¡®åŠ è½½

#### 2. éªŒè¯æ’ä»¶åŠ è½½
æ£€æŸ¥æ—¥å¿—ç¡®è®¤ï¼š
- [ ] æ’ä»¶ç®¡ç†å™¨æ­£ç¡®åŠ è½½data_sourcesä¸‹çš„æ’ä»¶
- [ ] UnifiedDataManageræ­£ç¡®æ³¨å†Œè¿™äº›æ’ä»¶
- [ ] æ•°æ®è·å–åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### åç»­ä»»åŠ¡ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

#### 3. å¤„ç†Examplesæ’ä»¶

**å·²æœ‰ç”Ÿäº§ç‰ˆæœ¬çš„æ’ä»¶ï¼ˆå¯åˆ é™¤ï¼‰**:
```bash
# è¿™äº›æ’ä»¶å·²åœ¨data_sourcesä¸­å®ç°ï¼Œå¯ä»¥åˆ é™¤examplesç‰ˆæœ¬
plugins/examples/binance_crypto_plugin.py
plugins/examples/okx_crypto_plugin.py
plugins/examples/huobi_crypto_plugin.py
plugins/examples/coinbase_crypto_plugin.py
plugins/examples/wenhua_data_plugin.py
```

**éœ€è¦å†³å®šçš„æ’ä»¶**:
- `wind_data_plugin.py` - Windæ•°æ®æºï¼Œæ˜¯å¦éœ€è¦ï¼Ÿ
- `tongdaxin_stock_plugin.py` - é€šè¾¾ä¿¡ï¼Œæ˜¯å¦å·²æœ‰ `data_sources/stock/tongdaxin_plugin.py`ï¼Ÿ
- `futures_data_plugin.py` - é€šç”¨æœŸè´§
- `ctp_futures_plugin.py` - CTPæœŸè´§
- `forex_data_plugin.py` - å¤–æ±‡
- `bond_data_plugin.py` - å€ºåˆ¸
- `mysteel_data_plugin.py` - æˆ‘çš„é’¢é“ç½‘
- `crypto_data_plugin.py` - é€šç”¨åŠ å¯†è´§å¸

**ç­–ç•¥**:
1. æ£€æŸ¥data_sourcesä¸­æ˜¯å¦å·²æœ‰å¯¹åº”æ’ä»¶
2. å¦‚æœæœ‰ â†’ åˆ é™¤examplesç‰ˆæœ¬
3. å¦‚æœæ²¡æœ‰ä¸”éœ€è¦ä¿ç•™ â†’ è¿ç§»åˆ°data_sources
4. å¦‚æœä¸éœ€è¦ â†’ åˆ é™¤

#### 4. æ›´æ–°å…¶ä»–ä¾èµ–

**éœ€è¦æ›´æ–°çš„æ–‡ä»¶**:
1. `gui/dialogs/data_source_plugin_config_dialog.py`
   - ç§»é™¤ç¡¬ç¼–ç çš„exampleså¼•ç”¨
   
2. `gui/dialogs/plugin_manager_dialog.py`
   - ç§»é™¤examples.macd_indicatorå¼•ç”¨
   
3. `strategies/adj_vwap_strategies.py`
   - æ›´æ–°ç­–ç•¥å¯¼å…¥è·¯å¾„
   
4. `strategies/strategy_adapters.py`
   - æ›´æ–°ç­–ç•¥å¯¼å…¥è·¯å¾„

5. `core/importdata/import_execution_engine.py`
   - ç§»é™¤examplesç‰¹æ®Šå¤„ç†

#### 5. æ¸…ç†åºŸå¼ƒä»£ç 

**ç¡®è®¤ä¸€åˆ‡æ­£å¸¸å**:
```python
# åˆ é™¤ä»¥ä¸‹æ–¹æ³•:
- _manual_register_core_plugins_DEPRECATED() (2606-2989è¡Œ)
- _create_fallback_data_source_DEPRECATED() (2991-3050è¡Œ)
```

**é¢„æœŸç»“æœ**:
- å‡å°‘ ~400è¡Œä»£ç 
- æ–‡ä»¶ä» 3245è¡Œ â†’ ~2850è¡Œ

#### 6. æ›´æ–°æ–‡æ¡£

- æ›´æ–°æ’ä»¶å¼€å‘æ–‡æ¡£
- æ›´æ–°READMEä¸­çš„examplesè¯´æ˜
- æ·»åŠ åŠ¨æ€åŠ è½½æœºåˆ¶çš„è¯´æ˜

### é•¿æœŸä»»åŠ¡ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰

#### 7. åˆ é™¤Examplesç›®å½•

**å‰ææ¡ä»¶**:
- æ‰€æœ‰examplesæ’ä»¶å·²è¿ç§»æˆ–ç¡®è®¤ä¸éœ€è¦
- æ‰€æœ‰ä»£ç ä¾èµ–å·²æ›´æ–°
- æµ‹è¯•å…¨éƒ¨é€šè¿‡

**æ‰§è¡Œ**:
```bash
# å¤‡ä»½
mv plugins/examples plugins/examples.backup

# æˆ–ç›´æ¥åˆ é™¤
rm -rf plugins/examples
```

## âš ï¸ é£é™©è¯„ä¼°

### å·²ç¼“è§£çš„é£é™©

âœ… **è¯­æ³•é”™è¯¯**: å·²é€šè¿‡ç¼–è¯‘éªŒè¯  
âœ… **æ–¹æ³•ç¼ºå¤±**: æ–°æ–¹æ³•å·²æ­£ç¡®æ·»åŠ   
âœ… **è°ƒç”¨é”™è¯¯**: è°ƒç”¨ç‚¹å·²æ­£ç¡®æ›´æ–°  

### éœ€è¦æ³¨æ„çš„é£é™©

âš ï¸ **æ’ä»¶æœªåŠ è½½**: 
- **åŸå› **: PluginManagerå¯èƒ½æœªå‘ç°æŸäº›æ’ä»¶
- **ç¼“è§£**: æ£€æŸ¥æ’ä»¶ç›®å½•ç»“æ„ï¼Œç¡®ä¿ç¬¦åˆè§„èŒƒ
- **ç›‘æ§**: è§‚å¯Ÿå¯åŠ¨æ—¥å¿—ä¸­çš„æ’ä»¶æ•°é‡

âš ï¸ **æ’ä»¶éªŒè¯å¤±è´¥**:
- **åŸå› **: æ’ä»¶ç¼ºå°‘å¿…è¦çš„æ–¹æ³•
- **ç¼“è§£**: `_is_valid_data_source_plugin` ä¼šè·³è¿‡æ— æ•ˆæ’ä»¶
- **ç›‘æ§**: æ³¨æ„ "âš ï¸ æ’ä»¶ç¼ºå°‘å¿…è¦æ–¹æ³•" è­¦å‘Š

âš ï¸ **æ€§èƒ½å½±å“**:
- **åŸå› **: åŠ¨æ€åŠ è½½å¯èƒ½ç¨æ…¢
- **ç¼“è§£**: åªåœ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡
- **é¢„æœŸ**: å½±å“< 1ç§’

## ğŸ“ˆ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½éªŒè¯
- [ ] ç³»ç»Ÿæ­£å¸¸å¯åŠ¨
- [ ] è‡³å°‘åŠ è½½10+ä¸ªæ•°æ®æºæ’ä»¶
- [ ] æ•°æ®è·å–åŠŸèƒ½æ­£å¸¸
- [ ] æ’ä»¶ç®¡ç†ç•Œé¢æ­£å¸¸æ˜¾ç¤º

### æ—¥å¿—éªŒè¯
åº”çœ‹åˆ°ç±»ä¼¼æ—¥å¿—ï¼š
```
[INFO] ğŸ” å¼€å§‹å‘ç°å’Œæ³¨å†Œæ•°æ®æºæ’ä»¶...
[INFO] ğŸ“¦ æ’ä»¶ç®¡ç†å™¨ä¸­æœ‰ X ä¸ªæ’ä»¶
[INFO] ğŸ” å‘ç° Y ä¸ªæ•°æ®æºæ’ä»¶
[INFO]   âœ… æˆåŠŸæ³¨å†Œ: Binanceæ•°æ®æº (data_sources.crypto.binance_plugin)
[INFO]   âœ… æˆåŠŸæ³¨å†Œ: AkShareæ•°æ®æº (data_sources.stock.akshare_plugin)
...
[INFO] ğŸ“Š æ’ä»¶æ³¨å†Œç»Ÿè®¡: æˆåŠŸ Y/Y
[INFO] âœ… æ’ä»¶å‘ç°å’Œæ³¨å†Œå®Œæˆ: å…±æ³¨å†Œ Y ä¸ªæ’ä»¶
```

### æ€§èƒ½éªŒè¯
- å¯åŠ¨æ—¶é—´ < åŸæ¥ + 2ç§’
- å†…å­˜å ç”¨æ— æ˜æ˜¾å¢åŠ 

## ğŸ‰ æ€»ç»“

### å·²å®Œæˆ
âœ… è®¾è®¡åŠ¨æ€æ’ä»¶åŠ è½½æ–¹æ¡ˆ  
âœ… å®æ–½UnifiedDataManageré‡æ„  
âœ… åºŸå¼ƒç¡¬ç¼–ç æ’ä»¶æ³¨å†Œæ–¹æ³•  
âœ… è¯­æ³•å’Œç»“æ„éªŒè¯

### æ ¸å¿ƒæ”¹è¿›
1. **åˆ é™¤ç¡¬ç¼–ç **: 18ä¸ªexampleså¯¼å…¥ â†’ 0
2. **åŠ¨æ€å‘ç°**: è‡ªåŠ¨ä»PluginManagerè·å–
3. **æ˜“äºç»´æŠ¤**: æ·»åŠ æ’ä»¶åªéœ€æ”¾æ–‡ä»¶
4. **ç»Ÿä¸€ç®¡ç†**: é€šè¿‡æ’ä»¶æ¶æ„ç®¡ç†

### ä»£ç è´¨é‡
- **å‡å°‘**: ~378è¡ŒåºŸå¼ƒä»£ç ï¼ˆå¾…åˆ é™¤ï¼‰
- **æ–°å¢**: ~105è¡ŒåŠ¨æ€åŠ è½½ä»£ç 
- **å‡€å‡å°‘**: ~273è¡Œ (-8.4%)

### ä¸‹ä¸€é‡Œç¨‹ç¢‘
1. âœ… é‡æ„å®Œæˆ
2. â³ ç³»ç»Ÿæµ‹è¯•
3. â³ Examplesæ¸…ç†
4. â³ åºŸå¼ƒä»£ç åˆ é™¤

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-18 20:50  
**é‡æ„çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: â³ å¾…éªŒè¯  
**éƒ¨ç½²çŠ¶æ€**: â³ å¾…ç¡®è®¤


