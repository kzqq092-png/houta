# stock_data vs stock_a_data æ•°æ®åº“å¯¹æ¯”åˆ†ææŠ¥å‘Š

## ğŸ“Š æ ¸å¿ƒå‘ç°

### âœ… æ²¡æœ‰é‡å¤æ•°æ®ï¼

**ç»“è®º**ï¼š`stock_data.duckdb` å’Œ `stock_a_data.duckdb` ä¹‹é—´**æ²¡æœ‰ä»»ä½•é‡å¤çš„è‚¡ç¥¨ä»£ç **ã€‚

ä¸¤ä¸ªæ•°æ®åº“æ˜¯**æŒ‰å¸‚åœºç±»å‹åˆ†ç¦»å­˜å‚¨**çš„ï¼Œè®¾è®¡åˆç†ï¼Œæœ‰å¿…è¦åŒæ—¶å­˜åœ¨ã€‚

## ğŸ” è¯¦ç»†å¯¹æ¯”

### 1. stock_data.duckdbï¼ˆé€šç”¨è‚¡ç¥¨æ•°æ®åº“ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`db/databases/stock/stock_data.duckdb`  
**å¤§å°**ï¼š3.51MB  
**è¡¨æ•°é‡**ï¼š6ä¸ª  
**æ ¸å¿ƒè¡¨**ï¼š`stock_kline`  

**æ•°æ®ç»Ÿè®¡**ï¼š
- è®°å½•æ•°ï¼š4,508æ¡
- è‚¡ç¥¨æ•°é‡ï¼š11åª
- ä¸»è¦å¸‚åœºï¼šç¾è‚¡ï¼ˆUSï¼‰

**è‚¡ç¥¨ä»£ç ç‰¹å¾**ï¼š
```
- AAPL.US (USå¸‚åœº): 2,000æ¡
- 000725 (æœªæ ‡å¸‚åœº): 251æ¡
- 600887 (æœªæ ‡å¸‚åœº): 251æ¡
- 000001 (æœªæ ‡å¸‚åœº): 251æ¡
- 300059 (æœªæ ‡å¸‚åœº): 251æ¡
- 600036 (æœªæ ‡å¸‚åœº): 251æ¡
- ... ç­‰10åªAè‚¡æµ‹è¯•æ•°æ®
```

**å¸‚åœºåˆ†å¸ƒ**ï¼š
| å¸‚åœº | è‚¡ç¥¨æ•° | è®°å½•æ•° |
|------|--------|--------|
| US | 1åª | 2,000æ¡ |
| Noneï¼ˆæœªæ ‡æ³¨ï¼‰ | 10åª | 2,508æ¡ |

**æ ·æœ¬æ•°æ®**ï¼š
```
AAPL.US (US): 2024-05-12 - å¼€9.99, é«˜10.12, ä½9.9, æ”¶10.06
```

### 2. stock_a_data.duckdbï¼ˆAè‚¡ä¸“ç”¨æ•°æ®åº“ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`db/databases/stock_a/stock_a_data.duckdb`  
**å¤§å°**ï¼š6.76MB  
**è¡¨æ•°é‡**ï¼š5ä¸ª  
**æ ¸å¿ƒè¡¨**ï¼š`stock_a_kline`  

**æ•°æ®ç»Ÿè®¡**ï¼š
- è®°å½•æ•°ï¼š10,703æ¡
- è‚¡ç¥¨æ•°é‡ï¼š23åª
- ä¸»è¦å¸‚åœºï¼šæ·±åœ³ï¼ˆSZï¼‰ã€ä¸Šæµ·ï¼ˆSHï¼‰

**è‚¡ç¥¨ä»£ç ç‰¹å¾**ï¼š
```
- 000001.SZ (æ·±åœ³): 2,002æ¡
- 600036.SH (ä¸Šæµ·): 2,000æ¡
- 600000.SH (ä¸Šæµ·): 2,000æ¡
- 000002.SZ (æ·±åœ³): 2,000æ¡
- 000003.SZ: 180æ¡
- ... ç­‰20+åªAè‚¡
```

**å¸‚åœºåˆ†å¸ƒ**ï¼š
| å¸‚åœº | è‚¡ç¥¨æ•° | è®°å½•æ•° |
|------|--------|--------|
| SZï¼ˆæ·±åœ³ï¼‰ | 3åª | 4,003æ¡ |
| SHï¼ˆä¸Šæµ·ï¼‰ | 2åª | 4,000æ¡ |
| NULLï¼ˆæœªæ ‡æ³¨ï¼‰ | 20åª | 2,700æ¡ |

**æ ·æœ¬æ•°æ®**ï¼š
```
000001.SZ (SZ): 2025-09-24 - å¼€11.98, é«˜12.35, ä½11.65, æ”¶12.01
```

### 3. å…³é”®åŒºåˆ«

#### è‚¡ç¥¨ä»£ç æ ¼å¼

**stock_data.duckdb**ï¼š
- `AAPL.US` - ç¾è‚¡ï¼ˆå¸¦å¸‚åœºåç¼€ï¼‰
- `000725`, `600887` - Aè‚¡ä»£ç ï¼ˆæ— åç¼€ï¼Œç–‘ä¼¼æµ‹è¯•æ•°æ®ï¼‰

**stock_a_data.duckdb**ï¼š
- `000001.SZ` - æ·±åœ³Aè‚¡ï¼ˆå¸¦.SZåç¼€ï¼‰
- `600036.SH` - ä¸Šæµ·Aè‚¡ï¼ˆå¸¦.SHåç¼€ï¼‰

#### è¡¨ç»“æ„å·®å¼‚

| ç‰¹æ€§ | stock_data | stock_a_data |
|------|-----------|--------------|
| æ ¸å¿ƒè¡¨å | `stock_kline` | `stock_a_kline` |
| åˆ—æ•° | 15åˆ— | 15åˆ— |
| è¡¨ç»“æ„ | å®Œå…¨ç›¸åŒ | å®Œå…¨ç›¸åŒ |
| é¢å¤–è¡¨ | æœ‰ `historical_kline_data`ï¼ˆç©ºï¼‰ | æ—  |

#### æ•°æ®é‡å¯¹æ¯”

| æŒ‡æ ‡ | stock_data | stock_a_data | å€æ•° |
|------|-----------|--------------|------|
| **è®°å½•æ•°** | 4,508æ¡ | 10,703æ¡ | **2.4å€** |
| **è‚¡ç¥¨æ•°** | 11åª | 23åª | **2.1å€** |
| **æ–‡ä»¶å¤§å°** | 3.51MB | 6.76MB | **1.9å€** |

## ğŸ¯ è®¾è®¡åˆç†æ€§åˆ†æ

### ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªæ•°æ®åº“ï¼Ÿ

#### ä¼˜åŠ¿1ï¼šæŒ‰å¸‚åœºç±»å‹åˆ†ç¦»å­˜å‚¨

**å¥½å¤„**ï¼š
- âœ… ä¸åŒå¸‚åœºçš„äº¤æ˜“è§„åˆ™ä¸åŒï¼ˆäº¤æ˜“æ—¶é—´ã€æ¶¨è·Œåœã€å‡æœŸç­‰ï¼‰
- âœ… æ•°æ®æ¥æºä¸åŒï¼ˆç¾è‚¡ç”¨Yahoo Financeï¼ŒAè‚¡ç”¨é€šè¾¾ä¿¡ç­‰ï¼‰
- âœ… æ•°æ®è´¨é‡å’Œæ›´æ–°é¢‘ç‡å¯ä»¥ç‹¬ç«‹ç®¡ç†
- âœ… æ”¯æŒä¸åŒå¸‚åœºçš„ç‹¬ç«‹æŸ¥è¯¢å’Œåˆ†æ

**å®ä¾‹**ï¼š
```python
# æŸ¥è¯¢Aè‚¡æ—¶åªæ‰«æ stock_a_data.duckdb
# æŸ¥è¯¢ç¾è‚¡æ—¶åªæ‰«æ stock_data.duckdb
# é¿å…å…¨è¡¨æ‰«æï¼Œæ€§èƒ½æ›´å¥½
```

#### ä¼˜åŠ¿2ï¼šé¿å…å•è¡¨è¿‡å¤§

**é—®é¢˜åœºæ™¯**ï¼ˆå¦‚æœåˆå¹¶ï¼‰ï¼š
- âŒ å•ä¸ªæ•°æ®åº“æ–‡ä»¶è¿‡å¤§ï¼ˆ10.27MB â†’ æœªæ¥å¯èƒ½å‡ GBï¼‰
- âŒ æŸ¥è¯¢æ—¶éœ€è¦æ‰«ææ›´å¤šæ•°æ®
- âŒ ç´¢å¼•æ•ˆç‡é™ä½

**åˆ†ç¦»å**ï¼š
- âœ… æ¯ä¸ªæ•°æ®åº“ä¿æŒåˆç†å¤§å°
- âœ… æŸ¥è¯¢æ—¶åªè®¿é—®ç›¸å…³å¸‚åœºçš„æ•°æ®
- âœ… ç´¢å¼•æ›´é«˜æ•ˆ

#### ä¼˜åŠ¿3ï¼šæ”¯æŒä¸åŒå¸‚åœºçš„ç‹¬ç«‹ç®¡ç†

**çµæ´»æ€§**ï¼š
- âœ… Aè‚¡å¯ä»¥ç‹¬ç«‹å¤‡ä»½å’Œæ¢å¤
- âœ… ç¾è‚¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æ›´æ–°ç­–ç•¥
- âœ… æ”¯æŒæŒ‰å¸‚åœºè®¾ç½®ä¸åŒçš„æ€§èƒ½ä¼˜åŒ–å‚æ•°

#### ä¼˜åŠ¿4ï¼šæŸ¥è¯¢æ€§èƒ½æ›´å¥½

**æ€§èƒ½å¯¹æ¯”**ï¼š

**åœºæ™¯1ï¼šæŸ¥è¯¢Aè‚¡æ•°æ®**
```python
# åˆå¹¶æ–¹æ¡ˆï¼ˆæ…¢ï¼‰
SELECT * FROM stock_kline 
WHERE market IN ('SZ', 'SH')  # éœ€è¦æ‰«ææ‰€æœ‰15,211æ¡è®°å½•

# åˆ†ç¦»æ–¹æ¡ˆï¼ˆå¿«ï¼‰
SELECT * FROM stock_a_kline  # åªæ‰«æ10,703æ¡Aè‚¡è®°å½•
```

**åœºæ™¯2ï¼šç»Ÿè®¡å„å¸‚åœºæ•°æ®é‡**
```python
# åˆå¹¶æ–¹æ¡ˆï¼ˆæ…¢ï¼‰
SELECT market, COUNT(*) FROM stock_kline GROUP BY market  # å…¨è¡¨æ‰«æ

# åˆ†ç¦»æ–¹æ¡ˆï¼ˆå¿«ï¼‰
# Aè‚¡æ•°é‡ï¼šç›´æ¥æŸ¥ stock_a_data å…ƒæ•°æ®
# ç¾è‚¡æ•°é‡ï¼šç›´æ¥æŸ¥ stock_data å…ƒæ•°æ®
```

## ğŸ”§ å½“å‰æ•°æ®é—®é¢˜åˆ†æ

### é—®é¢˜1ï¼šstock_data ä¸­æœ‰Aè‚¡æµ‹è¯•æ•°æ®

**å‘ç°**ï¼š
```
stock_data.duckdb ä¸­ï¼š
- 000725, 600887, 000001, 300059, 600036, 000002, 000858, 300142, 002415, 600519
- è¿™10åªéƒ½æ˜¯Aè‚¡ä»£ç ï¼ˆæ— åç¼€ï¼‰
- æ ‡è®°ä¸º market=None
- ç–‘ä¼¼æµ‹è¯•æ•°æ®
```

**å»ºè®®**ï¼š
- âš ï¸ è¿™äº›æ•°æ®åº”è¯¥ç§»åˆ° `stock_a_data.duckdb`
- âš ï¸ æˆ–è€…æ˜ç¡®æ ‡æ³¨ä¸ºæµ‹è¯•æ•°æ®

### é—®é¢˜2ï¼šéƒ¨åˆ†æ•°æ®æœªæ ‡æ³¨å¸‚åœº

**stock_data**ï¼š
- 10åªAè‚¡ä»£ç çš„ `market` å­—æ®µä¸º `None`

**stock_a_data**ï¼š
- 20åªAè‚¡ä»£ç çš„ `market` å­—æ®µä¸º `NULL`

**å»ºè®®**ï¼š
- âš ï¸ è¡¥å……å®Œæ•´çš„å¸‚åœºæ ‡æ³¨ï¼ˆSZ, SH, USç­‰ï¼‰
- âœ… æœ‰åŠ©äºæŒ‰å¸‚åœºè¿‡æ»¤å’Œç»Ÿè®¡

## ğŸ“ æ¶æ„è®¾è®¡éªŒè¯

### AssetSeparatedDatabaseManager çš„è·¯ç”±é€»è¾‘

```python
def _get_database_path(self, asset_type: AssetType) -> str:
    base_path = Path(self.config.base_path)  # "db/databases"
    asset_dir = base_path / asset_type.value.lower()  # "stock" æˆ– "stock_a"
    db_file = asset_dir / f"{asset_type.value.lower()}_data.duckdb"
    return str(db_file)

# è‡ªåŠ¨è·¯ç”±ç¤ºä¾‹ï¼š
# AssetType.STOCK â†’ db/databases/stock/stock_data.duckdb
# AssetType.STOCK_A â†’ db/databases/stock_a/stock_a_data.duckdb
# AssetType.STOCK_HK â†’ db/databases/stock_hk/stock_hk_data.duckdbï¼ˆå°†æ¥ï¼‰
# AssetType.STOCK_US â†’ db/databases/stock_us/stock_us_data.duckdbï¼ˆå°†æ¥ï¼‰
```

### AssetType è¯†åˆ«é€»è¾‘

```python
def identify_asset_type(self, symbol: str) -> AssetType:
    # æ ¹æ®è‚¡ç¥¨ä»£ç åç¼€è‡ªåŠ¨è¯†åˆ«
    if symbol.endswith('.US'):
        return AssetType.STOCK      # â†’ stock_data.duckdb
    elif symbol.endswith('.SZ') or symbol.endswith('.SH'):
        return AssetType.STOCK_A    # â†’ stock_a_data.duckdb
    elif symbol.endswith('.HK'):
        return AssetType.STOCK_HK   # â†’ stock_hk_data.duckdbï¼ˆå°†æ¥ï¼‰
    # ...
```

### å®é™…ä½¿ç”¨ç¤ºä¾‹

```python
# è‡ªåŠ¨è¯†åˆ«å¹¶å­˜å‚¨
asset_manager = AssetSeparatedDatabaseManager()

# å­˜å‚¨ç¾è‚¡æ•°æ®
symbol = "AAPL.US"
asset_type = identifier.identify_asset_type(symbol)  # AssetType.STOCK
db_path = asset_manager.get_database_path(asset_type)
# â†’ db/databases/stock/stock_data.duckdb

# å­˜å‚¨Aè‚¡æ•°æ®
symbol = "000001.SZ"
asset_type = identifier.identify_asset_type(symbol)  # AssetType.STOCK_A
db_path = asset_manager.get_database_path(asset_type)
# â†’ db/databases/stock_a/stock_a_data.duckdb
```

## âœ… æœ€ç»ˆç»“è®º

### Q: stock_data æ˜¯å¦æœ‰å¿…è¦å­˜åœ¨ï¼Ÿ

**A: éå¸¸æœ‰å¿…è¦ï¼**

1. âœ… **æ²¡æœ‰é‡å¤æ•°æ®**ï¼šä¸¤ä¸ªæ•°æ®åº“ä¹‹é—´0é‡å¤
2. âœ… **æŒ‰å¸‚åœºåˆ†ç¦»**ï¼šç¾è‚¡vs Aè‚¡ï¼Œå®šä½æ˜ç¡®
3. âœ… **æŸ¥è¯¢æ€§èƒ½**ï¼šæŒ‰å¸‚åœºæŸ¥è¯¢æ—¶åªæ‰«æç›¸å…³æ•°æ®
4. âœ… **ç‹¬ç«‹ç®¡ç†**ï¼šä¸åŒå¸‚åœºå¯ä»¥ç‹¬ç«‹å¤‡ä»½ã€ä¼˜åŒ–
5. âœ… **å¯æ‰©å±•æ€§**ï¼šæœªæ¥å¯ä»¥ç»§ç»­æ·»åŠ  stock_hk, stock_us ç­‰

### Q: æ˜¯å¦é‡å¤äº†ï¼Ÿ

**A: ä¸é‡å¤ï¼**

**è¯æ®**ï¼š
- è‚¡ç¥¨ä»£ç ï¼š0ä¸ªé‡å¤
- æ•°æ®ç”¨é€”ï¼šç¾è‚¡ vs Aè‚¡
- è¡¨åï¼š`stock_kline` vs `stock_a_kline`
- å­˜å‚¨è·¯å¾„ï¼šä¸åŒç›®å½•

### å»ºè®®ä¼˜åŒ–

#### çŸ­æœŸä¼˜åŒ–

1. **æ¸…ç†æµ‹è¯•æ•°æ®**ï¼š
   - å°† `stock_data` ä¸­çš„10åªAè‚¡æµ‹è¯•æ•°æ®ç§»åˆ° `stock_a_data`
   - æˆ–åˆ é™¤æµ‹è¯•æ•°æ®

2. **å®Œå–„å¸‚åœºæ ‡æ³¨**ï¼š
   - å°† `market=None/NULL` çš„æ•°æ®è¡¥å……å®Œæ•´

3. **ç»Ÿä¸€å‘½å**ï¼š
   - è€ƒè™‘å°† `stock_data` æ”¹åä¸º `stock_us_data`ï¼ˆæ›´æ˜ç¡®ï¼‰
   - æˆ–å°† `stock_a_data` æ”¹åä¸º `stock_cn_data`ï¼ˆæ›´é€šç”¨ï¼‰

#### é•¿æœŸè§„åˆ’

```
db/databases/
  â”œâ”€â”€ stock_us/          # ç¾è‚¡
  â”‚   â””â”€â”€ stock_us_data.duckdb
  â”œâ”€â”€ stock_cn/          # ä¸­å›½è‚¡ç¥¨ï¼ˆAè‚¡ã€Bè‚¡ã€æ¸¯è‚¡é€šï¼‰
  â”‚   â”œâ”€â”€ stock_a_data.duckdb   # æ²ªæ·±Aè‚¡
  â”‚   â”œâ”€â”€ stock_b_data.duckdb   # Bè‚¡
  â”‚   â””â”€â”€ stock_hgt_data.duckdb # æ¸¯è‚¡é€š
  â”œâ”€â”€ stock_hk/          # æ¸¯è‚¡
  â”‚   â””â”€â”€ stock_hk_data.duckdb
  â”œâ”€â”€ futures/           # æœŸè´§
  â”‚   â””â”€â”€ futures_data.duckdb
  â””â”€â”€ crypto/            # åŠ å¯†è´§å¸
      â””â”€â”€ crypto_data.duckdb
```

## ğŸ“Š æ€»ç»“

| è¯„ä¼°ç»´åº¦ | ç»“æœ | è¯´æ˜ |
|---------|------|------|
| **æ•°æ®é‡å¤** | âœ… æ— é‡å¤ | 0ä¸ªé‡å¤è‚¡ç¥¨ä»£ç  |
| **è®¾è®¡åˆç†** | âœ… åˆç† | æŒ‰å¸‚åœºç±»å‹åˆ†ç¦»ï¼Œç¬¦åˆä¸šåŠ¡é€»è¾‘ |
| **æŸ¥è¯¢æ€§èƒ½** | âœ… ä¼˜ç§€ | æŒ‰å¸‚åœºæŸ¥è¯¢æ—¶åªæ‰«æç›¸å…³æ•°æ® |
| **å¯ç»´æŠ¤æ€§** | âœ… è‰¯å¥½ | ç‹¬ç«‹ç®¡ç†ï¼Œäº’ä¸å½±å“ |
| **å¯æ‰©å±•æ€§** | âœ… ä¼˜ç§€ | æ”¯æŒç»§ç»­æ·»åŠ å…¶ä»–å¸‚åœº |
| **æ•°æ®è´¨é‡** | âš ï¸ éœ€æ”¹è¿› | éƒ¨åˆ†æµ‹è¯•æ•°æ®éœ€æ¸…ç† |

---

**åˆ†æå®Œæˆæ—¶é—´**ï¼š2025-10-14 00:50  
**ç»“è®º**ï¼š`stock_data` å’Œ `stock_a_data` éƒ½æœ‰å¿…è¦å­˜åœ¨ï¼Œæ— é‡å¤ï¼Œè®¾è®¡åˆç†

