# 菜单功能审计报告

## 审计概述

本报告详细分析了HIkyuu-UI系统中菜单功能的连接状态和实现情况。

## 菜单动作统计

| 菜单类别 | 总数 | 已连接 | 已实现 | 连接率 | 实现率 |
|----------|------|-------|--------|-------|--------|
| file | 1 | 1 | 1 | 100.0% | 100.0% |
| edit | 2 | 2 | 2 | 100.0% | 100.0% |
| view | 7 | 5 | 4 | 71.4% | 57.1% |
| strategy | 5 | 5 | 5 | 100.0% | 100.0% |
| data | 4 | 4 | 4 | 100.0% | 100.0% |
| tools | 10 | 9 | 9 | 90.0% | 90.0% |
| advanced | 12 | 12 | 12 | 100.0% | 100.0% |
| debug | 1 | 1 | 0 | 100.0% | 0.0% |
| help | 7 | 7 | 7 | 100.0% | 100.0% |

## 详细菜单动作分析


### Advanced 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| batch_analysis_action | _on_batch_analysis | ✅ | ✅ | 正常 |
| cloud_api_action | _on_cloud_api | ✅ | ✅ | 正常 |
| indicator_market_action | _on_indicator_market | ✅ | ✅ | 正常 |
| node_manager_action | _on_node_management | ✅ | ✅ | 正常 |
| one_click_optimize_action | _on_one_click_optimization | ✅ | ✅ | 正常 |
| optimization_dashboard_action | _on_optimization_dashboard | ✅ | ✅ | 正常 |
| optimization_status_action | _on_optimization_status | ✅ | ✅ | 正常 |
| performance_evaluation_action | _on_performance_evaluation | ✅ | ✅ | 正常 |
| plugin_manager_action | _on_plugin_manager | ✅ | ✅ | 正常 |
| plugin_market_action | _on_plugin_market | ✅ | ✅ | 正常 |
| smart_optimize_action | _on_intelligent_optimization | ✅ | ✅ | 正常 |
| version_manager_action | _on_version_management | ✅ | ✅ | 正常 |

### Data 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| data_quality_action | _on_data_quality_check | ✅ | ✅ | 正常 |
| database_admin_action | _on_database_admin | ✅ | ✅ | 正常 |
| export_data_action | _on_export_data | ✅ | ✅ | 正常 |
| import_data_action | _on_import_data | ✅ | ✅ | 正常 |

### Debug 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| toggle_log_action | toggle_log_panel | ✅ | ❌ | 方法不存在 |

### Edit 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| copy_action | _on_copy | ✅ | ✅ | 正常 |
| paste_action | _on_paste | ✅ | ✅ | 正常 |

### File 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| exit_action | _on_exit | ✅ | ✅ | 正常 |

### Help 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| about_action | _on_about | ✅ | ✅ | 正常 |
| data_usage_terms_action | _on_show_data_usage_terms | ✅ | ✅ | 正常 |
| help_action | _on_help | ✅ | ✅ | 正常 |
| shortcuts_action | _on_shortcuts | ✅ | ✅ | 正常 |
| startup_guides_action | _on_startup_guides | ✅ | ✅ | 正常 |
| update_action | _on_check_update | ✅ | ✅ | 正常 |
| user_manual_action | _on_help | ✅ | ✅ | 正常 |

### Strategy 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| create_strategy_action | _on_create_strategy | ✅ | ✅ | 正常 |
| export_strategy_action | _on_export_strategy | ✅ | ✅ | 正常 |
| import_strategy_action | _on_import_strategy | ✅ | ✅ | 正常 |
| strategy_backtest_action | _on_strategy_backtest | ✅ | ✅ | 正常 |
| strategy_optimize_action | _on_strategy_optimize | ✅ | ✅ | 正常 |

### Tools 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| advanced_search_action | _on_advanced_search | ✅ | ✅ | 正常 |
| calculator_action | _on_calculator | ✅ | ✅ | 正常 |
| clear_all_cache_action | _on_clear_all_cache | ✅ | ✅ | 正常 |
| clear_data_cache_action | _on_clear_data_cache | ✅ | ✅ | 正常 |
| clear_negative_cache_action | _on_clear_negative_cache | ✅ | ✅ | 正常 |
| converter_action | _on_converter | ✅ | ✅ | 正常 |
| data_export_action | _on_export_data | ✅ | ✅ | 正常 |
| settings_action | _on_settings | ✅ | ✅ | 正常 |
| system_optimizer_action | _on_system_optimizer | ✅ | ✅ | 正常 |
| webgpu_status_action |  | ❌ | ❌ | 未连接 |

### View 菜单

| 动作名称 | 目标方法 | 连接状态 | 实现状态 | 问题说明 |
|----------|----------|----------|----------|----------|
| dark_theme_action | _on_theme_changed | ✅ | ✅ | 正常 |
| default_theme_action | _on_theme_changed | ✅ | ✅ | 正常 |
| light_theme_action | _on_theme_changed | ✅ | ✅ | 正常 |
| performance_panel_action | _toggle_performance_panel | ✅ | ❌ | 方法不存在 |
| refresh_action | _on_refresh | ✅ | ✅ | 正常 |
| statusbar_action |  | ❌ | ❌ | 未连接 |
| toolbar_action |  | ❌ | ❌ | 未连接 |

## 问题分析

### 缺失的方法

- `_toggle_performance_panel` - 菜单已连接但方法不存在
- `toggle_log_panel` - 菜单已连接但方法不存在

### 断裂的连接

- `toolbar_action` - 菜单动作未连接到任何方法
- `statusbar_action` - 菜单动作未连接到任何方法
- `webgpu_status_action` - 菜单动作未连接到任何方法

### 未连接的方法

- `_on_bottom_panel_hidden` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_ui_data_ready` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_chart_updated` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_chart_updated` in `core\services\unified_chart_service.py` - 方法已实现但未连接到菜单
- `_on_analysis_completed` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_error` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_data_update` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_new_file` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_open_file` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_save_file` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_undo` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_redo` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_search_completed` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_search_completed` in `gui\dialogs\advanced_search_dialog.py` - 方法已实现但未连接到菜单
- `_on_data_export` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_settings_applied` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_strategy_management` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_single_stock_quality_check` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_batch_quality_check` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_commission_calculator` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_currency_converter` in `core\coordinators\main_window_coordinator.py` - 方法已实现但未连接到菜单
- `_on_search_progress` in `gui\dialogs\advanced_search_dialog.py` - 方法已实现但未连接到菜单
- `_on_search_error` in `gui\dialogs\advanced_search_dialog.py` - 方法已实现但未连接到菜单
- `_on_filter_changed` in `gui\dialogs\batch_filter_dialog.py` - 方法已实现但未连接到菜单
- `_on_export_progress` in `gui\dialogs\data_export_dialog.py` - 方法已实现但未连接到菜单
- `_on_export_completed` in `gui\dialogs\data_export_dialog.py` - 方法已实现但未连接到菜单
- `_on_export_error` in `gui\dialogs\data_export_dialog.py` - 方法已实现但未连接到菜单
- `_on_stock_changed` in `gui\dialogs\history_data_dialog.py` - 方法已实现但未连接到菜单
- `_on_period_changed` in `gui\dialogs\history_data_dialog.py` - 方法已实现但未连接到菜单
- `_on_update_progress` in `gui\dialogs\history_data_dialog.py` - 方法已实现但未连接到菜单
- `_on_update_status` in `gui\dialogs\history_data_dialog.py` - 方法已实现但未连接到菜单
- `_on_update_finished` in `gui\dialogs\history_data_dialog.py` - 方法已实现但未连接到菜单
- `_on_combinations_loaded` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_load_error` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_selection_changed` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_search` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_clear_search` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_load_combination` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_delete_combination` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_import_combinations` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_export_combinations` in `gui\dialogs\indicator_combination_dialog.py` - 方法已实现但未连接到菜单
- `_on_param_changed` in `gui\dialogs\indicator_params_dialog.py` - 方法已实现但未连接到菜单
- `_on_config_changed` in `gui\dialogs\sentiment_plugin_config_dialog.py` - 方法已实现但未连接到菜单
- `_on_theme_selected` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_theme_combo_changed` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_preview_theme` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_import_theme` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_export_theme` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_delete_theme` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_rename_theme` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_apply_clicked` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_ok_clicked` in `gui\dialogs\settings_dialog.py` - 方法已实现但未连接到菜单
- `_on_strategy_selected` in `gui\dialogs\strategy_manager_dialog.py` - 方法已实现但未连接到菜单
- `_on_strategy_double_clicked` in `gui\dialogs\strategy_manager_dialog.py` - 方法已实现但未连接到菜单
- `_on_progress` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_status` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_level_changed` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_level_changed` in `gui\panels\system_optimizer_panel.py` - 方法已实现但未连接到菜单
- `_on_progress_updated` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_progress_updated` in `gui\panels\system_optimizer_panel.py` - 方法已实现但未连接到菜单
- `_on_status_updated` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_status_updated` in `gui\panels\system_optimizer_panel.py` - 方法已实现但未连接到菜单
- `_on_optimization_completed` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_optimization_completed` in `gui\panels\system_optimizer_panel.py` - 方法已实现但未连接到菜单
- `_on_optimization_failed` in `gui\dialogs\system_optimizer_dialog.py` - 方法已实现但未连接到菜单
- `_on_optimization_failed` in `gui\panels\system_optimizer_panel.py` - 方法已实现但未连接到菜单
- `_on_analysis_data_received` in `core\services\analysis_service.py` - 方法已实现但未连接到菜单
- `_on_config_updated` in `core\services\base_service.py` - 方法已实现但未连接到菜单
- `_on_data_load_error` in `core\services\chart_service.py` - 方法已实现但未连接到菜单
- `_on_unknown_error` in `core\services\chart_service.py` - 方法已实现但未连接到菜单
- `_on_stock_selected` in `core\services\trading_service.py` - 方法已实现但未连接到菜单
- `_on_data_loaded` in `core\services\unified_chart_service.py` - 方法已实现但未连接到菜单
- `_on_condition_changed` in `components\stock_screener.py` - 方法已实现但未连接到菜单

### 重复的功能

- `_on_chart_updated` - 在以下文件中重复实现:
  - core\coordinators\main_window_coordinator.py
  - core\services\unified_chart_service.py
- `_on_theme_changed` - 在以下文件中重复实现:
  - core\coordinators\main_window_coordinator.py
  - core\coordinators\main_window_coordinator.py
- `_on_refresh` - 在以下文件中重复实现:
  - core\coordinators\main_window_coordinator.py
  - gui\dialogs\indicator_combination_dialog.py
- `_on_search_completed` - 在以下文件中重复实现:
  - core\coordinators\main_window_coordinator.py
  - gui\dialogs\advanced_search_dialog.py
- `_on_level_changed` - 在以下文件中重复实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py
- `_on_progress_updated` - 在以下文件中重复实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py
- `_on_status_updated` - 在以下文件中重复实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py
- `_on_optimization_completed` - 在以下文件中重复实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py
- `_on_optimization_failed` - 在以下文件中重复实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py
- `show_template_manager_dialog` - 在以下文件中重复实现:
  - components\fund_flow.py
  - components\market_sentiment.py
  - components\stock_screener.py

## 业务方法统计

- 发现业务方法: 129 个
- 已连接方法: 40 个
- 已实现方法: 129 个
- 连接率: 31.0%
- 实现率: 100.0%

## 修复建议

### 1. 补充缺失方法

以下方法需要在MainWindowCoordinator中实现:

```python
def _toggle_performance_panel(self):
    """TODO: 实现_toggle_performance_panel功能"""
    try:
        # 实现具体功能
        pass
    except Exception as e:
        self.log_manager.error(f"执行_toggle_performance_panel失败: {e}")
```

```python
def toggle_log_panel(self):
    """TODO: 实现toggle_log_panel功能"""
    try:
        # 实现具体功能
        pass
    except Exception as e:
        self.log_manager.error(f"执行toggle_log_panel失败: {e}")
```

### 2. 修复断裂连接

以下菜单动作需要连接到对应方法:

- `toolbar_action` → 建议连接到 `_on_toolbar`
- `statusbar_action` → 建议连接到 `_on_statusbar`
- `webgpu_status_action` → 建议连接到 `_on_webgpu_on_status`

### 3. 利用未连接方法

以下已实现的方法可以连接到菜单:

- `_on_bottom_panel_hidden` → 建议创建菜单动作 `bottom_panel_hidden_action`
- `_on_ui_data_ready` → 建议创建菜单动作 `ui_data_ready_action`
- `_on_chart_updated` → 建议创建菜单动作 `chart_updated_action`
- `_on_analysis_completed` → 建议创建菜单动作 `analysis_completed_action`
- `_on_error` → 建议创建菜单动作 `error_action`
- `_on_data_update` → 建议创建菜单动作 `data_update_action`
- `_on_new_file` → 建议创建菜单动作 `new_file_action`
- `_on_open_file` → 建议创建菜单动作 `open_file_action`
- `_on_save_file` → 建议创建菜单动作 `save_file_action`
- `_on_undo` → 建议创建菜单动作 `undo_action`
- `_on_redo` → 建议创建菜单动作 `redo_action`
- `_on_search_completed` → 建议创建菜单动作 `search_completed_action`
- `_on_data_export` → 建议创建菜单动作 `data_export_action`
- `_on_settings_applied` → 建议创建菜单动作 `settings_applied_action`
- `_on_strategy_management` → 建议创建菜单动作 `strategy_management_action`
- `_on_single_stock_quality_check` → 建议创建菜单动作 `single_stock_quality_check_action`
- `_on_batch_quality_check` → 建议创建菜单动作 `batch_quality_check_action`
- `_on_commission_calculator` → 建议创建菜单动作 `commission_calculator_action`
- `_on_currency_converter` → 建议创建菜单动作 `currency_converter_action`
- `_on_search_progress` → 建议创建菜单动作 `search_progress_action`
- `_on_search_error` → 建议创建菜单动作 `search_error_action`
- `_on_filter_changed` → 建议创建菜单动作 `filter_changed_action`
- `_on_export_progress` → 建议创建菜单动作 `export_progress_action`
- `_on_export_completed` → 建议创建菜单动作 `export_completed_action`
- `_on_export_error` → 建议创建菜单动作 `export_error_action`
- `_on_stock_changed` → 建议创建菜单动作 `stock_changed_action`
- `_on_period_changed` → 建议创建菜单动作 `period_changed_action`
- `_on_update_progress` → 建议创建菜单动作 `update_progress_action`
- `_on_update_status` → 建议创建菜单动作 `update_status_action`
- `_on_update_finished` → 建议创建菜单动作 `update_finished_action`
- `_on_combinations_loaded` → 建议创建菜单动作 `combinations_loaded_action`
- `_on_load_error` → 建议创建菜单动作 `load_error_action`
- `_on_selection_changed` → 建议创建菜单动作 `selection_changed_action`
- `_on_search` → 建议创建菜单动作 `search_action`
- `_on_clear_search` → 建议创建菜单动作 `clear_search_action`
- `_on_load_combination` → 建议创建菜单动作 `load_combination_action`
- `_on_delete_combination` → 建议创建菜单动作 `delete_combination_action`
- `_on_import_combinations` → 建议创建菜单动作 `import_combinations_action`
- `_on_export_combinations` → 建议创建菜单动作 `export_combinations_action`
- `_on_param_changed` → 建议创建菜单动作 `param_changed_action`
- `_on_config_changed` → 建议创建菜单动作 `config_changed_action`
- `_on_theme_selected` → 建议创建菜单动作 `theme_selected_action`
- `_on_theme_combo_changed` → 建议创建菜单动作 `theme_combo_changed_action`
- `_on_preview_theme` → 建议创建菜单动作 `preview_theme_action`
- `_on_import_theme` → 建议创建菜单动作 `import_theme_action`
- `_on_export_theme` → 建议创建菜单动作 `export_theme_action`
- `_on_delete_theme` → 建议创建菜单动作 `delete_theme_action`
- `_on_rename_theme` → 建议创建菜单动作 `rename_theme_action`
- `_on_apply_clicked` → 建议创建菜单动作 `apply_clicked_action`
- `_on_ok_clicked` → 建议创建菜单动作 `ok_clicked_action`
- `_on_strategy_selected` → 建议创建菜单动作 `strategy_selected_action`
- `_on_strategy_double_clicked` → 建议创建菜单动作 `strategy_double_clicked_action`
- `_on_progress` → 建议创建菜单动作 `progress_action`
- `_on_status` → 建议创建菜单动作 `status_action`
- `_on_level_changed` → 建议创建菜单动作 `level_changed_action`
- `_on_progress_updated` → 建议创建菜单动作 `progress_updated_action`
- `_on_status_updated` → 建议创建菜单动作 `status_updated_action`
- `_on_optimization_completed` → 建议创建菜单动作 `optimization_completed_action`
- `_on_optimization_failed` → 建议创建菜单动作 `optimization_failed_action`
- `_on_analysis_data_received` → 建议创建菜单动作 `analysis_data_received_action`
- `_on_config_updated` → 建议创建菜单动作 `config_updated_action`
- `_on_data_load_error` → 建议创建菜单动作 `data_load_error_action`
- `_on_unknown_error` → 建议创建菜单动作 `unknown_error_action`
- `_on_stock_selected` → 建议创建菜单动作 `stock_selected_action`
- `_on_data_loaded` → 建议创建菜单动作 `data_loaded_action`
- `_on_condition_changed` → 建议创建菜单动作 `condition_changed_action`

### 4. 合并重复功能

- `_on_chart_updated` - 建议合并以下实现:
  - core\coordinators\main_window_coordinator.py
  - core\services\unified_chart_service.py

- `_on_theme_changed` - 建议合并以下实现:
  - core\coordinators\main_window_coordinator.py
  - core\coordinators\main_window_coordinator.py

- `_on_refresh` - 建议合并以下实现:
  - core\coordinators\main_window_coordinator.py
  - gui\dialogs\indicator_combination_dialog.py

- `_on_search_completed` - 建议合并以下实现:
  - core\coordinators\main_window_coordinator.py
  - gui\dialogs\advanced_search_dialog.py

- `_on_level_changed` - 建议合并以下实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py

- `_on_progress_updated` - 建议合并以下实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py

- `_on_status_updated` - 建议合并以下实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py

- `_on_optimization_completed` - 建议合并以下实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py

- `_on_optimization_failed` - 建议合并以下实现:
  - gui\dialogs\system_optimizer_dialog.py
  - gui\panels\system_optimizer_panel.py

- `show_template_manager_dialog` - 建议合并以下实现:
  - components\fund_flow.py
  - components\market_sentiment.py
  - components\stock_screener.py

---

**审计完成时间**: 2025-08-02 21:15:49
**审计工具**: MenuAuditor v1.0
