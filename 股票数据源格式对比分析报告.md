# è‚¡ç¥¨æ•°æ®æºæ ¼å¼å¯¹æ¯”åˆ†æžæŠ¥å‘Š

## æ¦‚è¿°
æœ¬æŠ¥å‘ŠåŸºäºŽé¡¹ç›®ä¸­å·²å®žçŽ°çš„æ•°æ®æºæ’ä»¶ï¼Œå¯¹æ¯”åˆ†æžäº†ä¸åŒè‚¡ç¥¨æ•°æ®æºè¿”å›žçš„æ•°æ®æ ¼å¼å’Œæ•°æ®å€¼å·®å¼‚ã€‚

## æ•°æ®æºå¯¹æ¯”

### 1. é€šè¾¾ä¿¡ (TongdaxinStockPlugin - pytdx)

#### æ•°æ®æ ¼å¼ç‰¹ç‚¹ï¼š
- **APIè°ƒç”¨**: `api_client.get_security_bars()`
- **åŽŸå§‹æ•°æ®**: å­—å…¸åˆ—è¡¨æ ¼å¼ï¼Œé€šè¿‡pytdxåº“èŽ·å–
- **æ ‡å‡†åŒ–åŽå­—æ®µ**:
  ```python
  required_columns = ['datetime', 'open', 'high', 'low', 'close', 'volume']
  optional_columns = ['amount']
  ```

#### æ•°æ®ç±»åž‹ï¼š
- `datetime`: æ—¶é—´ç´¢å¼•
- `open`, `high`, `low`, `close`: float (ä»·æ ¼)
- `volume`: int (æˆäº¤é‡)
- `amount`: float (æˆäº¤é¢ï¼Œå¯é€‰)

#### æ•°æ®ç‰¹ç‚¹ï¼š
- ç›´æŽ¥ä»Žé€šè¾¾ä¿¡æœåŠ¡å™¨èŽ·å–åŽŸå§‹äº¤æ˜“æ•°æ®
- æ•°æ®ç²¾åº¦é«˜ï¼Œæ›´æ–°åŠæ—¶
- æ”¯æŒåˆ†é’Ÿçº§æ•°æ®
- æ•°æ®æ¥æºç¨³å®šå¯é 

---

### 2. ä¸œæ–¹è´¢å¯Œ (EastMoneyStockPlugin)

#### æ•°æ®æ ¼å¼ç‰¹ç‚¹ï¼š
- **APIè°ƒç”¨**: HTTP GETè¯·æ±‚ä¸œæ–¹è´¢å¯ŒAPI
- **åŽŸå§‹æ•°æ®**: JSONæ ¼å¼ï¼ŒKçº¿æ•°æ®ä»¥é€—å·åˆ†éš”å­—ç¬¦ä¸²å½¢å¼è¿”å›ž
- **è§£æžåŽå­—æ®µ**:
  ```python
  {
      'datetime': parts[0],      # æ—¥æœŸæ—¶é—´
      'open': float(parts[1]),   # å¼€ç›˜ä»·
      'close': float(parts[2]),  # æ”¶ç›˜ä»·  
      'high': float(parts[3]),   # æœ€é«˜ä»·
      'low': float(parts[4]),    # æœ€ä½Žä»·
      'volume': int(parts[5]),   # æˆäº¤é‡
      'amount': float(parts[6]), # æˆäº¤é¢
      'amplitude': float(parts[7]),    # æŒ¯å¹…
      'pct_change': float(parts[8]),   # æ¶¨è·Œå¹…
      'change': float(parts[9]),       # æ¶¨è·Œé¢
      'turnover': float(parts[10])     # æ¢æ‰‹çŽ‡
  }
  ```

#### æ•°æ®ç‰¹ç‚¹ï¼š
- æä¾›æ›´ä¸°å¯Œçš„æŠ€æœ¯æŒ‡æ ‡å­—æ®µ
- åŒ…å«æŒ¯å¹…ã€æ¶¨è·Œå¹…ã€æ¢æ‰‹çŽ‡ç­‰è¡ç”Ÿæ•°æ®
- **æ³¨æ„**: å­—æ®µé¡ºåºä¸Žé€šè¾¾ä¿¡ä¸åŒ (open/closeä½ç½®äº’æ¢)

---

### 3. âš ï¸ AKShareæ’ä»¶å·²ç§»é™¤

**æ³¨æ„**: AKShareæ’ä»¶å·²æŒ‰ç…§ç³»ç»Ÿä¼˜åŒ–è¦æ±‚è¢«ç§»é™¤ã€‚åŽŸå› ï¼š
- æ•°æ®æºæ•´åˆå¤æ‚ï¼Œè´¨é‡ä¸ç¨³å®š
- ä¸­æ–‡åˆ—åå¢žåŠ å¤„ç†å¤æ‚åº¦
- ä¸Žå…¶ä»–é«˜è´¨é‡æ•°æ®æºé‡å¤
- ç³»ç»Ÿç®€åŒ–å’Œæ€§èƒ½ä¼˜åŒ–éœ€è¦

**æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨é€šè¾¾ä¿¡ã€ä¸œæ–¹è´¢å¯Œã€æ–°æµªè´¢ç»ç­‰ç›´æŽ¥æ•°æ®æº

---

### 4. æ–°æµªè´¢ç» (SinaDataSource)

#### æ•°æ®æ ¼å¼ç‰¹ç‚¹ï¼š
- **APIè°ƒç”¨**: 
  - Kçº¿æ•°æ®: `http://money.finance.sina.com.cn/quotes_service/api/json_v2.php/CN_MarketData.getKLineData`
  - å®žæ—¶è¡Œæƒ…: `http://hq.sinajs.cn/list=`
- **åŽŸå§‹æ•°æ®**: JSONæ ¼å¼ï¼Œéœ€è¦è§£æž
- **Kçº¿æ•°æ®å­—æ®µ**:
  ```python
  df = df.rename(columns={
      'day': 'datetime',     # æ—¥æœŸ
      'open': 'open',        # å¼€ç›˜ä»·
      'high': 'high',        # æœ€é«˜ä»·
      'low': 'low',          # æœ€ä½Žä»·
      'close': 'close',      # æ”¶ç›˜ä»·
      'volume': 'volume',    # æˆäº¤é‡
  })
  ```

#### å®žæ—¶è¡Œæƒ…å­—æ®µï¼š
```python
{
    'symbol': symbol,           # è‚¡ç¥¨ä»£ç 
    'name': fields[0],         # è‚¡ç¥¨åç§°
    'open': float(fields[1]),  # å¼€ç›˜ä»·
    'close_prev': float(fields[2]), # æ˜¨æ”¶ä»·
    'price': float(fields[3]), # å½“å‰ä»·
    'high': float(fields[4]),  # æœ€é«˜ä»·
    'low': float(fields[5]),   # æœ€ä½Žä»·
    'volume': float(fields[8]), # æˆäº¤é‡
    'amount': float(fields[9]), # æˆäº¤é¢
    'datetime': pd.to_datetime(f"{fields[30]} {fields[31]}")
}
```

#### æ•°æ®ç‰¹ç‚¹ï¼š
- æ”¯æŒæ—¥çº¿å’Œ5åˆ†é’Ÿçº¿
- å®žæ—¶è¡Œæƒ…æ•°æ®ä¸°å¯Œï¼ŒåŒ…å«æ˜¨æ”¶ä»·
- éœ€è¦æ ¹æ®è‚¡ç¥¨ä»£ç æ·»åŠ å¸‚åœºå‰ç¼€(sh/sz/bj)
- æ•°æ®æ›´æ–°é¢‘çŽ‡è¾ƒé«˜

---

### 5. è…¾è®¯è´¢ç» (QQè´¢ç»)

#### æ•°æ®æ ¼å¼ç‰¹ç‚¹ï¼š
- **APIç«¯ç‚¹**: 
  - `qt.gtimg.cn` - è…¾è®¯è´¢ç»è¡Œæƒ…API
  - `stockapp.finance.qq.com` - è…¾è®¯è‚¡ç¥¨APP API
  - `gu.qq.com` - è…¾è®¯è¯åˆ¸
- **æ•°æ®ç‰¹ç‚¹**:
  - é€šå¸¸è¿”å›žé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²æ ¼å¼
  - éœ€è¦æŒ‰ä½ç½®è§£æžå­—æ®µ
  - æ”¯æŒæ‰¹é‡æŸ¥è¯¢

#### å…¸åž‹æ•°æ®æ ¼å¼ï¼š
```
v_è‚¡ç¥¨ä»£ç ="åç§°,å¼€ç›˜,æ˜¨æ”¶,çŽ°ä»·,æœ€é«˜,æœ€ä½Ž,ä¹°ä¸€,å–ä¸€,æˆäº¤é‡,æˆäº¤é¢,..."
```

---

### 6. åŒèŠ±é¡º (TongHuaShunDataSource)

#### æ•°æ®æ ¼å¼ç‰¹ç‚¹ï¼š
- **APIè°ƒç”¨**: `http://d.10jqka.com.cn/v6/time/hs_{}/last`
- **åŽŸå§‹æ•°æ®**: JSONæ ¼å¼ï¼ŒåŒ…å«dataæ•°ç»„
- **æ ‡å‡†åŒ–å­—æ®µ**:
  ```python
  df.columns = ['date', 'open', 'high', 'low', 'close', 'volume', 'amount']
  ```

#### æ”¯æŒçš„å‘¨æœŸï¼š
```python
freq_map = {
    'D': 'day',      # æ—¥çº¿
    'W': 'week',     # å‘¨çº¿
    'M': 'month',    # æœˆçº¿
    '60': 'min60',   # 60åˆ†é’Ÿ
    '30': 'min30',   # 30åˆ†é’Ÿ
    '15': 'min15',   # 15åˆ†é’Ÿ
    '5': 'min5',     # 5åˆ†é’Ÿ
    '1': 'min'       # 1åˆ†é’Ÿ
}
```

#### æ•°æ®ç‰¹ç‚¹ï¼š
- æ”¯æŒå¤šç§Kçº¿å‘¨æœŸ
- æ•°æ®æ ¼å¼ç›¸å¯¹æ ‡å‡†
- åŒ…å«æˆäº¤é¢å­—æ®µ
- éœ€è¦åŽ»é™¤è‚¡ç¥¨ä»£ç çš„å¸‚åœºå‰ç¼€

---

### 7. å¸å®‰ (BinanceCryptoPlugin) - æ•°å­—è´§å¸å‚è€ƒ

#### æ•°æ®æ ¼å¼ç‰¹ç‚¹ï¼š
- **åŽŸå§‹å­—æ®µ**:
  ```python
  columns = [
      'open_time', 'open', 'high', 'low', 'close', 'volume',
      'close_time', 'quote_volume', 'count', 'taker_buy_volume',
      'taker_buy_quote_volume', 'ignore'
  ]
  ```
- **æœ€ç»ˆè¾“å‡º**: `['open', 'high', 'low', 'close', 'volume', 'quote_volume', 'count']`

---

## å…³é”®å·®å¼‚åˆ†æž

### 1. å­—æ®µé¡ºåºå·®å¼‚

| æ•°æ®æº | å¼€ç›˜ | æœ€é«˜ | æœ€ä½Ž | æ”¶ç›˜ | æˆäº¤é‡ | æˆäº¤é¢ |
|--------|------|------|------|------|--------|--------|
| é€šè¾¾ä¿¡ | open | high | low | close | volume | amount(å¯é€‰) |
| ä¸œæ–¹è´¢å¯Œ | open | **close** | **high** | **low** | volume | amount |
| æ–°æµªè´¢ç» | open | high | low | close | volume | - |
| è…¾è®¯è´¢ç» | å¼€ç›˜ | æœ€é«˜ | æœ€ä½Ž | çŽ°ä»· | æˆäº¤é‡ | æˆäº¤é¢ |
| åŒèŠ±é¡º | open | high | low | close | volume | amount |

âš ï¸ **é‡è¦å‘çŽ°**: 
- ä¸œæ–¹è´¢å¯Œçš„å­—æ®µé¡ºåºä¸Žæ ‡å‡†OHLCä¸åŒï¼
- è…¾è®¯è´¢ç»ä½¿ç”¨"çŽ°ä»·"è€Œä¸æ˜¯"æ”¶ç›˜ä»·"
- æ–°æµªè´¢ç»Kçº¿æ•°æ®ä¸åŒ…å«æˆäº¤é¢

### 2. æ•°æ®ç±»åž‹å·®å¼‚

| å­—æ®µ | é€šè¾¾ä¿¡ | ä¸œæ–¹è´¢å¯Œ | æ–°æµªè´¢ç» | è…¾è®¯è´¢ç» | åŒèŠ±é¡º |
|------|--------|----------|----------|----------|--------|
| ä»·æ ¼å­—æ®µ | float | float | float | float | float |
| æˆäº¤é‡ | int | int | float | float | int |
| æ—¶é—´æ ¼å¼ | datetimeå¯¹è±¡ | å­—ç¬¦ä¸²â†’éœ€è½¬æ¢ | å­—ç¬¦ä¸²â†’éœ€è½¬æ¢ | å­—ç¬¦ä¸²â†’éœ€è½¬æ¢ | å­—ç¬¦ä¸²â†’éœ€è½¬æ¢ |
| åŽŸå§‹æ ¼å¼ | å­—å…¸åˆ—è¡¨ | JSONé€—å·åˆ†éš”å­—ç¬¦ä¸² | JSON | é€—å·åˆ†éš”å­—ç¬¦ä¸² | JSON |

### 3. é¢å¤–å­—æ®µå·®å¼‚

| æ•°æ®æº | ç‹¬æœ‰å­—æ®µ |
|--------|----------|
| é€šè¾¾ä¿¡ | amount(å¯é€‰) |
| ä¸œæ–¹è´¢å¯Œ | amplitude(æŒ¯å¹…), pct_change(æ¶¨è·Œå¹…), change(æ¶¨è·Œé¢), turnover(æ¢æ‰‹çŽ‡) |
| æ–°æµªè´¢ç» | name(è‚¡ç¥¨åç§°), close_prev(æ˜¨æ”¶ä»·), price(å½“å‰ä»·) |
| è…¾è®¯è´¢ç» | ä¹°ä¸€ä»·, å–ä¸€ä»·, å¤šæ¡£ç›˜å£æ•°æ® |
| åŒèŠ±é¡º | amount(æˆäº¤é¢)ï¼Œæ”¯æŒå¤šå‘¨æœŸ |
| å¸å®‰ | quote_volume, count, taker_buy_volume |

### 4. æ•°æ®ç²¾åº¦å’Œæ›´æ–°é¢‘çŽ‡

| æ•°æ®æº | æ•°æ®ç²¾åº¦ | æ›´æ–°é¢‘çŽ‡ | åŽ†å²æ•°æ®èŒƒå›´ | æ”¯æŒå‘¨æœŸ |
|--------|----------|----------|--------------|----------|
| é€šè¾¾ä¿¡ | é«˜(åŽŸå§‹äº¤æ˜“æ•°æ®) | å®žæ—¶ | è¾ƒé•¿åŽ†å² | 1min-æœˆçº¿ |
| ä¸œæ–¹è´¢å¯Œ | é«˜ | å‡†å®žæ—¶ | å®Œæ•´åŽ†å² | 1min-æœˆçº¿ |
| æ–°æµªè´¢ç» | é«˜ | å®žæ—¶ | è¾ƒé•¿åŽ†å² | æ—¥çº¿ã€5min |
| è…¾è®¯è´¢ç» | é«˜ | å®žæ—¶ | å®Œæ•´åŽ†å² | å¤šå‘¨æœŸ |
| åŒèŠ±é¡º | é«˜ | å‡†å®žæ—¶ | å®Œæ•´åŽ†å² | 1min-æœˆçº¿ |

## ðŸš¨ é‡è¦å‘çŽ°å’Œé—æ¼ä¿¡æ¯è¡¥å……

### 1. æ–°å¢žæ•°æ®æºå‘çŽ°ï¼š
ç»è¿‡æ·±å…¥åˆ†æžï¼Œé¡¹ç›®ä¸­å®žé™…åŒ…å«äº†æ¯”é¢„æœŸæ›´å¤šçš„æ•°æ®æºï¼š
- **æ–°æµªè´¢ç»**: å®Œæ•´å®žçŽ°ï¼Œæ”¯æŒKçº¿å’Œå®žæ—¶æ•°æ®
- **è…¾è®¯è´¢ç»(QQ)**: åœ¨é…ç½®ä¸­æœ‰ç«¯ç‚¹å®šä¹‰ï¼Œæ”¯æŒå¤šç§API
- **åŒèŠ±é¡º**: æœ‰å®Œæ•´å®žçŽ°ï¼Œæ”¯æŒå¤šå‘¨æœŸæ•°æ®
- **ç½‘æ˜“è´¢ç»**: åœ¨æŸäº›é…ç½®æ–‡ä»¶ä¸­è¢«æåŠ

### 2. æ•°æ®æ ¼å¼é™·é˜±ï¼š
1. **ä¸œæ–¹è´¢å¯Œå­—æ®µé¡ºåºé™·é˜±**: `[open, close, high, low]` â‰  æ ‡å‡†OHLC
2. **è…¾è®¯è´¢ç»æœ¯è¯­å·®å¼‚**: ä½¿ç”¨"çŽ°ä»·"è€Œéž"æ”¶ç›˜ä»·"
3. **æ–°æµªè´¢ç»ç¼ºå¤±å­—æ®µ**: Kçº¿æ•°æ®ä¸åŒ…å«æˆäº¤é¢
4. **æ•°æ®ç±»åž‹ä¸ç»Ÿä¸€**: æˆäº¤é‡å­—æ®µåœ¨ä¸åŒæ•°æ®æºä¸­ç±»åž‹ä¸åŒ

### 3. é—æ¼çš„å…³é”®ä¿¡æ¯ï¼š
- **ç½‘æ˜“è´¢ç»**: é¡¹ç›®ä¸­æœ‰æåŠä½†æœªæ‰¾åˆ°å®Œæ•´å®žçŽ°
- **Wind/Bloomberg**: åœ¨å¢žå¼ºæ¨¡åž‹ä¸­æœ‰å¯¹æ ‡è®¾è®¡
- **å¤æƒæ•°æ®å·®å¼‚**: å„æ•°æ®æºå¤æƒç®—æ³•å¯èƒ½ä¸åŒ
- **å¸‚åœºä»£ç å¤„ç†**: ä¸åŒæ•°æ®æºå¯¹è‚¡ç¥¨ä»£ç çš„å‰ç¼€å¤„ç†ä¸ä¸€è‡´

## æ•°æ®ä¸€è‡´æ€§é—®é¢˜

### 1. åŒä¸€è‚¡ç¥¨ä¸åŒæ•°æ®æºçš„æ½œåœ¨å·®å¼‚ï¼š

1. **å¤æƒå¤„ç†å·®å¼‚**: ä¸åŒæ•°æ®æºå¯èƒ½é‡‡ç”¨ä¸åŒçš„å¤æƒç®—æ³•
2. **æ•°æ®æ¸…æ´—æ ‡å‡†**: AKShareç­‰å¯èƒ½å¯¹å¼‚å¸¸æ•°æ®è¿›è¡Œè¿‡æ»¤  
3. **æ—¶é—´æˆ³å·®å¼‚**: ä¸åŒæ•°æ®æºçš„æ—¶é—´æˆ³å¯èƒ½å­˜åœ¨å¾®å°å·®å¼‚
4. **ç²¾åº¦å·®å¼‚**: ä»·æ ¼æ•°æ®çš„å°æ•°ä½æ•°å¯èƒ½ä¸åŒ
5. **å­—æ®µè¯­ä¹‰å·®å¼‚**: å¦‚è…¾è®¯çš„"çŽ°ä»·" vs å…¶ä»–çš„"æ”¶ç›˜ä»·"
6. **å¸‚åœºä»£ç æ ‡å‡†**: sh/szå‰ç¼€å¤„ç†æ–¹å¼ä¸ç»Ÿä¸€

### 2. å®žé™…æµ‹è¯•å»ºè®®ï¼š

```python
# å»ºè®®çš„æ•°æ®ä¸€è‡´æ€§æµ‹è¯•ä»£ç 
def compare_data_sources(symbol, date_range):
    tdx_data = tongdaxin_plugin.get_kline_data(symbol, 'daily', start_date, end_date)
    em_data = eastmoney_plugin.get_kline_data(symbol, 'daily', start_date, end_date)
    ak_data = akshare_plugin.get_kdata(symbol, 'D', start_date, end_date)
    
    # å¯¹æ¯”ç›¸åŒæ—¥æœŸçš„æ•°æ®å·®å¼‚
    comparison_result = {
        'price_diff': abs(tdx_data['close'] - em_data['close']),
        'volume_diff': abs(tdx_data['volume'] - em_data['volume']),
        'correlation': tdx_data['close'].corr(em_data['close'])
    }
    return comparison_result
```

## æ ‡å‡†åŒ–å¤„ç†å»ºè®®

### 1. ç»Ÿä¸€æ•°æ®æ ¼å¼ï¼š
```python
STANDARD_COLUMNS = ['datetime', 'open', 'high', 'low', 'close', 'volume', 'amount']
STANDARD_DTYPES = {
    'open': 'float64',
    'high': 'float64', 
    'low': 'float64',
    'close': 'float64',
    'volume': 'int64',
    'amount': 'float64'
}
```

### 2. æ•°æ®éªŒè¯è§„åˆ™ï¼š
- ä»·æ ¼æ•°æ®: `high >= max(open, close)` ä¸” `low <= min(open, close)`
- æˆäº¤é‡: éžè´Ÿæ•°
- æ—¶é—´åºåˆ—: è¿žç»­ä¸”æ— é‡å¤

## ç»“è®º

1. **æ ¼å¼å·®å¼‚æ˜¾è‘—**: ä¸åŒæ•°æ®æºçš„å­—æ®µé¡ºåºã€å‘½åã€ç±»åž‹éƒ½å­˜åœ¨å·®å¼‚
2. **éœ€è¦æ ‡å‡†åŒ–**: å¿…é¡»å®žçŽ°ç»Ÿä¸€çš„æ•°æ®æ ‡å‡†åŒ–å¤„ç†å±‚
3. **è´¨é‡å‚å·®ä¸é½**: é€šè¾¾ä¿¡æ•°æ®è´¨é‡æœ€é«˜ï¼ŒAKShareç»è¿‡å¤„ç†ä½†å¯èƒ½æœ‰å»¶è¿Ÿ
4. **äº’è¡¥æ€§å¼º**: ä¸åŒæ•°æ®æºå¯ä»¥ä½œä¸ºäº’ç›¸éªŒè¯å’Œè¡¥å……çš„æ‰‹æ®µ

**å»ºè®®**: åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥å®žçŽ°ä¸€ä¸ªæ•°æ®æ ‡å‡†åŒ–ä¸­é—´å±‚ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®æºè¾“å‡ºæ ¼å¼ä¸€è‡´ï¼Œå¹¶å»ºç«‹æ•°æ®è´¨é‡ç›‘æŽ§æœºåˆ¶ã€‚
