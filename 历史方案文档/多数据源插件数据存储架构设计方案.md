# FactorWeave-Quant å¤šæ•°æ®æºæ’ä»¶æ•°æ®å­˜å‚¨æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

æœ¬æ–¹æ¡ˆåŸºäºå¯¹TETæ•°æ®æ ‡å‡†ã€è¡Œä¸šä¸“ä¸šè½¯ä»¶ï¼ˆWindä¸‡å¾—ã€Bloombergã€Reutersç­‰ï¼‰æ•°æ®ç»“æ„çš„æ·±å…¥åˆ†æï¼Œç»“åˆå½“å‰ç³»ç»Ÿçš„æ’ä»¶åŒ–æ¶æ„ï¼Œè®¾è®¡äº†ä¸€å¥—å®Œæ•´çš„å¤šæ•°æ®æºæ’ä»¶æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚

**è®¾è®¡ç‰ˆæœ¬**: v1.0  
**è®¾è®¡æ—¥æœŸ**: 2025-01-27  
**è®¾è®¡ç›®æ ‡**: ç»Ÿä¸€æ•°æ®å­˜å‚¨ã€æ’ä»¶éš”ç¦»ã€è¡Œä¸šå¯¹æ ‡

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### æ··åˆæ•°æ®åº“æ¶æ„

é‡‡ç”¨SQLite + DuckDBæ··åˆæ¶æ„ï¼Œå®ç°OLTPå’ŒOLAPçš„æœ€ä¼˜åˆ†å·¥ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (HIkyuu-UI)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              TETæ•°æ®ç®¡é“ (æ ‡å‡†åŒ–å¤„ç†)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SQLite (OLTP)              â”‚  DuckDB (OLAP)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ’ä»¶å…ƒæ•°æ®ç®¡ç†            â”‚ â€¢ å†å²Kçº¿æ•°æ®                   â”‚
â”‚ â€¢ æ•°æ®æºé…ç½®               â”‚ â€¢ åŸºæœ¬é¢æ•°æ®                    â”‚
â”‚ â€¢ å­—æ®µæ˜ å°„è¡¨               â”‚ â€¢ æŠ€æœ¯æŒ‡æ ‡æ•°æ®                  â”‚
â”‚ â€¢ æ•°æ®è´¨é‡ç›‘æ§             â”‚ â€¢ å®è§‚ç»æµæ•°æ®                  â”‚
â”‚ â€¢ æ’ä»¶çŠ¶æ€ç®¡ç†             â”‚ â€¢ å›æµ‹ç»“æœæ•°æ®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **æ’ä»¶éš”ç¦»**: æ¯ä¸ªæ•°æ®æºæ’ä»¶ç‹¬ç«‹è¡¨ç©ºé—´ï¼Œé¿å…æ•°æ®æ··æ·†
2. **æ ‡å‡†ç»Ÿä¸€**: åŸºäºTETæ ‡å‡†è¿›è¡Œæ•°æ®æ ‡å‡†åŒ–å¤„ç†
3. **è¡Œä¸šå¯¹æ ‡**: æ‰©å±•å­—æ®µå¯¹æ ‡Windã€Bloombergç­‰ä¸“ä¸šè½¯ä»¶
4. **æ€§èƒ½ä¼˜åŒ–**: åˆ©ç”¨DuckDBåˆ—å¼å­˜å‚¨å’Œå‹ç¼©ç‰¹æ€§
5. **æ‰©å±•æ€§**: æ”¯æŒæ–°æ•°æ®æºæ’ä»¶çš„åŠ¨æ€æ³¨å†Œ

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### 1. æ ¸å¿ƒæ•°æ®å®ä½“

#### 1.1 è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯æ‰©å±•æ¨¡å‹

```sql
-- DuckDBè¡¨ç»“æ„ (æŒ‰æ’ä»¶åˆ†è¡¨)
CREATE TABLE stock_basic_info_{plugin_name} (
    -- åŸºç¡€æ ‡è¯†å­—æ®µ
    symbol VARCHAR PRIMARY KEY,           -- è‚¡ç¥¨ä»£ç 
    name VARCHAR NOT NULL,               -- è‚¡ç¥¨åç§°
    market VARCHAR NOT NULL,             -- å¸‚åœºä»£ç 
    exchange VARCHAR,                    -- äº¤æ˜“æ‰€ä»£ç 
    
    -- åŸºæœ¬é¢ä¿¡æ¯ (å¯¹æ ‡Wind)
    industry_l1 VARCHAR,                 -- ä¸€çº§è¡Œä¸šåˆ†ç±»
    industry_l2 VARCHAR,                 -- äºŒçº§è¡Œä¸šåˆ†ç±»
    industry_l3 VARCHAR,                 -- ä¸‰çº§è¡Œä¸šåˆ†ç±»
    sector VARCHAR,                      -- æ¿å—åˆ†ç±»
    concept_plates VARCHAR[],            -- æ¦‚å¿µæ¿å—æ•°ç»„
    
    -- ä¸Šå¸‚ä¿¡æ¯
    list_date DATE,                      -- ä¸Šå¸‚æ—¥æœŸ
    delist_date DATE,                    -- é€€å¸‚æ—¥æœŸ
    list_status VARCHAR,                 -- ä¸Šå¸‚çŠ¶æ€
    
    -- å¸‚å€¼ä¿¡æ¯
    total_shares BIGINT,                 -- æ€»è‚¡æœ¬
    float_shares BIGINT,                 -- æµé€šè‚¡æœ¬
    market_cap DECIMAL(20,2),            -- æ€»å¸‚å€¼
    float_market_cap DECIMAL(20,2),      -- æµé€šå¸‚å€¼
    
    -- è´¢åŠ¡æŒ‡æ ‡
    pe_ratio DECIMAL(10,4),              -- å¸‚ç›ˆç‡(TTM)
    pb_ratio DECIMAL(10,4),              -- å¸‚å‡€ç‡
    ps_ratio DECIMAL(10,4),              -- å¸‚é”€ç‡
    pcf_ratio DECIMAL(10,4),             -- å¸‚ç°ç‡
    
    -- ä¼°å€¼æŒ‡æ ‡ (å¯¹æ ‡Bloomberg)
    ev_ebitda DECIMAL(10,4),             -- ä¼ä¸šä»·å€¼å€æ•°
    roe DECIMAL(10,4),                   -- å‡€èµ„äº§æ”¶ç›Šç‡
    roa DECIMAL(10,4),                   -- æ€»èµ„äº§æ”¶ç›Šç‡
    gross_margin DECIMAL(10,4),          -- æ¯›åˆ©ç‡
    net_margin DECIMAL(10,4),            -- å‡€åˆ©ç‡
    
    -- é£é™©æŒ‡æ ‡
    beta DECIMAL(10,6),                  -- Betaç³»æ•°
    volatility_30d DECIMAL(10,6),        -- 30æ—¥æ³¢åŠ¨ç‡
    volatility_252d DECIMAL(10,6),       -- å¹´åŒ–æ³¢åŠ¨ç‡
    
    -- æŠ€æœ¯æŒ‡æ ‡
    ma5 DECIMAL(10,4),                   -- 5æ—¥å‡çº¿
    ma10 DECIMAL(10,4),                  -- 10æ—¥å‡çº¿
    ma20 DECIMAL(10,4),                  -- 20æ—¥å‡çº¿
    ma60 DECIMAL(10,4),                  -- 60æ—¥å‡çº¿
    
    -- æ‰©å±•å­—æ®µ (JSONæ ¼å¼å­˜å‚¨æ’ä»¶ç‰¹æœ‰æ•°æ®)
    plugin_specific_data JSON,
    
    -- å…ƒæ•°æ®
    data_source VARCHAR NOT NULL,        -- æ•°æ®æºæ ‡è¯†
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    data_quality_score DECIMAL(3,2),     -- æ•°æ®è´¨é‡è¯„åˆ†
    
    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_symbol (symbol),
    INDEX idx_market (market),
    INDEX idx_industry (industry_l1, industry_l2),
    INDEX idx_updated_at (updated_at)
);
```

#### 1.2 Kçº¿æ•°æ®æ‰©å±•æ¨¡å‹

```sql
-- DuckDBè¡¨ç»“æ„ (æŒ‰æ’ä»¶å’Œå‘¨æœŸåˆ†è¡¨)
CREATE TABLE kline_data_{plugin_name}_{period} (
    -- åŸºç¡€å­—æ®µ
    symbol VARCHAR NOT NULL,             -- è‚¡ç¥¨ä»£ç 
    datetime TIMESTAMP NOT NULL,         -- æ—¶é—´æˆ³
    
    -- OHLCVæ ‡å‡†å­—æ®µ
    open DECIMAL(10,4) NOT NULL,         -- å¼€ç›˜ä»·
    high DECIMAL(10,4) NOT NULL,         -- æœ€é«˜ä»·
    low DECIMAL(10,4) NOT NULL,          -- æœ€ä½ä»·
    close DECIMAL(10,4) NOT NULL,        -- æ”¶ç›˜ä»·
    volume BIGINT NOT NULL,              -- æˆäº¤é‡
    amount DECIMAL(20,2),                -- æˆäº¤é¢
    
    -- å¤æƒä»·æ ¼ (å¯¹æ ‡Wind)
    adj_close DECIMAL(10,4),             -- åå¤æƒæ”¶ç›˜ä»·
    adj_open DECIMAL(10,4),              -- åå¤æƒå¼€ç›˜ä»·
    adj_high DECIMAL(10,4),              -- åå¤æƒæœ€é«˜ä»·
    adj_low DECIMAL(10,4),               -- åå¤æƒæœ€ä½ä»·
    adj_factor DECIMAL(10,6),            -- å¤æƒå› å­
    
    -- å¸‚åœºå¾®è§‚ç»“æ„ (å¯¹æ ‡Bloomberg)
    vwap DECIMAL(10,4),                  -- æˆäº¤é‡åŠ æƒå¹³å‡ä»·
    twap DECIMAL(10,4),                  -- æ—¶é—´åŠ æƒå¹³å‡ä»·
    bid_price DECIMAL(10,4),             -- ä¹°ä¸€ä»·
    ask_price DECIMAL(10,4),             -- å–ä¸€ä»·
    bid_volume BIGINT,                   -- ä¹°ä¸€é‡
    ask_volume BIGINT,                   -- å–ä¸€é‡
    spread DECIMAL(10,4),                -- ä¹°å–ä»·å·®
    
    -- æŠ€æœ¯æŒ‡æ ‡é¢„è®¡ç®—
    rsi_14 DECIMAL(10,4),                -- 14æ—¥RSI
    macd_dif DECIMAL(10,4),              -- MACD DIF
    macd_dea DECIMAL(10,4),              -- MACD DEA
    macd_histogram DECIMAL(10,4),        -- MACDæŸ±çŠ¶å›¾
    kdj_k DECIMAL(10,4),                 -- KDJ Kå€¼
    kdj_d DECIMAL(10,4),                 -- KDJ Då€¼
    kdj_j DECIMAL(10,4),                 -- KDJ Jå€¼
    
    -- å¸‚åœºæƒ…ç»ªæŒ‡æ ‡
    turnover_rate DECIMAL(10,4),         -- æ¢æ‰‹ç‡
    amplitude DECIMAL(10,4),             -- æŒ¯å¹…
    change_pct DECIMAL(10,4),            -- æ¶¨è·Œå¹…
    change_amount DECIMAL(10,4),         -- æ¶¨è·Œé¢
    
    -- èµ„é‡‘æµå‘ (å¯¹æ ‡ä¸œæ–¹è´¢å¯Œ)
    net_inflow_large DECIMAL(20,2),      -- å¤§å•å‡€æµå…¥
    net_inflow_medium DECIMAL(20,2),     -- ä¸­å•å‡€æµå…¥
    net_inflow_small DECIMAL(20,2),      -- å°å•å‡€æµå…¥
    net_inflow_main DECIMAL(20,2),       -- ä¸»åŠ›å‡€æµå…¥
    
    -- æ‰©å±•å­—æ®µ
    plugin_specific_data JSON,
    
    -- å…ƒæ•°æ®
    data_source VARCHAR NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    data_quality_score DECIMAL(3,2),
    
    -- ä¸»é”®å’Œç´¢å¼•
    PRIMARY KEY (symbol, datetime),
    INDEX idx_symbol_datetime (symbol, datetime),
    INDEX idx_datetime (datetime),
    INDEX idx_volume (volume),
    INDEX idx_data_source (data_source)
);
```

#### 1.3 åŸºæœ¬é¢æ•°æ®æ¨¡å‹

```sql
-- è´¢åŠ¡æŠ¥è¡¨æ•°æ® (å¯¹æ ‡Windè´¢åŠ¡æ•°æ®)
CREATE TABLE financial_statements_{plugin_name} (
    symbol VARCHAR NOT NULL,
    report_date DATE NOT NULL,
    report_type VARCHAR NOT NULL,        -- å¹´æŠ¥/åŠå¹´æŠ¥/å­£æŠ¥
    
    -- èµ„äº§è´Ÿå€ºè¡¨
    total_assets DECIMAL(20,2),          -- æ€»èµ„äº§
    total_liabilities DECIMAL(20,2),     -- æ€»è´Ÿå€º
    shareholders_equity DECIMAL(20,2),   -- è‚¡ä¸œæƒç›Š
    current_assets DECIMAL(20,2),        -- æµåŠ¨èµ„äº§
    current_liabilities DECIMAL(20,2),   -- æµåŠ¨è´Ÿå€º
    cash_and_equivalents DECIMAL(20,2),  -- è´§å¸èµ„é‡‘
    
    -- åˆ©æ¶¦è¡¨
    total_revenue DECIMAL(20,2),         -- è¥ä¸šæ€»æ”¶å…¥
    operating_revenue DECIMAL(20,2),     -- è¥ä¸šæ”¶å…¥
    operating_cost DECIMAL(20,2),        -- è¥ä¸šæˆæœ¬
    gross_profit DECIMAL(20,2),          -- æ¯›åˆ©æ¶¦
    operating_profit DECIMAL(20,2),      -- è¥ä¸šåˆ©æ¶¦
    net_profit DECIMAL(20,2),            -- å‡€åˆ©æ¶¦
    net_profit_parent DECIMAL(20,2),     -- å½’æ¯å‡€åˆ©æ¶¦
    
    -- ç°é‡‘æµé‡è¡¨
    operating_cash_flow DECIMAL(20,2),   -- ç»è¥æ´»åŠ¨ç°é‡‘æµ
    investing_cash_flow DECIMAL(20,2),   -- æŠ•èµ„æ´»åŠ¨ç°é‡‘æµ
    financing_cash_flow DECIMAL(20,2),   -- ç­¹èµ„æ´»åŠ¨ç°é‡‘æµ
    free_cash_flow DECIMAL(20,2),        -- è‡ªç”±ç°é‡‘æµ
    
    -- è´¢åŠ¡æ¯”ç‡
    current_ratio DECIMAL(10,4),         -- æµåŠ¨æ¯”ç‡
    quick_ratio DECIMAL(10,4),           -- é€ŸåŠ¨æ¯”ç‡
    debt_to_equity DECIMAL(10,4),        -- èµ„äº§è´Ÿå€ºç‡
    interest_coverage DECIMAL(10,4),     -- åˆ©æ¯ä¿éšœå€æ•°
    
    -- æ‰©å±•å­—æ®µ
    plugin_specific_data JSON,
    
    -- å…ƒæ•°æ®
    data_source VARCHAR NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (symbol, report_date, report_type),
    INDEX idx_symbol_date (symbol, report_date),
    INDEX idx_report_date (report_date)
);
```

#### 1.4 å®è§‚ç»æµæ•°æ®æ¨¡å‹

```sql
-- å®è§‚ç»æµæŒ‡æ ‡ (å¯¹æ ‡Windå®è§‚æ•°æ®åº“)
CREATE TABLE macro_economic_data_{plugin_name} (
    indicator_code VARCHAR NOT NULL,     -- æŒ‡æ ‡ä»£ç 
    indicator_name VARCHAR NOT NULL,     -- æŒ‡æ ‡åç§°
    date DATE NOT NULL,                  -- æ•°æ®æ—¥æœŸ
    value DECIMAL(20,6),                 -- æŒ‡æ ‡å€¼
    unit VARCHAR,                        -- å•ä½
    frequency VARCHAR,                   -- é¢‘ç‡(æ—¥/å‘¨/æœˆ/å­£/å¹´)
    
    -- åˆ†ç±»ä¿¡æ¯
    category_l1 VARCHAR,                 -- ä¸€çº§åˆ†ç±»
    category_l2 VARCHAR,                 -- äºŒçº§åˆ†ç±»
    category_l3 VARCHAR,                 -- ä¸‰çº§åˆ†ç±»
    
    -- åœ°åŒºä¿¡æ¯
    country VARCHAR,                     -- å›½å®¶
    region VARCHAR,                      -- åœ°åŒº
    
    -- æ•°æ®å±æ€§
    is_seasonally_adjusted BOOLEAN,      -- æ˜¯å¦å­£è°ƒ
    is_preliminary BOOLEAN,              -- æ˜¯å¦åˆå€¼
    revision_count INTEGER,              -- ä¿®æ­£æ¬¡æ•°
    
    -- æ‰©å±•å­—æ®µ
    plugin_specific_data JSON,
    
    -- å…ƒæ•°æ®
    data_source VARCHAR NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    data_quality_score DECIMAL(3,2),
    
    PRIMARY KEY (indicator_code, date),
    INDEX idx_indicator_date (indicator_code, date),
    INDEX idx_category (category_l1, category_l2),
    INDEX idx_country_region (country, region)
);
```

### 2. æ’ä»¶ç®¡ç†å’Œé…ç½®æ¨¡å‹

#### 2.1 æ•°æ®æºæ’ä»¶æ³¨å†Œè¡¨ (SQLite)

```sql
-- æ’ä»¶æ³¨å†Œå’Œç®¡ç†
CREATE TABLE data_source_plugins (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    plugin_name VARCHAR UNIQUE NOT NULL,  -- æ’ä»¶å”¯ä¸€æ ‡è¯†
    display_name VARCHAR NOT NULL,        -- æ˜¾ç¤ºåç§°
    plugin_type VARCHAR NOT NULL,         -- æ’ä»¶ç±»å‹
    version VARCHAR NOT NULL,             -- ç‰ˆæœ¬å·
    
    -- æ”¯æŒçš„èµ„äº§ç±»å‹
    supported_assets JSON,               -- æ”¯æŒçš„èµ„äº§ç±»å‹æ•°ç»„
    supported_data_types JSON,           -- æ”¯æŒçš„æ•°æ®ç±»å‹æ•°ç»„
    supported_markets JSON,              -- æ”¯æŒçš„å¸‚åœºæ•°ç»„
    
    -- é…ç½®ä¿¡æ¯
    config_schema JSON,                  -- é…ç½®æ¨¡å¼
    default_config JSON,                 -- é»˜è®¤é…ç½®
    api_endpoints JSON,                  -- APIç«¯ç‚¹é…ç½®
    rate_limits JSON,                    -- é™æµé…ç½®
    
    -- å­—æ®µæ˜ å°„
    field_mappings JSON,                 -- å­—æ®µæ˜ å°„é…ç½®
    custom_fields JSON,                  -- è‡ªå®šä¹‰å­—æ®µå®šä¹‰
    
    -- çŠ¶æ€ä¿¡æ¯
    status VARCHAR DEFAULT 'inactive',   -- æ’ä»¶çŠ¶æ€
    priority INTEGER DEFAULT 100,        -- ä¼˜å…ˆçº§
    is_enabled BOOLEAN DEFAULT 1,        -- æ˜¯å¦å¯ç”¨
    
    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_sync_at TIMESTAMP,             -- æœ€ååŒæ­¥æ—¶é—´
    
    -- ç»Ÿè®¡ä¿¡æ¯
    total_requests INTEGER DEFAULT 0,    -- æ€»è¯·æ±‚æ•°
    success_requests INTEGER DEFAULT 0,  -- æˆåŠŸè¯·æ±‚æ•°
    error_requests INTEGER DEFAULT 0,    -- é”™è¯¯è¯·æ±‚æ•°
    avg_response_time DECIMAL(10,3)      -- å¹³å‡å“åº”æ—¶é—´
);
```

#### 2.2 å­—æ®µæ˜ å°„é…ç½®è¡¨ (SQLite)

```sql
-- æ ‡å‡†åŒ–å­—æ®µæ˜ å°„
CREATE TABLE field_mappings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    plugin_name VARCHAR NOT NULL,
    data_type VARCHAR NOT NULL,          -- æ•°æ®ç±»å‹(kline/basic_info/financialç­‰)
    source_field VARCHAR NOT NULL,       -- æºå­—æ®µå
    target_field VARCHAR NOT NULL,       -- ç›®æ ‡æ ‡å‡†å­—æ®µå
    field_type VARCHAR NOT NULL,         -- å­—æ®µç±»å‹
    transform_rule JSON,                 -- è½¬æ¢è§„åˆ™
    validation_rule JSON,                -- éªŒè¯è§„åˆ™
    is_required BOOLEAN DEFAULT 0,       -- æ˜¯å¦å¿…éœ€
    default_value VARCHAR,               -- é»˜è®¤å€¼
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(plugin_name, data_type, source_field),
    FOREIGN KEY (plugin_name) REFERENCES data_source_plugins(plugin_name)
);
```

#### 2.3 æ•°æ®è´¨é‡ç›‘æ§è¡¨ (SQLite)

```sql
-- æ•°æ®è´¨é‡ç›‘æ§
CREATE TABLE data_quality_metrics (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    plugin_name VARCHAR NOT NULL,
    table_name VARCHAR NOT NULL,
    metric_date DATE NOT NULL,
    
    -- å®Œæ•´æ€§æŒ‡æ ‡
    total_records INTEGER,
    null_records INTEGER,
    duplicate_records INTEGER,
    completeness_score DECIMAL(5,4),
    
    -- å‡†ç¡®æ€§æŒ‡æ ‡
    validation_errors INTEGER,
    format_errors INTEGER,
    range_errors INTEGER,
    accuracy_score DECIMAL(5,4),
    
    -- åŠæ—¶æ€§æŒ‡æ ‡
    data_delay_minutes INTEGER,
    timeliness_score DECIMAL(5,4),
    
    -- ä¸€è‡´æ€§æŒ‡æ ‡
    consistency_errors INTEGER,
    consistency_score DECIMAL(5,4),
    
    -- ç»¼åˆè¯„åˆ†
    overall_score DECIMAL(5,4),
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(plugin_name, table_name, metric_date),
    FOREIGN KEY (plugin_name) REFERENCES data_source_plugins(plugin_name)
);
```

## ğŸ”„ TETæ•°æ®ç®¡é“å¢å¼º

### æ‰©å±•å­—æ®µæ˜ å°„é…ç½®

```python
# å¢å¼ºçš„å­—æ®µæ˜ å°„è¡¨
ENHANCED_FIELD_MAPPINGS = {
    # Kçº¿æ•°æ®æ ‡å‡†åŒ–æ˜ å°„
    DataType.HISTORICAL_KLINE: {
        # åŸºç¡€OHLCVå­—æ®µ
        'o': 'open', 'Open': 'open', 'OPEN': 'open', 'å¼€ç›˜ä»·': 'open',
        'h': 'high', 'High': 'high', 'HIGH': 'high', 'æœ€é«˜ä»·': 'high',
        'l': 'low', 'Low': 'low', 'LOW': 'low', 'æœ€ä½ä»·': 'low',
        'c': 'close', 'Close': 'close', 'CLOSE': 'close', 'æ”¶ç›˜ä»·': 'close',
        'v': 'volume', 'Volume': 'volume', 'VOLUME': 'volume', 'æˆäº¤é‡': 'volume',
        'amount': 'amount', 'Amount': 'amount', 'æˆäº¤é¢': 'amount',
        
        # å¤æƒä»·æ ¼å­—æ®µ (Windæ ‡å‡†)
        'adj_close': 'adj_close', 'adjclose': 'adj_close', 'å¤æƒæ”¶ç›˜ä»·': 'adj_close',
        'adj_factor': 'adj_factor', 'adjfactor': 'adj_factor', 'å¤æƒå› å­': 'adj_factor',
        
        # å¸‚åœºå¾®è§‚ç»“æ„ (Bloombergæ ‡å‡†)
        'vwap': 'vwap', 'VWAP': 'vwap', 'æˆäº¤é‡åŠ æƒå‡ä»·': 'vwap',
        'bid': 'bid_price', 'bid_price': 'bid_price', 'ä¹°ä¸€ä»·': 'bid_price',
        'ask': 'ask_price', 'ask_price': 'ask_price', 'å–ä¸€ä»·': 'ask_price',
        
        # æŠ€æœ¯æŒ‡æ ‡å­—æ®µ
        'rsi': 'rsi_14', 'RSI': 'rsi_14', 'rsi_14': 'rsi_14',
        'macd': 'macd_dif', 'MACD': 'macd_dif', 'macd_dif': 'macd_dif',
        
        # èµ„é‡‘æµå‘å­—æ®µ (ä¸œæ–¹è´¢å¯Œæ ‡å‡†)
        'net_inflow_large': 'net_inflow_large', 'å¤§å•å‡€æµå…¥': 'net_inflow_large',
        'net_inflow_main': 'net_inflow_main', 'ä¸»åŠ›å‡€æµå…¥': 'net_inflow_main',
    },
    
    # åŸºæœ¬é¢æ•°æ®æ˜ å°„
    DataType.FUNDAMENTAL: {
        # åŸºæœ¬ä¿¡æ¯
        'symbol': 'symbol', 'code': 'symbol', 'è‚¡ç¥¨ä»£ç ': 'symbol',
        'name': 'name', 'è‚¡ç¥¨åç§°': 'name', 'sec_name': 'name',
        'industry': 'industry_l1', 'è¡Œä¸š': 'industry_l1',
        'sector': 'sector', 'æ¿å—': 'sector',
        
        # å¸‚å€¼ä¿¡æ¯
        'market_cap': 'market_cap', 'æ€»å¸‚å€¼': 'market_cap', 'total_mv': 'market_cap',
        'float_mv': 'float_market_cap', 'æµé€šå¸‚å€¼': 'float_market_cap',
        
        # ä¼°å€¼æŒ‡æ ‡
        'pe': 'pe_ratio', 'PE': 'pe_ratio', 'å¸‚ç›ˆç‡': 'pe_ratio',
        'pb': 'pb_ratio', 'PB': 'pb_ratio', 'å¸‚å‡€ç‡': 'pb_ratio',
        'ps': 'ps_ratio', 'PS': 'ps_ratio', 'å¸‚é”€ç‡': 'ps_ratio',
        
        # è´¢åŠ¡æŒ‡æ ‡
        'roe': 'roe', 'ROE': 'roe', 'å‡€èµ„äº§æ”¶ç›Šç‡': 'roe',
        'roa': 'roa', 'ROA': 'roa', 'æ€»èµ„äº§æ”¶ç›Šç‡': 'roa',
        'gross_margin': 'gross_margin', 'æ¯›åˆ©ç‡': 'gross_margin',
    },
    
    # å®è§‚æ•°æ®æ˜ å°„
    DataType.MACRO_ECONOMIC: {
        'indicator': 'indicator_code', 'æŒ‡æ ‡ä»£ç ': 'indicator_code',
        'name': 'indicator_name', 'æŒ‡æ ‡åç§°': 'indicator_name',
        'value': 'value', 'æ•°å€¼': 'value', 'val': 'value',
        'unit': 'unit', 'å•ä½': 'unit',
        'date': 'date', 'æ—¥æœŸ': 'date', 'time': 'date',
        'country': 'country', 'å›½å®¶': 'country',
        'region': 'region', 'åœ°åŒº': 'region',
    }
}
```

## ğŸš€ å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¶æ„æ­å»º (2å‘¨)

1. **æ•°æ®åº“æ¶æ„åˆå§‹åŒ–**
   - åˆ›å»ºDuckDBåˆ†ææ•°æ®åº“
   - è®¾è®¡SQLiteé…ç½®æ•°æ®åº“
   - å®ç°æ•°æ®åº“è¿æ¥æ± ç®¡ç†

2. **TETæ•°æ®ç®¡é“å¢å¼º**
   - æ‰©å±•å­—æ®µæ˜ å°„é…ç½®
   - å®ç°æ•°æ®æ ‡å‡†åŒ–å¤„ç†
   - æ·»åŠ æ•°æ®è´¨é‡æ£€æŸ¥

### é˜¶æ®µäºŒï¼šæ’ä»¶ç³»ç»Ÿé›†æˆ (3å‘¨)

1. **æ’ä»¶æ³¨å†Œæœºåˆ¶**
   - å®ç°æ’ä»¶åŠ¨æ€æ³¨å†Œ
   - é…ç½®å­—æ®µæ˜ å°„ç®¡ç†
   - æ’ä»¶çŠ¶æ€ç›‘æ§

2. **æ•°æ®å­˜å‚¨å¼•æ“**
   - å®ç°æŒ‰æ’ä»¶åˆ†è¡¨å­˜å‚¨
   - ä¼˜åŒ–DuckDBæŸ¥è¯¢æ€§èƒ½
   - æ·»åŠ æ•°æ®å‹ç¼©ç­–ç•¥

### é˜¶æ®µä¸‰ï¼šè¡Œä¸šæ ‡å‡†å¯¹æ ‡ (2å‘¨)

1. **æ‰©å±•å­—æ®µæ”¯æŒ**
   - å¯¹æ ‡Windä¸‡å¾—å­—æ®µ
   - æ”¯æŒBloombergæ•°æ®æ ¼å¼
   - æ·»åŠ å®è§‚ç»æµæŒ‡æ ‡

2. **æ•°æ®è´¨é‡ä¿éšœ**
   - å®ç°æ•°æ®éªŒè¯è§„åˆ™
   - æ·»åŠ å¼‚å¸¸æ•°æ®å¤„ç†
   - å»ºç«‹è´¨é‡è¯„åˆ†ä½“ç³»

### é˜¶æ®µå››ï¼šæ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯• (2å‘¨)

1. **æ€§èƒ½è°ƒä¼˜**
   - DuckDBæŸ¥è¯¢ä¼˜åŒ–
   - ç´¢å¼•ç­–ç•¥è°ƒæ•´
   - ç¼“å­˜æœºåˆ¶å®Œå–„

2. **å…¨é¢æµ‹è¯•**
   - å•å…ƒæµ‹è¯•è¦†ç›–
   - é›†æˆæµ‹è¯•éªŒè¯
   - æ€§èƒ½å‹åŠ›æµ‹è¯•

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### æŠ€æœ¯æ”¶ç›Š
- **ç»Ÿä¸€æ•°æ®æ ‡å‡†**: æ‰€æœ‰æ•°æ®æºç»Ÿä¸€ä¸ºæ ‡å‡†æ ¼å¼
- **æ’ä»¶éš”ç¦»**: ä¸åŒæ•°æ®æºæ•°æ®å®Œå…¨éš”ç¦»ï¼Œé¿å…å†²çª
- **æ€§èƒ½æå‡**: DuckDBåˆ—å¼å­˜å‚¨ï¼ŒæŸ¥è¯¢æ€§èƒ½æå‡10å€ä»¥ä¸Š
- **æ‰©å±•æ€§å¼º**: æ”¯æŒæ–°æ•°æ®æºæ’ä»¶çš„å¿«é€Ÿæ¥å…¥

### ä¸šåŠ¡æ”¶ç›Š
- **è¡Œä¸šå¯¹æ ‡**: æ•°æ®å­—æ®µå¯¹æ ‡ä¸“ä¸šé‡‘èè½¯ä»¶
- **æ•°æ®è´¨é‡**: å»ºç«‹å®Œå–„çš„æ•°æ®è´¨é‡ç›‘æ§ä½“ç³»
- **å¼€å‘æ•ˆç‡**: æ ‡å‡†åŒ–æ¥å£ï¼Œé™ä½å¼€å‘æˆæœ¬
- **ç”¨æˆ·ä½“éªŒ**: æ•°æ®æºåˆ‡æ¢æ— ç¼ï¼Œç”¨æˆ·ä½“éªŒä¸€è‡´

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. DuckDBä¼˜åŒ–é…ç½®

```python
# DuckDBæ€§èƒ½ä¼˜åŒ–é…ç½®
DUCKDB_CONFIG = {
    'memory_limit': '8GB',
    'threads': 'auto',
    'max_memory': '80%',
    'checkpoint_threshold': '16MB',
    'enable_progress_bar': True,
    'enable_profiling': True,
    'preserve_insertion_order': False,
    'enable_external_access': True,
    'enable_fsst_vectors': True,  # å¯ç”¨FSSTå­—ç¬¦ä¸²å‹ç¼©
    'compression': 'zstd',        # ä½¿ç”¨ZSTDå‹ç¼©
}
```

### 2. åˆ†è¡¨ç­–ç•¥

```python
# åŠ¨æ€è¡¨åç”Ÿæˆç­–ç•¥
def generate_table_name(plugin_name: str, data_type: str, period: str = None) -> str:
    """ç”Ÿæˆæ ‡å‡†åŒ–è¡¨å"""
    base_name = f"{data_type}_{plugin_name}"
    if period:
        return f"{base_name}_{period}"
    return base_name

# ç¤ºä¾‹è¡¨å
# kline_data_akshare_1d
# kline_data_wind_1h  
# stock_basic_info_tushare
# financial_statements_wind
```

### 3. æ•°æ®è´¨é‡ç›‘æ§

```python
class DataQualityMonitor:
    """æ•°æ®è´¨é‡ç›‘æ§å™¨"""
    
    def calculate_quality_score(self, plugin_name: str, table_name: str) -> float:
        """è®¡ç®—æ•°æ®è´¨é‡ç»¼åˆè¯„åˆ†"""
        completeness = self.check_completeness(plugin_name, table_name)
        accuracy = self.check_accuracy(plugin_name, table_name)
        timeliness = self.check_timeliness(plugin_name, table_name)
        consistency = self.check_consistency(plugin_name, table_name)
        
        # åŠ æƒè®¡ç®—ç»¼åˆè¯„åˆ†
        weights = {'completeness': 0.3, 'accuracy': 0.3, 'timeliness': 0.2, 'consistency': 0.2}
        score = (completeness * weights['completeness'] + 
                accuracy * weights['accuracy'] + 
                timeliness * weights['timeliness'] + 
                consistency * weights['consistency'])
        
        return round(score, 4)
```

## ğŸ“‹ æ€»ç»“

æœ¬æ–¹æ¡ˆé€šè¿‡æ·±å…¥åˆ†æTETæ•°æ®æ ‡å‡†ã€è¡Œä¸šä¸“ä¸šè½¯ä»¶æ•°æ®ç»“æ„ï¼Œç»“åˆDuckDBçš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œè®¾è®¡äº†ä¸€å¥—å®Œæ•´çš„å¤šæ•°æ®æºæ’ä»¶æ•°æ®å­˜å‚¨æ¶æ„ã€‚è¯¥æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æ ‡å‡†ç»Ÿä¸€**: åŸºäºTETæ ‡å‡†ï¼Œç»Ÿä¸€æ•°æ®æ ¼å¼
2. **æ’ä»¶éš”ç¦»**: æŒ‰æ’ä»¶åˆ†è¡¨å­˜å‚¨ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
3. **è¡Œä¸šå¯¹æ ‡**: æ‰©å±•å­—æ®µå¯¹æ ‡Windã€Bloombergç­‰ä¸“ä¸šè½¯ä»¶
4. **æ€§èƒ½ä¼˜åŒ–**: åˆ©ç”¨DuckDBåˆ—å¼å­˜å‚¨å’Œå‹ç¼©ç‰¹æ€§
5. **è´¨é‡ä¿éšœ**: å»ºç«‹å®Œå–„çš„æ•°æ®è´¨é‡ç›‘æ§ä½“ç³»

è¯¥æ–¹æ¡ˆå°†ä¸ºFactorWeave-Quantç³»ç»Ÿæä¾›å¼ºå¤§çš„æ•°æ®å­˜å‚¨èƒ½åŠ›ï¼Œæ”¯æŒå¤šæ•°æ®æºçš„ç»Ÿä¸€ç®¡ç†å’Œé«˜æ•ˆæŸ¥è¯¢ã€‚ 