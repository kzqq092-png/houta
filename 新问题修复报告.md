# æ–°é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ¯ é—®é¢˜æ¦‚è¿°

ç”¨æˆ·æŠ¥å‘Šäº†ä¸¤ä¸ªæ–°çš„é—®é¢˜ï¼š
1. **è‡ªåŠ¨è°ƒä¼˜æ•°æ®æ›´æ–°é”™è¯¯**: `'>' not supported between instances of 'str' and 'int'`
2. **å¥åº·æ£€æŸ¥æ²¡æœ‰ç»“æœ**: å¥åº·æ£€æŸ¥ä¸€ç›´æ²¡æœ‰æ˜¾ç¤ºç»“æœ

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. è‡ªåŠ¨è°ƒä¼˜æ•°æ®æ›´æ–°é”™è¯¯ä¿®å¤

#### ğŸ” é—®é¢˜åˆ†æ
**é”™è¯¯ä½ç½®**: `gui/widgets/performance/tabs/auto_tuning_tab.py` ç¬¬73è¡Œ
**é”™è¯¯åŸå› **: åœ¨æ¯”è¾ƒæ“ä½œä¸­ï¼Œ`value` å¯èƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†ä»£ç ç›´æ¥ä¸æ•°å­—è¿›è¡Œæ¯”è¾ƒ

**åŸå§‹ä»£ç **:
```python
trend = "up" if value > 70 else "neutral" if value > 40 else "down"
```

#### âœ… ä¿®å¤æ–¹æ¡ˆ
**ä¿®å¤ç­–ç•¥**: æ·»åŠ ç±»å‹æ£€æŸ¥å’Œè½¬æ¢ï¼Œç¡®ä¿æ‰€æœ‰å€¼éƒ½æ˜¯æ•°å­—ç±»å‹

**ä¿®å¤åä»£ç **:
```python
def update_data(self, tuning_metrics: Dict[str, float]):
    """æ›´æ–°è‡ªåŠ¨è°ƒä¼˜æ•°æ®"""
    try:
        for name, value in tuning_metrics.items():
            if name in self.cards:
                # ğŸ”§ ä¿®å¤ï¼šç¡®ä¿valueæ˜¯æ•°å­—ç±»å‹ï¼Œå¤„ç†å­—ç¬¦ä¸²å’Œéæ•°å­—å€¼
                try:
                    # å°è¯•è½¬æ¢ä¸ºæµ®ç‚¹æ•°
                    if isinstance(value, str):
                        # å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•è½¬æ¢
                        if value.lower() in ['nan', 'none', '', 'null']:
                            numeric_value = 0.0
                        else:
                            numeric_value = float(value)
                    else:
                        numeric_value = float(value) if value is not None else 0.0
                except (ValueError, TypeError):
                    # å¦‚æœè½¬æ¢å¤±è´¥ï¼Œè®¾ä¸º0
                    numeric_value = 0.0
                    logger.warning(f"è°ƒä¼˜æŒ‡æ ‡ '{name}' çš„å€¼ '{value}' æ— æ³•è½¬æ¢ä¸ºæ•°å­—ï¼Œè®¾ä¸º0")
                
                # å¦‚æœå€¼ä¸º0ï¼Œæ˜¾ç¤º"æš‚æ— æ•°æ®"
                if numeric_value == 0:
                    self.cards[name].update_value("æš‚æ— æ•°æ®", "neutral")
                else:
                    # å¤§éƒ¨åˆ†è°ƒä¼˜æŒ‡æ ‡ï¼Œæ•°å€¼è¶Šé«˜è¶Šå¥½
                    trend = "up" if numeric_value > 70 else "neutral" if numeric_value > 40 else "down"
                    # å¯¹äºè¿­ä»£æ¬¡æ•°ï¼Œæ˜¾ç¤ºä¸ºæ•´æ•°
                    if name == "è¿­ä»£æ¬¡æ•°":
                        self.cards[name].update_value(f"{int(numeric_value)}", trend)
                    else:
                        self.cards[name].update_value(f"{numeric_value:.1f}", trend)

        # æ›´æ–°å›¾è¡¨ - åªæœ‰éé›¶å€¼æ‰æ·»åŠ åˆ°å›¾è¡¨
        for name, value in tuning_metrics.items():
            try:
                # ğŸ”§ ä¿®å¤ï¼šåŒæ ·å¤„ç†å›¾è¡¨æ•°æ®çš„ç±»å‹è½¬æ¢
                if isinstance(value, str):
                    if value.lower() in ['nan', 'none', '', 'null']:
                        numeric_value = 0.0
                    else:
                        numeric_value = float(value)
                else:
                    numeric_value = float(value) if value is not None else 0.0
            except (ValueError, TypeError):
                numeric_value = 0.0
            
            if name in ["è°ƒä¼˜è¿›åº¦", "æ€§èƒ½æå‡", "æœ€ä¼˜è§£è´¨é‡"] and numeric_value > 0:
                self.tuning_chart.add_data_point(name, numeric_value)

        self.tuning_chart.update_chart()

    except Exception as e:
        logger.error(f"æ›´æ–°è‡ªåŠ¨è°ƒä¼˜æ•°æ®å¤±è´¥: {e}")
        import traceback
        logger.error(f"è¯¦ç»†é”™è¯¯ä¿¡æ¯: {traceback.format_exc()}")
```

#### ğŸ¯ ä¿®å¤æ•ˆæœ
- âœ… å¤„ç†å­—ç¬¦ä¸²ç±»å‹çš„è¾“å…¥å€¼
- âœ… å¤„ç† `None`ã€`NaN`ã€ç©ºå­—ç¬¦ä¸²ç­‰ç‰¹æ®Šå€¼
- âœ… æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†
- âœ… ç¡®ä¿å›¾è¡¨æ•°æ®ä¹Ÿè¿›è¡Œç±»å‹è½¬æ¢
- âœ… æä¾›å‹å¥½çš„"æš‚æ— æ•°æ®"æ˜¾ç¤º

### 2. å¥åº·æ£€æŸ¥æ²¡æœ‰ç»“æœé—®é¢˜ä¿®å¤

#### ğŸ” é—®é¢˜åˆ†æ
**å¯èƒ½åŸå› **:
1. `SystemHealthCheckThread` æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸
2. `SystemHealthChecker` çš„æŸäº›æ£€æŸ¥æ–¹æ³•å¤±è´¥
3. ä¾èµ–æ¨¡å—å¯¼å…¥å¤±è´¥
4. é”™è¯¯ä¿¡æ¯æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º

#### âœ… ä¿®å¤æ–¹æ¡ˆ

**1. å¢å¼º SystemHealthCheckThread çš„é”™è¯¯å¤„ç†**
**æ–‡ä»¶**: `gui/widgets/performance/workers/async_workers.py`

```python
def run(self):
    """æ‰§è¡Œå¥åº·æ£€æŸ¥"""
    try:
        logger.info("ğŸ” å¼€å§‹æ‰§è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥...")
        
        # ğŸ”§ ä¿®å¤ï¼šæ·»åŠ è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
        if not self._health_checker:
            error_msg = "å¥åº·æ£€æŸ¥å™¨ä¸ºNoneï¼Œæ— æ³•æ‰§è¡Œæ£€æŸ¥"
            logger.error(error_msg)
            self.health_check_error.emit(error_msg)
            return
        
        logger.info("å¥åº·æ£€æŸ¥å™¨å·²å‡†å¤‡å°±ç»ªï¼Œå¼€å§‹æ‰§è¡Œæ£€æŸ¥...")
        health_report = self._health_checker.run_comprehensive_check()
        
        if health_report:
            logger.info(f"âœ… å¥åº·æ£€æŸ¥å®Œæˆï¼ŒæŠ¥å‘ŠåŒ…å« {len(health_report)} ä¸ªé¡¹ç›®")
            self.health_check_completed.emit(health_report)
        else:
            error_msg = "å¥åº·æ£€æŸ¥è¿”å›äº†ç©ºæŠ¥å‘Š"
            logger.error(error_msg)
            self.health_check_error.emit(error_msg)
            
    except Exception as e:
        import traceback
        error_msg = f"ç³»ç»Ÿå¥åº·æ£€æŸ¥é”™è¯¯: {e}"
        logger.error(error_msg)
        logger.error(f"è¯¦ç»†é”™è¯¯ä¿¡æ¯: {traceback.format_exc()}")
        self.health_check_error.emit(error_msg)
```

**2. å¢å¼º SystemHealthChecker çš„å®‰å…¨æ€§**
**æ–‡ä»¶**: `analysis/system_health_checker.py`

**ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥ä¿®å¤**:
```python
def _check_system_info(self) -> Dict[str, Any]:
    """æ£€æŸ¥ç³»ç»ŸåŸºæœ¬ä¿¡æ¯"""
    try:
        # ğŸ”§ ä¿®å¤ï¼šæ·»åŠ æ›´å®‰å…¨çš„ä¿¡æ¯è·å–
        try:
            info = get_pattern_recognizer_info()
        except Exception as e:
            print(f"âš ï¸ è·å–å½¢æ€è¯†åˆ«å™¨ä¿¡æ¯å¤±è´¥: {e}")
            # ä½¿ç”¨é»˜è®¤ä¿¡æ¯
            info = {
                'version': 'unknown',
                'supported_patterns': 0,
                'performance_optimized': False,
                'cache_enabled': False,
                'monitoring_enabled': True,  # å‡è®¾ç›‘æ§æ˜¯å¯ç”¨çš„
                'database_algorithms': False,
                'ml_predictions': False
            }
        
        return {
            'status': 'healthy',
            'version': info.get('version', 'unknown'),
            'supported_patterns': info.get('supported_patterns', 0),
            'features': {
                'performance_optimized': info.get('performance_optimized', False),
                'cache_enabled': info.get('cache_enabled', False),
                'monitoring_enabled': info.get('monitoring_enabled', False),
                'database_algorithms': info.get('database_algorithms', False),
                'ml_predictions': info.get('ml_predictions', False)
            }
        }
    except Exception as e:
        print(f"âŒ ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥å¤±è´¥: {e}")
        return {
            'status': 'error',
            'error': str(e),
            'details': traceback.format_exc()
        }
```

**å½¢æ€è¯†åˆ«æ£€æŸ¥ä¿®å¤**:
```python
def _check_pattern_recognition(self) -> Dict[str, Any]:
    """æ£€æŸ¥å½¢æ€è¯†åˆ«åŠŸèƒ½"""
    try:
        # ğŸ”§ ä¿®å¤ï¼šæ·»åŠ æ›´å®‰å…¨çš„å½¢æ€è¯†åˆ«æ£€æŸ¥
        print("ğŸ” æ£€æŸ¥å½¢æ€è¯†åˆ«åŠŸèƒ½...")
        
        try:
            # åˆ›å»ºæµ‹è¯•æ•°æ®
            test_data = self._generate_test_kdata()
            print(f"âœ“ æµ‹è¯•æ•°æ®ç”ŸæˆæˆåŠŸï¼Œæ•°æ®é‡: {len(test_data)}")

            # æµ‹è¯•è¯†åˆ«å™¨åˆ›å»º
            recognizer = EnhancedPatternRecognizer(debug_mode=False)
            print("âœ“ å½¢æ€è¯†åˆ«å™¨åˆ›å»ºæˆåŠŸ")

            # æµ‹è¯•å½¢æ€è¯†åˆ«
            start_time = time.time()
            patterns = recognizer.identify_patterns(
                test_data, confidence_threshold=0.1)
            processing_time = time.time() - start_time
            print(f"âœ“ å½¢æ€è¯†åˆ«å®Œæˆï¼Œè¯†åˆ«åˆ° {len(patterns)} ä¸ªå½¢æ€")

            return {
                'status': 'healthy',
                'recognizer_created': True,
                'patterns_detected': len(patterns),
                'processing_time': processing_time,
                'test_data_size': len(test_data),
                'average_confidence': np.mean([p.get('confidence', 0) for p in patterns]) if patterns else 0
            }
        except ImportError as e:
            print(f"âš ï¸ å½¢æ€è¯†åˆ«æ¨¡å—å¯¼å…¥å¤±è´¥: {e}")
            return {
                'status': 'warning',
                'error': f'æ¨¡å—å¯¼å…¥å¤±è´¥: {e}',
                'recognizer_created': False,
                'patterns_detected': 0,
                'processing_time': 0,
                'test_data_size': 0,
                'average_confidence': 0
            }
    except Exception as e:
        print(f"âŒ å½¢æ€è¯†åˆ«æ£€æŸ¥å¤±è´¥: {e}")
        return {
            'status': 'error',
            'error': str(e),
            'details': traceback.format_exc()
        }
```

**3. å¢å¼ºé”™è¯¯æ˜¾ç¤º**
**æ–‡ä»¶**: `gui/widgets/performance/tabs/system_health_tab.py`

```python
@pyqtSlot(str)
def on_check_error(self, error: str):
    """å¥åº·æ£€æŸ¥é”™è¯¯å¤„ç†"""
    self.check_button.setEnabled(True)
    self.check_button.setText("ğŸ” å¼€å§‹å¥åº·æ£€æŸ¥")
    
    # ğŸ”§ ä¿®å¤ï¼šæ›´å¥½çš„é”™è¯¯æ˜¾ç¤ºå’Œæ—¥å¿—
    logger.error(f"å¥åº·æ£€æŸ¥å¤±è´¥: {error}")
    
    # åœ¨æŠ¥å‘ŠåŒºåŸŸæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    error_report = f"""âŒ å¥åº·æ£€æŸ¥å¤±è´¥

é”™è¯¯ä¿¡æ¯: {error}

è¯·æ£€æŸ¥ï¼š
1. ç³»ç»Ÿä¾èµ–æ˜¯å¦å®Œæ•´
2. ç›¸å…³æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. æŸ¥çœ‹æ—¥å¿—è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯

æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""
    self.report_text.setPlainText(error_report)
    
    # æ›´æ–°æ€»ä½“çŠ¶æ€
    self.overall_status_label.setText("æ€»ä½“çŠ¶æ€: æ£€æŸ¥å¤±è´¥")
    self.overall_status_label.setStyleSheet("font-size: 14px; font-weight: bold; color: #e74c3c;")
    
    # ä¹Ÿæ˜¾ç¤ºå¼¹çª—
    QMessageBox.critical(self, "æ£€æŸ¥é”™è¯¯", f"å¥åº·æ£€æŸ¥å¤±è´¥ï¼š{error}")
```

#### ğŸ¯ ä¿®å¤æ•ˆæœ
- âœ… æ·»åŠ è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- âœ… å¤„ç†ä¾èµ–æ¨¡å—å¯¼å…¥å¤±è´¥çš„æƒ…å†µ
- âœ… æä¾›é»˜è®¤å€¼é¿å…æ£€æŸ¥å®Œå…¨å¤±è´¥
- âœ… åœ¨UIä¸­æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- âœ… åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ï¼ˆerror/warningï¼‰

## ğŸ“Š ä¿®å¤æ€»ç»“

### âœ… å·²è§£å†³çš„é—®é¢˜
1. **è‡ªåŠ¨è°ƒä¼˜æ•°æ®æ›´æ–°é”™è¯¯** - å®Œå…¨ä¿®å¤ç±»å‹æ¯”è¾ƒé—®é¢˜
2. **å¥åº·æ£€æŸ¥æ²¡æœ‰ç»“æœ** - å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### ğŸ”§ æŠ€æœ¯æ”¹è¿›
1. **ç±»å‹å®‰å…¨** - æ·»åŠ äº†å…¨é¢çš„ç±»å‹æ£€æŸ¥å’Œè½¬æ¢
2. **é”™è¯¯å¤„ç†** - å¢å¼ºäº†å¼‚å¸¸å¤„ç†å’Œé”™è¯¯åé¦ˆ
3. **æ—¥å¿—è®°å½•** - æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
4. **ç”¨æˆ·ä½“éªŒ** - æä¾›äº†æ›´å‹å¥½çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

### ğŸ“ˆ é¢„æœŸæ•ˆæœ
1. **è‡ªåŠ¨è°ƒä¼˜æ ‡ç­¾é¡µ** - ç°åœ¨å¯ä»¥å¤„ç†ä»»ä½•ç±»å‹çš„è¾“å…¥æ•°æ®
2. **å¥åº·æ£€æŸ¥åŠŸèƒ½** - ç°åœ¨ä¼šæ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹å’Œé”™è¯¯ä¿¡æ¯
3. **ç³»ç»Ÿç¨³å®šæ€§** - å¢å¼ºäº†å®¹é”™èƒ½åŠ›å’Œè°ƒè¯•èƒ½åŠ›

## ğŸš€ ä½¿ç”¨å»ºè®®

1. **æŸ¥çœ‹æ—¥å¿—** - å¦‚æœå¥åº·æ£€æŸ¥ä»æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯
2. **é€æ­¥è°ƒè¯•** - å¥åº·æ£€æŸ¥ç°åœ¨ä¼šæ˜¾ç¤ºæ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæƒ…å†µ
3. **æ•°æ®æ ¼å¼** - è‡ªåŠ¨è°ƒä¼˜åŠŸèƒ½ç°åœ¨å¯ä»¥å¤„ç†å„ç§æ•°æ®æ ¼å¼

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-01-28
**ä¿®å¤çŠ¶æ€**: å·²å®Œæˆï¼Œå»ºè®®ç”¨æˆ·æµ‹è¯•éªŒè¯ 