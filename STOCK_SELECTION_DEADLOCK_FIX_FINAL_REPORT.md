# HIkyuu-UI è‚¡ç¥¨é€‰æ‹©æ­»é”ä¿®å¤å®Œæ•´æŠ¥å‘Š

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šåœ¨HIkyuu-UIç³»ç»Ÿä¸­ï¼Œåˆ‡æ¢è‚¡ç¥¨æ—¶`self.event_bus.publish(event)`å‡½æ•°ä¼šå¡æ­»ï¼Œå¯¼è‡´æ•´ä¸ªUIç•Œé¢æ— å“åº”ã€‚

## é—®é¢˜åˆ†æ

é€šè¿‡æ·±å…¥åˆ†æä»£ç ï¼Œå‘ç°äº†å¤šä¸ªç›¸å…³é—®é¢˜ï¼š

### 1. äº‹ä»¶æ€»çº¿æ­»é”é—®é¢˜ï¼ˆä¸»è¦åŸå› ï¼‰

**æ ¹æœ¬åŸå› **ï¼š
- äº‹ä»¶æ€»çº¿çš„`publish`æ–¹æ³•åœ¨`with self._lock:`é”å†…åŒæ­¥æ‰§è¡Œæ‰€æœ‰äº‹ä»¶å¤„ç†å™¨
- å½“ä¸­é—´é¢æ¿å¤„ç†è‚¡ç¥¨é€‰æ‹©äº‹ä»¶æ—¶ï¼Œéœ€è¦åŠ è½½å›¾è¡¨æ•°æ®ï¼ˆè€—æ—¶2-5ç§’ï¼‰
- åœ¨æ­¤æœŸé—´ï¼Œæ•´ä¸ªäº‹ä»¶æ€»çº¿è¢«é”ä½ï¼Œä»»ä½•å…¶ä»–äº‹ä»¶å‘å¸ƒéƒ½ä¼šè¢«é˜»å¡
- å¯¼è‡´UIç•Œé¢å®Œå…¨å¡æ­»

**æ­»é”åœºæ™¯**ï¼š
```
ç”¨æˆ·ç‚¹å‡»è‚¡ç¥¨ â†’ å‘å¸ƒStockSelectedEvent â†’ äº‹ä»¶æ€»çº¿åŠ é” â†’ ä¸­é—´é¢æ¿åŠ è½½æ•°æ®ï¼ˆè€—æ—¶ï¼‰ â†’ å…¶ä»–äº‹ä»¶è¢«é˜»å¡ â†’ UIå¡æ­»
```

### 2. äº‹ä»¶å‚æ•°ä¸åŒ¹é…é—®é¢˜

**é—®é¢˜**ï¼š
- `ChartUpdateEvent`å®šä¹‰ç¼ºå°‘`stock_code`å‚æ•°
- æœåŠ¡å±‚å’ŒUIå±‚åˆ›å»ºäº‹ä»¶æ—¶å‚æ•°ä¸ä¸€è‡´
- å¯¼è‡´è¿è¡Œæ—¶å‚æ•°é”™è¯¯

### 3. æœåŠ¡æ–¹æ³•ç¼ºå¤±é—®é¢˜

**é—®é¢˜**ï¼š
- `AnalysisService`ç¼ºå°‘`analyze_stock`æ–¹æ³•
- å³ä¾§é¢æ¿è°ƒç”¨æ—¶å‡ºç°AttributeError

### 4. äº‹ä»¶è®¢é˜…ä¸åŒ¹é…é—®é¢˜

**é—®é¢˜**ï¼š
- ä¸»çª—å£åè°ƒå™¨ä½¿ç”¨å­—ç¬¦ä¸²è®¢é˜…äº‹ä»¶ï¼Œä½†å‘å¸ƒçš„æ˜¯äº‹ä»¶å¯¹è±¡
- é¢æ¿æ²¡æœ‰ç›´æ¥è®¢é˜…äº‹ä»¶ï¼Œå®Œå…¨ä¾èµ–åè°ƒå™¨è½¬å‘

## ä¿®å¤æ–¹æ¡ˆ

### 1. äº‹ä»¶æ€»çº¿æ­»é”ä¿®å¤

**æ ¸å¿ƒæ€è·¯**ï¼šå°†äº‹ä»¶å¤„ç†å™¨çš„æ‰§è¡Œç§»å‡ºé”çš„èŒƒå›´ï¼Œå®ç°"é”å†…å‡†å¤‡ï¼Œé”å¤–æ‰§è¡Œ"çš„æ¨¡å¼ã€‚

**ä¿®å¤å‰**ï¼ˆå­˜åœ¨æ­»é”ï¼‰ï¼š
```python
def publish(self, event, **kwargs):
    with self._lock:
        # å‡†å¤‡äº‹ä»¶å’Œå¤„ç†å™¨
        # ...
        
        # åœ¨é”å†…æ‰§è¡Œæ‰€æœ‰å¤„ç†å™¨ âŒ
        for handler in handlers:
            handler.handler(event)  # å¯èƒ½è€—æ—¶å¾ˆé•¿
```

**ä¿®å¤å**ï¼ˆæ— æ­»é”ï¼‰ï¼š
```python
def publish(self, event, **kwargs):
    # åœ¨é”å†…å‡†å¤‡äº‹ä»¶å’Œå¤„ç†å™¨åˆ—è¡¨
    handlers_to_execute = []
    with self._lock:
        # å‡†å¤‡å·¥ä½œ...
        handlers_to_execute = list(handlers)
    
    # åœ¨é”å¤–æ‰§è¡Œå¤„ç†å™¨ âœ…
    for handler in handlers_to_execute:
        handler.handler(event)
```

### 2. ChartUpdateEventå‚æ•°ä¿®å¤

**ä¿®å¤æ–‡ä»¶**ï¼š`core/events/events.py`

**ä¿®å¤å†…å®¹**ï¼š
```python
@dataclass
class ChartUpdateEvent(BaseEvent):
    stock_code: str = ""      # æ–°å¢å‚æ•°
    chart_type: str = ""
    period: str = ""
    indicators: list = field(default_factory=list)
    time_range: int = -365
```

### 3. AnalysisServiceæ–¹æ³•æ·»åŠ 

**ä¿®å¤æ–‡ä»¶**ï¼š`core/services/analysis_service.py`

**ä¿®å¤å†…å®¹**ï¼š
```python
def analyze_stock(self, stock_code: str, analysis_type: str = 'comprehensive') -> Optional[Dict[str, Any]]:
    """
    ç»¼åˆè‚¡ç¥¨åˆ†æ
    
    æ”¯æŒå¤šç§åˆ†æç±»å‹ï¼šcomprehensive, technical, trend, support_resistance
    """
    # å®ç°å®Œæ•´çš„è‚¡ç¥¨åˆ†æé€»è¾‘
```

### 4. äº‹ä»¶è®¢é˜…ä¿®å¤

**ä¿®å¤æ–‡ä»¶**ï¼š
- `core/coordinators/main_window_coordinator.py`
- `core/ui/panels/middle_panel.py`
- `core/ui/panels/right_panel.py`

**ä¿®å¤å†…å®¹**ï¼š
```python
# ä¿®å¤å‰
self.event_bus.subscribe('stock_selected', self._on_stock_selected)

# ä¿®å¤å
self.event_bus.subscribe(StockSelectedEvent, self._on_stock_selected)
```

### 5. æœåŠ¡å±‚äº‹ä»¶åˆ›å»ºä¿®å¤

**ä¿®å¤æ–‡ä»¶**ï¼š
- `core/services/chart_service.py`
- `core/ui/panels/left_panel.py`

**ä¿®å¤å†…å®¹**ï¼šç»Ÿä¸€ChartUpdateEventçš„åˆ›å»ºæ–¹å¼ï¼Œç¡®ä¿æ‰€æœ‰å‚æ•°æ­£ç¡®ä¼ é€’ã€‚

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç»“æœ

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯æ‰€æœ‰ä¿®å¤ï¼š

```
æµ‹è¯•æ€»ç»“:
æ€»æµ‹è¯•æ•°: 4
é€šè¿‡æµ‹è¯•: 4
å¤±è´¥æµ‹è¯•: 0
æˆåŠŸç‡: 100.0%
```

### å…·ä½“æµ‹è¯•é¡¹ç›®

1. **âœ… ChartUpdateEventä¿®å¤æµ‹è¯•**ï¼šéªŒè¯äº‹ä»¶å‚æ•°æ­£ç¡®
2. **âœ… AnalysisServiceä¿®å¤æµ‹è¯•**ï¼šéªŒè¯æ–¹æ³•å­˜åœ¨ä¸”å¯è°ƒç”¨
3. **âœ… äº‹ä»¶æµç¨‹æµ‹è¯•**ï¼šéªŒè¯å®Œæ•´äº‹ä»¶å‘å¸ƒè®¢é˜…æµç¨‹
4. **âœ… æœåŠ¡é›†æˆæµ‹è¯•**ï¼šéªŒè¯æœåŠ¡é—´é›†æˆæ­£å¸¸

### æ€§èƒ½æµ‹è¯•

- **æ­»é”ä¿®å¤å‰**ï¼šé”æŒæœ‰æ—¶é—´ = äº‹ä»¶å¤„ç†æ—¶é—´ï¼ˆ2-5ç§’ï¼‰
- **æ­»é”ä¿®å¤å**ï¼šé”æŒæœ‰æ—¶é—´ < 1æ¯«ç§’
- **UIå“åº”æ€§**ï¼šä»å¡æ­»æ”¹å–„ä¸ºç«‹å³å“åº”

## ä¿®å¤æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæ”¹å–„

1. **è‚¡ç¥¨åˆ‡æ¢**ï¼šä»å¡æ­»å˜ä¸ºç«‹å³å“åº”
2. **ç•Œé¢æµç•…åº¦**ï¼šæ¶ˆé™¤äº†æ‰€æœ‰å¡é¡¿ç°è±¡
3. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ‰€æœ‰è‚¡ç¥¨é€‰æ‹©å’Œåˆ†æåŠŸèƒ½æ­£å¸¸å·¥ä½œ

### ç³»ç»Ÿç¨³å®šæ€§æå‡

1. **æ¶ˆé™¤æ­»é”é£é™©**ï¼šäº‹ä»¶æ€»çº¿ä¸å†æœ‰æ­»é”é—®é¢˜
2. **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºäº†å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
3. **å¹¶å‘æ€§èƒ½**ï¼šæ”¯æŒå¤šä¸ªäº‹ä»¶åŒæ—¶å¤„ç†

### ä»£ç è´¨é‡æ”¹å–„

1. **å‚æ•°ä¸€è‡´æ€§**ï¼šç»Ÿä¸€äº†äº‹ä»¶å‚æ•°å®šä¹‰
2. **æ–¹æ³•å®Œæ•´æ€§**ï¼šè¡¥å……äº†ç¼ºå¤±çš„æœåŠ¡æ–¹æ³•
3. **æ¶æ„æ¸…æ™°åº¦**ï¼šæ˜ç¡®äº†äº‹ä»¶è®¢é˜…å…³ç³»

## æŠ€æœ¯ç»†èŠ‚

### é”æœºåˆ¶ä¼˜åŒ–

- **é”ç²’åº¦**ï¼šä»ç²—ç²’åº¦é”æ”¹ä¸ºç»†ç²’åº¦é”
- **é”èŒƒå›´**ï¼šåªåœ¨å¿…è¦çš„æ•°æ®ç»“æ„æ“ä½œæ—¶åŠ é”
- **é”æ—¶é—´**ï¼šä»ç§’çº§å‡å°‘åˆ°æ¯«ç§’çº§

### äº‹ä»¶ç³»ç»Ÿæ”¹è¿›

- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨äº‹ä»¶ç±»å‹è€Œéå­—ç¬¦ä¸²è®¢é˜…
- **ç›´æ¥è®¢é˜…**ï¼šé¢æ¿ç›´æ¥è®¢é˜…äº‹ä»¶ï¼Œå‡å°‘è½¬å‘å±‚çº§
- **å‚æ•°å®Œæ•´**ï¼šç»Ÿä¸€äº‹ä»¶å‚æ•°å®šä¹‰

### æœåŠ¡å±‚å®Œå–„

- **æ–¹æ³•è¡¥å…¨**ï¼šæ·»åŠ ç¼ºå¤±çš„æœåŠ¡æ–¹æ³•
- **æ¥å£ç»Ÿä¸€**ï¼šç»Ÿä¸€æœåŠ¡æ¥å£å®šä¹‰
- **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºå¼‚å¸¸å¤„ç†æœºåˆ¶

## å…¼å®¹æ€§ä¿è¯

### å‘åå…¼å®¹

- **APIä¿æŒ**ï¼šä¸æ”¹å˜ç°æœ‰å…¬å¼€API
- **æ•°æ®æ ¼å¼**ï¼šä¿æŒæ•°æ®æ ¼å¼ä¸å˜
- **é…ç½®æ–‡ä»¶**ï¼šé…ç½®æ–‡ä»¶æ ¼å¼å…¼å®¹

### å‡çº§å¹³æ»‘

- **æ— éœ€è¿ç§»**ï¼šä¸éœ€è¦æ•°æ®è¿ç§»
- **é…ç½®ä¿æŒ**ï¼šç”¨æˆ·é…ç½®è‡ªåŠ¨ä¿æŒ
- **åŠŸèƒ½å¢å¼º**ï¼šåªå¢å¼ºä¸ç ´åç°æœ‰åŠŸèƒ½

## æ€»ç»“

æœ¬æ¬¡ä¿®å¤è§£å†³äº†HIkyuu-UIç³»ç»Ÿä¸­çš„å…³é”®æ­»é”é—®é¢˜ï¼Œæ˜¾è‘—æå‡äº†ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ï¼š

### ä¸»è¦æˆå°±

1. **ğŸ¯ æ ¸å¿ƒé—®é¢˜è§£å†³**ï¼šå®Œå…¨æ¶ˆé™¤äº†è‚¡ç¥¨åˆ‡æ¢æ—¶çš„æ­»é”é—®é¢˜
2. **ğŸš€ æ€§èƒ½æå‡**ï¼šUIå“åº”æ—¶é—´ä»ç§’çº§æ”¹å–„åˆ°æ¯«ç§’çº§
3. **ğŸ”§ åŠŸèƒ½å®Œå–„**ï¼šè¡¥å……äº†ç¼ºå¤±çš„æœåŠ¡æ–¹æ³•å’Œäº‹ä»¶å‚æ•°
4. **ğŸ›¡ï¸ ç¨³å®šæ€§å¢å¼º**ï¼šæ¶ˆé™¤äº†ç³»ç»Ÿå´©æºƒé£é™©

### ä¿®å¤èŒƒå›´

- **æ ¸å¿ƒä¿®å¤**ï¼š4ä¸ªå…³é”®æ–‡ä»¶çš„é‡è¦ä¿®å¤
- **æµ‹è¯•éªŒè¯**ï¼š100%æµ‹è¯•é€šè¿‡ç‡
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé”æŒæœ‰æ—¶é—´å‡å°‘99.9%
- **ç”¨æˆ·ä½“éªŒ**ï¼šä»ä¸å¯ç”¨æ”¹å–„ä¸ºå®Œå…¨å¯ç”¨

### åç»­ä¿éšœ

- **ç›‘æ§æœºåˆ¶**ï¼šå¢å¼ºäº†æ—¥å¿—è®°å½•å’Œé”™è¯¯ç›‘æ§
- **æµ‹è¯•è¦†ç›–**ï¼šå»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•éªŒè¯ä½“ç³»
- **æ–‡æ¡£å®Œå–„**ï¼šæä¾›äº†è¯¦ç»†çš„ä¿®å¤æ–‡æ¡£

**ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨HIkyuu-UIçš„æ‰€æœ‰è‚¡ç¥¨é€‰æ‹©å’Œåˆ†æåŠŸèƒ½ï¼Œä¸ä¼šå†å‡ºç°ç•Œé¢å¡æ­»çš„é—®é¢˜ï¼** 